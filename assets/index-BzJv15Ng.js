var Ut=Object.defineProperty;var jt=(o,i,t)=>i in o?Ut(o,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[i]=t;var d=(o,i,t)=>jt(o,typeof i!="symbol"?i+"":i,t);import{cf as ft,d0 as Mt,d1 as It,d2 as Zt,aQ as $t,d3 as Jt,d4 as Vt}from"./index-Cdga8aNU.js";/*!
 *  decimal.js v10.5.0
 *  An arbitrary-precision Decimal type for JavaScript.
 *  https://github.com/MikeMcl/decimal.js
 *  Copyright (c) 2025 Michael Mclaughlin <M8ch88l@gmail.com>
 *  MIT Licence
 */var Z=9e15,j=1e9,St="0123456789abcdef",ut="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",dt="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",Ot={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-Z,maxE:Z,crypto:!1},Ht,_,C=!0,pt="[DecimalError] ",U=pt+"Invalid argument: ",Lt=pt+"Precision limit exceeded",Tt=pt+"crypto unavailable",Xt="[object Decimal]",M=Math.floor,D=Math.pow,Kt=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,Qt=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,te=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,Yt=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,T=1e7,x=7,ee=9007199254740991,ie=ut.length-1,Rt=dt.length-1,p={toStringTag:Xt};p.absoluteValue=p.abs=function(){var o=new this.constructor(this);return o.s<0&&(o.s=1),w(o)};p.ceil=function(){return w(new this.constructor(this),this.e+1,2)};p.clampedTo=p.clamp=function(o,i){var t,e=this,s=e.constructor;if(o=new s(o),i=new s(i),!o.s||!i.s)return new s(NaN);if(o.gt(i))throw Error(U+i);return t=e.cmp(o),t<0?o:e.cmp(i)>0?i:new s(e)};p.comparedTo=p.cmp=function(o){var i,t,e,s,n=this,r=n.d,a=(o=new n.constructor(o)).d,l=n.s,h=o.s;if(!r||!a)return!l||!h?NaN:l!==h?l:r===a?0:!r^l<0?1:-1;if(!r[0]||!a[0])return r[0]?l:a[0]?-h:0;if(l!==h)return l;if(n.e!==o.e)return n.e>o.e^l<0?1:-1;for(e=r.length,s=a.length,i=0,t=e<s?e:s;i<t;++i)if(r[i]!==a[i])return r[i]>a[i]^l<0?1:-1;return e===s?0:e>s^l<0?1:-1};p.cosine=p.cos=function(){var o,i,t=this,e=t.constructor;return t.d?t.d[0]?(o=e.precision,i=e.rounding,e.precision=o+Math.max(t.e,t.sd())+x,e.rounding=1,t=se(e,qt(e,t)),e.precision=o,e.rounding=i,w(_==2||_==3?t.neg():t,o,i,!0)):new e(1):new e(NaN)};p.cubeRoot=p.cbrt=function(){var o,i,t,e,s,n,r,a,l,h,c=this,f=c.constructor;if(!c.isFinite()||c.isZero())return new f(c);for(C=!1,n=c.s*D(c.s*c,1/3),!n||Math.abs(n)==1/0?(t=A(c.d),o=c.e,(n=(o-t.length+1)%3)&&(t+=n==1||n==-2?"0":"00"),n=D(t,1/3),o=M((o+1)/3)-(o%3==(o<0?-1:2)),n==1/0?t="5e"+o:(t=n.toExponential(),t=t.slice(0,t.indexOf("e")+1)+o),e=new f(t),e.s=c.s):e=new f(n.toString()),r=(o=f.precision)+3;;)if(a=e,l=a.times(a).times(a),h=l.plus(c),e=R(h.plus(c).times(a),h.plus(l),r+2,1),A(a.d).slice(0,r)===(t=A(e.d)).slice(0,r))if(t=t.slice(r-3,r+1),t=="9999"||!s&&t=="4999"){if(!s&&(w(a,o+1,0),a.times(a).times(a).eq(c))){e=a;break}r+=4,s=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(w(e,o+1,1),i=!e.times(e).times(e).eq(c));break}return C=!0,w(e,o,f.rounding,i)};p.decimalPlaces=p.dp=function(){var o,i=this.d,t=NaN;if(i){if(o=i.length-1,t=(o-M(this.e/x))*x,o=i[o],o)for(;o%10==0;o/=10)t--;t<0&&(t=0)}return t};p.dividedBy=p.div=function(o){return R(this,new this.constructor(o))};p.dividedToIntegerBy=p.divToInt=function(o){var i=this,t=i.constructor;return w(R(i,new t(o),0,1,1),t.precision,t.rounding)};p.equals=p.eq=function(o){return this.cmp(o)===0};p.floor=function(){return w(new this.constructor(this),this.e+1,3)};p.greaterThan=p.gt=function(o){return this.cmp(o)>0};p.greaterThanOrEqualTo=p.gte=function(o){var i=this.cmp(o);return i==1||i===0};p.hyperbolicCosine=p.cosh=function(){var o,i,t,e,s,n=this,r=n.constructor,a=new r(1);if(!n.isFinite())return new r(n.s?1/0:NaN);if(n.isZero())return a;t=r.precision,e=r.rounding,r.precision=t+Math.max(n.e,n.sd())+4,r.rounding=1,s=n.d.length,s<32?(o=Math.ceil(s/3),i=(1/yt(4,o)).toString()):(o=16,i="2.3283064365386962890625e-10"),n=J(r,1,n.times(i),new r(1),!0);for(var l,h=o,c=new r(8);h--;)l=n.times(n),n=a.minus(l.times(c.minus(l.times(c))));return w(n,r.precision=t,r.rounding=e,!0)};p.hyperbolicSine=p.sinh=function(){var o,i,t,e,s=this,n=s.constructor;if(!s.isFinite()||s.isZero())return new n(s);if(i=n.precision,t=n.rounding,n.precision=i+Math.max(s.e,s.sd())+4,n.rounding=1,e=s.d.length,e<3)s=J(n,2,s,s,!0);else{o=1.4*Math.sqrt(e),o=o>16?16:o|0,s=s.times(1/yt(5,o)),s=J(n,2,s,s,!0);for(var r,a=new n(5),l=new n(16),h=new n(20);o--;)r=s.times(s),s=s.times(a.plus(r.times(l.times(r).plus(h))))}return n.precision=i,n.rounding=t,w(s,i,t,!0)};p.hyperbolicTangent=p.tanh=function(){var o,i,t=this,e=t.constructor;return t.isFinite()?t.isZero()?new e(t):(o=e.precision,i=e.rounding,e.precision=o+7,e.rounding=1,R(t.sinh(),t.cosh(),e.precision=o,e.rounding=i)):new e(t.s)};p.inverseCosine=p.acos=function(){var o=this,i=o.constructor,t=o.abs().cmp(1),e=i.precision,s=i.rounding;return t!==-1?t===0?o.isNeg()?X(i,e,s):new i(0):new i(NaN):o.isZero()?X(i,e+4,s).times(.5):(i.precision=e+6,i.rounding=1,o=new i(1).minus(o).div(o.plus(1)).sqrt().atan(),i.precision=e,i.rounding=s,o.times(2))};p.inverseHyperbolicCosine=p.acosh=function(){var o,i,t=this,e=t.constructor;return t.lte(1)?new e(t.eq(1)?0:NaN):t.isFinite()?(o=e.precision,i=e.rounding,e.precision=o+Math.max(Math.abs(t.e),t.sd())+4,e.rounding=1,C=!1,t=t.times(t).minus(1).sqrt().plus(t),C=!0,e.precision=o,e.rounding=i,t.ln()):new e(t)};p.inverseHyperbolicSine=p.asinh=function(){var o,i,t=this,e=t.constructor;return!t.isFinite()||t.isZero()?new e(t):(o=e.precision,i=e.rounding,e.precision=o+2*Math.max(Math.abs(t.e),t.sd())+6,e.rounding=1,C=!1,t=t.times(t).plus(1).sqrt().plus(t),C=!0,e.precision=o,e.rounding=i,t.ln())};p.inverseHyperbolicTangent=p.atanh=function(){var o,i,t,e,s=this,n=s.constructor;return s.isFinite()?s.e>=0?new n(s.abs().eq(1)?s.s/0:s.isZero()?s:NaN):(o=n.precision,i=n.rounding,e=s.sd(),Math.max(e,o)<2*-s.e-1?w(new n(s),o,i,!0):(n.precision=t=e-s.e,s=R(s.plus(1),new n(1).minus(s),t+o,1),n.precision=o+4,n.rounding=1,s=s.ln(),n.precision=o,n.rounding=i,s.times(.5))):new n(NaN)};p.inverseSine=p.asin=function(){var o,i,t,e,s=this,n=s.constructor;return s.isZero()?new n(s):(i=s.abs().cmp(1),t=n.precision,e=n.rounding,i!==-1?i===0?(o=X(n,t+4,e).times(.5),o.s=s.s,o):new n(NaN):(n.precision=t+6,n.rounding=1,s=s.div(new n(1).minus(s.times(s)).sqrt().plus(1)).atan(),n.precision=t,n.rounding=e,s.times(2)))};p.inverseTangent=p.atan=function(){var o,i,t,e,s,n,r,a,l,h=this,c=h.constructor,f=c.precision,u=c.rounding;if(h.isFinite()){if(h.isZero())return new c(h);if(h.abs().eq(1)&&f+4<=Rt)return r=X(c,f+4,u).times(.25),r.s=h.s,r}else{if(!h.s)return new c(NaN);if(f+4<=Rt)return r=X(c,f+4,u).times(.5),r.s=h.s,r}for(c.precision=a=f+10,c.rounding=1,t=Math.min(28,a/x+2|0),o=t;o;--o)h=h.div(h.times(h).plus(1).sqrt().plus(1));for(C=!1,i=Math.ceil(a/x),e=1,l=h.times(h),r=new c(h),s=h;o!==-1;)if(s=s.times(l),n=r.minus(s.div(e+=2)),s=s.times(l),r=n.plus(s.div(e+=2)),r.d[i]!==void 0)for(o=i;r.d[o]===n.d[o]&&o--;);return t&&(r=r.times(2<<t-1)),C=!0,w(r,c.precision=f,c.rounding=u,!0)};p.isFinite=function(){return!!this.d};p.isInteger=p.isInt=function(){return!!this.d&&M(this.e/x)>this.d.length-2};p.isNaN=function(){return!this.s};p.isNegative=p.isNeg=function(){return this.s<0};p.isPositive=p.isPos=function(){return this.s>0};p.isZero=function(){return!!this.d&&this.d[0]===0};p.lessThan=p.lt=function(o){return this.cmp(o)<0};p.lessThanOrEqualTo=p.lte=function(o){return this.cmp(o)<1};p.logarithm=p.log=function(o){var i,t,e,s,n,r,a,l,h=this,c=h.constructor,f=c.precision,u=c.rounding,m=5;if(o==null)o=new c(10),i=!0;else{if(o=new c(o),t=o.d,o.s<0||!t||!t[0]||o.eq(1))return new c(NaN);i=o.eq(10)}if(t=h.d,h.s<0||!t||!t[0]||h.eq(1))return new c(t&&!t[0]?-1/0:h.s!=1?NaN:t?0:1/0);if(i)if(t.length>1)n=!0;else{for(s=t[0];s%10===0;)s/=10;n=s!==1}if(C=!1,a=f+m,r=W(h,a),e=i?mt(c,a+10):W(o,a),l=R(r,e,a,1),et(l.d,s=f,u))do if(a+=10,r=W(h,a),e=i?mt(c,a+10):W(o,a),l=R(r,e,a,1),!n){+A(l.d).slice(s+1,s+15)+1==1e14&&(l=w(l,f+1,0));break}while(et(l.d,s+=10,u));return C=!0,w(l,f,u)};p.minus=p.sub=function(o){var i,t,e,s,n,r,a,l,h,c,f,u,m=this,g=m.constructor;if(o=new g(o),!m.d||!o.d)return!m.s||!o.s?o=new g(NaN):m.d?o.s=-o.s:o=new g(o.d||m.s!==o.s?m:NaN),o;if(m.s!=o.s)return o.s=-o.s,m.plus(o);if(h=m.d,u=o.d,a=g.precision,l=g.rounding,!h[0]||!u[0]){if(u[0])o.s=-o.s;else if(h[0])o=new g(m);else return new g(l===3?-0:0);return C?w(o,a,l):o}if(t=M(o.e/x),c=M(m.e/x),h=h.slice(),n=c-t,n){for(f=n<0,f?(i=h,n=-n,r=u.length):(i=u,t=c,r=h.length),e=Math.max(Math.ceil(a/x),r)+2,n>e&&(n=e,i.length=1),i.reverse(),e=n;e--;)i.push(0);i.reverse()}else{for(e=h.length,r=u.length,f=e<r,f&&(r=e),e=0;e<r;e++)if(h[e]!=u[e]){f=h[e]<u[e];break}n=0}for(f&&(i=h,h=u,u=i,o.s=-o.s),r=h.length,e=u.length-r;e>0;--e)h[r++]=0;for(e=u.length;e>n;){if(h[--e]<u[e]){for(s=e;s&&h[--s]===0;)h[s]=T-1;--h[s],h[e]+=T}h[e]-=u[e]}for(;h[--r]===0;)h.pop();for(;h[0]===0;h.shift())--t;return h[0]?(o.d=h,o.e=gt(h,t),C?w(o,a,l):o):new g(l===3?-0:0)};p.modulo=p.mod=function(o){var i,t=this,e=t.constructor;return o=new e(o),!t.d||!o.s||o.d&&!o.d[0]?new e(NaN):!o.d||t.d&&!t.d[0]?w(new e(t),e.precision,e.rounding):(C=!1,e.modulo==9?(i=R(t,o.abs(),0,3,1),i.s*=o.s):i=R(t,o,0,e.modulo,1),i=i.times(o),C=!0,t.minus(i))};p.naturalExponential=p.exp=function(){return Nt(this)};p.naturalLogarithm=p.ln=function(){return W(this)};p.negated=p.neg=function(){var o=new this.constructor(this);return o.s=-o.s,w(o)};p.plus=p.add=function(o){var i,t,e,s,n,r,a,l,h,c,f=this,u=f.constructor;if(o=new u(o),!f.d||!o.d)return!f.s||!o.s?o=new u(NaN):f.d||(o=new u(o.d||f.s===o.s?f:NaN)),o;if(f.s!=o.s)return o.s=-o.s,f.minus(o);if(h=f.d,c=o.d,a=u.precision,l=u.rounding,!h[0]||!c[0])return c[0]||(o=new u(f)),C?w(o,a,l):o;if(n=M(f.e/x),e=M(o.e/x),h=h.slice(),s=n-e,s){for(s<0?(t=h,s=-s,r=c.length):(t=c,e=n,r=h.length),n=Math.ceil(a/x),r=n>r?n+1:r+1,s>r&&(s=r,t.length=1),t.reverse();s--;)t.push(0);t.reverse()}for(r=h.length,s=c.length,r-s<0&&(s=r,t=c,c=h,h=t),i=0;s;)i=(h[--s]=h[s]+c[s]+i)/T|0,h[s]%=T;for(i&&(h.unshift(i),++e),r=h.length;h[--r]==0;)h.pop();return o.d=h,o.e=gt(h,e),C?w(o,a,l):o};p.precision=p.sd=function(o){var i,t=this;if(o!==void 0&&o!==!!o&&o!==1&&o!==0)throw Error(U+o);return t.d?(i=Gt(t.d),o&&t.e+1>i&&(i=t.e+1)):i=NaN,i};p.round=function(){var o=this,i=o.constructor;return w(new i(o),o.e+1,i.rounding)};p.sine=p.sin=function(){var o,i,t=this,e=t.constructor;return t.isFinite()?t.isZero()?new e(t):(o=e.precision,i=e.rounding,e.precision=o+Math.max(t.e,t.sd())+x,e.rounding=1,t=oe(e,qt(e,t)),e.precision=o,e.rounding=i,w(_>2?t.neg():t,o,i,!0)):new e(NaN)};p.squareRoot=p.sqrt=function(){var o,i,t,e,s,n,r=this,a=r.d,l=r.e,h=r.s,c=r.constructor;if(h!==1||!a||!a[0])return new c(!h||h<0&&(!a||a[0])?NaN:a?r:1/0);for(C=!1,h=Math.sqrt(+r),h==0||h==1/0?(i=A(a),(i.length+l)%2==0&&(i+="0"),h=Math.sqrt(i),l=M((l+1)/2)-(l<0||l%2),h==1/0?i="5e"+l:(i=h.toExponential(),i=i.slice(0,i.indexOf("e")+1)+l),e=new c(i)):e=new c(h.toString()),t=(l=c.precision)+3;;)if(n=e,e=n.plus(R(r,n,t+2,1)).times(.5),A(n.d).slice(0,t)===(i=A(e.d)).slice(0,t))if(i=i.slice(t-3,t+1),i=="9999"||!s&&i=="4999"){if(!s&&(w(n,l+1,0),n.times(n).eq(r))){e=n;break}t+=4,s=1}else{(!+i||!+i.slice(1)&&i.charAt(0)=="5")&&(w(e,l+1,1),o=!e.times(e).eq(r));break}return C=!0,w(e,l,c.rounding,o)};p.tangent=p.tan=function(){var o,i,t=this,e=t.constructor;return t.isFinite()?t.isZero()?new e(t):(o=e.precision,i=e.rounding,e.precision=o+10,e.rounding=1,t=t.sin(),t.s=1,t=R(t,new e(1).minus(t.times(t)).sqrt(),o+10,0),e.precision=o,e.rounding=i,w(_==2||_==4?t.neg():t,o,i,!0)):new e(NaN)};p.times=p.mul=function(o){var i,t,e,s,n,r,a,l,h,c=this,f=c.constructor,u=c.d,m=(o=new f(o)).d;if(o.s*=c.s,!u||!u[0]||!m||!m[0])return new f(!o.s||u&&!u[0]&&!m||m&&!m[0]&&!u?NaN:!u||!m?o.s/0:o.s*0);for(t=M(c.e/x)+M(o.e/x),l=u.length,h=m.length,l<h&&(n=u,u=m,m=n,r=l,l=h,h=r),n=[],r=l+h,e=r;e--;)n.push(0);for(e=h;--e>=0;){for(i=0,s=l+e;s>e;)a=n[s]+m[e]*u[s-e-1]+i,n[s--]=a%T|0,i=a/T|0;n[s]=(n[s]+i)%T|0}for(;!n[--r];)n.pop();return i?++t:n.shift(),o.d=n,o.e=gt(n,t),C?w(o,f.precision,f.rounding):o};p.toBinary=function(o,i){return kt(this,2,o,i)};p.toDecimalPlaces=p.toDP=function(o,i){var t=this,e=t.constructor;return t=new e(t),o===void 0?t:(I(o,0,j),i===void 0?i=e.rounding:I(i,0,8),w(t,o+t.e+1,i))};p.toExponential=function(o,i){var t,e=this,s=e.constructor;return o===void 0?t=Y(e,!0):(I(o,0,j),i===void 0?i=s.rounding:I(i,0,8),e=w(new s(e),o+1,i),t=Y(e,!0,o+1)),e.isNeg()&&!e.isZero()?"-"+t:t};p.toFixed=function(o,i){var t,e,s=this,n=s.constructor;return o===void 0?t=Y(s):(I(o,0,j),i===void 0?i=n.rounding:I(i,0,8),e=w(new n(s),o+s.e+1,i),t=Y(e,!1,o+e.e+1)),s.isNeg()&&!s.isZero()?"-"+t:t};p.toFraction=function(o){var i,t,e,s,n,r,a,l,h,c,f,u,m=this,g=m.d,y=m.constructor;if(!g)return new y(m);if(h=t=new y(1),e=l=new y(0),i=new y(e),n=i.e=Gt(g)-m.e-1,r=n%x,i.d[0]=D(10,r<0?x+r:r),o==null)o=n>0?i:h;else{if(a=new y(o),!a.isInt()||a.lt(h))throw Error(U+a);o=a.gt(i)?n>0?i:h:a}for(C=!1,a=new y(A(g)),c=y.precision,y.precision=n=g.length*x*2;f=R(a,i,0,1,1),s=t.plus(f.times(e)),s.cmp(o)!=1;)t=e,e=s,s=h,h=l.plus(f.times(s)),l=s,s=i,i=a.minus(f.times(s)),a=s;return s=R(o.minus(t),e,0,1,1),l=l.plus(s.times(h)),t=t.plus(s.times(e)),l.s=h.s=m.s,u=R(h,e,n,1).minus(m).abs().cmp(R(l,t,n,1).minus(m).abs())<1?[h,e]:[l,t],y.precision=c,C=!0,u};p.toHexadecimal=p.toHex=function(o,i){return kt(this,16,o,i)};p.toNearest=function(o,i){var t=this,e=t.constructor;if(t=new e(t),o==null){if(!t.d)return t;o=new e(1),i=e.rounding}else{if(o=new e(o),i===void 0?i=e.rounding:I(i,0,8),!t.d)return o.s?t:o;if(!o.d)return o.s&&(o.s=t.s),o}return o.d[0]?(C=!1,t=R(t,o,0,i,1).times(o),C=!0,w(t)):(o.s=t.s,t=o),t};p.toNumber=function(){return+this};p.toOctal=function(o,i){return kt(this,8,o,i)};p.toPower=p.pow=function(o){var i,t,e,s,n,r,a=this,l=a.constructor,h=+(o=new l(o));if(!a.d||!o.d||!a.d[0]||!o.d[0])return new l(D(+a,h));if(a=new l(a),a.eq(1))return a;if(e=l.precision,n=l.rounding,o.eq(1))return w(a,e,n);if(i=M(o.e/x),i>=o.d.length-1&&(t=h<0?-h:h)<=ee)return s=Bt(l,a,t,e),o.s<0?new l(1).div(s):w(s,e,n);if(r=a.s,r<0){if(i<o.d.length-1)return new l(NaN);if(o.d[i]&1||(r=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=r,a}return t=D(+a,h),i=t==0||!isFinite(t)?M(h*(Math.log("0."+A(a.d))/Math.LN10+a.e+1)):new l(t+"").e,i>l.maxE+1||i<l.minE-1?new l(i>0?r/0:0):(C=!1,l.rounding=a.s=1,t=Math.min(12,(i+"").length),s=Nt(o.times(W(a,e+t)),e),s.d&&(s=w(s,e+5,1),et(s.d,e,n)&&(i=e+10,s=w(Nt(o.times(W(a,i+t)),i),i+5,1),+A(s.d).slice(e+1,e+15)+1==1e14&&(s=w(s,e+1,0)))),s.s=r,C=!0,l.rounding=n,w(s,e,n))};p.toPrecision=function(o,i){var t,e=this,s=e.constructor;return o===void 0?t=Y(e,e.e<=s.toExpNeg||e.e>=s.toExpPos):(I(o,1,j),i===void 0?i=s.rounding:I(i,0,8),e=w(new s(e),o,i),t=Y(e,o<=e.e||e.e<=s.toExpNeg,o)),e.isNeg()&&!e.isZero()?"-"+t:t};p.toSignificantDigits=p.toSD=function(o,i){var t=this,e=t.constructor;return o===void 0?(o=e.precision,i=e.rounding):(I(o,1,j),i===void 0?i=e.rounding:I(i,0,8)),w(new e(t),o,i)};p.toString=function(){var o=this,i=o.constructor,t=Y(o,o.e<=i.toExpNeg||o.e>=i.toExpPos);return o.isNeg()&&!o.isZero()?"-"+t:t};p.truncated=p.trunc=function(){return w(new this.constructor(this),this.e+1,1)};p.valueOf=p.toJSON=function(){var o=this,i=o.constructor,t=Y(o,o.e<=i.toExpNeg||o.e>=i.toExpPos);return o.isNeg()?"-"+t:t};function A(o){var i,t,e,s=o.length-1,n="",r=o[0];if(s>0){for(n+=r,i=1;i<s;i++)e=o[i]+"",t=x-e.length,t&&(n+=F(t)),n+=e;r=o[i],e=r+"",t=x-e.length,t&&(n+=F(t))}else if(r===0)return"0";for(;r%10===0;)r/=10;return n+r}function I(o,i,t){if(o!==~~o||o<i||o>t)throw Error(U+o)}function et(o,i,t,e){var s,n,r,a;for(n=o[0];n>=10;n/=10)--i;return--i<0?(i+=x,s=0):(s=Math.ceil((i+1)/x),i%=x),n=D(10,x-i),a=o[s]%n|0,e==null?i<3?(i==0?a=a/100|0:i==1&&(a=a/10|0),r=t<4&&a==99999||t>3&&a==49999||a==5e4||a==0):r=(t<4&&a+1==n||t>3&&a+1==n/2)&&(o[s+1]/n/100|0)==D(10,i-2)-1||(a==n/2||a==0)&&(o[s+1]/n/100|0)==0:i<4?(i==0?a=a/1e3|0:i==1?a=a/100|0:i==2&&(a=a/10|0),r=(e||t<4)&&a==9999||!e&&t>3&&a==4999):r=((e||t<4)&&a+1==n||!e&&t>3&&a+1==n/2)&&(o[s+1]/n/1e3|0)==D(10,i-3)-1,r}function ot(o,i,t){for(var e,s=[0],n,r=0,a=o.length;r<a;){for(n=s.length;n--;)s[n]*=i;for(s[0]+=St.indexOf(o.charAt(r++)),e=0;e<s.length;e++)s[e]>t-1&&(s[e+1]===void 0&&(s[e+1]=0),s[e+1]+=s[e]/t|0,s[e]%=t)}return s.reverse()}function se(o,i){var t,e,s;if(i.isZero())return i;e=i.d.length,e<32?(t=Math.ceil(e/3),s=(1/yt(4,t)).toString()):(t=16,s="2.3283064365386962890625e-10"),o.precision+=t,i=J(o,1,i.times(s),new o(1));for(var n=t;n--;){var r=i.times(i);i=r.times(r).minus(r).times(8).plus(1)}return o.precision-=t,i}var R=function(){function o(e,s,n){var r,a=0,l=e.length;for(e=e.slice();l--;)r=e[l]*s+a,e[l]=r%n|0,a=r/n|0;return a&&e.unshift(a),e}function i(e,s,n,r){var a,l;if(n!=r)l=n>r?1:-1;else for(a=l=0;a<n;a++)if(e[a]!=s[a]){l=e[a]>s[a]?1:-1;break}return l}function t(e,s,n,r){for(var a=0;n--;)e[n]-=a,a=e[n]<s[n]?1:0,e[n]=a*r+e[n]-s[n];for(;!e[0]&&e.length>1;)e.shift()}return function(e,s,n,r,a,l){var h,c,f,u,m,g,y,v,P,O,S,k,K,G,wt,it,Q,xt,H,st,nt=e.constructor,Pt=e.s==s.s?1:-1,E=e.d,N=s.d;if(!E||!E[0]||!N||!N[0])return new nt(!e.s||!s.s||(E?N&&E[0]==N[0]:!N)?NaN:E&&E[0]==0||!N?Pt*0:Pt/0);for(l?(m=1,c=e.e-s.e):(l=T,m=x,c=M(e.e/m)-M(s.e/m)),H=N.length,Q=E.length,P=new nt(Pt),O=P.d=[],f=0;N[f]==(E[f]||0);f++);if(N[f]>(E[f]||0)&&c--,n==null?(G=n=nt.precision,r=nt.rounding):a?G=n+(e.e-s.e)+1:G=n,G<0)O.push(1),g=!0;else{if(G=G/m+2|0,f=0,H==1){for(u=0,N=N[0],G++;(f<Q||u)&&G--;f++)wt=u*l+(E[f]||0),O[f]=wt/N|0,u=wt%N|0;g=u||f<Q}else{for(u=l/(N[0]+1)|0,u>1&&(N=o(N,u,l),E=o(E,u,l),H=N.length,Q=E.length),it=H,S=E.slice(0,H),k=S.length;k<H;)S[k++]=0;st=N.slice(),st.unshift(0),xt=N[0],N[1]>=l/2&&++xt;do u=0,h=i(N,S,H,k),h<0?(K=S[0],H!=k&&(K=K*l+(S[1]||0)),u=K/xt|0,u>1?(u>=l&&(u=l-1),y=o(N,u,l),v=y.length,k=S.length,h=i(y,S,v,k),h==1&&(u--,t(y,H<v?st:N,v,l))):(u==0&&(h=u=1),y=N.slice()),v=y.length,v<k&&y.unshift(0),t(S,y,k,l),h==-1&&(k=S.length,h=i(N,S,H,k),h<1&&(u++,t(S,H<k?st:N,k,l))),k=S.length):h===0&&(u++,S=[0]),O[f++]=u,h&&S[0]?S[k++]=E[it]||0:(S=[E[it]],k=1);while((it++<Q||S[0]!==void 0)&&G--);g=S[0]!==void 0}O[0]||O.shift()}if(m==1)P.e=c,Ht=g;else{for(f=1,u=O[0];u>=10;u/=10)f++;P.e=f+c*m-1,w(P,a?n+P.e+1:n,r,g)}return P}}();function w(o,i,t,e){var s,n,r,a,l,h,c,f,u,m=o.constructor;t:if(i!=null){if(f=o.d,!f)return o;for(s=1,a=f[0];a>=10;a/=10)s++;if(n=i-s,n<0)n+=x,r=i,c=f[u=0],l=c/D(10,s-r-1)%10|0;else if(u=Math.ceil((n+1)/x),a=f.length,u>=a)if(e){for(;a++<=u;)f.push(0);c=l=0,s=1,n%=x,r=n-x+1}else break t;else{for(c=a=f[u],s=1;a>=10;a/=10)s++;n%=x,r=n-x+s,l=r<0?0:c/D(10,s-r-1)%10|0}if(e=e||i<0||f[u+1]!==void 0||(r<0?c:c%D(10,s-r-1)),h=t<4?(l||e)&&(t==0||t==(o.s<0?3:2)):l>5||l==5&&(t==4||e||t==6&&(n>0?r>0?c/D(10,s-r):0:f[u-1])%10&1||t==(o.s<0?8:7)),i<1||!f[0])return f.length=0,h?(i-=o.e+1,f[0]=D(10,(x-i%x)%x),o.e=-i||0):f[0]=o.e=0,o;if(n==0?(f.length=u,a=1,u--):(f.length=u+1,a=D(10,x-n),f[u]=r>0?(c/D(10,s-r)%D(10,r)|0)*a:0),h)for(;;)if(u==0){for(n=1,r=f[0];r>=10;r/=10)n++;for(r=f[0]+=a,a=1;r>=10;r/=10)a++;n!=a&&(o.e++,f[0]==T&&(f[0]=1));break}else{if(f[u]+=a,f[u]!=T)break;f[u--]=0,a=1}for(n=f.length;f[--n]===0;)f.pop()}return C&&(o.e>m.maxE?(o.d=null,o.e=NaN):o.e<m.minE&&(o.e=0,o.d=[0])),o}function Y(o,i,t){if(!o.isFinite())return _t(o);var e,s=o.e,n=A(o.d),r=n.length;return i?(t&&(e=t-r)>0?n=n.charAt(0)+"."+n.slice(1)+F(e):r>1&&(n=n.charAt(0)+"."+n.slice(1)),n=n+(o.e<0?"e":"e+")+o.e):s<0?(n="0."+F(-s-1)+n,t&&(e=t-r)>0&&(n+=F(e))):s>=r?(n+=F(s+1-r),t&&(e=t-s-1)>0&&(n=n+"."+F(e))):((e=s+1)<r&&(n=n.slice(0,e)+"."+n.slice(e)),t&&(e=t-r)>0&&(s+1===r&&(n+="."),n+=F(e))),n}function gt(o,i){var t=o[0];for(i*=x;t>=10;t/=10)i++;return i}function mt(o,i,t){if(i>ie)throw C=!0,t&&(o.precision=t),Error(Lt);return w(new o(ut),i,1,!0)}function X(o,i,t){if(i>Rt)throw Error(Lt);return w(new o(dt),i,t,!0)}function Gt(o){var i=o.length-1,t=i*x+1;if(i=o[i],i){for(;i%10==0;i/=10)t--;for(i=o[0];i>=10;i/=10)t++}return t}function F(o){for(var i="";o--;)i+="0";return i}function Bt(o,i,t,e){var s,n=new o(1),r=Math.ceil(e/x+4);for(C=!1;;){if(t%2&&(n=n.times(i),bt(n.d,r)&&(s=!0)),t=M(t/2),t===0){t=n.d.length-1,s&&n.d[t]===0&&++n.d[t];break}i=i.times(i),bt(i.d,r)}return C=!0,n}function Dt(o){return o.d[o.d.length-1]&1}function zt(o,i,t){for(var e,s,n=new o(i[0]),r=0;++r<i.length;){if(s=new o(i[r]),!s.s){n=s;break}e=n.cmp(s),(e===t||e===0&&n.s===t)&&(n=s)}return n}function Nt(o,i){var t,e,s,n,r,a,l,h=0,c=0,f=0,u=o.constructor,m=u.rounding,g=u.precision;if(!o.d||!o.d[0]||o.e>17)return new u(o.d?o.d[0]?o.s<0?0:1/0:1:o.s?o.s<0?0:o:NaN);for(i==null?(C=!1,l=g):l=i,a=new u(.03125);o.e>-2;)o=o.times(a),f+=5;for(e=Math.log(D(2,f))/Math.LN10*2+5|0,l+=e,t=n=r=new u(1),u.precision=l;;){if(n=w(n.times(o),l,1),t=t.times(++c),a=r.plus(R(n,t,l,1)),A(a.d).slice(0,l)===A(r.d).slice(0,l)){for(s=f;s--;)r=w(r.times(r),l,1);if(i==null)if(h<3&&et(r.d,l-e,m,h))u.precision=l+=10,t=n=a=new u(1),c=0,h++;else return w(r,u.precision=g,m,C=!0);else return u.precision=g,r}r=a}}function W(o,i){var t,e,s,n,r,a,l,h,c,f,u,m=1,g=10,y=o,v=y.d,P=y.constructor,O=P.rounding,S=P.precision;if(y.s<0||!v||!v[0]||!y.e&&v[0]==1&&v.length==1)return new P(v&&!v[0]?-1/0:y.s!=1?NaN:v?0:y);if(i==null?(C=!1,c=S):c=i,P.precision=c+=g,t=A(v),e=t.charAt(0),Math.abs(n=y.e)<15e14){for(;e<7&&e!=1||e==1&&t.charAt(1)>3;)y=y.times(o),t=A(y.d),e=t.charAt(0),m++;n=y.e,e>1?(y=new P("0."+t),n++):y=new P(e+"."+t.slice(1))}else return h=mt(P,c+2,S).times(n+""),y=W(new P(e+"."+t.slice(1)),c-g).plus(h),P.precision=S,i==null?w(y,S,O,C=!0):y;for(f=y,l=r=y=R(y.minus(1),y.plus(1),c,1),u=w(y.times(y),c,1),s=3;;){if(r=w(r.times(u),c,1),h=l.plus(R(r,new P(s),c,1)),A(h.d).slice(0,c)===A(l.d).slice(0,c))if(l=l.times(2),n!==0&&(l=l.plus(mt(P,c+2,S).times(n+""))),l=R(l,new P(m),c,1),i==null)if(et(l.d,c-g,O,a))P.precision=c+=g,h=r=y=R(f.minus(1),f.plus(1),c,1),u=w(y.times(y),c,1),s=a=1;else return w(l,P.precision=S,O,C=!0);else return P.precision=S,l;l=h,s+=2}}function _t(o){return String(o.s*o.s/0)}function rt(o,i){var t,e,s;for((t=i.indexOf("."))>-1&&(i=i.replace(".","")),(e=i.search(/e/i))>0?(t<0&&(t=e),t+=+i.slice(e+1),i=i.substring(0,e)):t<0&&(t=i.length),e=0;i.charCodeAt(e)===48;e++);for(s=i.length;i.charCodeAt(s-1)===48;--s);if(i=i.slice(e,s),i){if(s-=e,o.e=t=t-e-1,o.d=[],e=(t+1)%x,t<0&&(e+=x),e<s){for(e&&o.d.push(+i.slice(0,e)),s-=x;e<s;)o.d.push(+i.slice(e,e+=x));i=i.slice(e),e=x-i.length}else e-=s;for(;e--;)i+="0";o.d.push(+i),C&&(o.e>o.constructor.maxE?(o.d=null,o.e=NaN):o.e<o.constructor.minE&&(o.e=0,o.d=[0]))}else o.e=0,o.d=[0];return o}function ne(o,i){var t,e,s,n,r,a,l,h,c;if(i.indexOf("_")>-1){if(i=i.replace(/(\d)_(?=\d)/g,"$1"),Yt.test(i))return rt(o,i)}else if(i==="Infinity"||i==="NaN")return+i||(o.s=NaN),o.e=NaN,o.d=null,o;if(Qt.test(i))t=16,i=i.toLowerCase();else if(Kt.test(i))t=2;else if(te.test(i))t=8;else throw Error(U+i);for(n=i.search(/p/i),n>0?(l=+i.slice(n+1),i=i.substring(2,n)):i=i.slice(2),n=i.indexOf("."),r=n>=0,e=o.constructor,r&&(i=i.replace(".",""),a=i.length,n=a-n,s=Bt(e,new e(t),n,n*2)),h=ot(i,t,T),c=h.length-1,n=c;h[n]===0;--n)h.pop();return n<0?new e(o.s*0):(o.e=gt(h,c),o.d=h,C=!1,r&&(o=R(o,s,a*4)),l&&(o=o.times(Math.abs(l)<54?D(2,l):V.pow(2,l))),C=!0,o)}function oe(o,i){var t,e=i.d.length;if(e<3)return i.isZero()?i:J(o,2,i,i);t=1.4*Math.sqrt(e),t=t>16?16:t|0,i=i.times(1/yt(5,t)),i=J(o,2,i,i);for(var s,n=new o(5),r=new o(16),a=new o(20);t--;)s=i.times(i),i=i.times(n.plus(s.times(r.times(s).minus(a))));return i}function J(o,i,t,e,s){var n,r,a,l,h=o.precision,c=Math.ceil(h/x);for(C=!1,l=t.times(t),a=new o(e);;){if(r=R(a.times(l),new o(i++*i++),h,1),a=s?e.plus(r):e.minus(r),e=R(r.times(l),new o(i++*i++),h,1),r=a.plus(e),r.d[c]!==void 0){for(n=c;r.d[n]===a.d[n]&&n--;);if(n==-1)break}n=a,a=e,e=r,r=n}return C=!0,r.d.length=c+1,r}function yt(o,i){for(var t=o;--i;)t*=o;return t}function qt(o,i){var t,e=i.s<0,s=X(o,o.precision,1),n=s.times(.5);if(i=i.abs(),i.lte(n))return _=e?4:1,i;if(t=i.divToInt(s),t.isZero())_=e?3:2;else{if(i=i.minus(t.times(s)),i.lte(n))return _=Dt(t)?e?2:3:e?4:1,i;_=Dt(t)?e?1:4:e?3:2}return i.minus(s).abs()}function kt(o,i,t,e){var s,n,r,a,l,h,c,f,u,m=o.constructor,g=t!==void 0;if(g?(I(t,1,j),e===void 0?e=m.rounding:I(e,0,8)):(t=m.precision,e=m.rounding),!o.isFinite())c=_t(o);else{for(c=Y(o),r=c.indexOf("."),g?(s=2,i==16?t=t*4-3:i==8&&(t=t*3-2)):s=i,r>=0&&(c=c.replace(".",""),u=new m(1),u.e=c.length-r,u.d=ot(Y(u),10,s),u.e=u.d.length),f=ot(c,10,s),n=l=f.length;f[--l]==0;)f.pop();if(!f[0])c=g?"0p+0":"0";else{if(r<0?n--:(o=new m(o),o.d=f,o.e=n,o=R(o,u,t,e,0,s),f=o.d,n=o.e,h=Ht),r=f[t],a=s/2,h=h||f[t+1]!==void 0,h=e<4?(r!==void 0||h)&&(e===0||e===(o.s<0?3:2)):r>a||r===a&&(e===4||h||e===6&&f[t-1]&1||e===(o.s<0?8:7)),f.length=t,h)for(;++f[--t]>s-1;)f[t]=0,t||(++n,f.unshift(1));for(l=f.length;!f[l-1];--l);for(r=0,c="";r<l;r++)c+=St.charAt(f[r]);if(g){if(l>1)if(i==16||i==8){for(r=i==16?4:3,--l;l%r;l++)c+="0";for(f=ot(c,s,i),l=f.length;!f[l-1];--l);for(r=1,c="1.";r<l;r++)c+=St.charAt(f[r])}else c=c.charAt(0)+"."+c.slice(1);c=c+(n<0?"p":"p+")+n}else if(n<0){for(;++n;)c="0"+c;c="0."+c}else if(++n>l)for(n-=l;n--;)c+="0";else n<l&&(c=c.slice(0,n)+"."+c.slice(n))}c=(i==16?"0x":i==2?"0b":i==8?"0o":"")+c}return o.s<0?"-"+c:c}function bt(o,i){if(o.length>i)return o.length=i,!0}function re(o){return new this(o).abs()}function ae(o){return new this(o).acos()}function le(o){return new this(o).acosh()}function he(o,i){return new this(o).plus(i)}function ce(o){return new this(o).asin()}function fe(o){return new this(o).asinh()}function ue(o){return new this(o).atan()}function de(o){return new this(o).atanh()}function me(o,i){o=new this(o),i=new this(i);var t,e=this.precision,s=this.rounding,n=e+4;return!o.s||!i.s?t=new this(NaN):!o.d&&!i.d?(t=X(this,n,1).times(i.s>0?.25:.75),t.s=o.s):!i.d||o.isZero()?(t=i.s<0?X(this,e,s):new this(0),t.s=o.s):!o.d||i.isZero()?(t=X(this,n,1).times(.5),t.s=o.s):i.s<0?(this.precision=n,this.rounding=1,t=this.atan(R(o,i,n,1)),i=X(this,n,1),this.precision=e,this.rounding=s,t=o.s<0?t.minus(i):t.plus(i)):t=this.atan(R(o,i,n,1)),t}function pe(o){return new this(o).cbrt()}function ge(o){return w(o=new this(o),o.e+1,2)}function ye(o,i,t){return new this(o).clamp(i,t)}function ve(o){if(!o||typeof o!="object")throw Error(pt+"Object expected");var i,t,e,s=o.defaults===!0,n=["precision",1,j,"rounding",0,8,"toExpNeg",-Z,0,"toExpPos",0,Z,"maxE",0,Z,"minE",-Z,0,"modulo",0,9];for(i=0;i<n.length;i+=3)if(t=n[i],s&&(this[t]=Ot[t]),(e=o[t])!==void 0)if(M(e)===e&&e>=n[i+1]&&e<=n[i+2])this[t]=e;else throw Error(U+t+": "+e);if(t="crypto",s&&(this[t]=Ot[t]),(e=o[t])!==void 0)if(e===!0||e===!1||e===0||e===1)if(e)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(Tt);else this[t]=!1;else throw Error(U+t+": "+e);return this}function we(o){return new this(o).cos()}function xe(o){return new this(o).cosh()}function Ft(o){var i,t,e;function s(n){var r,a,l,h=this;if(!(h instanceof s))return new s(n);if(h.constructor=s,At(n)){h.s=n.s,C?!n.d||n.e>s.maxE?(h.e=NaN,h.d=null):n.e<s.minE?(h.e=0,h.d=[0]):(h.e=n.e,h.d=n.d.slice()):(h.e=n.e,h.d=n.d?n.d.slice():n.d);return}if(l=typeof n,l==="number"){if(n===0){h.s=1/n<0?-1:1,h.e=0,h.d=[0];return}if(n<0?(n=-n,h.s=-1):h.s=1,n===~~n&&n<1e7){for(r=0,a=n;a>=10;a/=10)r++;C?r>s.maxE?(h.e=NaN,h.d=null):r<s.minE?(h.e=0,h.d=[0]):(h.e=r,h.d=[n]):(h.e=r,h.d=[n]);return}if(n*0!==0){n||(h.s=NaN),h.e=NaN,h.d=null;return}return rt(h,n.toString())}if(l==="string")return(a=n.charCodeAt(0))===45?(n=n.slice(1),h.s=-1):(a===43&&(n=n.slice(1)),h.s=1),Yt.test(n)?rt(h,n):ne(h,n);if(l==="bigint")return n<0?(n=-n,h.s=-1):h.s=1,rt(h,n.toString());throw Error(U+n)}if(s.prototype=p,s.ROUND_UP=0,s.ROUND_DOWN=1,s.ROUND_CEIL=2,s.ROUND_FLOOR=3,s.ROUND_HALF_UP=4,s.ROUND_HALF_DOWN=5,s.ROUND_HALF_EVEN=6,s.ROUND_HALF_CEIL=7,s.ROUND_HALF_FLOOR=8,s.EUCLID=9,s.config=s.set=ve,s.clone=Ft,s.isDecimal=At,s.abs=re,s.acos=ae,s.acosh=le,s.add=he,s.asin=ce,s.asinh=fe,s.atan=ue,s.atanh=de,s.atan2=me,s.cbrt=pe,s.ceil=ge,s.clamp=ye,s.cos=we,s.cosh=xe,s.div=Pe,s.exp=Ce,s.floor=Se,s.hypot=Oe,s.ln=Re,s.log=Ne,s.log10=Ve,s.log2=ke,s.max=De,s.min=be,s.mod=Ae,s.mul=Ee,s.pow=Me,s.random=Ie,s.round=He,s.sign=Le,s.sin=Te,s.sinh=Xe,s.sqrt=Ye,s.sub=Ge,s.sum=Be,s.tan=ze,s.tanh=_e,s.trunc=qe,o===void 0&&(o={}),o&&o.defaults!==!0)for(e=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],i=0;i<e.length;)o.hasOwnProperty(t=e[i++])||(o[t]=this[t]);return s.config(o),s}function Pe(o,i){return new this(o).div(i)}function Ce(o){return new this(o).exp()}function Se(o){return w(o=new this(o),o.e+1,3)}function Oe(){var o,i,t=new this(0);for(C=!1,o=0;o<arguments.length;)if(i=new this(arguments[o++]),i.d)t.d&&(t=t.plus(i.times(i)));else{if(i.s)return C=!0,new this(1/0);t=i}return C=!0,t.sqrt()}function At(o){return o instanceof V||o&&o.toStringTag===Xt||!1}function Re(o){return new this(o).ln()}function Ne(o,i){return new this(o).log(i)}function ke(o){return new this(o).log(2)}function Ve(o){return new this(o).log(10)}function De(){return zt(this,arguments,-1)}function be(){return zt(this,arguments,1)}function Ae(o,i){return new this(o).mod(i)}function Ee(o,i){return new this(o).mul(i)}function Me(o,i){return new this(o).pow(i)}function Ie(o){var i,t,e,s,n=0,r=new this(1),a=[];if(o===void 0?o=this.precision:I(o,1,j),e=Math.ceil(o/x),this.crypto)if(crypto.getRandomValues)for(i=crypto.getRandomValues(new Uint32Array(e));n<e;)s=i[n],s>=429e7?i[n]=crypto.getRandomValues(new Uint32Array(1))[0]:a[n++]=s%1e7;else if(crypto.randomBytes){for(i=crypto.randomBytes(e*=4);n<e;)s=i[n]+(i[n+1]<<8)+(i[n+2]<<16)+((i[n+3]&127)<<24),s>=214e7?crypto.randomBytes(4).copy(i,n):(a.push(s%1e7),n+=4);n=e/4}else throw Error(Tt);else for(;n<e;)a[n++]=Math.random()*1e7|0;for(e=a[--n],o%=x,e&&o&&(s=D(10,x-o),a[n]=(e/s|0)*s);a[n]===0;n--)a.pop();if(n<0)t=0,a=[0];else{for(t=-1;a[0]===0;t-=x)a.shift();for(e=1,s=a[0];s>=10;s/=10)e++;e<x&&(t-=x-e)}return r.e=t,r.d=a,r}function He(o){return w(o=new this(o),o.e+1,this.rounding)}function Le(o){return o=new this(o),o.d?o.d[0]?o.s:0*o.s:o.s||NaN}function Te(o){return new this(o).sin()}function Xe(o){return new this(o).sinh()}function Ye(o){return new this(o).sqrt()}function Ge(o,i){return new this(o).sub(i)}function Be(){var o=0,i=arguments,t=new this(i[o]);for(C=!1;t.s&&++o<i.length;)t=t.plus(i[o]);return C=!0,w(t,this.precision,this.rounding)}function ze(o){return new this(o).tan()}function _e(o){return new this(o).tanh()}function qe(o){return w(o=new this(o),o.e+1,1)}p[Symbol.for("nodejs.util.inspect.custom")]=p.toString;p[Symbol.toStringTag]="Decimal";var V=p.constructor=Ft(Ot);ut=new V(ut);dt=new V(dt);function Et(o){const t=o.toString().split("."),e=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,",");return t.length>1?e+"."+t[1]:e}class Fe{constructor(i){d(this,"canvas");d(this,"axis_canvas",document.createElement("canvas"));d(this,"ctx",this.axis_canvas.getContext("2d"));d(this,"isReload",!1);d(this,"show",{all:!0,grid:{main:!0,secondary:!0},axis:!0,axisText:!0});this.canvas=i,this.initAxisCanvas()}initAxisCanvas(){var e,s;const{canvas:i,axis_canvas:t}=this;i&&(t.width=((e=i.rect)==null?void 0:e.value.width)||0,t.height=((s=i.rect)==null?void 0:s.value.height)||0)}toggleAxis(i){const t=(()=>{if(typeof i=="object"){const{all:e=!0,grid:s={main:!0,secondary:!0},axis:n=!0,axisText:r=!0}=i;return Object.assign({main:!0,secondary:!0},s),{all:e,grid:s,axis:n,axisText:r}}return typeof i=="boolean"?{all:!0,grid:{main:i,secondary:i},axis:i,axisText:i}:!this.show.all})();typeof t=="boolean"?this.show.all=t:this.show=t,this.isReload=!0}drawAxisAndGrid(){if(!(!this.canvas||!this.show.all))return(this.canvas.isRecalculate||this.isReload||this.canvas.isThemeUpdated)&&(this.isReload=!1,this.initAxisCanvas(),(this.show.grid.main||this.show.grid.secondary)&&this.drawGrid(),this.show.axis&&this.drawAxis(),this.show.axisText&&this.drawAxisText()),this.axis_canvas}color(){const{theme:i,style:t}=this.canvas;return(t[i]||t.light).grid}drawGrid(){const{canvas:i,ctx:t}=this,{rect:e,center:s,axisConfig:n}=i,{width:r,height:a}=e.value,l=this.color(),h=n.size,c=h/5;t.lineWidth=1;const f=(m,g)=>{const y=s.x%m>0?s.x%m:m+s.x%m;t.strokeStyle=g,t.beginPath();for(let v=0;v*m+y<=r;v++)t.moveTo(v*m+y,0),t.lineTo(v*m+y,a);t.stroke()},u=(m,g)=>{const y=s.y%m>0?s.y%m:m+s.y%m;t.strokeStyle=g,t.beginPath();for(let v=0;v*m+y<=a;v++)t.moveTo(0,v*m+y),t.lineTo(r,v*m+y);t.stroke()};this.show.grid.secondary&&(f(c,l.innerGrid),u(c,l.innerGrid)),this.show.grid.main&&(f(h,l.grid),u(h,l.grid))}drawAxis(){const{canvas:i,ctx:t}=this,{rect:e,center:s}=i,{width:n,height:r}=e.value,a=this.color();t.lineWidth=2,t.strokeStyle=a.axis;const l=()=>{s.y>=0&&s.y<=r&&(t.beginPath(),t.moveTo(0,s.y),t.lineTo(n,s.y),t.stroke())},h=()=>{s.x>=0&&s.x<=n&&(t.beginPath(),t.moveTo(s.x,0),t.lineTo(s.x,r),t.stroke())};l(),h()}drawText(i,t,e,s){const{canvas:n,ctx:r}=this,{theme:a}=n,l=this.canvas.style[a].text;r.font=`${l.bold?"bold":""} ${l.size}px ${l.family}`,r.strokeStyle=l.stroke,![i,t,e].includes(void 0)&&r.strokeText(i,t,e),r.fillStyle=l[s?"secondary":"color"],![i,t,e].includes(void 0)&&r.fillText(i,t,e)}drawAxisText(){const{canvas:i,ctx:t}=this,{rect:e,center:s,axisConfig:n,style:r,theme:a}=i,{width:l,height:h}=e.value;this.drawText();const c=y=>Math.ceil(t.measureText(y).width),f=4,u=r[a].text.size;{const y=c("0"),v=s.x<f||s.x>l+y+f,P=s.y<-(f+u)||s.y>h+u+f;!v&&!P&&this.drawText("0",s.x-y-f,s.y+u+f)}const m=i.getNowGridCount,g=n.size;{let y=s.y+u+f;y=Math.max(Math.min(y,h-f),f+u);const v=s.y>h||s.y<0;let P=s.x>0?s.x%g:s.x<0?g+s.x%g:0,O=i.getAxisValueByPoint((P-s.x)*n.x,0).xV;for(;P<=l;){const S=Et(O),k=c(S);O!==0&&this.drawText(S,P-k/2,y,v),P+=g,O=new V(m).mul(n.x).add(O).toNumber()}}{const y=s.x>l||s.x<0;let v=s.y>0?s.y%g:s.y<0?g+s.y%g:0,P=i.getAxisValueByPoint(0,(v-s.y)*n.y).yV;for(;v<=h;){const O=Et(P),S=c(O);let k=s.x-S-f;k=Math.max(Math.min(k,l-S-f),f),P!=0&&this.drawText(O,k,v+u/2,y),v+=g,P=new V(m).mul(n.y).add(P).toNumber()}}}}class vt{constructor(i){d(this,"show",!0);d(this,"scales");d(this,"notifyReload");(i==null?void 0:i.show)!==void 0&&(this.show=i.show),i!=null&&i.scales&&(this.scales=i.scales)}setShow(i){var t;i!=this.show&&(this.show=i,(t=this.notifyReload)==null||t.call(this,!0))}setScales(i){var t;i!=this.scales&&(this.scales=i,this.show&&((t=this.notifyReload)==null||t.call(this)))}shouldRender(i,t){if(!this.show||i===void 0||t===0)return!1;if(this.scales){const e=Math.min(...this.scales),s=Math.max(...this.scales);return i>=e&&i<=s}return!0}}class b{constructor(i){d(this,"name");d(this,"show",new vt);d(this,"style");d(this,"position");d(this,"value");d(this,"zIndex");d(this,"dynamicPosition");d(this,"isInteractable",!0);d(this,"path");d(this,"extData");d(this,"staticValueScope");d(this,"valueScope");d(this,"extraOffset",{x:0,y:0,xV:0,yV:0});d(this,"lastPointRadius",{value:0,radius:0});d(this,"eventListener",{click:new Set,dblclick:new Set,hover:new Set,draggable:new Set});d(this,"isClick",!1);d(this,"clickTime",0);d(this,"isDblClick",!1);d(this,"isDown",!1);d(this,"isHover",!1);d(this,"redrawOnIsHoverChange",!0);d(this,"sharedHoverOverlays");d(this,"draggable",!1);d(this,"sharedDraggableOverlays");d(this,"mainCanvas");d(this,"notifyReload");this.mainCanvas=i.mainCanvas,i.notifyReload&&this.setNotifyReload(i.notifyReload),this.show.setShow(i.show??!0),this.style=i.style,this.zIndex=i.zIndex??0,this.position=i.position,this.dynamicPosition=i.dynamicPosition,this.value=i.value,this.name=i.name,this.draggable=i.draggable??!1,this.isInteractable=i.isInteractable??!0,this.setExtraOffset(i.extraOffset,!1)}initValueScope(){const i=this.value;if(Array.isArray(i[0])){let t=1/0,e=-1/0,s=1/0,n=-1/0;i.forEach(([r,a])=>{t=Math.min(t,r),e=Math.max(e,r),s=Math.min(s,a),n=Math.max(n,a)}),this.valueScope={minX:t,maxX:e,minY:s,maxY:n}}else{const[t,e]=i;this.valueScope={minX:t,maxX:t,minY:e,maxY:e}}this.staticValueScope={...this.valueScope}}setExtraOffset(i,t=!0){var a;if(i=i||{x:0,y:0},!this.valueScope)return Object.assign(this.extraOffset,i);const{xV:e,yV:s}=this.mainCanvas.getAxisValueByPoint(i.x,i.y),n=e-this.extraOffset.xV,r=s-this.extraOffset.yV;this.valueScope.minX-=n,this.valueScope.maxX+=n,this.valueScope.minY-=r,this.valueScope.maxY+=r,Object.assign(this.extraOffset,i,{xV:e,yV:s}),t&&((a=this.notifyReload)==null||a.call(this))}calculatePointRadiusValue(i){if(!this.valueScope)return;const t=i?i.radius+i.width/2:this.lastPointRadius.radius,e=this.mainCanvas.getAxisValueByPoint(t,0).xV,s=e-this.lastPointRadius.value;this.valueScope.minX-=s,this.valueScope.maxX+=s,this.valueScope.minY-=s,this.valueScope.maxY+=s,this.lastPointRadius={radius:t,value:e}}addEventListener(i,t){this.eventListener[i].add(t)}removeEventListener(i,t){this.eventListener[i].delete(t)}notifyClick(i,t,e){i?(this.isDblClick=Date.now()-this.clickTime<300,this.clickTime=Date.now()):(this.isDblClick=!1,this.clickTime=0),this.isInteractable&&(this.isClick=i,this.isDblClick?this.eventListener.dblclick.forEach(s=>s(!0)):this.isClick&&this.eventListener.click.forEach(s=>s(!0)))}notifyDown(i,t,e){this.isInteractable&&(this.isDown=i)}notifyHover(i,t,e){var s;this.isInteractable&&(this.isHover=i,this.eventListener.hover.forEach(n=>n(i)),this.redrawOnIsHoverChange&&((s=this.notifyReload)==null||s.call(this)))}notifyDraggable(i,t){if(this.isInteractable&&this.draggable&&this.mainCanvas){this.eventListener.draggable.forEach(l=>l(i,t));const{percentage:e,axisConfig:s}=this.mainCanvas,n=s.count/s.min/e,r={value:i*n*s.x,position:i/e*s.x,dynamicPosition:i*s.x},a={value:t*n*s.y,position:t/e*s.y,dynamicPosition:t*s.y};return{x:r,y:a}}}isPointInAnywhere(i,t){return this.isPointInPath(i,t)||this.isPointInStroke(i,t)}setMainCanvas(i){this.mainCanvas=i,i&&this.updateBaseData()}equalsMainCanvas(i){return this.mainCanvas===i}setNotifyReload(i){this.notifyReload=i?t=>{var e;(t||this.show.shouldRender((e=this.mainCanvas)==null?void 0:e.scale))&&i()}:void 0,this.show.notifyReload=this.notifyReload}setStyle(i){var t;this.style=i,this.dynamicPosition&&((t=this.notifyReload)==null||t.call(this))}setZIndex(i){var t;this.zIndex=i,this.dynamicPosition&&((t=this.notifyReload)==null||t.call(this))}setPosition(i){var e;this.position=i,this.value=void 0;const t=!!this.dynamicPosition;this.updateBaseData(),(this.dynamicPosition||t)&&((e=this.notifyReload)==null||e.call(this))}setValue(i){var e;this.value=i,this.position=void 0;const t=!!this.dynamicPosition;this.updateBaseData(),(this.dynamicPosition||t)&&((e=this.notifyReload)==null||e.call(this))}}d(b,"ctx",document.createElement("canvas").getContext("2d"));class L{static LngLatToPlane(i,t){const e=Math.max(Math.min(i,180),-180),s=Math.max(Math.min(t,this.MAX_LAT),-this.MAX_LAT),n=e*this.PI_OVER_180*this.EARTH_RADIUS,r=s*this.PI_OVER_180,a=Math.log(Math.tan(Math.PI/4+r/2))*this.EARTH_RADIUS;return[n,a]}static PlaneToLngLat(i,t){const e=i/this.EARTH_RADIUS/this.PI_OVER_180,s=(2*Math.atan(Math.exp(t/this.EARTH_RADIUS))-this.HALF_PI)/this.PI_OVER_180;return[e,s]}static PointToLineDistance(i,t,e){const[s,n]=i,[r,a]=t,[l,h]=e,c=(l-r)**2+(h-a)**2;if(c===0)return Math.sqrt((s-r)**2+(n-a)**2);let f=((s-r)*(l-r)+(n-a)*(h-a))/c;return f=Math.max(0,Math.min(1,f)),Math.sqrt((s-(r+f*(l-r)))**2+(n-(a+f*(h-a)))**2)}static IsValid(i){return Array.isArray(i)&&typeof i[0]=="number"&&typeof i[1]=="number"&&isFinite(i[0])&&isFinite(i[1])}static IsValids(i){return Array.isArray(i)&&i.every(t=>this.IsValid(t))}}d(L,"HALF_PI",Math.PI/2),d(L,"PI_OVER_180",Math.PI/180),d(L,"EARTH_RADIUS",6378137),d(L,"MAX_LAT",85.05112878);class at extends b{constructor(t){super(t);d(this,"textOffset",{x:0,y:0});d(this,"text");this.text=String(t.text)}updateValueScope(){const{textOffset:t,value:e}=this,{xV:s,yV:n}=this.mainCanvas.getAxisValueByPoint(t.x*2,t.y*2);this.valueScope={minX:e[0]-s/2,maxX:e[0]+s/2,minY:e[1]-n/2,maxY:e[1]+n/2},this.staticValueScope={minX:e[0],maxX:e[0],minY:e[1],maxY:e[1]},this.setExtraOffset(this.extraOffset,!1)}notifyDraggable(t,e){var a;const s=super.notifyDraggable(t,e);if(!s)return;const{x:n,y:r}=s;this.value=[this.value[0]+n.value,this.value[1]+r.value],this.position=[this.position[0]+n.position,this.position[1]+r.position],this.dynamicPosition=[this.dynamicPosition[0]+n.dynamicPosition,this.dynamicPosition[1]+r.dynamicPosition],this.updateValueScope(),(a=this.notifyReload)==null||a.call(this)}isPointInPath(t,e){return this.path?b.ctx.isPointInPath(this.path,t,e):!1}isPointInStroke(t,e){return!1}updateBaseData(){if(!this.mainCanvas)return;if(!this.text||this.text.length==0)return this.dynamicPosition=void 0;const t=L.IsValid;let{value:e,position:s}=this;const[n,r]=[t(e),t(s)];if(!n&&!r)return this.dynamicPosition=void 0;if(n){const c=this.mainCanvas.getAxisPointByValue(e[0],e[1],!0);s=[c.x,c.y]}else{const c=this.mainCanvas.getAxisValueByPoint(s[0],s[1],!0);e=[c.xV,c.yV]}const a=this.mainCanvas.transformPosition([s])[0];this.dynamicPosition=a,this.value=e,this.position=s;const l=this.mainCanvas.ctx;this.setCanvasStyles(l);const h=l.measureText(this.text);this.textOffset={x:h.width/2,y:h.actualBoundingBoxAscent/2},this.updateValueScope()}setText(t){var e;t!=this.text&&(this.text=t,this.updateBaseData(),this.dynamicPosition&&((e=this.notifyReload)==null||e.call(this)))}setCanvasStyles(t){var r;const e=this.mainCanvas,s=e.style[e.theme].text;let n={};typeof this.style=="string"?n=((r=e.style[this.style])==null?void 0:r.text)||s:typeof this.style=="object"?n=Object.assign({},s,this.style):n=s,t.font=`${n.bold?"bold":""} ${n.size}px ${n.family}`,t.lineWidth=2,t.strokeStyle=n.stroke,t.fillStyle=n[this.isHover?"secondary":"color"]}draw(t){if(!this.mainCanvas)return;const e=this.dynamicPosition,s=this.textOffset,n=this.text,r=this.extraOffset;this.setCanvasStyles(t);const a=e[0]+r.x-s.x,l=e[1]+r.y+s.y;t.strokeText(n,a,l),t.fillText(n,a,l),this.path=new Path2D,this.path.rect(a,e[1]+r.y-s.y,s.x*2,s.y*2)}getDraw(){const{show:t,dynamicPosition:e,position:s,valueScope:n,mainCanvas:r}=this;if(!r)return;const{scale:a,maxMinValue:l,isRecalculate:h,isScaleUpdated:c}=r;if(t.shouldRender(a)&&e)return c&&this.setExtraOffset(this.extraOffset,!1),l.maxXV<n.minX||l.minXV>n.maxX||l.maxYV<n.minY||l.minYV>n.maxY?void 0:(h&&(this.dynamicPosition=r.transformPosition([s])[0]),[this.draw,this])}}class $ extends b{constructor(t){super(t);d(this,"angle",2*Math.PI);d(this,"fillProgress")}updateValueScope(){this.initValueScope(),this.calculatePointRadiusValue(this.setCanvasStyles()),this.setExtraOffset(this.extraOffset,!1)}notifyDraggable(t,e){var a;const s=super.notifyDraggable(t,e);if(!s)return;const{x:n,y:r}=s;this.value=[this.value[0]+n.value,this.value[1]+r.value],this.position=[this.position[0]+n.position,this.position[1]+r.position],this.dynamicPosition=[this.dynamicPosition[0]+n.dynamicPosition,this.dynamicPosition[1]+r.dynamicPosition],this.updateValueScope(),(a=this.notifyReload)==null||a.call(this)}notifyHover(t,e,s){if(!this.isInteractable)return;super.notifyHover(t,e,s);const n=300,r=this.setCanvasStyles().width;this.fillProgress?this.cancelAndRestartAnimation(t,r,n-100):t&&this.startNewHoverAnimation(r,n)}cancelAndRestartAnimation(t,e,s){this.fillProgress.scheduleCallback();let n=0;this.fillProgress.scheduleCallback=ft(r=>{!this.fillProgress||!r||(this.fillProgress.progress+=(r-n)*(t?1:-1),n=r,this.fillProgress.progress=Math.min(1,Math.max(0,this.fillProgress.progress)),this.updateLineWidthOffset(e),(this.fillProgress.progress===1||this.fillProgress.progress===0)&&(this.fillProgress.scheduleCallback(),this.fillProgress.progress===0&&(this.fillProgress=void 0)))},s)}startNewHoverAnimation(t,e){this.fillProgress={lineWidthOffset:0,progress:0,scheduleCallback:ft(s=>{this.fillProgress&&(this.fillProgress.progress=s,this.updateLineWidthOffset(t))},e)}}updateLineWidthOffset(t){var s;if(!this.fillProgress)return;const e=Math.ceil(t*this.fillProgress.progress);e!==this.fillProgress.lineWidthOffset&&(this.fillProgress.lineWidthOffset=e,(s=this.notifyReload)==null||s.call(this))}isPointInPath(t,e){return this.path?b.ctx.isPointInPath(this.path,t,e):!1}isPointInStroke(t,e){var s;if(this.path&&this.mainCanvas){const{width:n}=this.setCanvasStyles(b.ctx);return((s=this.fillProgress)==null?void 0:s.lineWidthOffset)==n?!1:b.ctx.isPointInStroke(this.path,t,e)}return!1}setStyle(t){super.setStyle(t),this.calculatePointRadiusValue(this.setCanvasStyles())}updateBaseData(){if(!this.mainCanvas)return;const t=L.IsValid;let{value:e,position:s}=this;const[n,r]=[t(e),t(s)];if(!n&&!r)return this.dynamicPosition=void 0;if(n){const l=this.mainCanvas.getAxisPointByValue(e[0],e[1],!0);s=[l.x,l.y]}else{const l=this.mainCanvas.getAxisValueByPoint(s[0],s[1],!0);e=[l.xV,l.yV]}const a=this.mainCanvas.transformPosition([s])[0];this.dynamicPosition=a,this.value=e,this.position=s,this.updateValueScope()}setCanvasStyles(t){var h,c;const e=this.mainCanvas,s=e.style[e.theme].point;let n={};typeof this.style=="string"?n=((h=e.style[this.style])==null?void 0:h.point)||s:typeof this.style=="object"?n=Object.assign({},s,this.style):n=s;const{width:r,stroke:a,fill:l}=n;if(t){const f=((c=this.fillProgress)==null?void 0:c.lineWidthOffset)||0;t.lineWidth=r-f,t.strokeStyle=a,t.fillStyle=l}return{...n}}draw(t){var f;const{dynamicPosition:e,mainCanvas:s,extraOffset:n}=this;if(!s)return;const{radius:r,width:a}=this.setCanvasStyles(t),l=((f=this.fillProgress)==null?void 0:f.lineWidthOffset)||0,h=e[0]+n.x,c=e[1]+n.y;t.beginPath(),this.path=new Path2D,this.path.arc(h,c,r+l/2,0,this.angle),t.fill(this.path),a!=l&&t.stroke(this.path)}getDraw(){const{show:t,dynamicPosition:e,position:s,valueScope:n,mainCanvas:r}=this;if(!r)return;const{scale:a,maxMinValue:l,isRecalculate:h,isScaleUpdated:c}=r;if(t.shouldRender(a)&&!!e)return c&&(this.setExtraOffset(this.extraOffset,!1),this.calculatePointRadiusValue()),l.maxXV<n.minX||l.minXV>n.maxX||l.maxYV<n.minY||l.minYV>n.maxY?void 0:(h&&(this.dynamicPosition=r.transformPosition([s])[0]),[this.draw,this])}}function We(o,i,t=10){if(i.length===0)return 0;if(i.length===1)return 1;let e=1/0,s=-1;for(let n=0;n<i.length-1;n++){const r=L.PointToLineDistance(o,i[n],i[n+1]);if(r<t)return n+1;r<e&&(e=r,s=n+1)}return s}function Ct(o,i){const{x:t,y:e}=Mt(...o,...i);return[t,e]}class Wt extends b{constructor(t){super(t);d(this,"handlePoints",[]);d(this,"isShowHandlePoint",!0);d(this,"canCreateOrDeleteHandlePoint",!0);d(this,"lockedCanCreateOrDeleteHandlePoint",!1);this.isShowHandlePoint=t.isShowHandlePoint??!0,this.canCreateOrDeleteHandlePoint=t.canCreateOrDeleteHandlePoint??!0}notifyClick(t,e,s){var r;const n=this.isClick;if(super.notifyClick(t,e,s),!(!this.isInteractable||!this.isShowHandlePoint)){if(this.lockedCanCreateOrDeleteHandlePoint)this.resetHandlePointLock();else if(n&&this.isClick&&this.isShowHandlePoint&&this.canCreateOrDeleteHandlePoint&&this.draggable){const l=this.handlePoints.findIndex(h=>h.isHover);l===-1?this.tryCreateNewHandlePoint(e,s):this.tryDeleteHandlePoint(l)}n!=this.isClick&&!this.infinite&&((r=this.notifyReload)==null||r.call(this))}}tryCreateNewHandlePoint(t,e){var h;if(this.isDblClick||!this.isPointInStroke(t,e))return;const s=this.getExtendedDynamicPositions(),n=We([t,e],s);if(n===-1)return;const[r,a]=this.getAdjacentIndices(n),l=this.createNewHandlePoint(r,a);this.insertHandlePoint(n,l),this.lockHandlePointCreationTemporarily(),(h=this.notifyReload)==null||h.call(this)}tryDeleteHandlePoint(t){var e;!this.isDblClick||!this.canDeleteHandlePoint||(this.deleteHandlePoint(t),(e=this.notifyReload)==null||e.call(this))}getExtendedDynamicPositions(){return this.isClosed?[...this.dynamicPosition,this.dynamicPosition[0]]:this.dynamicPosition}getAdjacentIndices(t){const e=t-1,s=this.isClosed&&t===this.dynamicPosition.length?0:t;return[e,s]}createNewHandlePoint(t,e){const s=Ct(this.value[t],this.value[e]),n=Ct(this.position[t],this.position[e]),r=Ct(this.dynamicPosition[t],this.dynamicPosition[e]);return new $({value:s,position:n,dynamicPosition:r,draggable:!0,mainCanvas:this.mainCanvas,notifyReload:()=>{var a;return(a=this.notifyReload)==null?void 0:a.call(this)}})}insertHandlePoint(t,e){this.handlePoints.splice(t,0,e),this.value.splice(t,0,e.value),this.position.splice(t,0,e.position),this.dynamicPosition.splice(t,0,e.dynamicPosition)}deleteHandlePoint(t){this.handlePoints.splice(t,1),this.value.splice(t,1),this.position.splice(t,1),this.dynamicPosition.splice(t,1)}lockHandlePointCreationTemporarily(){this.lockedCanCreateOrDeleteHandlePoint=!0,setTimeout(()=>{this.lockedCanCreateOrDeleteHandlePoint=!1},300)}resetHandlePointLock(){this.lockedCanCreateOrDeleteHandlePoint=!1}get canDeleteHandlePoint(){return this.handlePoints.length>this.minNeededHandlePoints}notifyDraggable(t,e){if(!this.isInteractable||!this.draggable||!this.mainCanvas)return;const s=()=>{var a;const{x:n,y:r}=super.notifyDraggable(t,e);this.value.forEach((l,h)=>{this.value[h][0]+=n.value,this.value[h][1]+=r.value,this.position[h][0]+=n.position,this.position[h][1]+=r.position,this.dynamicPosition[h][0]+=n.dynamicPosition,this.dynamicPosition[h][1]+=r.dynamicPosition}),this.handlePoints.forEach((l,h)=>{l.value=this.value[h],l.position=this.position[h],l.dynamicPosition=this.dynamicPosition[h]}),(a=this.notifyReload)==null||a.call(this),this.lockedCanCreateOrDeleteHandlePoint=!0};if(this.isShowHandlePoint){const n=this.handlePoints.findIndex(r=>r.isHover);if(n!=-1){const r=this.handlePoints[n];r.notifyDraggable(t,e),this.value[n]=r.value,this.position[n]=r.position,this.dynamicPosition[n]=r.dynamicPosition}else s()}else s();this.updateValueScope()}updateHandlePoints(){let{value:t,position:e,dynamicPosition:s}=this;s&&(t==null||t.forEach((n,r)=>{const a=this.handlePoints[r]||new $({draggable:!0});a.value=t[r],a.position=e[r],a.dynamicPosition=s[r],a.mainCanvas=this.mainCanvas,a.setNotifyReload(()=>{var l;return(l=this.notifyReload)==null?void 0:l.call(this)}),this.handlePoints[r]||this.handlePoints.push(a)}),this.handlePoints.length=t.length)}}class lt extends Wt{constructor(t){super(t);d(this,"infinite");d(this,"isClosed",!1);d(this,"minNeededHandlePoints",2);this.infinite=t.infinite,this.canCreateOrDeleteHandlePoint=!t.infinite,this.redrawOnIsHoverChange=!1}updateValueScope(){this.initValueScope(),this.calculatePointRadiusValue(this.setCanvasStyles().point),this.setExtraOffset(this.extraOffset,!1)}isPointInPath(t,e){return!1}isPointInStroke(t,e){return this.path&&this.mainCanvas?(this.setCanvasStyles(b.ctx),this.draggable&&(b.ctx.lineWidth=Math.max(b.ctx.lineWidth,20)),b.ctx.isPointInStroke(this.path,t,e)):!1}isPointInAnywhere(t,e){const s=super.isPointInAnywhere(t,e),n=(this.isClick||!!this.infinite)&&this.isShowHandlePoint&&this.handlePoints.some(r=>{const a=r.isPointInAnywhere(t,e);return a!=r.isHover&&r.notifyHover(a,t,e),a});return s||n}updateBaseData(){if(!this.mainCanvas)return;let{value:t,position:e}=this;const[s,n]=[L.IsValids(t)&&t.length>1,L.IsValids(e)&&e.length>1];if(!s&&!n)return this.handlePoints=[],this.dynamicPosition=void 0;if(s){e=[];for(let a=0;a<t.length;a++){const l=t[a],h=this.mainCanvas.getAxisPointByValue(l[0],l[1],!0);e.push([h.x,h.y])}}else{t=[];for(let a=0;a<e.length;a++){const l=e[a],h=this.mainCanvas.getAxisValueByPoint(l[0],l[1],!0);t.push([h.xV,h.yV])}}const r=this.mainCanvas.transformPosition(e);this.dynamicPosition=r,this.value=t,this.position=e,this.updateHandlePoints(),this.updateValueScope()}setInfinite(t){var e;t!=this.infinite&&(this.infinite=t,this.canCreateOrDeleteHandlePoint=!t,this.dynamicPosition&&((e=this.notifyReload)==null||e.call(this)))}setCanvasStyles(t){var m;const e=this.mainCanvas,s=e.style[e.theme].line;let n={};typeof this.style=="string"?n=((m=e.style[this.style])==null?void 0:m.line)||s:typeof this.style=="object"?n=Object.assign({},s,this.style):n=s;const{width:r,color:a,dash:l,dashGap:h,dashOffset:c,cap:f,join:u}=n;return t&&(t.setLineDash(l?h:[]),t.lineDashOffset=c,t.lineCap=f,t.lineJoin=u,t.lineWidth=r,t.strokeStyle=a),n}drawLine(t,e){const{mainCanvas:s,infinite:n,isClick:r}=this;if(e=e||this.dynamicPosition,!s)return;const a=this.setCanvasStyles(t);t.beginPath(),this.path=new Path2D,e.forEach((l,h)=>{this.path[h==0?"moveTo":"lineTo"](l[0],l[1])}),t.stroke(this.path),(n||r)&&this.isShowHandlePoint&&this.handlePoints.forEach(l=>{l.style=a.point,l.draw(t)})}drawInfiniteStraightLine(t){const{mainCanvas:e,dynamicPosition:s}=this;if(!e)return;const{rect:n}=e,[r,a]=It(s),l=[a[0]-r[0],a[1]-r[1]];if(l[0]===0&&l[1]===0)return console.error("");const h=(u,m)=>{const[g,y]=u,[v,P]=m;let O=1/0;if(v!==0){const S=v>0?(n.value.width-g)/v:-g/v;S>0&&(O=Math.min(O,S))}if(v!==0){const S=v>0?(n.value.width-g)/v:-g/v;S>0&&(O=Math.min(O,S))}return O===1/0?u:[g+v*O,y+P*O]},c=h(r,[-l[0],-l[1]]),f=h(a,l);this.drawLine(t,[c,f])}getDraw(){const{show:t,dynamicPosition:e,position:s,infinite:n,mainCanvas:r,valueScope:a}=this;if(!r)return;const{scale:l,isRecalculate:h,isScaleUpdated:c,maxMinValue:f}=r;if(t.shouldRender(l)&&!!e)return c&&(this.setExtraOffset(this.extraOffset,!1),this.calculatePointRadiusValue()),!n&&(f.maxXV<a.minX||f.minXV>a.maxX||f.maxYV<a.minY||f.minYV>a.maxY)?void 0:(h&&(this.dynamicPosition=r.transformPosition(s),this.handlePoints.forEach((y,v)=>y.dynamicPosition=this.dynamicPosition[v])),n?[this.drawInfiniteStraightLine,this]:[this.drawLine,this])}}class ht extends Wt{constructor(t){super(t);d(this,"isRect",!1);d(this,"isClosed",!0);d(this,"minNeededHandlePoints",3);this.isRect=t.isRect??!1,this.canCreateOrDeleteHandlePoint=!t.isRect}updateValueScope(){this.initValueScope(),this.calculatePointRadiusValue(this.setCanvasStyles().point),this.setExtraOffset(this.extraOffset,!1)}isPointInPath(t,e){return this.path?b.ctx.isPointInPath(this.path,t,e):!1}isPointInStroke(t,e){return this.path&&this.mainCanvas?(this.setCanvasStyles(b.ctx),this.draggable&&(b.ctx.lineWidth=Math.max(b.ctx.lineWidth,20)),b.ctx.isPointInStroke(this.path,t,e)):!1}isPointInAnywhere(t,e){const s=super.isPointInAnywhere(t,e),n=this.isClick&&this.isShowHandlePoint&&this.handlePoints.some(r=>{const a=r.isPointInAnywhere(t,e);return a!=r.isHover&&r.notifyHover(a,t,e),a});return s||n}updateBaseData(){if(!this.mainCanvas)return;let{value:t,position:e,isRect:s}=this,[n,r]=[L.IsValids(t)&&t.length>(s?1:2),L.IsValids(e)&&e.length>(s?1:2)];if(!n&&!r)return this.dynamicPosition=void 0;if(s){if(n){t.length=2;const[l,h]=t;n=!(l[0]==h[0]||l[1]==h[1])}if(r){e.length=2;const[l,h]=e;r=!(l[0]==h[0]||l[1]==h[1])}}if(n){e=[];for(let l=0;l<t.length;l++){const h=t[l],c=this.mainCanvas.getAxisPointByValue(h[0],h[1],!0);e.push([c.x,c.y])}}else{t=[];for(let l=0;l<e.length;l++){const h=e[l],c=this.mainCanvas.getAxisValueByPoint(h[0],h[1],!0);t.push([c.xV,c.yV])}}const a=this.mainCanvas.transformPosition(e);this.dynamicPosition=a,this.value=t,this.position=e,this.updateHandlePoints(),this.updateValueScope()}setRect(t){var e;if(this.isRect!=t){this.isRect=t,this.canCreateOrDeleteHandlePoint=!t;const s=!!this.dynamicPosition;this.updateBaseData(),(this.dynamicPosition||s)&&((e=this.notifyReload)==null||e.call(this))}}setCanvasStyles(t){var y;const e=this.isHover,s=this.mainCanvas,n=s.style[s.theme].polygon;let r={};typeof this.style=="string"?r=((y=s.style[this.style])==null?void 0:y.polygon)||n:typeof this.style=="object"?r=Object.assign({},n,this.style):r=n;const{width:a,stroke:l,dash:h,dashGap:c,dashOffset:f,fill:u,fill_hover:m,stroke_hover:g}=r;return t&&(t.setLineDash(h?c:[]),t.lineDashOffset=f,t.lineWidth=a,t.strokeStyle=e?g:l,t.fillStyle=e?m:u),r}drawRect(t){const[[e,s],[n,r]]=this.dynamicPosition,a=Math.abs(n-e),l=Math.abs(r-s),h=Math.min(e,n),c=Math.min(s,r),f=this.setCanvasStyles(t);t.beginPath(),this.path=new Path2D,this.path.rect(h,c,a,l),t.stroke(this.path),t.fill(this.path),this.isClick&&this.isShowHandlePoint&&this.handlePoints.forEach(u=>{u.style=f.point,u.draw(t)})}drawPolygon(t){const e=this.dynamicPosition,s=this.setCanvasStyles(t);t.beginPath(),this.path=new Path2D,e.forEach((n,r)=>{this.path[r==0?"moveTo":"lineTo"](n[0],n[1])}),this.path.lineTo(e[0][0],e[0][1]),t.closePath(),t.stroke(this.path),t.fill(this.path),this.isClick&&this.isShowHandlePoint&&this.handlePoints.forEach(n=>{n.style=s.point,n.draw(t)})}getDraw(){const{show:t,dynamicPosition:e,position:s,mainCanvas:n,valueScope:r}=this;if(!n)return;const{scale:a,isRecalculate:l,isScaleUpdated:h,maxMinValue:c}=n;if(t.shouldRender(a)&&!!e)return h&&(this.setExtraOffset(this.extraOffset,!1),this.calculatePointRadiusValue()),c.maxXV<r.minX||c.minXV>r.maxX||c.maxYV<r.minY||c.minYV>r.maxY?void 0:(l&&(this.dynamicPosition=n.transformPosition(s),this.handlePoints.forEach((g,y)=>g.dynamicPosition=this.dynamicPosition[y])),this.isRect?[this.drawRect,this]:[this.drawPolygon,this])}}class ct extends b{constructor(t,e){super(t);d(this,"draw");this.draw=e,this.redrawOnIsHoverChange=!1}updateValueScope(){this.initValueScope(),this.setExtraOffset(this.extraOffset,!1)}isPointInPath(t,e){return!1}isPointInStroke(t,e){return!1}updateBaseData(){if(!this.mainCanvas)return;this.dynamicPosition=void 0;let t=this.value,e=this.position;t?e=this.convertValuesToPositions(t):t=this.convertPositionsToValues(e),this.updateDataProperties(t,e),this.updateValueScope()}convertValuesToPositions(t){const e=[];let s=1;return t.forEach((n,r)=>{if(r===0){const a=this.mainCanvas.getAxisPointByValue(n[0],n[1],!0);e.push([a.x,a.y]),s=new V(a.x).div(n[0]).toNumber()}else e.push([new V(s).mul(n[0]).toNumber(),new V(s).mul(n[1]).toNumber()])}),e}convertPositionsToValues(t){const e=[];let s=1;return t.forEach((n,r)=>{if(r===0){const a=this.mainCanvas.getAxisValueByPoint(n[0],n[1],!0);e.push([a.xV,a.yV]),s=new V(a.xV).div(n[0]).toNumber()}else e.push([new V(s).mul(n[0]).toNumber(),new V(s).mul(n[1]).toNumber()])}),e}updateDataProperties(t,e){this.dynamicPosition=this.mainCanvas.transformPosition(e),this.value=t,this.position=e}getDraw(){const{show:t,dynamicPosition:e,mainCanvas:s,position:n,valueScope:r}=this;if(!s)return;const{scale:a,isRecalculate:l,isScaleUpdated:h,maxMinValue:c}=s;if(t.shouldRender(a)&&!!e)return h&&this.setExtraOffset(this.extraOffset,!1),c.maxXV<r.minX||c.minXV>r.maxX||c.maxYV<r.minY||c.minYV>r.maxY?void 0:(l&&(this.dynamicPosition=s.transformPosition(n)),[this.draw,this])}}class B{constructor(i){d(this,"name");d(this,"show",new vt);d(this,"overlays",new Set);d(this,"mainCanvas");d(this,"notifyReload");this.name=i}equalsMainCanvas(i){return this.mainCanvas===i}setMainCanvas(i){var t;this.mainCanvas=i,this.overlays.forEach(e=>e.setMainCanvas(i)),i&&this.overlays.size&&((t=this.notifyReload)==null||t.call(this))}setNotifyReload(i){this.notifyReload=i?t=>{var e;(t||this.show.shouldRender((e=this.mainCanvas)==null?void 0:e.scale)&&this.overlays.size)&&i()}:void 0,this.overlays.forEach(t=>t.setNotifyReload(this.notifyReload)),this.show.notifyReload=this.notifyReload}addOverlays(i){var t;[i].flat().forEach(e=>{e.setNotifyReload(this.notifyReload),e.setMainCanvas(this.mainCanvas),this.overlays.add(e)}),(t=this.notifyReload)==null||t.call(this)}hasOverlay(i){return this.overlays.has(i)}removeOverlays(i){var t;[i].flat().forEach(e=>{this.overlays.delete(e),e.setNotifyReload(),e.setMainCanvas()}),(t=this.notifyReload)==null||t.call(this)}clearOverlays(){var i;(i=this.notifyReload)==null||i.call(this),this.overlays.forEach(t=>{t.setNotifyReload(),t.setMainCanvas()}),this.overlays.clear()}getOverlaysDrawingMethod(){var t;const i=[];if(this.show.shouldRender((t=this.mainCanvas)==null?void 0:t.scale)&&this.overlays.size){let e=1;Array.from(this.overlays.values()).sort((s,n)=>s.zIndex-n.zIndex).forEach(s=>{if(s.equalsMainCanvas(this.mainCanvas)){const n=s.getDraw();n&&i.push([(Number(s.zIndex)||0)+e++,n])}else this.overlays.delete(s)})}return i}}class z{constructor(i){d(this,"name");d(this,"show",new vt);d(this,"opacity",1);d(this,"zIndex",4);d(this,"canvas",document.createElement("canvas"));d(this,"ctx",this.canvas.getContext("2d"));d(this,"isReload",!1);d(this,"groups",new Map);d(this,"mainCanvas");d(this,"notifyReload");d(this,"currentDrawOverlays",[]);this.name=i}equalsMainCanvas(i){return this.mainCanvas===i}setMainCanvas(i){var t,e;this.mainCanvas=i,this.canvas.width=((t=i==null?void 0:i.rect)==null?void 0:t.value.width)||0,this.canvas.height=((e=i==null?void 0:i.rect)==null?void 0:e.value.height)||0,this.groups.forEach(s=>s.setMainCanvas(i))}setNotifyReload(i){this.notifyReload=i?t=>{var e;(t||this.show.shouldRender((e=this.mainCanvas)==null?void 0:e.scale)&&this.groups.size)&&i()}:void 0,this.groups.forEach(t=>this.setGroupNotifyReload(t)),this.show.notifyReload=this.notifyReload}setGroupNotifyReload(i){i.setNotifyReload(this.notifyReload?()=>{var t;(t=this.notifyReload)==null||t.call(this),this.isReload=!0}:void 0)}getGroup(i){return this.groups.get(i)}addGroup(i){[i].flat().forEach(t=>{t instanceof B&&(this.setGroupNotifyReload(t),t.setMainCanvas(this.mainCanvas),this.groups.set(t.name,t))})}removeGroup(i){var e;let t=!1;[i].flat().forEach(s=>{s instanceof B&&(this.groups.delete(s.name),s.setNotifyReload(),s.setMainCanvas(),t=!0)}),t&&((e=this.notifyReload)==null||e.call(this))}clearGroup(){var i;this.groups.size&&(this.groups.forEach(t=>{t.setNotifyReload(),t.setMainCanvas()}),this.groups.clear(),(i=this.notifyReload)==null||i.call(this))}setzIndex(i){var t;i!=this.zIndex&&(this.zIndex=i,(t=this.notifyReload)==null||t.call(this,!1))}setOpacity(i){var t;this.opacity!=i&&(i>=0&&i<=1?(this.opacity=i,(t=this.notifyReload)==null||t.call(this,!1)):console.warn("Opacity value should be between 0 and 1."))}getCanvas(){if(!this.mainCanvas)return;const{scale:i,rect:t,isRecalculate:e,isThemeUpdated:s}=this.mainCanvas,n=this.show.shouldRender(i),r=this.groups.size;if(n&&r){if(this.isReload||e||s){this.currentDrawOverlays=[],this.isReload=!1,this.canvas.width=(t==null?void 0:t.value.width)||0,this.canvas.height=(t==null?void 0:t.value.height)||0;const a=[];this.groups.forEach(l=>{l.equalsMainCanvas(this.mainCanvas)?a.push(...l.getOverlaysDrawingMethod()):this.groups.delete(l.name)}),a.sort((l,h)=>l[0]-h[0]),a.forEach(([l,[h,c]])=>{h.call(c,this.ctx),this.currentDrawOverlays.push([[Number(this.zIndex)||0,l],c])})}return[Number(this.zIndex)||0,this.canvas,this.currentDrawOverlays]}}}class tt{constructor(i){d(this,"name");d(this,"show",new vt);d(this,"layers",new Map);d(this,"mainCanvas");d(this,"notifyReload");this.name=i}setMainCanvas(i){this.mainCanvas=i,this.layers.forEach(t=>t.setMainCanvas(i))}setNotifyReload(i){this.notifyReload=i?t=>{var e;(t||this.show.shouldRender((e=this.mainCanvas)==null?void 0:e.scale)&&this.layers.size)&&i()}:void 0,this.layers.forEach(t=>t.setNotifyReload(this.notifyReload)),this.show.notifyReload=this.notifyReload}getLayer(i){return this.layers.get(i)}addLayer(i){[i].flat().forEach(t=>{t instanceof z&&(t.setNotifyReload(this.notifyReload),t.setMainCanvas(this.mainCanvas),this.layers.set(t.name,t))})}removeLayer(i){var e;let t=!1;[i].flat().forEach(s=>{s instanceof z&&(this.layers.delete(s.name),s.setNotifyReload(),s.setMainCanvas(),t=!0)}),t&&((e=this.notifyReload)==null||e.call(this))}clearLayers(){var i;this.layers.size&&(this.layers.forEach(t=>{t.setNotifyReload(),t.setMainCanvas()}),this.layers.clear(),(i=this.notifyReload)==null||i.call(this))}fetchCanvas(){var i;if(this.show.shouldRender((i=this.mainCanvas)==null?void 0:i.scale)&&this.layers.size){const t=[];return this.layers.forEach(e=>{if(e.equalsMainCanvas(this.mainCanvas)){const s=e.getCanvas();s&&t.push(s)}else this.layers.delete(e.name)}),t}return[]}}class Ue{constructor(i){d(this,"canvas");d(this,"ctx");d(this,"rect");d(this,"offset",{x:0,y:0});d(this,"center",{x:0,y:0});d(this,"defaultCenter",{top:void 0,bottom:void 0,left:void 0,right:void 0});d(this,"lockDragAndResize",!1);d(this,"accuracy",5);d(this,"scale",1);d(this,"percentage",1);d(this,"axisConfig",{count:2,min:100,size:100,x:1,y:1});d(this,"cycle",10);d(this,"delta",.02);d(this,"redrawInNextRenderFrame",!1);d(this,"isAuto",!1);d(this,"isRendering",!1);d(this,"drawAxis");d(this,"layerGroups",new Map);d(this,"isScaleUpdated",!1);d(this,"nowGridCount");const t=document.getElementById(i);if(t instanceof HTMLCanvasElement)if(t.getContext){this.canvas=t,this.ctx=t.getContext("2d"),this.rect=(n=>{let r=!0;Promise.resolve().then(()=>r=!1);const a={value:n.getBoundingClientRect()};return new Proxy(a,{get(l,h){return h=="value"?(r||(l.value=n.getBoundingClientRect(),r=!0,Promise.resolve().then(()=>r=!1)),l.value):l[h]},set(){return!1}})})(t);const{clientWidth:e,clientHeight:s}=t;[t.width,t.height]=[e,s]}else throw new Error("canvas-unsupported code here");else throw new Error("canvas is not HTMLCanvasElement")}getDefaultCenterLocation(){const{canvas:i,rect:t,defaultCenter:e}=this;if(!i)return console.error("canvas is not HTMLCanvasElement");const{width:s,height:n}=t.value,{top:r,bottom:a,left:l,right:h}=e,c={vertical:(g,y)=>{if([0,"0","0%"].includes(g))return 0;if(!(g==1/0||g==-1/0))return typeof g=="number"?g:["top","left"].includes(g)?0:["bottom","right"].includes(g)?y:["middle","center"].includes(g)?y/2:/^(\d+)%$/.test(g)?(g=g.match(/^(\d+)%$/)[1],y*Number(g)/100):Number(g)||void 0},reverse:(g,y)=>{if([0,"0","0%"].includes(g))return y;if(g==1/0||g==-1/0)return;if(typeof g=="number")return y-g;const v=c.vertical(g,y);return v?y-v:void 0}},f=(g,y,v)=>{if(g!==void 0){const P=c.vertical(g,v);if(P!==void 0)return P}if(y!==void 0){const P=c.reverse(y,v);if(P!==void 0)return P}return v/2},u=f(r,a,n);return{x:f(l,h,s),y:u}}updateCenter(){const{x:i,y:t}=this.getDefaultCenterLocation();this.center={x:Math.floor(i+this.offset.x),y:Math.floor(t+this.offset.y)}}updateSize(){const{scale:i,axisConfig:t}=this;t.size=this.getGridSize(i),this.percentage=this.getAxisPointByValue(t.count,0).x/t.min}setScale(i,t){const{canvas:e,lockDragAndResize:s,axisConfig:n}=this,r=this.rect.value;if(s)return;if(!e||!r)return console.error("canvas is not HTMLCanvasElement");let a,l;i==="center"?(a=r.left+r.width/2,l=r.top+r.height/2):[a,l]=[i.clientX,i.clientY];const h=this.getMousePositionOnAxis({clientX:a,clientY:l}),c=this.getAxisValueByPoint(h.x,h.y);this.scale=new V(this.scale).add(t).toNumber(),this.isScaleUpdated=!0,this.updateSize();const f=this.getAxisPointByValue(c.xV,c.yV);this.offset.x-=(f.x-h.x)*n.x,this.offset.y-=(f.y-h.y)*n.y,this.offset.x=Number(this.offset.x.toFixed(0)),this.offset.y=Number(this.offset.y.toFixed(0))}setAxis(i){const t={...this.axisConfig,...i},e=Object.fromEntries(Object.entries(t).map(([g,y])=>[g,Number(y)])),{x:s,y:n,count:r,min:a,size:l}=e,h=[1,-1].includes(s),c=[1,-1].includes(n),f=r>0,u=a>0,m=l>=a&&l<=a*2;if(!h||!c||!f||!u||!m){console.warn("Invalid axis configuration:",{x:s,y:n,count:r,min:a,size:l});return}this.axisConfig=e}setDefaultCenter(i){Object.assign(this.defaultCenter,i)}getGridSize(i){const{cycle:t,delta:e,axisConfig:s}=this;let n=new V(i).sub(1).abs().mod(t*e).div(e).toNumber();return n=i<1&&n!=0?t-n:n,Number(((n/t+1)*s.min).toFixed(0))}getGridCount(i){const{axisConfig:t,cycle:e,delta:s}=this,n=t.count,r=e*s;if(i===1)return n;if(i>1){const a=new V(i).sub(1).div(r).floor();return new V(n).div(new V(2).pow(a)).toNumber()}else{const a=new V(1).sub(i).div(r).ceil();return new V(n).mul(new V(2).pow(a)).toNumber()}}get getNowGridCount(){const{scale:i,nowGridCount:t,isRendering:e}=this;return t&&e?t:(this.nowGridCount=this.getGridCount(i),e&&Promise.resolve().then(()=>this.nowGridCount=void 0),this.nowGridCount)}getMousePositionOnAxis(i){const{canvas:t,center:e,rect:s,axisConfig:n}=this;if(!t)return console.error("canvas is not HTMLCanvasElement");const{clientX:r,clientY:a}=i,{left:l,top:h}=s.value,c=(r-l-e.x)*n.x,f=(a-h-e.y)*n.y;return{x:c,y:f}}getAxisValueByPoint(i,t,e){const{axisConfig:s}=this;if(e)return{xV:i/s.min*s.count,yV:t/s.min*s.count};const n=this.getNowGridCount,r=new V(i).div(s.size).mul(n).toFixed(8),a=new V(t).div(s.size).mul(n).toFixed(8);return{xV:Number(r),yV:Number(a)}}getAxisPointByValue(i,t,e){const{axisConfig:s}=this;if(e)return{x:i/s.count*s.min,y:t/s.count*s.min};const n=this.getNowGridCount,r=new V(i).div(n).mul(s.size).toFixed(3),a=new V(t).div(n).mul(s.size).toFixed(3);return{x:Number(r),y:Number(a)}}getMaxMinValue(i){i=i||this.rect.value;const{left:t,top:e,right:s,bottom:n}=i,{axisConfig:r}=this,{x:a,y:l}=this.getMousePositionOnAxis({clientX:r.x==1?t:s,clientY:r.y==1?e:n}),{xV:h,yV:c}=this.getAxisValueByPoint(a,l),{x:f,y:u}=this.getMousePositionOnAxis({clientX:r.x==1?s:t,clientY:r.y==1?n:e}),{xV:m,yV:g}=this.getAxisValueByPoint(f,u);return{minXV:h,maxXV:m,minYV:c,maxYV:g}}transformPosition(i){const{center:t,percentage:e,axisConfig:s}=this,n=[];for(let r=0;r<i.length;r++){let[a,l]=i[r];a=t.x+a*e*s.x,l=t.y+l*e*s.y,n.push([a,l])}return n}}class je extends Ue{constructor(t){super(t);d(this,"theme","light");d(this,"isThemeUpdated",!1);d(this,"style",{light:{background:"#fff",text:{color:"#222",secondary:"#909399",stroke:"#fff",size:12,family:"monospace",bold:!0},grid:{axis:"#222",grid:"#666",innerGrid:"#e5e5e5"},point:{radius:5,fill:"#d03050",width:14,stroke:"#d0305080"},line:{color:"#f0a020",width:4,dash:!1,dashGap:[5,10],dashOffset:0,cap:"round",join:"round",point:{radius:5,stroke:"#f0a02080",width:14,fill:"#f0a020"}},polygon:{fill:"#18a05830",stroke:"#18a058",fill_hover:"#03693360",stroke_hover:"#036933",width:1,dash:!1,dashGap:[5,10],dashOffset:0,point:{radius:5,stroke:"#03693380",width:14,fill:"#036933"}}},dark:{background:"#000",text:{color:"#aeaeae",secondary:"#8c8c8c",stroke:"#000",size:12,family:"monospace",bold:!0},grid:{axis:"#aeaeae",grid:"#666",innerGrid:"#454545"},point:{radius:5,fill:"#e88080",width:14,stroke:"#e8808070"},line:{color:"#f2c97d",width:4,dash:!1,dashGap:[5,10],dashOffset:0,cap:"round",join:"round",point:{radius:5,stroke:"#f2c97d80",width:14,fill:"#f2c97d"}},polygon:{fill:"#63e2b730",stroke:"#63e2b7",fill_hover:"#7efbd160",stroke_hover:"#7efbd1",width:1,dash:!1,dashGap:[5,10],dashOffset:0,point:{radius:5,stroke:"#7efbd180",width:14,fill:"#7efbd1"}}}});this.initStyle(),this.clearScreen()}initStyle(){const{canvas:t,ctx:e,theme:s}=this;t.classList.add("_nhanh_canvas");const n=this.style[s];e.font=`${n.text.bold?"bold":""} ${n.text.size}px ${n.text.family}`}clearScreen(){const{ctx:t,theme:e,rect:s}=this,{width:n,height:r}=s.value;t.fillStyle=this.style[e].background,t.fillRect(0,0,n,r)}setStyle(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e)){const s=It(this.style[e]||this.style[this.theme]);Zt(s,t[e]),this.style[e]=s}this.initStyle()}setTheme(t){t in this.style&&(this.theme=t,this.isThemeUpdated=!0)}}class Ze extends je{constructor(t){super(t);d(this,"resizeObserver");d(this,"currentDrawOverlays",[]);d(this,"rely","");d(this,"isRecalculate",!1);d(this,"notifyReload");d(this,"maxMinValue",{minXV:0,maxXV:0,minYV:0,maxYV:0});d(this,"measureRedrawPerformance",Jt(()=>this.redraw(),[[1,"#F56C6C"],[.5,"#E6A23C"],[0,"#67C23A"]]));this.canvas&&(this.resizeObserver=new ResizeObserver($t(()=>{const e=this.rect.value;[this.canvas.width,this.canvas.height]=[e.width,e.height],this.redrawOnce()},200)),this.resizeObserver.observe(this.canvas)),this.updateRely(),this.isRecalculate=!1}updateRely(){const{center:t,scale:e,rect:s,axisConfig:n}=this,r=[t.x,t.y,e,JSON.stringify(n),s.value.width,s.value.height].join();this.isRecalculate=this.rely!==r,this.rely=r}redraw(){var n,r;if(!this.canvas)return console.error("canvas is not HTMLCanvasElement");if(this.canvas.clientWidth==0||this.canvas.clientHeight==0)return console.error("The image argument is a canvas element with a width or height of 0.");this.updateCenter(),this.updateRely(),this.maxMinValue=this.getMaxMinValue(),this.clearScreen();const t=[];let e=[];const s=(n=this.drawAxis)==null?void 0:n.drawAxisAndGrid();s&&e.push([0,s,[]]),this.layerGroups.forEach(a=>e=e.concat(a.fetchCanvas())),e.sort((a,l)=>a[0]-l[0]),e.forEach(([,a,l],h)=>{this.ctx.drawImage(a,0,0),l.forEach(([[c,f],u])=>{t.push([[c+h,f],u])})}),t.sort(([[a,l],h],[[c,f],u])=>{if(h.isClick)return-1;if(u.isClick)return 1;if(a!==c)return c-a;if(l!==f)return f-l;const m=g=>g instanceof ct?0:g instanceof at?1:g instanceof $?2:g instanceof lt?3:g instanceof ht?4:5;return m(u)-m(h)}),this.currentDrawOverlays=t.map(([,a])=>a),this.isRecalculate=!1,this.isThemeUpdated=!1,this.isScaleUpdated=!1,(r=this.notifyReload)==null||r.call(this)}redrawOnce(){this.redrawInNextRenderFrame||(this.redrawInNextRenderFrame=!0,Promise.resolve().then(()=>{this.isRendering=!0,this.redrawInNextRenderFrame=!1,this.redraw(),this.isRendering=!1}))}findOverlayByPoint(t,e){return this.currentDrawOverlays.find(s=>s.isPointInAnywhere(t,e))}destroy(){var t;(t=this.resizeObserver)==null||t.disconnect()}}class $e extends Ze{constructor(t){super(t);d(this,"mouseInCanvas",!1);d(this,"mouseIsDown",!1);d(this,"mouseLastPosition",{x:0,y:0});d(this,"unBind");d(this,"lastClickedOverlay");d(this,"lockNotifyClick",!1);d(this,"lastPressedKey",{key:"",keyupTime:0,dblclick:!1});d(this,"lastDownOverlay");d(this,"lastHoverOverlay");d(this,"oldClientX",[]);d(this,"oldClientY",[]);this.initEvent()}initEvent(){const{canvas:t}=this;if(!t)return console.error("canvas is not HTMLCanvasElement");const e=[{type:"click",handler:this.click.bind(this)},{type:"contextmenu",handler:this.contextmenu.bind(this)},{type:"mouseenter",handler:this.mouseenter.bind(this)},{type:"mouseleave",handler:this.mouseleave.bind(this)},{type:"keydown",handler:this.keydown.bind(this),target:window},{type:"keyup",handler:this.keyup.bind(this),target:window},{type:"wheel",handler:this.wheel.bind(this)},{type:"mousedown",handler:this.mousedown.bind(this)},{type:"mouseup",handler:this.mouseup.bind(this),target:window},{type:"mousemove",handler:this.mousemove.bind(this),target:window},{type:"touchend",handler:this.touchend.bind(this)},{type:"touchmove",handler:this.touchmove.bind(this)}];e.forEach(({type:s,handler:n,target:r=t})=>{r.addEventListener(s,n)}),this.unBind=()=>{e.forEach(({type:s,handler:n,target:r=t})=>{r.removeEventListener(s,n)})}}click(t){var s;if(this.lockNotifyClick)return this.lockNotifyClick=!1;const e=this.findOverlayByPoint(t.offsetX,t.offsetY);this.lastClickedOverlay!=e&&((s=this.lastClickedOverlay)==null||s.notifyClick(!1,t.offsetX,t.offsetY)),e==null||e.notifyClick(!0,t.offsetX,t.offsetY),this.lastClickedOverlay=e}contextmenu(t){var e;t.preventDefault(),console.log("mousecontextmenu"),(e=this.lastClickedOverlay)==null||e.notifyClick(!1,t.offsetX,t.offsetY),this.lastClickedOverlay=void 0}mouseenter(t){this.mouseInCanvas=!0}mouseleave(t){this.mouseInCanvas=!1}getStep(t){const{lastPressedKey:e}=this;return e.dblclick?4:e.key===t&&Date.now()-e.keyupTime<300?(e.dblclick=!0,4):1}keydown(t){const{mouseInCanvas:e,offset:s,delta:n,lockDragAndResize:r}=this,a=t.key;if(e&&!r&&!this.isAuto){const l=this.getStep(a);switch(a){case"ArrowUp":s.y-=l;break;case"ArrowDown":s.y+=l;break;case"ArrowLeft":s.x-=l;break;case"ArrowRight":s.x+=l;break;case"+":this.setScale("center",n);break;case"-":this.setScale("center",-n);break}["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","+","-"].includes(a)&&this.redrawOnce()}}keyup(t){const{mouseInCanvas:e,lastPressedKey:s}=this;if(e){const n=t.key;s.key=n,s.keyupTime=Date.now(),s.dblclick=!1}}wheel(t){t.preventDefault();const{delta:e,lockDragAndResize:s}=this;s||this.isAuto||(this.setScale(t,t.deltaY<0?e:-e),this.redrawOnce())}mousedown(t){var r;this.mouseIsDown=!0;const{clientX:e,clientY:s}=t;this.mouseLastPosition={x:e,y:s};const n=this.findOverlayByPoint(t.offsetX,t.offsetY);this.lastDownOverlay!=n&&((r=this.lastDownOverlay)==null||r.notifyDown(!1,t.offsetX,t.offsetY),n==null||n.notifyDown(!0,t.offsetX,t.offsetY)),this.lastDownOverlay=n}mouseup(t){this.mouseIsDown=!1,this.lastDownOverlay=void 0}mousemove(t){const{clientX:e,clientY:s}=t;this.isAuto||(this.mouseIsDown?this.handleDragMove(e,s):this.handleHover(t))}handleDragMove(t,e){const{lockDragAndResize:s,lastDownOverlay:n}=this;s||(n!=null&&n.draggable?this.notifyDraggableOverlays(t,e):this.handleCanvasPan(t,e),this.mouseLastPosition={x:t,y:e},this.lockNotifyClick=!0)}notifyDraggableOverlays(t,e){const s=this.lastDownOverlay,{mouseLastPosition:n}=this,r=s.sharedHoverOverlays||[];r.includes(s)||r.push(s),r.forEach(a=>{a.notifyDraggable(t-n.x,e-n.y)})}handleCanvasPan(t,e){const{offset:s,mouseLastPosition:n}=this;s.x+=t-n.x,s.y+=e-n.y,this.redrawOnce()}handleHover(t){const{clientX:e,clientY:s}=t,n=this.rect.value,r=e-n.x,a=s-n.y;if(r<0||a<0||r>n.width||a>n.height)return;const l=this.findOverlayByPoint(t.offsetX,t.offsetY);this.updateHoverState(l,t)}updateHoverState(t,e){var n;if(this.lastHoverOverlay===t)return;this.lastHoverOverlay&&t&&((n=t.sharedHoverOverlays)==null?void 0:n.includes(this.lastHoverOverlay))||(this.clearHoverState(e),this.applyHoverState(t,e)),this.lastHoverOverlay=t}clearHoverState(t){this.lastHoverOverlay&&(this.canvas.classList.remove(this.getHoverClass(this.lastHoverOverlay)),this.notifyHoverOverlays(this.lastHoverOverlay,t,!1))}applyHoverState(t,e){t&&(this.canvas.classList.add(this.getHoverClass(t)),this.notifyHoverOverlays(t,e,!0))}notifyHoverOverlays(t,e,s){const n=t.sharedHoverOverlays||[];n.includes(t)||n.push(t),n.forEach(r=>{r.notifyHover(s,e.offsetX,e.offsetY)})}getHoverClass(t){return t.draggable?"_nhanh_canvas_hover_overlay_draggable":"_nhanh_canvas_hover_overlay"}touchend(t){this.oldClientX=this.oldClientY=[]}touchmove(t){const e=t.touches;t.preventDefault();const{oldClientX:s,oldClientY:n,offset:r,delta:a,lockDragAndResize:l,isAuto:h}=this;if(!l&&!h){if(e.length===1){const{clientX:c,clientY:f}=e[0];s.length&&(r.x+=c-s[0],r.y+=f-n[0],this.redrawOnce()),this.oldClientX=[c],this.oldClientY=[f]}else if(e.length===2){const{clientX:c,clientY:f}=e[0],{clientX:u,clientY:m}=e[1];if(s.length==2){const g=Vt(s[0],n[0],s[1],n[1]),y=Vt(c,f,u,m),{x:v,y:P}=Mt(c,f,u,m);this.setScale({clientX:v,clientY:P},y>g?a:-a),this.redrawOnce()}this.oldClientX=[c,u],this.oldClientY=[f,m]}}}destroy(){var t;super.destroy(),(t=this.unBind)==null||t.call(this)}}class Je extends $e{getDefaultOverlayGroup(){var a,l,h,c,f;const i=this.layerGroups.get("");if(!i)return;const t=(a=i.getLayer(""))==null?void 0:a.getGroup(""),e=(l=i.getLayer(""))==null?void 0:l.getGroup(""),s=(h=i.getLayer(""))==null?void 0:h.getGroup(""),n=(c=i.getLayer(""))==null?void 0:c.getGroup(""),r=(f=i.getLayer(""))==null?void 0:f.getGroup("");return{overlays_text:n,overlays_point:t,overlays_line:e,overlays_polygon:s,overlays_custom:r}}getAllOverlays(i){const t=[],e=i!==void 0?Array.isArray(i)?[...i]:[i]:Array.from(this.layerGroups.values());for(;e.length>0;){const s=e.pop();if(s instanceof tt){if(!s.show.show)continue;e.push(...s.layers.values())}else if(s instanceof z){if(!s.show.show)continue;e.push(...s.groups.values())}else if(s instanceof B){if(!s.show.show)continue;e.push(...s.overlays.values())}else s.show.show&&t.push(s)}return t}setFitView(i=void 0,t=!1,e=[60,60,60,60],s){const n=this.getAllOverlays(i);if(n.length===0)return;const{minX:r,maxX:a,minY:l,maxY:h}=this.calculateBoundingBox(n),c=a-r,f=h-l,u=this.calculateOptimalScale(c,f,e,s),m=this.calculateOffsetDifference(r,a,l,h,e);u==this.scale&&m.x==0&&m.y==0||(t?this.applyTransformImmediately(u,m):this.animateTransform(u,m))}calculateBoundingBox(i){let t=1/0,e=-1/0,s=1/0,n=-1/0;for(const r of i){const a=r.staticValueScope;t=Math.min(t,a.minX),e=Math.max(e,a.maxX),s=Math.min(s,a.minY),n=Math.max(n,a.maxY)}return{minX:t,maxX:e,minY:s,maxY:n}}calculateOptimalScale(i,t,e,s){const{width:n,height:r}=this.rect.value,{cycle:a,delta:l,axisConfig:h}=this,c=Math.max(0,n-e[1]-e[3])||n,f=Math.max(0,r-e[0]-e[2])||r;if(c<=0||f<=0)return console.warn(""),this.scale;const u=i/c,m=t/f,g=Math.max(u,m),y=h.count,v=y/h.min,P=a*l;let O;if(g>v){const S=Math.ceil(g/v);O=1-((y*S/g-h.min)/h.min+(S-2))*P}else{const S=Math.floor(Math.sqrt(v/g)),k=Math.pow(2,S);O=1+((y/k/g-h.min)/h.min+S)*P}return s!==void 0&&(O=Math.min(s,O)),O=new V(O).div(l).round().mul(l).toNumber(),O}calculateOffsetDifference(i,t,e,s,n){const{width:r,height:a}=this.rect.value,{axisConfig:l,center:h}=this,c=(t+i)/2,f=(s+e)/2,u=this.getAxisPointByValue(c,f),m=this.getAxisValueByPoint((r/2-h.x)*l.x,(a/2-h.y)*l.y),g=this.getAxisPointByValue(m.xV,m.yV);return{x:Math.round(-(u.x+(n[3]-n[1])-g.x)*l.x),y:Math.round(-(u.y+(n[0]-n[2])-g.y)*l.y)}}applyTransformImmediately(i,t){this.offset={x:this.offset.x+t.x,y:this.offset.y+t.y},this.scale=i,this.updateSize(),this.redrawOnce()}animateTransform(i,t){const e=this.scale,s={...this.offset},n=300;this.isAuto=!0;const r=()=>this.isAuto=!1;(h=>this.animateOffset(s,t,n,h||r))(h=>this.animateScale(e,i,n,h||r))}animateScale(i,t,e,s){const n=t-i;let r=0;ft(a=>{!this.isAuto||!this.canvas||this.lockDragAndResize||(this.setScale("center",(a-r)*n),r=a,this.redrawOnce(),a===1&&s())},e)}animateOffset(i,t,e,s){ft(n=>{!this.isAuto||!this.canvas||this.lockDragAndResize||(this.offset={x:Number((i.x+t.x*n).toFixed(0)),y:Number((i.y+t.y*n).toFixed(0))},this.redrawOnce(),n===1&&s())},e)}returnToOrigin(){if(this.lockDragAndResize||this.scale==1&&this.offset.x==0&&this.offset.y==0)return;const{rect:i,axisConfig:t}=this,e=this.getDefaultCenterLocation(),s=(i.value.width/2-e.x)*t.x,n=(i.value.height/2-e.y)*t.y,r=this.getAxisValueByPoint(s,n,!0),a=this.getMousePositionOnAxis({clientX:i.value.x+i.value.width/2,clientY:i.value.y+i.value.height/2}),l=this.getAxisValueByPoint(a.x,a.y),h=t.size/this.getNowGridCount,c=(l.xV-r.xV)*t.x*h,f=(l.yV-r.yV)*t.y*h;this.animateTransform(1,{x:c,y:f})}zoom(i){const{canvas:t,rect:e}=this;if(!t||!e)return console.error("canvas is not HTMLCanvasElement");this.setScale("center",i),this.redrawOnce()}zoomIn(){this.zoom(this.delta)}zoomOut(){this.zoom(-this.delta)}setStyle(i){super.setStyle(i),this.redrawOnce()}setTheme(i){super.setTheme(i),this.redrawOnce()}setAxis(i){super.setAxis(i),this.redrawOnce()}setDefaultCenter(i){super.setDefaultCenter(i),this.redrawOnce()}toggleAxis(i){this.drawAxis.toggleAxis(i),this.redrawOnce()}togglePoint(i){const{overlays_point:t}=this.getDefaultOverlayGroup()||{};return t?(t.show.setShow(i??!t.show),this.redrawOnce(),t.show):!1}toggleLine(i){const{overlays_line:t}=this.getDefaultOverlayGroup()||{};return t?(t.show.setShow(i??!t.show),this.redrawOnce(),t.show):!1}togglePolygon(i){const{overlays_polygon:t}=this.getDefaultOverlayGroup()||{};return t?(t.show.setShow(i??!t.show),this.redrawOnce(),t.show):!1}toggleLock(i){return this.lockDragAndResize=i??!this.lockDragAndResize,this.lockDragAndResize}}class q extends Je{constructor(i,t){if(super(i),this.drawAxis=new Fe(this),t){const{theme:e,axisConfig:s,axisShow:n,defaultCenter:r,offset:a}=t;e&&this.setTheme(e),s&&this.setAxis(s),n&&this.toggleAxis(n),r&&this.setDefaultCenter(r),a&&(this.offset.x=a.x||0,this.offset.y=a.y||0)}this.initLayerGroups(),this.updateCenter()}initLayerGroups(){const i=new z("");i.addGroup(new B("")),i.setzIndex(1);const t=new z("");t.addGroup(new B("")),t.setzIndex(2);const e=new z("");e.addGroup(new B("")),e.setzIndex(3);const s=new z("");s.addGroup(new B("")),s.setzIndex(4);const n=new z("");n.addGroup(new B("")),n.setzIndex(5);const r=new tt("");r.addLayer([s,e,t,i,n]),this.setLayerGroups(r)}gteLayerGroups(i){return this.layerGroups.get(i)}setLayerGroups(i){i instanceof tt&&(this.layerGroups.set(i.name,i),i.setNotifyReload(()=>this.redrawOnce()),i.setMainCanvas(this))}removeLayerGroups(i){i instanceof tt&&(this.layerGroups.delete(i.name),i.setNotifyReload(),i.setMainCanvas(),this.redrawOnce())}addLayer(i){const t=this.layerGroups.get("");t&&t.addLayer([i].flat())}removeLayer(i){const t=this.layerGroups.get("");t&&t.removeLayer([i].flat())}addOverlay(i){const{overlays_text:t,overlays_point:e,overlays_line:s,overlays_polygon:n,overlays_custom:r}=this.getDefaultOverlayGroup()||{};[i].flat().forEach(a=>{a instanceof at?t==null||t.addOverlays(a):a instanceof $?e==null||e.addOverlays(a):a instanceof lt?s==null||s.addOverlays(a):a instanceof ht?n==null||n.addOverlays(a):a instanceof ct&&(r==null||r.addOverlays(a))})}removeOverlay(i){const{overlays_text:t,overlays_point:e,overlays_line:s,overlays_polygon:n,overlays_custom:r}=this.getDefaultOverlayGroup()||{};[i].flat().forEach(a=>{a instanceof at?t==null||t.removeOverlays(a):a instanceof $?e==null||e.removeOverlays(a):a instanceof lt?s==null||s.removeOverlays(a):a instanceof ht?n==null||n.removeOverlays(a):a instanceof ct&&(r==null||r.addOverlays(a))})}destroy(){super.destroy()}}d(q,"LayerGroup",tt),d(q,"Layer",z),d(q,"OverlayGroup",B),d(q,"Text",at),d(q,"Point",$),d(q,"Line",lt),d(q,"Polygon",ht),d(q,"Custom",ct);export{L as D,q as _};
