var te=Object.defineProperty;var ee=(r,n,t)=>n in r?te(r,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[n]=t;var d=(r,n,t)=>ee(r,typeof n!="symbol"?n+"":n,t);import{db as At,aQ as ie,dc as Gt,dd as yt,c6 as vt,de as se,df as Xt,dg as nt,dh as ne,aR as re,di as ae,dj as Mt}from"./index-Bas7IHTD.js";/*!
 *  decimal.js v10.5.0
 *  An arbitrary-precision Decimal type for JavaScript.
 *  https://github.com/MikeMcl/decimal.js
 *  Copyright (c) 2025 Michael Mclaughlin <M8ch88l@gmail.com>
 *  MIT Licence
 */var tt=9e15,J=1e9,_t="0123456789abcdef",wt="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",Pt="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",kt={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-tt,maxE:tt,crypto:!1},Yt,z,C=!0,Ct="[DecimalError] ",Z=Ct+"Invalid argument: ",Ut=Ct+"Precision limit exceeded",Ft=Ct+"crypto unavailable",zt="[object Decimal]",A=Math.floor,N=Math.pow,oe=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,le=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,he=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,Wt=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,B=1e7,x=7,ce=9007199254740991,ue=wt.length-1,Rt=Pt.length-1,m={toStringTag:zt};m.absoluteValue=m.abs=function(){var r=new this.constructor(this);return r.s<0&&(r.s=1),P(r)};m.ceil=function(){return P(new this.constructor(this),this.e+1,2)};m.clampedTo=m.clamp=function(r,n){var t,e=this,i=e.constructor;if(r=new i(r),n=new i(n),!r.s||!n.s)return new i(NaN);if(r.gt(n))throw Error(Z+n);return t=e.cmp(r),t<0?r:e.cmp(n)>0?n:new i(e)};m.comparedTo=m.cmp=function(r){var n,t,e,i,s=this,a=s.d,o=(r=new s.constructor(r)).d,l=s.s,h=r.s;if(!a||!o)return!l||!h?NaN:l!==h?l:a===o?0:!a^l<0?1:-1;if(!a[0]||!o[0])return a[0]?l:o[0]?-h:0;if(l!==h)return l;if(s.e!==r.e)return s.e>r.e^l<0?1:-1;for(e=a.length,i=o.length,n=0,t=e<i?e:i;n<t;++n)if(a[n]!==o[n])return a[n]>o[n]^l<0?1:-1;return e===i?0:e>i^l<0?1:-1};m.cosine=m.cos=function(){var r,n,t=this,e=t.constructor;return t.d?t.d[0]?(r=e.precision,n=e.rounding,e.precision=r+Math.max(t.e,t.sd())+x,e.rounding=1,t=fe(e,Jt(e,t)),e.precision=r,e.rounding=n,P(z==2||z==3?t.neg():t,r,n,!0)):new e(1):new e(NaN)};m.cubeRoot=m.cbrt=function(){var r,n,t,e,i,s,a,o,l,h,c=this,u=c.constructor;if(!c.isFinite()||c.isZero())return new u(c);for(C=!1,s=c.s*N(c.s*c,1/3),!s||Math.abs(s)==1/0?(t=H(c.d),r=c.e,(s=(r-t.length+1)%3)&&(t+=s==1||s==-2?"0":"00"),s=N(t,1/3),r=A((r+1)/3)-(r%3==(r<0?-1:2)),s==1/0?t="5e"+r:(t=s.toExponential(),t=t.slice(0,t.indexOf("e")+1)+r),e=new u(t),e.s=c.s):e=new u(s.toString()),a=(r=u.precision)+3;;)if(o=e,l=o.times(o).times(o),h=l.plus(c),e=_(h.plus(c).times(o),h.plus(l),a+2,1),H(o.d).slice(0,a)===(t=H(e.d)).slice(0,a))if(t=t.slice(a-3,a+1),t=="9999"||!i&&t=="4999"){if(!i&&(P(o,r+1,0),o.times(o).times(o).eq(c))){e=o;break}a+=4,i=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(P(e,r+1,1),n=!e.times(e).times(e).eq(c));break}return C=!0,P(e,r,u.rounding,n)};m.decimalPlaces=m.dp=function(){var r,n=this.d,t=NaN;if(n){if(r=n.length-1,t=(r-A(this.e/x))*x,r=n[r],r)for(;r%10==0;r/=10)t--;t<0&&(t=0)}return t};m.dividedBy=m.div=function(r){return _(this,new this.constructor(r))};m.dividedToIntegerBy=m.divToInt=function(r){var n=this,t=n.constructor;return P(_(n,new t(r),0,1,1),t.precision,t.rounding)};m.equals=m.eq=function(r){return this.cmp(r)===0};m.floor=function(){return P(new this.constructor(this),this.e+1,3)};m.greaterThan=m.gt=function(r){return this.cmp(r)>0};m.greaterThanOrEqualTo=m.gte=function(r){var n=this.cmp(r);return n==1||n===0};m.hyperbolicCosine=m.cosh=function(){var r,n,t,e,i,s=this,a=s.constructor,o=new a(1);if(!s.isFinite())return new a(s.s?1/0:NaN);if(s.isZero())return o;t=a.precision,e=a.rounding,a.precision=t+Math.max(s.e,s.sd())+4,a.rounding=1,i=s.d.length,i<32?(r=Math.ceil(i/3),n=(1/St(4,r)).toString()):(r=16,n="2.3283064365386962890625e-10"),s=et(a,1,s.times(n),new a(1),!0);for(var l,h=r,c=new a(8);h--;)l=s.times(s),s=o.minus(l.times(c.minus(l.times(c))));return P(s,a.precision=t,a.rounding=e,!0)};m.hyperbolicSine=m.sinh=function(){var r,n,t,e,i=this,s=i.constructor;if(!i.isFinite()||i.isZero())return new s(i);if(n=s.precision,t=s.rounding,s.precision=n+Math.max(i.e,i.sd())+4,s.rounding=1,e=i.d.length,e<3)i=et(s,2,i,i,!0);else{r=1.4*Math.sqrt(e),r=r>16?16:r|0,i=i.times(1/St(5,r)),i=et(s,2,i,i,!0);for(var a,o=new s(5),l=new s(16),h=new s(20);r--;)a=i.times(i),i=i.times(o.plus(a.times(l.times(a).plus(h))))}return s.precision=n,s.rounding=t,P(i,n,t,!0)};m.hyperbolicTangent=m.tanh=function(){var r,n,t=this,e=t.constructor;return t.isFinite()?t.isZero()?new e(t):(r=e.precision,n=e.rounding,e.precision=r+7,e.rounding=1,_(t.sinh(),t.cosh(),e.precision=r,e.rounding=n)):new e(t.s)};m.inverseCosine=m.acos=function(){var r=this,n=r.constructor,t=r.abs().cmp(1),e=n.precision,i=n.rounding;return t!==-1?t===0?r.isNeg()?X(n,e,i):new n(0):new n(NaN):r.isZero()?X(n,e+4,i).times(.5):(n.precision=e+6,n.rounding=1,r=new n(1).minus(r).div(r.plus(1)).sqrt().atan(),n.precision=e,n.rounding=i,r.times(2))};m.inverseHyperbolicCosine=m.acosh=function(){var r,n,t=this,e=t.constructor;return t.lte(1)?new e(t.eq(1)?0:NaN):t.isFinite()?(r=e.precision,n=e.rounding,e.precision=r+Math.max(Math.abs(t.e),t.sd())+4,e.rounding=1,C=!1,t=t.times(t).minus(1).sqrt().plus(t),C=!0,e.precision=r,e.rounding=n,t.ln()):new e(t)};m.inverseHyperbolicSine=m.asinh=function(){var r,n,t=this,e=t.constructor;return!t.isFinite()||t.isZero()?new e(t):(r=e.precision,n=e.rounding,e.precision=r+2*Math.max(Math.abs(t.e),t.sd())+6,e.rounding=1,C=!1,t=t.times(t).plus(1).sqrt().plus(t),C=!0,e.precision=r,e.rounding=n,t.ln())};m.inverseHyperbolicTangent=m.atanh=function(){var r,n,t,e,i=this,s=i.constructor;return i.isFinite()?i.e>=0?new s(i.abs().eq(1)?i.s/0:i.isZero()?i:NaN):(r=s.precision,n=s.rounding,e=i.sd(),Math.max(e,r)<2*-i.e-1?P(new s(i),r,n,!0):(s.precision=t=e-i.e,i=_(i.plus(1),new s(1).minus(i),t+r,1),s.precision=r+4,s.rounding=1,i=i.ln(),s.precision=r,s.rounding=n,i.times(.5))):new s(NaN)};m.inverseSine=m.asin=function(){var r,n,t,e,i=this,s=i.constructor;return i.isZero()?new s(i):(n=i.abs().cmp(1),t=s.precision,e=s.rounding,n!==-1?n===0?(r=X(s,t+4,e).times(.5),r.s=i.s,r):new s(NaN):(s.precision=t+6,s.rounding=1,i=i.div(new s(1).minus(i.times(i)).sqrt().plus(1)).atan(),s.precision=t,s.rounding=e,i.times(2)))};m.inverseTangent=m.atan=function(){var r,n,t,e,i,s,a,o,l,h=this,c=h.constructor,u=c.precision,f=c.rounding;if(h.isFinite()){if(h.isZero())return new c(h);if(h.abs().eq(1)&&u+4<=Rt)return a=X(c,u+4,f).times(.25),a.s=h.s,a}else{if(!h.s)return new c(NaN);if(u+4<=Rt)return a=X(c,u+4,f).times(.5),a.s=h.s,a}for(c.precision=o=u+10,c.rounding=1,t=Math.min(28,o/x+2|0),r=t;r;--r)h=h.div(h.times(h).plus(1).sqrt().plus(1));for(C=!1,n=Math.ceil(o/x),e=1,l=h.times(h),a=new c(h),i=h;r!==-1;)if(i=i.times(l),s=a.minus(i.div(e+=2)),i=i.times(l),a=s.plus(i.div(e+=2)),a.d[n]!==void 0)for(r=n;a.d[r]===s.d[r]&&r--;);return t&&(a=a.times(2<<t-1)),C=!0,P(a,c.precision=u,c.rounding=f,!0)};m.isFinite=function(){return!!this.d};m.isInteger=m.isInt=function(){return!!this.d&&A(this.e/x)>this.d.length-2};m.isNaN=function(){return!this.s};m.isNegative=m.isNeg=function(){return this.s<0};m.isPositive=m.isPos=function(){return this.s>0};m.isZero=function(){return!!this.d&&this.d[0]===0};m.lessThan=m.lt=function(r){return this.cmp(r)<0};m.lessThanOrEqualTo=m.lte=function(r){return this.cmp(r)<1};m.logarithm=m.log=function(r){var n,t,e,i,s,a,o,l,h=this,c=h.constructor,u=c.precision,f=c.rounding,g=5;if(r==null)r=new c(10),n=!0;else{if(r=new c(r),t=r.d,r.s<0||!t||!t[0]||r.eq(1))return new c(NaN);n=r.eq(10)}if(t=h.d,h.s<0||!t||!t[0]||h.eq(1))return new c(t&&!t[0]?-1/0:h.s!=1?NaN:t?0:1/0);if(n)if(t.length>1)s=!0;else{for(i=t[0];i%10===0;)i/=10;s=i!==1}if(C=!1,o=u+g,a=j(h,o),e=n?xt(c,o+10):j(r,o),l=_(a,e,o,1),st(l.d,i=u,f))do if(o+=10,a=j(h,o),e=n?xt(c,o+10):j(r,o),l=_(a,e,o,1),!s){+H(l.d).slice(i+1,i+15)+1==1e14&&(l=P(l,u+1,0));break}while(st(l.d,i+=10,f));return C=!0,P(l,u,f)};m.minus=m.sub=function(r){var n,t,e,i,s,a,o,l,h,c,u,f,g=this,y=g.constructor;if(r=new y(r),!g.d||!r.d)return!g.s||!r.s?r=new y(NaN):g.d?r.s=-r.s:r=new y(r.d||g.s!==r.s?g:NaN),r;if(g.s!=r.s)return r.s=-r.s,g.plus(r);if(h=g.d,f=r.d,o=y.precision,l=y.rounding,!h[0]||!f[0]){if(f[0])r.s=-r.s;else if(h[0])r=new y(g);else return new y(l===3?-0:0);return C?P(r,o,l):r}if(t=A(r.e/x),c=A(g.e/x),h=h.slice(),s=c-t,s){for(u=s<0,u?(n=h,s=-s,a=f.length):(n=f,t=c,a=h.length),e=Math.max(Math.ceil(o/x),a)+2,s>e&&(s=e,n.length=1),n.reverse(),e=s;e--;)n.push(0);n.reverse()}else{for(e=h.length,a=f.length,u=e<a,u&&(a=e),e=0;e<a;e++)if(h[e]!=f[e]){u=h[e]<f[e];break}s=0}for(u&&(n=h,h=f,f=n,r.s=-r.s),a=h.length,e=f.length-a;e>0;--e)h[a++]=0;for(e=f.length;e>s;){if(h[--e]<f[e]){for(i=e;i&&h[--i]===0;)h[i]=B-1;--h[i],h[e]+=B}h[e]-=f[e]}for(;h[--a]===0;)h.pop();for(;h[0]===0;h.shift())--t;return h[0]?(r.d=h,r.e=bt(h,t),C?P(r,o,l):r):new y(l===3?-0:0)};m.modulo=m.mod=function(r){var n,t=this,e=t.constructor;return r=new e(r),!t.d||!r.s||r.d&&!r.d[0]?new e(NaN):!r.d||t.d&&!t.d[0]?P(new e(t),e.precision,e.rounding):(C=!1,e.modulo==9?(n=_(t,r.abs(),0,3,1),n.s*=r.s):n=_(t,r,0,e.modulo,1),n=n.times(r),C=!0,t.minus(n))};m.naturalExponential=m.exp=function(){return Ot(this)};m.naturalLogarithm=m.ln=function(){return j(this)};m.negated=m.neg=function(){var r=new this.constructor(this);return r.s=-r.s,P(r)};m.plus=m.add=function(r){var n,t,e,i,s,a,o,l,h,c,u=this,f=u.constructor;if(r=new f(r),!u.d||!r.d)return!u.s||!r.s?r=new f(NaN):u.d||(r=new f(r.d||u.s===r.s?u:NaN)),r;if(u.s!=r.s)return r.s=-r.s,u.minus(r);if(h=u.d,c=r.d,o=f.precision,l=f.rounding,!h[0]||!c[0])return c[0]||(r=new f(u)),C?P(r,o,l):r;if(s=A(u.e/x),e=A(r.e/x),h=h.slice(),i=s-e,i){for(i<0?(t=h,i=-i,a=c.length):(t=c,e=s,a=h.length),s=Math.ceil(o/x),a=s>a?s+1:a+1,i>a&&(i=a,t.length=1),t.reverse();i--;)t.push(0);t.reverse()}for(a=h.length,i=c.length,a-i<0&&(i=a,t=c,c=h,h=t),n=0;i;)n=(h[--i]=h[i]+c[i]+n)/B|0,h[i]%=B;for(n&&(h.unshift(n),++e),a=h.length;h[--a]==0;)h.pop();return r.d=h,r.e=bt(h,e),C?P(r,o,l):r};m.precision=m.sd=function(r){var n,t=this;if(r!==void 0&&r!==!!r&&r!==1&&r!==0)throw Error(Z+r);return t.d?(n=qt(t.d),r&&t.e+1>n&&(n=t.e+1)):n=NaN,n};m.round=function(){var r=this,n=r.constructor;return P(new n(r),r.e+1,n.rounding)};m.sine=m.sin=function(){var r,n,t=this,e=t.constructor;return t.isFinite()?t.isZero()?new e(t):(r=e.precision,n=e.rounding,e.precision=r+Math.max(t.e,t.sd())+x,e.rounding=1,t=ge(e,Jt(e,t)),e.precision=r,e.rounding=n,P(z>2?t.neg():t,r,n,!0)):new e(NaN)};m.squareRoot=m.sqrt=function(){var r,n,t,e,i,s,a=this,o=a.d,l=a.e,h=a.s,c=a.constructor;if(h!==1||!o||!o[0])return new c(!h||h<0&&(!o||o[0])?NaN:o?a:1/0);for(C=!1,h=Math.sqrt(+a),h==0||h==1/0?(n=H(o),(n.length+l)%2==0&&(n+="0"),h=Math.sqrt(n),l=A((l+1)/2)-(l<0||l%2),h==1/0?n="5e"+l:(n=h.toExponential(),n=n.slice(0,n.indexOf("e")+1)+l),e=new c(n)):e=new c(h.toString()),t=(l=c.precision)+3;;)if(s=e,e=s.plus(_(a,s,t+2,1)).times(.5),H(s.d).slice(0,t)===(n=H(e.d)).slice(0,t))if(n=n.slice(t-3,t+1),n=="9999"||!i&&n=="4999"){if(!i&&(P(s,l+1,0),s.times(s).eq(a))){e=s;break}t+=4,i=1}else{(!+n||!+n.slice(1)&&n.charAt(0)=="5")&&(P(e,l+1,1),r=!e.times(e).eq(a));break}return C=!0,P(e,l,c.rounding,r)};m.tangent=m.tan=function(){var r,n,t=this,e=t.constructor;return t.isFinite()?t.isZero()?new e(t):(r=e.precision,n=e.rounding,e.precision=r+10,e.rounding=1,t=t.sin(),t.s=1,t=_(t,new e(1).minus(t.times(t)).sqrt(),r+10,0),e.precision=r,e.rounding=n,P(z==2||z==4?t.neg():t,r,n,!0)):new e(NaN)};m.times=m.mul=function(r){var n,t,e,i,s,a,o,l,h,c=this,u=c.constructor,f=c.d,g=(r=new u(r)).d;if(r.s*=c.s,!f||!f[0]||!g||!g[0])return new u(!r.s||f&&!f[0]&&!g||g&&!g[0]&&!f?NaN:!f||!g?r.s/0:r.s*0);for(t=A(c.e/x)+A(r.e/x),l=f.length,h=g.length,l<h&&(s=f,f=g,g=s,a=l,l=h,h=a),s=[],a=l+h,e=a;e--;)s.push(0);for(e=h;--e>=0;){for(n=0,i=l+e;i>e;)o=s[i]+g[e]*f[i-e-1]+n,s[i--]=o%B|0,n=o/B|0;s[i]=(s[i]+n)%B|0}for(;!s[--a];)s.pop();return n?++t:s.shift(),r.d=s,r.e=bt(s,t),C?P(r,u.precision,u.rounding):r};m.toBinary=function(r,n){return Et(this,2,r,n)};m.toDecimalPlaces=m.toDP=function(r,n){var t=this,e=t.constructor;return t=new e(t),r===void 0?t:(I(r,0,J),n===void 0?n=e.rounding:I(n,0,8),P(t,r+t.e+1,n))};m.toExponential=function(r,n){var t,e=this,i=e.constructor;return r===void 0?t=Y(e,!0):(I(r,0,J),n===void 0?n=i.rounding:I(n,0,8),e=P(new i(e),r+1,n),t=Y(e,!0,r+1)),e.isNeg()&&!e.isZero()?"-"+t:t};m.toFixed=function(r,n){var t,e,i=this,s=i.constructor;return r===void 0?t=Y(i):(I(r,0,J),n===void 0?n=s.rounding:I(n,0,8),e=P(new s(i),r+i.e+1,n),t=Y(e,!1,r+e.e+1)),i.isNeg()&&!i.isZero()?"-"+t:t};m.toFraction=function(r){var n,t,e,i,s,a,o,l,h,c,u,f,g=this,y=g.d,p=g.constructor;if(!y)return new p(g);if(h=t=new p(1),e=l=new p(0),n=new p(e),s=n.e=qt(y)-g.e-1,a=s%x,n.d[0]=N(10,a<0?x+a:a),r==null)r=s>0?n:h;else{if(o=new p(r),!o.isInt()||o.lt(h))throw Error(Z+o);r=o.gt(n)?s>0?n:h:o}for(C=!1,o=new p(H(y)),c=p.precision,p.precision=s=y.length*x*2;u=_(o,n,0,1,1),i=t.plus(u.times(e)),i.cmp(r)!=1;)t=e,e=i,i=h,h=l.plus(u.times(i)),l=i,i=n,n=o.minus(u.times(i)),o=i;return i=_(r.minus(t),e,0,1,1),l=l.plus(i.times(h)),t=t.plus(i.times(e)),l.s=h.s=g.s,f=_(h,e,s,1).minus(g).abs().cmp(_(l,t,s,1).minus(g).abs())<1?[h,e]:[l,t],p.precision=c,C=!0,f};m.toHexadecimal=m.toHex=function(r,n){return Et(this,16,r,n)};m.toNearest=function(r,n){var t=this,e=t.constructor;if(t=new e(t),r==null){if(!t.d)return t;r=new e(1),n=e.rounding}else{if(r=new e(r),n===void 0?n=e.rounding:I(n,0,8),!t.d)return r.s?t:r;if(!r.d)return r.s&&(r.s=t.s),r}return r.d[0]?(C=!1,t=_(t,r,0,n,1).times(r),C=!0,P(t)):(r.s=t.s,t=r),t};m.toNumber=function(){return+this};m.toOctal=function(r,n){return Et(this,8,r,n)};m.toPower=m.pow=function(r){var n,t,e,i,s,a,o=this,l=o.constructor,h=+(r=new l(r));if(!o.d||!r.d||!o.d[0]||!r.d[0])return new l(N(+o,h));if(o=new l(o),o.eq(1))return o;if(e=l.precision,s=l.rounding,r.eq(1))return P(o,e,s);if(n=A(r.e/x),n>=r.d.length-1&&(t=h<0?-h:h)<=ce)return i=jt(l,o,t,e),r.s<0?new l(1).div(i):P(i,e,s);if(a=o.s,a<0){if(n<r.d.length-1)return new l(NaN);if(r.d[n]&1||(a=1),o.e==0&&o.d[0]==1&&o.d.length==1)return o.s=a,o}return t=N(+o,h),n=t==0||!isFinite(t)?A(h*(Math.log("0."+H(o.d))/Math.LN10+o.e+1)):new l(t+"").e,n>l.maxE+1||n<l.minE-1?new l(n>0?a/0:0):(C=!1,l.rounding=o.s=1,t=Math.min(12,(n+"").length),i=Ot(r.times(j(o,e+t)),e),i.d&&(i=P(i,e+5,1),st(i.d,e,s)&&(n=e+10,i=P(Ot(r.times(j(o,n+t)),n),n+5,1),+H(i.d).slice(e+1,e+15)+1==1e14&&(i=P(i,e+1,0)))),i.s=a,C=!0,l.rounding=s,P(i,e,s))};m.toPrecision=function(r,n){var t,e=this,i=e.constructor;return r===void 0?t=Y(e,e.e<=i.toExpNeg||e.e>=i.toExpPos):(I(r,1,J),n===void 0?n=i.rounding:I(n,0,8),e=P(new i(e),r,n),t=Y(e,r<=e.e||e.e<=i.toExpNeg,r)),e.isNeg()&&!e.isZero()?"-"+t:t};m.toSignificantDigits=m.toSD=function(r,n){var t=this,e=t.constructor;return r===void 0?(r=e.precision,n=e.rounding):(I(r,1,J),n===void 0?n=e.rounding:I(n,0,8)),P(new e(t),r,n)};m.toString=function(){var r=this,n=r.constructor,t=Y(r,r.e<=n.toExpNeg||r.e>=n.toExpPos);return r.isNeg()&&!r.isZero()?"-"+t:t};m.truncated=m.trunc=function(){return P(new this.constructor(this),this.e+1,1)};m.valueOf=m.toJSON=function(){var r=this,n=r.constructor,t=Y(r,r.e<=n.toExpNeg||r.e>=n.toExpPos);return r.isNeg()?"-"+t:t};function H(r){var n,t,e,i=r.length-1,s="",a=r[0];if(i>0){for(s+=a,n=1;n<i;n++)e=r[n]+"",t=x-e.length,t&&(s+=q(t)),s+=e;a=r[n],e=a+"",t=x-e.length,t&&(s+=q(t))}else if(a===0)return"0";for(;a%10===0;)a/=10;return s+a}function I(r,n,t){if(r!==~~r||r<n||r>t)throw Error(Z+r)}function st(r,n,t,e){var i,s,a,o;for(s=r[0];s>=10;s/=10)--n;return--n<0?(n+=x,i=0):(i=Math.ceil((n+1)/x),n%=x),s=N(10,x-n),o=r[i]%s|0,e==null?n<3?(n==0?o=o/100|0:n==1&&(o=o/10|0),a=t<4&&o==99999||t>3&&o==49999||o==5e4||o==0):a=(t<4&&o+1==s||t>3&&o+1==s/2)&&(r[i+1]/s/100|0)==N(10,n-2)-1||(o==s/2||o==0)&&(r[i+1]/s/100|0)==0:n<4?(n==0?o=o/1e3|0:n==1?o=o/100|0:n==2&&(o=o/10|0),a=(e||t<4)&&o==9999||!e&&t>3&&o==4999):a=((e||t<4)&&o+1==s||!e&&t>3&&o+1==s/2)&&(r[i+1]/s/1e3|0)==N(10,n-3)-1,a}function ut(r,n,t){for(var e,i=[0],s,a=0,o=r.length;a<o;){for(s=i.length;s--;)i[s]*=n;for(i[0]+=_t.indexOf(r.charAt(a++)),e=0;e<i.length;e++)i[e]>t-1&&(i[e+1]===void 0&&(i[e+1]=0),i[e+1]+=i[e]/t|0,i[e]%=t)}return i.reverse()}function fe(r,n){var t,e,i;if(n.isZero())return n;e=n.d.length,e<32?(t=Math.ceil(e/3),i=(1/St(4,t)).toString()):(t=16,i="2.3283064365386962890625e-10"),r.precision+=t,n=et(r,1,n.times(i),new r(1));for(var s=t;s--;){var a=n.times(n);n=a.times(a).minus(a).times(8).plus(1)}return r.precision-=t,n}var _=function(){function r(e,i,s){var a,o=0,l=e.length;for(e=e.slice();l--;)a=e[l]*i+o,e[l]=a%s|0,o=a/s|0;return o&&e.unshift(o),e}function n(e,i,s,a){var o,l;if(s!=a)l=s>a?1:-1;else for(o=l=0;o<s;o++)if(e[o]!=i[o]){l=e[o]>i[o]?1:-1;break}return l}function t(e,i,s,a){for(var o=0;s--;)e[s]-=o,o=e[s]<i[s]?1:0,e[s]=o*a+e[s]-i[s];for(;!e[0]&&e.length>1;)e.shift()}return function(e,i,s,a,o,l){var h,c,u,f,g,y,p,v,w,S,b,V,M,L,ot,K,W,Q,T,lt,ht=e.constructor,Vt=e.s==i.s?1:-1,E=e.d,k=i.d;if(!E||!E[0]||!k||!k[0])return new ht(!e.s||!i.s||(E?k&&E[0]==k[0]:!k)?NaN:E&&E[0]==0||!k?Vt*0:Vt/0);for(l?(g=1,c=e.e-i.e):(l=B,g=x,c=A(e.e/g)-A(i.e/g)),T=k.length,W=E.length,w=new ht(Vt),S=w.d=[],u=0;k[u]==(E[u]||0);u++);if(k[u]>(E[u]||0)&&c--,s==null?(L=s=ht.precision,a=ht.rounding):o?L=s+(e.e-i.e)+1:L=s,L<0)S.push(1),y=!0;else{if(L=L/g+2|0,u=0,T==1){for(f=0,k=k[0],L++;(u<W||f)&&L--;u++)ot=f*l+(E[u]||0),S[u]=ot/k|0,f=ot%k|0;y=f||u<W}else{for(f=l/(k[0]+1)|0,f>1&&(k=r(k,f,l),E=r(E,f,l),T=k.length,W=E.length),K=T,b=E.slice(0,T),V=b.length;V<T;)b[V++]=0;lt=k.slice(),lt.unshift(0),Q=k[0],k[1]>=l/2&&++Q;do f=0,h=n(k,b,T,V),h<0?(M=b[0],T!=V&&(M=M*l+(b[1]||0)),f=M/Q|0,f>1?(f>=l&&(f=l-1),p=r(k,f,l),v=p.length,V=b.length,h=n(p,b,v,V),h==1&&(f--,t(p,T<v?lt:k,v,l))):(f==0&&(h=f=1),p=k.slice()),v=p.length,v<V&&p.unshift(0),t(b,p,V,l),h==-1&&(V=b.length,h=n(k,b,T,V),h<1&&(f++,t(b,T<V?lt:k,V,l))),V=b.length):h===0&&(f++,b=[0]),S[u++]=f,h&&b[0]?b[V++]=E[K]||0:(b=[E[K]],V=1);while((K++<W||b[0]!==void 0)&&L--);y=b[0]!==void 0}S[0]||S.shift()}if(g==1)w.e=c,Yt=y;else{for(u=1,f=S[0];f>=10;f/=10)u++;w.e=u+c*g-1,P(w,o?s+w.e+1:s,a,y)}return w}}();function P(r,n,t,e){var i,s,a,o,l,h,c,u,f,g=r.constructor;t:if(n!=null){if(u=r.d,!u)return r;for(i=1,o=u[0];o>=10;o/=10)i++;if(s=n-i,s<0)s+=x,a=n,c=u[f=0],l=c/N(10,i-a-1)%10|0;else if(f=Math.ceil((s+1)/x),o=u.length,f>=o)if(e){for(;o++<=f;)u.push(0);c=l=0,i=1,s%=x,a=s-x+1}else break t;else{for(c=o=u[f],i=1;o>=10;o/=10)i++;s%=x,a=s-x+i,l=a<0?0:c/N(10,i-a-1)%10|0}if(e=e||n<0||u[f+1]!==void 0||(a<0?c:c%N(10,i-a-1)),h=t<4?(l||e)&&(t==0||t==(r.s<0?3:2)):l>5||l==5&&(t==4||e||t==6&&(s>0?a>0?c/N(10,i-a):0:u[f-1])%10&1||t==(r.s<0?8:7)),n<1||!u[0])return u.length=0,h?(n-=r.e+1,u[0]=N(10,(x-n%x)%x),r.e=-n||0):u[0]=r.e=0,r;if(s==0?(u.length=f,o=1,f--):(u.length=f+1,o=N(10,x-s),u[f]=a>0?(c/N(10,i-a)%N(10,a)|0)*o:0),h)for(;;)if(f==0){for(s=1,a=u[0];a>=10;a/=10)s++;for(a=u[0]+=o,o=1;a>=10;a/=10)o++;s!=o&&(r.e++,u[0]==B&&(u[0]=1));break}else{if(u[f]+=o,u[f]!=B)break;u[f--]=0,o=1}for(s=u.length;u[--s]===0;)u.pop()}return C&&(r.e>g.maxE?(r.d=null,r.e=NaN):r.e<g.minE&&(r.e=0,r.d=[0])),r}function Y(r,n,t){if(!r.isFinite())return Zt(r);var e,i=r.e,s=H(r.d),a=s.length;return n?(t&&(e=t-a)>0?s=s.charAt(0)+"."+s.slice(1)+q(e):a>1&&(s=s.charAt(0)+"."+s.slice(1)),s=s+(r.e<0?"e":"e+")+r.e):i<0?(s="0."+q(-i-1)+s,t&&(e=t-a)>0&&(s+=q(e))):i>=a?(s+=q(i+1-a),t&&(e=t-i-1)>0&&(s=s+"."+q(e))):((e=i+1)<a&&(s=s.slice(0,e)+"."+s.slice(e)),t&&(e=t-a)>0&&(i+1===a&&(s+="."),s+=q(e))),s}function bt(r,n){var t=r[0];for(n*=x;t>=10;t/=10)n++;return n}function xt(r,n,t){if(n>ue)throw C=!0,t&&(r.precision=t),Error(Ut);return P(new r(wt),n,1,!0)}function X(r,n,t){if(n>Rt)throw Error(Ut);return P(new r(Pt),n,t,!0)}function qt(r){var n=r.length-1,t=n*x+1;if(n=r[n],n){for(;n%10==0;n/=10)t--;for(n=r[0];n>=10;n/=10)t++}return t}function q(r){for(var n="";r--;)n+="0";return n}function jt(r,n,t,e){var i,s=new r(1),a=Math.ceil(e/x+4);for(C=!1;;){if(t%2&&(s=s.times(n),Lt(s.d,a)&&(i=!0)),t=A(t/2),t===0){t=s.d.length-1,i&&s.d[t]===0&&++s.d[t];break}n=n.times(n),Lt(n.d,a)}return C=!0,s}function It(r){return r.d[r.d.length-1]&1}function $t(r,n,t){for(var e,i,s=new r(n[0]),a=0;++a<n.length;){if(i=new r(n[a]),!i.s){s=i;break}e=s.cmp(i),(e===t||e===0&&s.s===t)&&(s=i)}return s}function Ot(r,n){var t,e,i,s,a,o,l,h=0,c=0,u=0,f=r.constructor,g=f.rounding,y=f.precision;if(!r.d||!r.d[0]||r.e>17)return new f(r.d?r.d[0]?r.s<0?0:1/0:1:r.s?r.s<0?0:r:NaN);for(n==null?(C=!1,l=y):l=n,o=new f(.03125);r.e>-2;)r=r.times(o),u+=5;for(e=Math.log(N(2,u))/Math.LN10*2+5|0,l+=e,t=s=a=new f(1),f.precision=l;;){if(s=P(s.times(r),l,1),t=t.times(++c),o=a.plus(_(s,t,l,1)),H(o.d).slice(0,l)===H(a.d).slice(0,l)){for(i=u;i--;)a=P(a.times(a),l,1);if(n==null)if(h<3&&st(a.d,l-e,g,h))f.precision=l+=10,t=s=o=new f(1),c=0,h++;else return P(a,f.precision=y,g,C=!0);else return f.precision=y,a}a=o}}function j(r,n){var t,e,i,s,a,o,l,h,c,u,f,g=1,y=10,p=r,v=p.d,w=p.constructor,S=w.rounding,b=w.precision;if(p.s<0||!v||!v[0]||!p.e&&v[0]==1&&v.length==1)return new w(v&&!v[0]?-1/0:p.s!=1?NaN:v?0:p);if(n==null?(C=!1,c=b):c=n,w.precision=c+=y,t=H(v),e=t.charAt(0),Math.abs(s=p.e)<15e14){for(;e<7&&e!=1||e==1&&t.charAt(1)>3;)p=p.times(r),t=H(p.d),e=t.charAt(0),g++;s=p.e,e>1?(p=new w("0."+t),s++):p=new w(e+"."+t.slice(1))}else return h=xt(w,c+2,b).times(s+""),p=j(new w(e+"."+t.slice(1)),c-y).plus(h),w.precision=b,n==null?P(p,b,S,C=!0):p;for(u=p,l=a=p=_(p.minus(1),p.plus(1),c,1),f=P(p.times(p),c,1),i=3;;){if(a=P(a.times(f),c,1),h=l.plus(_(a,new w(i),c,1)),H(h.d).slice(0,c)===H(l.d).slice(0,c))if(l=l.times(2),s!==0&&(l=l.plus(xt(w,c+2,b).times(s+""))),l=_(l,new w(g),c,1),n==null)if(st(l.d,c-y,S,o))w.precision=c+=y,h=a=p=_(u.minus(1),u.plus(1),c,1),f=P(p.times(p),c,1),i=o=1;else return P(l,w.precision=b,S,C=!0);else return w.precision=b,l;l=h,i+=2}}function Zt(r){return String(r.s*r.s/0)}function ft(r,n){var t,e,i;for((t=n.indexOf("."))>-1&&(n=n.replace(".","")),(e=n.search(/e/i))>0?(t<0&&(t=e),t+=+n.slice(e+1),n=n.substring(0,e)):t<0&&(t=n.length),e=0;n.charCodeAt(e)===48;e++);for(i=n.length;n.charCodeAt(i-1)===48;--i);if(n=n.slice(e,i),n){if(i-=e,r.e=t=t-e-1,r.d=[],e=(t+1)%x,t<0&&(e+=x),e<i){for(e&&r.d.push(+n.slice(0,e)),i-=x;e<i;)r.d.push(+n.slice(e,e+=x));n=n.slice(e),e=x-n.length}else e-=i;for(;e--;)n+="0";r.d.push(+n),C&&(r.e>r.constructor.maxE?(r.d=null,r.e=NaN):r.e<r.constructor.minE&&(r.e=0,r.d=[0]))}else r.e=0,r.d=[0];return r}function de(r,n){var t,e,i,s,a,o,l,h,c;if(n.indexOf("_")>-1){if(n=n.replace(/(\d)_(?=\d)/g,"$1"),Wt.test(n))return ft(r,n)}else if(n==="Infinity"||n==="NaN")return+n||(r.s=NaN),r.e=NaN,r.d=null,r;if(le.test(n))t=16,n=n.toLowerCase();else if(oe.test(n))t=2;else if(he.test(n))t=8;else throw Error(Z+n);for(s=n.search(/p/i),s>0?(l=+n.slice(s+1),n=n.substring(2,s)):n=n.slice(2),s=n.indexOf("."),a=s>=0,e=r.constructor,a&&(n=n.replace(".",""),o=n.length,s=o-s,i=jt(e,new e(t),s,s*2)),h=ut(n,t,B),c=h.length-1,s=c;h[s]===0;--s)h.pop();return s<0?new e(r.s*0):(r.e=bt(h,c),r.d=h,C=!1,a&&(r=_(r,i,o*4)),l&&(r=r.times(Math.abs(l)<54?N(2,l):rt.pow(2,l))),C=!0,r)}function ge(r,n){var t,e=n.d.length;if(e<3)return n.isZero()?n:et(r,2,n,n);t=1.4*Math.sqrt(e),t=t>16?16:t|0,n=n.times(1/St(5,t)),n=et(r,2,n,n);for(var i,s=new r(5),a=new r(16),o=new r(20);t--;)i=n.times(n),n=n.times(s.plus(i.times(a.times(i).minus(o))));return n}function et(r,n,t,e,i){var s,a,o,l,h=r.precision,c=Math.ceil(h/x);for(C=!1,l=t.times(t),o=new r(e);;){if(a=_(o.times(l),new r(n++*n++),h,1),o=i?e.plus(a):e.minus(a),e=_(a.times(l),new r(n++*n++),h,1),a=o.plus(e),a.d[c]!==void 0){for(s=c;a.d[s]===o.d[s]&&s--;);if(s==-1)break}s=o,o=e,e=a,a=s}return C=!0,a.d.length=c+1,a}function St(r,n){for(var t=r;--n;)t*=r;return t}function Jt(r,n){var t,e=n.s<0,i=X(r,r.precision,1),s=i.times(.5);if(n=n.abs(),n.lte(s))return z=e?4:1,n;if(t=n.divToInt(i),t.isZero())z=e?3:2;else{if(n=n.minus(t.times(i)),n.lte(s))return z=It(t)?e?2:3:e?4:1,n;z=It(t)?e?1:4:e?3:2}return n.minus(i).abs()}function Et(r,n,t,e){var i,s,a,o,l,h,c,u,f,g=r.constructor,y=t!==void 0;if(y?(I(t,1,J),e===void 0?e=g.rounding:I(e,0,8)):(t=g.precision,e=g.rounding),!r.isFinite())c=Zt(r);else{for(c=Y(r),a=c.indexOf("."),y?(i=2,n==16?t=t*4-3:n==8&&(t=t*3-2)):i=n,a>=0&&(c=c.replace(".",""),f=new g(1),f.e=c.length-a,f.d=ut(Y(f),10,i),f.e=f.d.length),u=ut(c,10,i),s=l=u.length;u[--l]==0;)u.pop();if(!u[0])c=y?"0p+0":"0";else{if(a<0?s--:(r=new g(r),r.d=u,r.e=s,r=_(r,f,t,e,0,i),u=r.d,s=r.e,h=Yt),a=u[t],o=i/2,h=h||u[t+1]!==void 0,h=e<4?(a!==void 0||h)&&(e===0||e===(r.s<0?3:2)):a>o||a===o&&(e===4||h||e===6&&u[t-1]&1||e===(r.s<0?8:7)),u.length=t,h)for(;++u[--t]>i-1;)u[t]=0,t||(++s,u.unshift(1));for(l=u.length;!u[l-1];--l);for(a=0,c="";a<l;a++)c+=_t.charAt(u[a]);if(y){if(l>1)if(n==16||n==8){for(a=n==16?4:3,--l;l%a;l++)c+="0";for(u=ut(c,i,n),l=u.length;!u[l-1];--l);for(a=1,c="1.";a<l;a++)c+=_t.charAt(u[a])}else c=c.charAt(0)+"."+c.slice(1);c=c+(s<0?"p":"p+")+s}else if(s<0){for(;++s;)c="0"+c;c="0."+c}else if(++s>l)for(s-=l;s--;)c+="0";else s<l&&(c=c.slice(0,s)+"."+c.slice(s))}c=(n==16?"0x":n==2?"0b":n==8?"0o":"")+c}return r.s<0?"-"+c:c}function Lt(r,n){if(r.length>n)return r.length=n,!0}function pe(r){return new this(r).abs()}function me(r){return new this(r).acos()}function ye(r){return new this(r).acosh()}function ve(r,n){return new this(r).plus(n)}function we(r){return new this(r).asin()}function Pe(r){return new this(r).asinh()}function xe(r){return new this(r).atan()}function Ce(r){return new this(r).atanh()}function be(r,n){r=new this(r),n=new this(n);var t,e=this.precision,i=this.rounding,s=e+4;return!r.s||!n.s?t=new this(NaN):!r.d&&!n.d?(t=X(this,s,1).times(n.s>0?.25:.75),t.s=r.s):!n.d||r.isZero()?(t=n.s<0?X(this,e,i):new this(0),t.s=r.s):!r.d||n.isZero()?(t=X(this,s,1).times(.5),t.s=r.s):n.s<0?(this.precision=s,this.rounding=1,t=this.atan(_(r,n,s,1)),n=X(this,s,1),this.precision=e,this.rounding=i,t=r.s<0?t.minus(n):t.plus(n)):t=this.atan(_(r,n,s,1)),t}function Se(r){return new this(r).cbrt()}function Ve(r){return P(r=new this(r),r.e+1,2)}function De(r,n,t){return new this(r).clamp(n,t)}function _e(r){if(!r||typeof r!="object")throw Error(Ct+"Object expected");var n,t,e,i=r.defaults===!0,s=["precision",1,J,"rounding",0,8,"toExpNeg",-tt,0,"toExpPos",0,tt,"maxE",0,tt,"minE",-tt,0,"modulo",0,9];for(n=0;n<s.length;n+=3)if(t=s[n],i&&(this[t]=kt[t]),(e=r[t])!==void 0)if(A(e)===e&&e>=s[n+1]&&e<=s[n+2])this[t]=e;else throw Error(Z+t+": "+e);if(t="crypto",i&&(this[t]=kt[t]),(e=r[t])!==void 0)if(e===!0||e===!1||e===0||e===1)if(e)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(Ft);else this[t]=!1;else throw Error(Z+t+": "+e);return this}function ke(r){return new this(r).cos()}function Re(r){return new this(r).cosh()}function Kt(r){var n,t,e;function i(s){var a,o,l,h=this;if(!(h instanceof i))return new i(s);if(h.constructor=i,Tt(s)){h.s=s.s,C?!s.d||s.e>i.maxE?(h.e=NaN,h.d=null):s.e<i.minE?(h.e=0,h.d=[0]):(h.e=s.e,h.d=s.d.slice()):(h.e=s.e,h.d=s.d?s.d.slice():s.d);return}if(l=typeof s,l==="number"){if(s===0){h.s=1/s<0?-1:1,h.e=0,h.d=[0];return}if(s<0?(s=-s,h.s=-1):h.s=1,s===~~s&&s<1e7){for(a=0,o=s;o>=10;o/=10)a++;C?a>i.maxE?(h.e=NaN,h.d=null):a<i.minE?(h.e=0,h.d=[0]):(h.e=a,h.d=[s]):(h.e=a,h.d=[s]);return}if(s*0!==0){s||(h.s=NaN),h.e=NaN,h.d=null;return}return ft(h,s.toString())}if(l==="string")return(o=s.charCodeAt(0))===45?(s=s.slice(1),h.s=-1):(o===43&&(s=s.slice(1)),h.s=1),Wt.test(s)?ft(h,s):de(h,s);if(l==="bigint")return s<0?(s=-s,h.s=-1):h.s=1,ft(h,s.toString());throw Error(Z+s)}if(i.prototype=m,i.ROUND_UP=0,i.ROUND_DOWN=1,i.ROUND_CEIL=2,i.ROUND_FLOOR=3,i.ROUND_HALF_UP=4,i.ROUND_HALF_DOWN=5,i.ROUND_HALF_EVEN=6,i.ROUND_HALF_CEIL=7,i.ROUND_HALF_FLOOR=8,i.EUCLID=9,i.config=i.set=_e,i.clone=Kt,i.isDecimal=Tt,i.abs=pe,i.acos=me,i.acosh=ye,i.add=ve,i.asin=we,i.asinh=Pe,i.atan=xe,i.atanh=Ce,i.atan2=be,i.cbrt=Se,i.ceil=Ve,i.clamp=De,i.cos=ke,i.cosh=Re,i.div=Oe,i.exp=Ne,i.floor=He,i.hypot=Ee,i.ln=Ae,i.log=Me,i.log10=Le,i.log2=Ie,i.max=Te,i.min=Be,i.mod=Ge,i.mul=Xe,i.pow=Ye,i.random=Ue,i.round=Fe,i.sign=ze,i.sin=We,i.sinh=qe,i.sqrt=je,i.sub=$e,i.sum=Ze,i.tan=Je,i.tanh=Ke,i.trunc=Qe,r===void 0&&(r={}),r&&r.defaults!==!0)for(e=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],n=0;n<e.length;)r.hasOwnProperty(t=e[n++])||(r[t]=this[t]);return i.config(r),i}function Oe(r,n){return new this(r).div(n)}function Ne(r){return new this(r).exp()}function He(r){return P(r=new this(r),r.e+1,3)}function Ee(){var r,n,t=new this(0);for(C=!1,r=0;r<arguments.length;)if(n=new this(arguments[r++]),n.d)t.d&&(t=t.plus(n.times(n)));else{if(n.s)return C=!0,new this(1/0);t=n}return C=!0,t.sqrt()}function Tt(r){return r instanceof rt||r&&r.toStringTag===zt||!1}function Ae(r){return new this(r).ln()}function Me(r,n){return new this(r).log(n)}function Ie(r){return new this(r).log(2)}function Le(r){return new this(r).log(10)}function Te(){return $t(this,arguments,-1)}function Be(){return $t(this,arguments,1)}function Ge(r,n){return new this(r).mod(n)}function Xe(r,n){return new this(r).mul(n)}function Ye(r,n){return new this(r).pow(n)}function Ue(r){var n,t,e,i,s=0,a=new this(1),o=[];if(r===void 0?r=this.precision:I(r,1,J),e=Math.ceil(r/x),this.crypto)if(crypto.getRandomValues)for(n=crypto.getRandomValues(new Uint32Array(e));s<e;)i=n[s],i>=429e7?n[s]=crypto.getRandomValues(new Uint32Array(1))[0]:o[s++]=i%1e7;else if(crypto.randomBytes){for(n=crypto.randomBytes(e*=4);s<e;)i=n[s]+(n[s+1]<<8)+(n[s+2]<<16)+((n[s+3]&127)<<24),i>=214e7?crypto.randomBytes(4).copy(n,s):(o.push(i%1e7),s+=4);s=e/4}else throw Error(Ft);else for(;s<e;)o[s++]=Math.random()*1e7|0;for(e=o[--s],r%=x,e&&r&&(i=N(10,x-r),o[s]=(e/i|0)*i);o[s]===0;s--)o.pop();if(s<0)t=0,o=[0];else{for(t=-1;o[0]===0;t-=x)o.shift();for(e=1,i=o[0];i>=10;i/=10)e++;e<x&&(t-=x-e)}return a.e=t,a.d=o,a}function Fe(r){return P(r=new this(r),r.e+1,this.rounding)}function ze(r){return r=new this(r),r.d?r.d[0]?r.s:0*r.s:r.s||NaN}function We(r){return new this(r).sin()}function qe(r){return new this(r).sinh()}function je(r){return new this(r).sqrt()}function $e(r,n){return new this(r).sub(n)}function Ze(){var r=0,n=arguments,t=new this(n[r]);for(C=!1;t.s&&++r<n.length;)t=t.plus(n[r]);return C=!0,P(t,this.precision,this.rounding)}function Je(r){return new this(r).tan()}function Ke(r){return new this(r).tanh()}function Qe(r){return P(r=new this(r),r.e+1,1)}m[Symbol.for("nodejs.util.inspect.custom")]=m.toString;m[Symbol.toStringTag]="Decimal";var rt=m.constructor=Kt(kt);wt=new rt(wt);Pt=new rt(Pt);const R=rt;class ti{constructor(n){d(this,"canvas");d(this,"axis_canvas",document.createElement("canvas"));d(this,"ctx",this.axis_canvas.getContext("2d"));d(this,"isReload",!1);d(this,"show",{all:!0,grid:{main:!0,secondary:!0},axis:!0,axisText:!0});this.canvas=n,this.initAxisCanvas()}initAxisCanvas(){const{canvas:n,axis_canvas:t}=this;n&&(t.width=n.rect.width||0,t.height=n.rect.height||0)}toggleAxis(n){const t=(()=>{if(typeof n=="object"){const{all:e=!0,grid:i={main:!0,secondary:!0},axis:s=!0,axisText:a=!0}=n;return Object.assign({main:!0,secondary:!0},i),{all:e,grid:i,axis:s,axisText:a}}return typeof n=="boolean"?{all:!0,grid:{main:n,secondary:n},axis:n,axisText:n}:!this.show.all})();typeof t=="boolean"?this.show.all=t:this.show=t,this.isReload=!0}drawAxisAndGrid(){if(!(!this.canvas||!this.show.all))return(this.canvas.isRecalculate||this.isReload||this.canvas.isThemeUpdated)&&(this.isReload=!1,this.initAxisCanvas(),(this.show.grid.main||this.show.grid.secondary)&&this.drawGrid(),this.show.axis&&this.drawAxis(),this.show.axisText&&this.drawAxisText()),this.axis_canvas}color(){const{theme:n,style:t}=this.canvas;return(t[n]||t.light).grid}drawGrid(){const{canvas:n,ctx:t}=this,{rect:e,center:i,axisConfig:s}=n,{width:a,height:o}=e,l=this.color(),h=s.size,c=h/5;t.lineWidth=1;const u=(g,y)=>{const p=i.x%g>0?i.x%g:g+i.x%g;t.strokeStyle=y,t.beginPath();for(let v=0;v*g+p<=a;v++)t.moveTo(v*g+p,0),t.lineTo(v*g+p,o);t.stroke()},f=(g,y)=>{const p=i.y%g>0?i.y%g:g+i.y%g;t.strokeStyle=y,t.beginPath();for(let v=0;v*g+p<=o;v++)t.moveTo(0,v*g+p),t.lineTo(a,v*g+p);t.stroke()};this.show.grid.secondary&&(u(c,l.innerGrid),f(c,l.innerGrid)),this.show.grid.main&&(u(h,l.grid),f(h,l.grid))}drawAxis(){const{canvas:n,ctx:t}=this,{rect:e,center:i}=n,{width:s,height:a}=e,o=this.color();t.lineWidth=2,t.strokeStyle=o.axis;const l=()=>{i.y>=0&&i.y<=a&&(t.beginPath(),t.moveTo(0,i.y),t.lineTo(s,i.y),t.stroke())},h=()=>{i.x>=0&&i.x<=s&&(t.beginPath(),t.moveTo(i.x,0),t.lineTo(i.x,a),t.stroke())};l(),h()}drawText(n,t,e,i){const{canvas:s,ctx:a}=this,{theme:o}=s,l=this.canvas.style[o].text;a.font=`${l.bold?"bold":""} ${l.size}px ${l.family}`,a.strokeStyle=l.stroke,![n,t,e].includes(void 0)&&a.strokeText(n,t,e),a.fillStyle=l[i?"secondary":"color"],![n,t,e].includes(void 0)&&a.fillText(n,t,e)}drawAxisText(){const{canvas:n,ctx:t}=this,{rect:e,center:i,axisConfig:s,style:a,theme:o}=n,{width:l,height:h}=e;this.drawText();const c=p=>Math.ceil(t.measureText(p).width),u=4,f=a[o].text.size;{const p=c("0"),v=i.x<u||i.x>l+p+u,w=i.y<-(u+f)||i.y>h+f+u;!v&&!w&&this.drawText("0",i.x-p-u,i.y+f+u)}const g=n.getNowGridCount,y=s.size;{let p=i.y+f+u;p=Math.max(Math.min(p,h-u),u+f);const v=i.y>h||i.y<0;let w=i.x>0?i.x%y:i.x<0?y+i.x%y:0,S=n.getAxisValueByPoint((w-i.x)*s.x,0).xV;for(;w<=l;){const b=At(S),V=c(b);S!==0&&this.drawText(b,w-V/2,p,v),w+=y,S=new R(g).mul(s.x).add(S).toNumber()}}{const p=i.x>l||i.x<0;let v=i.y>0?i.y%y:i.y<0?y+i.y%y:0,w=n.getAxisValueByPoint(0,(v-i.y)*s.y).yV;for(;v<=h;){const S=At(w),b=c(S);let V=i.x-b-u;V=Math.max(Math.min(V,l-b-u),u),w!=0&&this.drawText(S,V,v+f/2,p),v+=y,w=new R(g).mul(s.y).add(w).toNumber()}}}}class ei{constructor(){d(this,"parent");d(this,"name","");d(this,"extData");d(this,"mainCanvas");d(this,"_isRecalculate",!1);d(this,"notifyReload")}get isRecalculate(){return(this.parent?this.parent.isRecalculate:!1)||this._isRecalculate}set isRecalculate(n){this._isRecalculate=n}equalsMainCanvas(n){return this.mainCanvas===n}setMainCanvas(n){this.mainCanvas=n}}class ii extends ei{constructor(){super(...arguments);d(this,"_isVisible",!0);d(this,"inheritOpacity",!0);d(this,"_opacity");d(this,"_scaleRange")}get isVisible(){return this._isVisible}set isVisible(t){var e;t!=this.isVisible&&(this._isVisible=t,(e=this.notifyReload)==null||e.call(this,!0))}get opacity(){var t;return this.inheritOpacity?this._opacity??((t=this.parent)==null?void 0:t.opacity):this._opacity}set opacity(t){var e;this._opacity!=t&&(t===void 0||t>=0&&t<=1?(this._opacity=t,(e=this.notifyReload)==null||e.call(this,!1)):console.warn("Opacity value should be between 0 and 1."))}get scaleRange(){return this._scaleRange}set scaleRange(t){var e;t!=this.scaleRange&&(this._scaleRange=t,this.isVisible&&((e=this.notifyReload)==null||e.call(this)))}shouldRender(){var e;if(!this.isVisible||this.opacity===0)return!1;const t=(e=this.mainCanvas)==null?void 0:e.scale;if(this.scaleRange&&t){const i=Math.min(...this.scaleRange),s=Math.max(...this.scaleRange);return t>=i&&t<=s}return!0}}let si=class extends ii{constructor(n){super(),n.name=n.name||ie("default-name-"),Object.assign(this,{...n})}};class ni extends si{constructor(t){super(t);d(this,"_isInteractive",!0);d(this,"_isHoverable",!0);d(this,"_isDownable",!0);d(this,"_isContextmenuable",!0);d(this,"_isClickable",!0);d(this,"_isDoubleClickable",!0);d(this,"_isDraggable",!0);d(this,"_isWheelable",!0);Object.assign(this,{...t})}get isInteractive(){return this.getPropValue("isInteractive",this._isInteractive,!1)}set isInteractive(t){this._isInteractive=t}get isHoverable(){return this.getPropValue("isHoverable",this._isHoverable)}set isHoverable(t){this._isHoverable=t}get isDownable(){return this.getPropValue("isDownable",this._isDownable)}set isDownable(t){this._isDownable=t}get isContextmenuable(){return this.getPropValue("isContextmenuable",this._isContextmenuable)}set isContextmenuable(t){this._isContextmenuable=t}get isClickable(){return this.getPropValue("isClickable",this._isClickable)}set isClickable(t){this._isClickable=t}get isDoubleClickable(){return this.getPropValue("isDoubleClickable",this._isDoubleClickable)}set isDoubleClickable(t){this._isDoubleClickable=t}get isDraggable(){return this.getPropValue("isDraggable",this._isDraggable)}set isDraggable(t){this._isDraggable=t}get isWheelable(){return this.getPropValue("isWheelable",this._isWheelable)}set isWheelable(t){this._isWheelable=t}getPropValue(t,e,i=!0){return(this.parent?this.parent[t]:!0)&&e&&(i?this.isInteractive:!0)}}class ri{constructor(n){d(this,"propagationStopped",!1);this.data=n}stopPropagation(){this.propagationStopped=!0}get canPropagate(){return!this.propagationStopped}}class at extends ni{constructor(){super(...arguments);d(this,"listeners",{wheel:new Set,hover:new Set,down:new Set,contextmenu:new Set,click:new Set,doubleClick:new Set,dragg:new Set});d(this,"sharedControllers",{});d(this,"_eventDate",{});d(this,"_clearEventDate",!1);d(this,"_isHover",!1);d(this,"notifyHover",(t,e)=>this.checkEventDate("hover",t)&&this.trigger("hover",{state:t,oldState:this.isHover},e,"isHoverable"));d(this,"_isDown",!1);d(this,"notifyDown",(t,e)=>this.checkEventDate("down",t)&&this.trigger("down",{state:t,oldState:this.isDown},e,"isDownable"));d(this,"_isContextmenu",!1);d(this,"notifyContextmenu",(t,e)=>this.checkEventDate("contextmenu",t)&&this.trigger("contextmenu",{state:t,oldState:this.isContextmenu},e,"isContextmenuable"));d(this,"_isClick",!1);d(this,"clickTimestamp",0);d(this,"doubleClickInterval",300);d(this,"notifyClick",(t,e)=>{if(!this.checkEventDate("click",t))return;let i=!1;t?(i=Date.now()-this.clickTimestamp<this.doubleClickInterval,this.clickTimestamp=i?0:Date.now()):(this._isDblClick=!1,this.clickTimestamp=0),i?this.notifyDoubleClick(i,e):this.trigger("click",{state:t,oldState:this.isClick},e,"isClickable")});d(this,"_isDblClick",!1);d(this,"notifyDoubleClick",(t,e)=>this.checkEventDate("doubleClick",t)&&this.trigger("doubleClick",{state:t,oldState:this.isDblClick},e,"isDoubleClickable"));d(this,"notifyDragg",(t,e)=>this.checkEventDate("dragg",t)&&this.trigger("dragg",t,e,"isDraggable"));d(this,"notifyWheel",(t,e)=>this.checkEventDate("wheel",t)&&this.trigger("wheel",t,e,"isWheelable"))}addEventListener(t,e){this.listeners[t].add(e)}removeEventListener(t,e){this.listeners[t].delete(e)}registerControllers(t,e){this.sharedControllers[t]=e}hasController(t,e){var i;return(i=this.sharedControllers[t])==null?void 0:i.includes(e)}trigger(t,e,i,s){var h,c;if(!this[s])return;this.updateStates(t,e);const a=new ri(e);this.listeners[t].forEach(u=>u(a,i));const o="notify"+(t.charAt(0).toUpperCase()+t.slice(1)),l=["notifyDragg","notifyWheel"].includes(o)?e:e.state;a.canPropagate&&((h=this.parent)==null||h[o](l,i)),(c=this.sharedControllers[t])==null||c.forEach(u=>u!==this&&u[o](l,i))}updateStates(t,e){const i=e;switch(t){case"hover":this._isHover=i.state;break;case"down":this._isDown=i.state;break;case"contextmenu":this._isContextmenu=i.state;break;case"click":this._isClick=i.state;break;case"doubleClick":this._isDblClick=i.state;break}}checkEventDate(t,e){const i=this._eventDate[t],s=JSON.stringify(e);return i==s?!1:(this._eventDate[t]=s,this._clearEventDate||(this._clearEventDate=!0,Promise.resolve().then(()=>{this._clearEventDate=!1,this._eventDate={}})),!0)}get isHover(){return this.isHoverable&&this._isHover}get isDown(){return this.isDraggable&&this._isDown}get isContextmenu(){return this.isClickable&&this._isContextmenu}get isClick(){return this.isClickable&&this._isClick}get isDblClick(){return this.isDoubleClickable&&this._isDblClick}}class D extends at{constructor(t){t={...t},t.isDraggable=t.isDraggable??!1;const{mainCanvas:e,notifyReload:i}=t;delete t.mainCanvas,delete t.notifyReload;super(t);d(this,"_style");d(this,"_position");d(this,"_value");d(this,"_zIndex",0);d(this,"_dynamicPosition");d(this,"_offset",{x:0,y:0});d(this,"path");d(this,"publicToPrivateKeyMap",{offset:"_offset",position:"_position",value:"_value",dynamicPosition:"_dynamicPosition",zIndex:"_zIndex",style:"_style"});d(this,"redrawOnIsHoverChange",!0);d(this,"defaultHover",(t,e)=>{var i;this.redrawOnIsHoverChange&&((i=this.notifyReload)==null||i.call(this))});d(this,"_valueScope");d(this,"styleRadius",{value:0,radius:0});d(this,"offsetValue",{xV:0,yV:0});d(this,"fixedExtraScope",{topV:0,bottomV:0,leftV:0,rightV:0});d(this,"extraScope",{top:0,bottom:0,left:0,right:0,topV:0,bottomV:0,leftV:0,rightV:0});this.setNotifyReload(i),this.mainCanvas=e,["redrawOnIsHoverChange"].forEach(a=>{a in t&&(this[a]=t[a])});const s={};["offset","style","zIndex","position","dynamicPosition","value"].forEach(a=>{a in t&&(s[a]=t[a])}),this.internalUpdate(s),this.addEventListener("hover",this.defaultHover)}get style(){return this._style}set style(t){var e;this._style=t,this.mainCanvas&&(this.updateValueScope(),(e=this.notifyReload)==null||e.call(this))}get position(){return this._position}set position(t){var e;this._position=t,this._value=void 0,this.updateBaseData(),(e=this.notifyReload)==null||e.call(this)}get value(){return this._value}set value(t){var e;this._value=t,this._position=void 0,this.updateBaseData(),(e=this.notifyReload)==null||e.call(this)}get zIndex(){return this._zIndex}set zIndex(t){var e;this._zIndex!=t&&(this._zIndex=t,(e=this.notifyReload)==null||e.call(this))}get dynamicPosition(){return this._dynamicPosition}set dynamicPosition(t){this._dynamicPosition=t}get offset(){return this._offset}set offset(t){var e;this._offset=t,this.calculateOffsetValue(),(e=this.notifyReload)==null||e.call(this)}get finalDynamicPosition(){var i;const{x:t,y:e}=this.offset;return(i=this.dynamicPosition)==null?void 0:i.map((s,a)=>typeof s=="number"?a==0?s+t:s+e:[s[0]+t,s[1]+e])}internalUpdate(t,e){Object.keys(t).forEach(i=>{const s=this.publicToPrivateKeyMap[i];s&&(this[s]=t[i])}),e&&this.updateValueScope()}setMainCanvas(t){super.setMainCanvas(t),t&&this.updateBaseData()}setNotifyReload(t){this.notifyReload=t?e=>{var i;e&&(this.isRecalculate=!0),(e||this.isNeedRender||(i=this.mainCanvas)!=null&&i.currentDrawOverlays.includes(this))&&t()}:void 0}get valueScope(){return this._valueScope}set valueScope(t){this._valueScope=t}initValueScope(){const t=this.value;if(Array.isArray(t[0])){let e=1/0,i=-1/0,s=1/0,a=-1/0;t.forEach(([o,l])=>{e=Math.min(e,o),i=Math.max(i,o),s=Math.min(s,l),a=Math.max(a,l)}),this.valueScope={minX:e,maxX:i,minY:s,maxY:a}}else{const[e,i]=t;this.valueScope={minX:e,maxX:e,minY:i,maxY:i}}this.calculateStyleRadiusValue(!1),this.calculateOffsetValue(!1),this.setFixedExtraScope(!0),this.setExtraScope(!0)}calculateStyleRadiusValue(t=!0){if(!(!this.mainCanvas||!this.valueScope))if(t){const{radius:e,value:i}=this.styleRadius;if(e==0)return;const s=this.mainCanvas.getAxisValueByPoint(e,0).xV,a=s-i;this.valueScope.minX-=a,this.valueScope.maxX+=a,this.valueScope.minY-=a,this.valueScope.maxY+=a,this.styleRadius={radius:e,value:s}}else{const{stroke:e,point:i}=this.computedValueScopeStyles,s=i?i.radius+Math.max(0,i.width/2):0,a=e?Math.max(0,e.width/2):0,o=Math.max(s,a);if(o==0)return this.styleRadius={radius:0,value:0};const l=this.mainCanvas.getAxisValueByPoint(o,0).xV;this.valueScope.minX-=l,this.valueScope.maxX+=l,this.valueScope.minY-=l,this.valueScope.maxY+=l,this.styleRadius={radius:o,value:l}}}calculateOffsetValue(t=!0){const{mainCanvas:e,valueScope:i,offset:s,offsetValue:a}=this;if(!(!e||!i))if(t){const{x:o,y:l}=e.axisConfig;let{xV:h,yV:c}=e.getAxisValueByPoint(s.x,s.y);h*=o,c*=l;const u=h-a.xV,f=c-a.yV;i.minX+=u,i.maxX+=u,i.minY+=f,i.maxY+=f,this.offsetValue={xV:h,yV:c}}else{if(this.offsetValue={xV:0,yV:0},s.x==0&&s.y==0)return;this.calculateOffsetValue()}}setFixedExtraScope(t){if(t===!0)this.fixedExtraScope={topV:0,bottomV:0,leftV:0,rightV:0};else{const e=t||{topV:0,bottomV:0,leftV:0,rightV:0};if(this.valueScope){const{leftV:i,rightV:s,topV:a,bottomV:o}=e;this.valueScope.minX-=i-this.fixedExtraScope.leftV,this.valueScope.maxX+=s-this.fixedExtraScope.rightV,this.valueScope.minY-=a-this.fixedExtraScope.topV,this.valueScope.maxY+=o-this.fixedExtraScope.bottomV,this.fixedExtraScope=e}}}setExtraScope(t){const{valueScope:e,mainCanvas:i,extraScope:s}=this;if(!(!e||!i))if(t===!0)this.extraScope={top:0,bottom:0,left:0,right:0,topV:0,bottomV:0,leftV:0,rightV:0};else if(t){const{left:a,right:o,top:l,bottom:h}=t,{xV:c,yV:u}=i.getAxisValueByPoint(l,h),{xV:f,yV:g}=i.getAxisValueByPoint(a,o);e.minX-=f-s.leftV,e.maxX+=g-s.rightV,e.minY-=c-s.topV,e.maxY+=u-s.bottomV,this.extraScope={...t,topV:c,bottomV:u,leftV:f,rightV:g}}else this.setExtraScope(this.extraScope)}get isWithinRange(){const{mainCanvas:t,valueScope:e}=this;if(!t)return!1;const{isScaleUpdated:i,maxMinValue:s}=t;return i&&(this.calculateStyleRadiusValue(),this.calculateOffsetValue(),this.setExtraScope()),e?!(s.maxXV<e.minX||s.minXV>e.maxX||s.maxYV<e.minY||s.minYV>e.maxY):!0}get isNeedRender(){return!!(this.mainCanvas&&this.shouldRender()&&this.dynamicPosition&&this.isWithinRange)}calculateOffset(t,e){const{percentage:i,axisConfig:s}=this.mainCanvas,a=s.count/s.min/i,o={value:t*a*s.x,position:t/i*s.x,dynamicPosition:t},l={value:e*a*s.y,position:e/i*s.y,dynamicPosition:e};return{x:o,y:l}}handleValuePosition(t,e){let{value:i,position:s,mainCanvas:a}=this;if(!a)return!1;const o=t==="array1D"?Gt:yt,[l,h]=[o(i)&&(!e||i.length>=e),o(s)&&(!e||s.length>=e)],c={value:i,position:s,dynamicPosition:[]};if(!l&&!h)return this.internalUpdate({dynamicPosition:void 0}),!1;if(l){const u=i;if(t==="array1D"){const f=a.getAxisPointByValue(u[0],u[1],!0);c.position=[f.x,f.y]}else{c.position=[];for(let f=0;f<u.length;f++){const g=u[f],y=a.getAxisPointByValue(g[0],g[1],!0);c.position.push([y.x,y.y])}}}else{const u=s;if(t==="array1D"){const f=a.getAxisValueByPoint(u[0],u[1],!0);c.value=[f.xV,f.yV]}else{c.value=[];for(let f=0;f<u.length;f++){const g=u[f],y=a.getAxisValueByPoint(g[0],g[1],!0);c.value.push([y.xV,y.yV])}}}return c.dynamicPosition=a.transformPosition(c.position),this.internalUpdate(c,!0),!0}isPointInAnywhere(t,e){return this.isPointInPath(t,e)||this.isPointInStroke(t,e)}setGlobalAlpha(t){var i;const e=this.opacity??((i=this.parent)==null?void 0:i.opacity);e!==void 0&&(t.globalAlpha=e)}setBaseLineStyle(t,e){const{width:i,dash:s,dashGap:a,dashOffset:o,color:l,color_hover:h,cap:c,join:u}=e;return t.setLineDash(s?a:[]),t.lineDashOffset=o,t.lineCap=c,t.lineJoin=u,t.lineWidth=i,t.strokeStyle=this.isHover?h:l,e}get cursorStyle(){return this.isInteractive?this.isDraggable?"_nhanh_canvas_hover_overlay_draggable":"_nhanh_canvas_hover_overlay":void 0}}d(D,"ctx",document.createElement("canvas").getContext("2d"));class O{static add(n,t){return new R(n).add(t).toNumber()}static sub(n,t){return new R(n).sub(t).toNumber()}static mul(n,t){return new R(n).mul(t).toNumber()}static div(n,t){return new R(n).div(t).toNumber()}}class dt extends D{constructor(t){super(t);d(this,"textOffset",{x:0,y:0});d(this,"_text");d(this,"defaultDragg",(t,e)=>{var l;const{offsetX:i,offsetY:s}=t.data,{x:a,y:o}=this.calculateOffset(i,s);this.internalUpdate({value:[O.add(this.value[0],a.value),O.add(this.value[1],o.value)],position:[O.add(this.position[0],a.position),O.add(this.position[1],o.position)],dynamicPosition:[O.add(this.dynamicPosition[0],a.dynamicPosition),O.add(this.dynamicPosition[1],o.dynamicPosition)]},!0),(l=this.notifyReload)==null||l.call(this)});const{text:e}=t;Object.assign(this,{text:e}),this.addEventListener("dragg",this.defaultDragg)}get text(){return this._text}set text(t){var e;this._text!=t&&(this._text=t,this.updateBaseData(),(e=this.notifyReload)==null||e.call(this))}updateValueScope(){this.initValueScope();const t=this.textOffset;this.setExtraScope({top:t.y,bottom:t.y,left:t.x,right:t.x})}isPointInPath(t,e){return this.path?D.ctx.isPointInPath(this.path,t,e):!1}isPointInStroke(t,e){return!1}updateBaseData(){if(!this.mainCanvas)return;if(!this.text||this.text.length==0)return this.internalUpdate({dynamicPosition:void 0});const t=D.ctx;this.setOverlayStyles(t);const e=t.measureText(this.text);this.textOffset={x:e.width/2,y:e.actualBoundingBoxAscent/2},this.handleValuePosition("array1D")}setOverlayStyles(t){var a;const e=this.mainCanvas,i=e.style[e.theme].text;let s={};return typeof this.style=="string"?s=((a=e.style[this.style])==null?void 0:a.text)||i:typeof this.style=="object"?s=Object.assign({},i,this.style):s=i,t.font=`${s.bold?"bold":""} ${s.size}px ${s.family}`,t.lineWidth=2,t.strokeStyle=s.stroke,t.fillStyle=s[this.isHover?"secondary":"color"],s}get computedValueScopeStyles(){return{}}draw(t){const{text:e,textOffset:i,finalDynamicPosition:s}=this;if(!this.mainCanvas||!e)return;this.setGlobalAlpha(t),this.setOverlayStyles(t);const a=s[0]-i.x,o=s[1]+i.y;t.strokeText(e,a,o),t.fillText(e,a,o),this.path=new Path2D,this.path.rect(a,s[1]-i.y,i.x*2,i.y*2)}getDraw(){if(this.isNeedRender){if(this.isRecalculate){const{position:t,mainCanvas:e}=this;this.internalUpdate({dynamicPosition:e.transformPosition(t)})}return[this.draw,this]}}}class $ extends D{constructor(t){super(t);d(this,"angle",2*Math.PI);d(this,"defaultDragg",(t,e)=>{var l;const{offsetX:i,offsetY:s}=t.data,{x:a,y:o}=this.calculateOffset(i,s);this.internalUpdate({value:[O.add(this.value[0],a.value),O.add(this.value[1],o.value)],position:[O.add(this.position[0],a.position),O.add(this.position[1],o.position)],dynamicPosition:[O.add(this.dynamicPosition[0],a.dynamicPosition),O.add(this.dynamicPosition[1],o.dynamicPosition)]},!0),(l=this.notifyReload)==null||l.call(this)});d(this,"fillProgress");d(this,"defaultHover",(t,e)=>{const i=t.data.state,s=300,a=this.setOverlayStyles().width;this.fillProgress?this.cancelAndRestartAnimation(i,a,s-100):i&&this.startNewHoverAnimation(a,s)});this.addEventListener("hover",this.defaultHover),this.addEventListener("dragg",this.defaultDragg)}updateValueScope(){this.initValueScope()}cancelAndRestartAnimation(t,e,i){this.fillProgress.scheduleCallback();let s=0;this.fillProgress.scheduleCallback=vt(a=>{!this.fillProgress||!a||(this.fillProgress.progress+=(a-s)*(t?1:-1),s=a,this.fillProgress.progress=Math.min(1,Math.max(0,this.fillProgress.progress)),this.updateLineWidthOffset(e),(this.fillProgress.progress===1||this.fillProgress.progress===0)&&(this.fillProgress.scheduleCallback(),this.fillProgress.progress===0&&(this.fillProgress=void 0)))},i)}startNewHoverAnimation(t,e){this.fillProgress={lineWidthOffset:0,progress:0,scheduleCallback:vt(i=>{this.fillProgress&&(this.fillProgress.progress=i,this.updateLineWidthOffset(t))},e)}}updateLineWidthOffset(t){var i;if(!this.fillProgress)return;const e=Math.ceil(t*this.fillProgress.progress);e!==this.fillProgress.lineWidthOffset&&(this.fillProgress.lineWidthOffset=e,(i=this.notifyReload)==null||i.call(this))}isPointInPath(t,e){return this.path?D.ctx.isPointInPath(this.path,t,e):!1}isPointInStroke(t,e){var i;if(this.path&&this.mainCanvas){const{width:s}=this.setOverlayStyles(D.ctx);return((i=this.fillProgress)==null?void 0:i.lineWidthOffset)==s?!1:D.ctx.isPointInStroke(this.path,t,e)}return!1}updateBaseData(){this.handleValuePosition("array1D")}setOverlayStyles(t){var h,c;const e=this.mainCanvas,i=e.style[e.theme].point;let s={};typeof this.style=="string"?s=((h=e.style[this.style])==null?void 0:h.point)||i:typeof this.style=="object"?s=Object.assign({},i,this.style):s=i;const{width:a,stroke:o,fill:l}=s;if(t){t.setLineDash([]);const u=((c=this.fillProgress)==null?void 0:c.lineWidthOffset)||0;t.lineWidth=a-u,t.strokeStyle=o,t.fillStyle=l}return{...s}}get computedValueScopeStyles(){return{point:this.setOverlayStyles()}}draw(t){var c;const{finalDynamicPosition:e,mainCanvas:i}=this;if(!i)return;this.setGlobalAlpha(t);const{radius:s,width:a}=this.setOverlayStyles(t),o=((c=this.fillProgress)==null?void 0:c.lineWidthOffset)||0,[l,h]=e;t.beginPath(),this.path=new Path2D,this.path.arc(l,h,s+o/2,0,this.angle),a!=o&&t.stroke(this.path),t.fill(this.path)}getDraw(){if(this.isNeedRender){const{mainCanvas:t,position:e}=this;return this.isRecalculate&&this.internalUpdate({dynamicPosition:t.transformPosition(e)}),[this.draw,this]}}}class Qt extends D{constructor(t){super(t);d(this,"handlePoints",[]);d(this,"isShowHandlePoint",!1);d(this,"_isHandlePointsVisible",!0);d(this,"canCreateOrDeleteHandlePoint",!0);d(this,"lockedCanCreateOrDeleteHandlePoint",!1);d(this,"defaultClick",(t,e)=>{var a;if(!this.isHandlePointsVisible)return;const{state:i,oldState:s}=t.data;i!=s&&!this.isInfinite&&((a=this.notifyReload)==null||a.call(this))});d(this,"defaultDoubleClick",(t,e)=>{if(e){if(!this.isHandlePointsVisible)return;const{offsetX:i,offsetY:s}=e,{state:a}=t.data;if(this.lockedCanCreateOrDeleteHandlePoint)this.resetHandlePointLock();else if(a&&this.isHandlePointsVisible&&this.canCreateOrDeleteHandlePoint&&this.isDraggable){const l=this.handlePoints.findIndex(h=>h.isHover);l===-1?this.tryCreateNewHandlePoint(i,s):this.tryDeleteHandlePoint(l)}}});d(this,"defaultDragg",(t,e)=>{var s;if(!this.mainCanvas)return;const i=()=>{const{offsetX:a,offsetY:o}=t.data,{x:l,y:h}=this.calculateOffset(a,o);this.value.forEach((c,u)=>{this.value[u]=[O.add(this.value[u][0],l.value),O.add(this.value[u][1],h.value)],this.position[u]=[O.add(this.position[u][0],l.position),O.add(this.position[u][1],h.position)],this.dynamicPosition[u]=[O.add(this.dynamicPosition[u][0],l.dynamicPosition),O.add(this.dynamicPosition[u][1],h.dynamicPosition)]}),this.handlePoints.forEach((c,u)=>{c.internalUpdate({value:this.value[u],position:this.position[u],dynamicPosition:this.dynamicPosition[u]})}),this.lockedCanCreateOrDeleteHandlePoint=!0};if(this.isHandlePointsVisible){const a=this.handlePoints.findIndex(o=>o.isHover);if(a!=-1){const o=this.handlePoints[a];o.notifyDragg(t.data,e),this.value[a]=o.value,this.position[a]=o.position,this.dynamicPosition[a]=o.dynamicPosition}else i()}else i();(s=this.notifyReload)==null||s.call(this),this.updateValueScope()});["isHandlePointsVisible","canCreateOrDeleteHandlePoint"].forEach(e=>{e in t&&(this[e]=t[e])}),this.addEventListener("click",this.defaultClick),this.addEventListener("doubleClick",this.defaultDoubleClick),this.addEventListener("dragg",this.defaultDragg)}get isHandlePointsVisible(){return this._isHandlePointsVisible}set isHandlePointsVisible(t){var e;this._isHandlePointsVisible!==t&&(this._isHandlePointsVisible=t,this.isShowHandlePoint!=t&&((e=this.notifyReload)==null||e.call(this)),this.updateHandlePoints())}get offset(){return super.offset}set offset(t){super.offset=t;let{isHandlePointsVisible:e,handlePoints:i}=this;e&&i.forEach(s=>s.internalUpdate({offset:t}))}tryCreateNewHandlePoint(t,e){var h;if(!this.isPointInStroke(t,e))return;const i=this.getExtendedDynamicPositions(),s=ai([t,e],i);if(s===-1)return;const[a,o]=this.getAdjacentIndices(s),l=this.createNewHandlePoint(a,o);this.insertHandlePoint(s,l),this.lockHandlePointCreationTemporarily(),(h=this.notifyReload)==null||h.call(this)}tryDeleteHandlePoint(t){var e;!this.isDblClick||!this.canDeleteHandlePoint||(this.deleteHandlePoint(t),(e=this.notifyReload)==null||e.call(this))}getExtendedDynamicPositions(){return this.isClosed?[...this.dynamicPosition,this.dynamicPosition[0]]:this.dynamicPosition}getAdjacentIndices(t){const e=t-1,i=this.isClosed&&t===this.dynamicPosition.length?0:t;return[e,i]}createNewHandlePoint(t,e){const i=Dt(this.value[t],this.value[e]),s=Dt(this.position[t],this.position[e]),a=Dt(this.dynamicPosition[t],this.dynamicPosition[e]);return new $({value:i,position:s,dynamicPosition:a,isDraggable:!0,mainCanvas:this.mainCanvas,notifyReload:()=>{var o;return(o=this.notifyReload)==null?void 0:o.call(this)}})}insertHandlePoint(t,e){this.handlePoints.splice(t,0,e),this.value.splice(t,0,e.value),this.position.splice(t,0,e.position),this.dynamicPosition.splice(t,0,e.dynamicPosition)}deleteHandlePoint(t){this.handlePoints.splice(t,1),this.value.splice(t,1),this.position.splice(t,1),this.dynamicPosition.splice(t,1)}lockHandlePointCreationTemporarily(){this.lockedCanCreateOrDeleteHandlePoint=!0,setTimeout(()=>{this.lockedCanCreateOrDeleteHandlePoint=!1},300)}resetHandlePointLock(){this.lockedCanCreateOrDeleteHandlePoint=!1}get canDeleteHandlePoint(){return this.handlePoints.length>this.minNeededHandlePoints}updateHandlePoints(){let{value:t,position:e,dynamicPosition:i,offset:s,isHandlePointsVisible:a}=this;!i||!a||(t==null||t.forEach((o,l)=>{if(!this.handlePoints[l]){const h=new $({mainCanvas:this.mainCanvas,isDraggable:!0,offset:s,notifyReload:()=>{var c;return(c=this.notifyReload)==null?void 0:c.call(this)}});this.handlePoints.push(h)}this.handlePoints[l].internalUpdate({value:t[l],position:e[l],dynamicPosition:i[l]},!0)}),this.handlePoints.length=t.length)}updateHandlePointsPosition(){this.isHandlePointsVisible&&this.handlePoints.forEach((t,e)=>{t.internalUpdate({dynamicPosition:this.dynamicPosition[e]})})}}function ai(r,n,t=10){if(n.length===0)return 0;if(n.length===1)return 1;let e=1/0,i=-1;for(let s=0;s<n.length-1;s++){const a=se(r,n[s],n[s+1]);if(a<t)return s+1;a<e&&(e=a,i=s+1)}return i}function Dt(r,n){const{x:t,y:e}=Xt(...r,...n);return[t,e]}class gt extends Qt{constructor(t){super(t);d(this,"_isInfinite");d(this,"isClosed",!1);d(this,"minNeededHandlePoints",2);const{isInfinite:e}=t;Object.assign(this,{isInfinite:e}),e&&(this.canCreateOrDeleteHandlePoint=!1)}get isInfinite(){return this._isInfinite}set isInfinite(t){var e;this._isInfinite!=t&&(this._isInfinite=t,this.canCreateOrDeleteHandlePoint=!t,(e=this.notifyReload)==null||e.call(this))}updateValueScope(){this.initValueScope()}isPointInPath(t,e){return!1}isPointInStroke(t,e){return this.path&&this.mainCanvas?(this.setOverlayStyles(D.ctx),this.isDraggable&&(D.ctx.lineWidth=Math.max(D.ctx.lineWidth,20)),D.ctx.isPointInStroke(this.path,t,e)):!1}isPointInAnywhere(t,e){return(s=>{if(!s)return!1;let a=!1;return[...this.handlePoints].sort((l,h)=>(l.isHover?0:1)-(h.isHover?0:1)).forEach(l=>{a?l.isHover&&l.notifyHover(!1):(a=l.isPointInAnywhere(t,e),a!=l.isHover&&l.notifyHover(a))}),a})((this.isClick||!!this.isInfinite)&&this.isShowHandlePoint)||super.isPointInAnywhere(t,e)}get isWithinRange(){if(this.isInfinite){this.isRecalculate&&this.updateDynamicPosition();const{width:t,height:e}=this.mainCanvas.rect;return oi([0,0],[t,e],this.finalDynamicPosition[0],this.finalDynamicPosition[1])}return super.isWithinRange}updateBaseData(){this.handleValuePosition("array2D",2)&&this.updateHandlePoints()}updateDynamicPosition(){const{mainCanvas:t,position:e}=this,i=t.transformPosition(e);this.internalUpdate({dynamicPosition:i}),this.updateHandlePointsPosition()}setOverlayStyles(t){var a;const e=this.mainCanvas,i=e.style[e.theme].line;let s={};return typeof this.style=="string"?s=((a=e.style[this.style])==null?void 0:a.line)||i:typeof this.style=="object"?s=nt(JSON.parse(JSON.stringify(i)),this.style):s=i,t&&this.setBaseLineStyle(t,s.stroke),s}get computedValueScopeStyles(){return this.setOverlayStyles()}drawLine(t,e){const{mainCanvas:i,isInfinite:s,isClick:a}=this;if(e=e||this.finalDynamicPosition,!i)return;this.setGlobalAlpha(t);const o=this.setOverlayStyles(t);t.beginPath(),this.path=new Path2D,e.forEach((l,h)=>{this.path[h==0?"moveTo":"lineTo"](l[0],l[1])}),t.stroke(this.path),this.isShowHandlePoint=(s||a)&&this.isHandlePointsVisible,this.isShowHandlePoint&&this.handlePoints.forEach(l=>{var h;l.style=o.point,(h=l.getDraw())==null||h[0].call(l,t)})}drawisInfiniteStraightLine(t){const{mainCanvas:e,finalDynamicPosition:i}=this;if(!e)return;this.setGlobalAlpha(t);const{rect:s}=e,[a,o]=i,l=[o[0]-a[0],o[1]-a[1]];if(l[0]===0&&l[1]===0)return console.error("");const h=Bt(a,[-l[0],-l[1]],s.width,s.height),c=Bt(o,l,s.width,s.height);this.drawLine(t,[h,c])}getDraw(){if(this.isNeedRender){const{isRecalculate:t,isInfinite:e}=this;return t&&this.updateDynamicPosition(),e?[this.drawisInfiniteStraightLine,this]:[this.drawLine,this]}}}function Bt(r,n,t,e){const[i,s]=r,[a,o]=n;let l=1/0;if(a!==0){const h=a>0?(t-i)/a:-i/a;h>0&&(l=Math.min(l,h))}if(o!==0){const h=o>0?(e-s)/o:-s/o;h>0&&(l=Math.min(l,h))}return l===1/0?r:[i+a*l,s+o*l]}function oi(r,n,t,e){const i=Math.min(r[0],n[0]),s=Math.max(r[0],n[0]),a=Math.min(r[1],n[1]),o=Math.max(r[1],n[1]),l=[[i,a],[s,a],[s,o],[i,o]],h=e[1]-t[1],c=t[0]-e[0],u=e[0]*t[1]-t[0]*e[1];if(h===0&&c===0){const[p,v]=t;return p>=i&&p<=s&&v>=a&&v<=o}const f=1e-10;let g=!1,y=!1;for(const[p,v]of l){const w=h*p+c*v+u;if(Math.abs(w)<f||(w>f?g=!0:y=!0,g&&y))return!0}return g&&y}class pt extends Qt{constructor(t){super(t);d(this,"_isRect",!1);d(this,"dynamicBorderRadius");d(this,"_borderRadius");d(this,"_borderRadiusType","position");d(this,"isClosed",!0);d(this,"minNeededHandlePoints",3);["isRect","borderRadius","borderRadiusType"].forEach(e=>{e in t&&(this[e]=t[e])}),t.isRect&&(this.canCreateOrDeleteHandlePoint=!1)}get isRect(){return this._isRect}set isRect(t){var e;this._isRect!=t&&(this._isRect=t,this.canCreateOrDeleteHandlePoint=!t,this.updateBaseData(),(e=this.notifyReload)==null||e.call(this))}get borderRadius(){return this._borderRadius}set borderRadius(t){var e;this._borderRadius!=t&&(this._borderRadius=t,this.updateDynamicRadius(),(e=this.notifyReload)==null||e.call(this))}get borderRadiusType(){return this._borderRadiusType}set borderRadiusType(t){var e;this._borderRadiusType!=t&&(this._borderRadiusType=t,this.updateDynamicRadius(),(e=this.notifyReload)==null||e.call(this))}updateValueScope(){this.initValueScope()}isPointInPath(t,e){return this.path?D.ctx.isPointInPath(this.path,t,e):!1}isPointInStroke(t,e){return this.path&&this.mainCanvas?(this.setOverlayStyles(D.ctx),this.isDraggable&&(D.ctx.lineWidth=Math.max(D.ctx.lineWidth,20)),D.ctx.isPointInStroke(this.path,t,e)):!1}isPointInAnywhere(t,e){return(s=>{if(!s)return!1;let a=!1;return[...this.handlePoints].sort((l,h)=>(l.isHover?0:1)-(h.isHover?0:1)).forEach(l=>{a?l.isHover&&l.notifyHover(!1):(a=l.isPointInAnywhere(t,e),a!=l.isHover&&l.notifyHover(a))}),a})(this.isClick&&this.isShowHandlePoint)||super.isPointInAnywhere(t,e)}updateDynamicRadius(){const{mainCanvas:t,borderRadius:e}=this;if(!t||!e){this.dynamicBorderRadius=void 0;return}if(typeof e=="number"){this.dynamicBorderRadius=this.handleSingleRadius(e);return}this.dynamicBorderRadius=e.map(i=>this.handleSingleRadius(i,!0))}handleSingleRadius(t,e){const{mainCanvas:i,borderRadiusType:s}=this;if(t<=0)return e?0:void 0;switch(s){case"position":return t*i.percentage;default:return i.getAxisPointByValue(t,0).x}}updateBaseData(){if(!this.mainCanvas)return;let{value:t,position:e,isRect:i}=this;const s=i?2:3;i&&(Array.isArray(t)&&(t.length=2),Array.isArray(e)&&(e.length=2)),this.handleValuePosition("array2D",s)&&(this.updateHandlePoints(),this.updateDynamicRadius())}setOverlayStyles(t){var h;const e=this.isHover,i=this.mainCanvas,s=i.style[i.theme].polygon;let a={};typeof this.style=="string"?a=((h=i.style[this.style])==null?void 0:h.polygon)||s:typeof this.style=="object"?a=nt(JSON.parse(JSON.stringify(s)),this.style):a=s;const{fill:o,fill_hover:l}=a;return t&&(this.setBaseLineStyle(t,a.stroke),t.fillStyle=e?l:o),a}get computedValueScopeStyles(){return this.setOverlayStyles()}drawRect(t){this.setGlobalAlpha(t);const[[e,i],[s,a]]=this.finalDynamicPosition,o=Math.abs(s-e),l=Math.abs(a-i),h=Math.min(e,s),c=Math.min(i,a),u=this.setOverlayStyles(t);t.beginPath(),this.path=new Path2D,this.dynamicBorderRadius?this.path.roundRect(h,c,o,l,this.dynamicBorderRadius):this.path.rect(h,c,o,l),t.stroke(this.path),t.fill(this.path),this.isShowHandlePoint=this.isClick&&this.isHandlePointsVisible,this.isShowHandlePoint&&this.handlePoints.forEach(f=>{var g;f.internalUpdate({style:u.point}),(g=f.getDraw())==null||g[0].call(f,t)})}drawPolygon(t){this.setGlobalAlpha(t);const e=this.finalDynamicPosition,i=this.setOverlayStyles(t);t.beginPath(),this.path=new Path2D,e.forEach((s,a)=>{this.path[a==0?"moveTo":"lineTo"](s[0],s[1])}),this.path.closePath(),t.stroke(this.path),t.fill(this.path),this.isShowHandlePoint=this.isClick&&this.isHandlePointsVisible,this.isShowHandlePoint&&this.handlePoints.forEach(s=>{var a;s.internalUpdate({style:i.point}),(a=s.getDraw())==null||a[0].call(s,t)})}getDraw(){if(this.isNeedRender){const{mainCanvas:t,position:e}=this;if(this.isRecalculate){this.updateDynamicRadius();const i=t.transformPosition(e);this.internalUpdate({dynamicPosition:i}),this.updateHandlePointsPosition()}return this.isRect?[this.drawRect,this]:[this.drawPolygon,this]}}}class mt extends D{constructor(t){super(t);d(this,"_draw");this.redrawOnIsHoverChange=!1;const{draw:e}=t;Object.assign(this,{draw:e})}updateValueScope(){this.initValueScope()}isPointInPath(t,e){return!1}isPointInStroke(t,e){return!1}updateBaseData(){if(!this.mainCanvas)return;this.internalUpdate({dynamicPosition:void 0});let t=this.value,e=this.position;t?e=this.convertValuesToPositions(t):t=this.convertPositionsToValues(e),this.updateDataProperties(t,e)}convertValuesToPositions(t){const e=[];let i=1;return t.forEach((s,a)=>{if(a===0){const o=this.mainCanvas.getAxisPointByValue(s[0],s[1],!0);e.push([o.x,o.y]),i=new R(o.x).div(s[0]).toNumber()}else e.push([new R(i).mul(s[0]).toNumber(),new R(i).mul(s[1]).toNumber()])}),e}convertPositionsToValues(t){const e=[];let i=1;return t.forEach((s,a)=>{if(a===0){const o=this.mainCanvas.getAxisValueByPoint(s[0],s[1],!0);e.push([o.xV,o.yV]),i=new R(o.xV).div(s[0]).toNumber()}else e.push([new R(i).mul(s[0]).toNumber(),new R(i).mul(s[1]).toNumber()])}),e}updateDataProperties(t,e){this.internalUpdate({value:t,position:e,dynamicPosition:this.mainCanvas.transformPosition(e)})}setOverlayStyles(t){}get computedValueScopeStyles(){return{}}get draw(){return t=>{var e;this.setGlobalAlpha(t),(e=this._draw)==null||e.call(this,t)}}set draw(t){this._draw=t}getDraw(){if(this.isNeedRender){const{mainCanvas:t,position:e}=this;return this.isRecalculate&&this.internalUpdate({dynamicPosition:t.transformPosition(e)}),[this.draw,this]}}}class Nt extends D{constructor(t){super(t);d(this,"_isFill",!1);d(this,"_isClosed",!1);d(this,"_isClosedThroughCenter",!1);d(this,"_radiusValue",0);d(this,"_radiusPosition",0);d(this,"_startAngle",0);d(this,"_endAngle",0);d(this,"_counterclockwise",!1);d(this,"isShowHandlePoint",!1);d(this,"_isHandlePointsVisible",!0);d(this,"defaultClick",(t,e)=>{var a;if(!this.isHandlePointsVisible)return;const{state:i,oldState:s}=t.data;i!=s&&((a=this.notifyReload)==null||a.call(this))});d(this,"defaultDragg",(t,e)=>{if(!this.mainCanvas)return;const i=()=>{var c;const{offsetX:s,offsetY:a}=t.data,{x:o,y:l}=this.calculateOffset(s,a);this.handlePointsArr.concat(this).forEach(u=>{u.internalUpdate({value:[O.add(u.value[0],o.value),O.add(u.value[1],l.value)],position:[O.add(u.position[0],o.position),O.add(u.position[1],l.position)],dynamicPosition:[O.add(u.dynamicPosition[0],o.dynamicPosition),O.add(u.dynamicPosition[1],l.dynamicPosition)]},!0)}),(c=this.notifyReload)==null||c.call(this)};if(this.isHandlePointsVisible){const{start:s,end:a,radius:o}=this.handlePoints,l=this.handlePointsArr.find(h=>h.isHover);if(l){const h=t.data.offsetX;if(l==s)this.startAngle=(this.startAngle+-h/180*Math.PI)%(Math.PI*2);else if(l==a)this.endAngle=(this.endAngle+-h/180*Math.PI)%(Math.PI*2);else if(l==o){const c=h/2/this.mainCanvas.percentage;this.radiusPosition+c>0&&(this.radiusPosition+=c)}}else i()}else i()});d(this,"handlePoints",{start:void 0,end:void 0,radius:void 0});["isFill","isClosed","isClosedThroughCenter","radiusValue","radiusPosition","startAngle","endAngle","counterclockwise","isHandlePointsVisible"].forEach(e=>{e in t&&(this["_"+e]=t[e])}),this.addEventListener("click",this.defaultClick),this.addEventListener("dragg",this.defaultDragg)}get isFill(){return this._isFill}set isFill(t){var e;this._isFill!=t&&(this._isFill=t,(e=this.notifyReload)==null||e.call(this))}get isClosed(){return this._isClosed}set isClosed(t){var e;this._isClosed!=t&&(this._isClosed=t,(e=this.notifyReload)==null||e.call(this))}get isClosedThroughCenter(){return this._isClosedThroughCenter}set isClosedThroughCenter(t){var e;this._isClosedThroughCenter!=t&&(this._isClosedThroughCenter=t,(e=this.notifyReload)==null||e.call(this))}get radiusValue(){return this._radiusValue}set radiusValue(t){this._radiusValue!=t&&(this._radiusValue=t,this._radiusPosition=0,this.updateBaseData())}get radiusPosition(){return this._radiusPosition}set radiusPosition(t){this._radiusPosition!=t&&(this._radiusPosition=t,this._radiusValue=0,this.updateBaseData())}get startAngle(){return this._startAngle}set startAngle(t){var e;this._startAngle!=t&&(this._startAngle=t,this.updateHandlePoints(),(e=this.notifyReload)==null||e.call(this))}get endAngle(){return this._endAngle}set endAngle(t){var e;this._endAngle!=t&&(this._endAngle=t,this.updateHandlePoints(),(e=this.notifyReload)==null||e.call(this))}get counterclockwise(){return this._counterclockwise}set counterclockwise(t){var e;this._counterclockwise!=t&&(this._counterclockwise=t,(e=this.notifyReload)==null||e.call(this))}get isHandlePointsVisible(){return this._isHandlePointsVisible}set isHandlePointsVisible(t){var e;this._isHandlePointsVisible!==t&&(this._isHandlePointsVisible=t,this.isShowHandlePoint!=t&&((e=this.notifyReload)==null||e.call(this)),this.updateHandlePoints())}get offset(){return super.offset}set offset(t){super.offset=t;let{isHandlePointsVisible:e,handlePointsArr:i}=this;e&&i.forEach(s=>s.internalUpdate({offset:t}))}updateValueScope(){const{mainCanvas:t,radiusValue:e}=this;t&&(this.initValueScope(),this.setFixedExtraScope({topV:e,bottomV:e,leftV:e,rightV:e*2}))}isPointInPath(t,e){return this.isFill&&this.path?D.ctx.isPointInPath(this.path,t,e):!1}isPointInStroke(t,e){return this.path&&this.mainCanvas?(this.setOverlayStyles(D.ctx),this.isDraggable&&(D.ctx.lineWidth=Math.max(D.ctx.lineWidth,20)),D.ctx.isPointInStroke(this.path,t,e)):!1}isPointInAnywhere(t,e){return(s=>{if(!s)return!1;let a=!1;return this.handlePointsArr.forEach(o=>{a?o.isHover&&o.notifyHover(!1):(a=o.isPointInAnywhere(t,e),a!=o.isHover&&o.notifyHover(a))}),a})(this.isClick&&this.isShowHandlePoint)||super.isPointInAnywhere(t,e)}get cursorStyle(){const t=this.handlePointsArr.some(e=>e==null?void 0:e.isHover);return this.isInteractive?this.isDraggable?"_nhanh_canvas_hover_overlay_draggable"+(t?"_ew":""):"_nhanh_canvas_hover_overlay":void 0}setOverlayStyles(t){var h;const e=this.isHover,i=this.mainCanvas,s=i.style[i.theme].arc;let a={};typeof this.style=="string"?a=((h=i.style[this.style])==null?void 0:h.arc)||s:typeof this.style=="object"?a=nt(JSON.parse(JSON.stringify(s)),this.style):a=s;const{fill:o,fill_hover:l}=a;return t&&(this.setBaseLineStyle(t,a.stroke),t.fillStyle=e?l:o),a}get computedValueScopeStyles(){return this.setOverlayStyles()}get handlePointsArr(){const t=this.handlePoints.radius;return Object.values(this.handlePoints).filter(Boolean).sort((e,i)=>(e.isHover||e==t?0:1)-(i.isHover||i==t?0:1))}updateHandlePoints(){let{mainCanvas:t,value:e,radiusValue:i,startAngle:s,endAngle:a,dynamicPosition:o,isHandlePointsVisible:l,offset:h}=this;if(!t||!o||!l)return;const[c,u]=li(...e,i,s,a,t.axisConfig.x,t.axisConfig.y),f=w=>new $({name:w,offset:h,isDraggable:!0,mainCanvas:this.mainCanvas,notifyReload:()=>{var S;return(S=this.notifyReload)==null?void 0:S.call(this)}}),g=this.handlePoints.start||f("start"),y=this.handlePoints.end||f("end"),p=this.handlePoints.radius||f("radius");g.value=c,y.value=u;const v=e[0]+i*2*t.axisConfig.x;p.value=[v,e[1]],this.handlePoints={start:g,end:y,radius:p}}updateBaseData(){this.mainCanvas&&(this.radiusValue?this._radiusPosition=this.mainCanvas.getAxisPointByValue(this.radiusValue,0,!0).x:this._radiusValue=this.mainCanvas.getAxisValueByPoint(this.radiusPosition,0,!0).xV,this.handleValuePosition("array1D")&&this.updateHandlePoints())}drawGuideLine(t,e,i,s){this.setBaseLineStyle(t,{...s.stroke,dash:!s.stroke.dash});const{radiusPosition:a,startAngle:o,endAngle:l,counterclockwise:h,mainCanvas:c}=this;t.beginPath(),t.arc(e,i,a*c.percentage,l,o,h),t.stroke(),t.beginPath(),t.moveTo(e,i);const u=this.handlePoints.radius.finalDynamicPosition;t.lineTo(u[0],u[1]),t.stroke(),!(this.isClosed&&this.isClosedThroughCenter)&&(t.fillStyle=t.strokeStyle,t.beginPath(),t.arc(e,i,s.point.radius,0,Math.PI*2),t.fill())}draw(t){const{finalDynamicPosition:e,mainCanvas:i,startAngle:s,endAngle:a,counterclockwise:o,isFill:l,isClosed:h,isClosedThroughCenter:c,radiusPosition:u}=this;if(!i||u<=0)return;this.setGlobalAlpha(t);const f=this.setOverlayStyles(t),[g,y]=e;t.beginPath(),this.path=new Path2D,this.path.arc(g,y,u*i.percentage,s,a,o),h&&(this.path.lineTo(g,y),c&&this.path.closePath()),t.stroke(this.path),l&&t.fill(this.path),this.isShowHandlePoint=this.isClick&&this.isHandlePointsVisible,this.isShowHandlePoint&&(this.drawGuideLine(t,g,y,f),this.handlePointsArr.forEach(p=>{var v;p.internalUpdate({style:f.point}),(v=p.getDraw())==null||v[0].call(p,t)}))}getDraw(){if(this.isNeedRender){if(this.isRecalculate){const{position:t,mainCanvas:e}=this,i=this.dynamicPosition,s=e.transformPosition(t);if(this.internalUpdate({dynamicPosition:s}),this.isHandlePointsVisible)if(e!=null&&e.isScaleUpdated)this.updateHandlePoints();else{const a=s[0]-i[0],o=s[1]-i[1];this.handlePointsArr.forEach(l=>{const h=l.dynamicPosition[0]+a,c=l.dynamicPosition[1]+o;l.internalUpdate({dynamicPosition:[h,c]})})}}return[this.draw,this]}}}function li(r,n,t,e,i,s=1,a=1){const o=r+t*Math.cos(e)*s,l=n+t*Math.sin(e)*a,h=r+t*Math.cos(i)*s,c=n+t*Math.sin(i)*a;return[[o,l],[h,c]]}class Ht extends D{constructor(t){super(t);d(this,"handlePoints");d(this,"isShowHandlePoint",!1);d(this,"_isHandlePointsVisible",!0);d(this,"_radiusValue",0);d(this,"_radiusPosition",0);d(this,"defaultClick",(t,e)=>{var a;if(!this.isHandlePointsVisible)return;const{state:i,oldState:s}=t.data;i!=s&&((a=this.notifyReload)==null||a.call(this))});d(this,"defaultDragg",(t,e)=>{this.mainCanvas});["isHandlePointsVisible"].forEach(e=>{e in t&&(this["_"+e]=t[e])}),this.addEventListener("click",this.defaultClick),this.addEventListener("dragg",this.defaultDragg)}get handlePointsArr(){if(this.handlePoints){const{radius:t,other:e}=this.handlePoints;return[t,...e].filter(Boolean).sort((i,s)=>(i.isHover||i==t?0:1)-(s.isHover||s==t?0:1))}return[]}get isHandlePointsVisible(){return this._isHandlePointsVisible}set isHandlePointsVisible(t){var e;this._isHandlePointsVisible!==t&&(this._isHandlePointsVisible=t,this.isShowHandlePoint!=t&&((e=this.notifyReload)==null||e.call(this)))}get radiusValue(){return this._radiusValue}set radiusValue(t){this._radiusValue!=t&&(this._radiusValue=t,this.updateBaseData())}get radiusPosition(){return this._radiusPosition}set radiusPosition(t){this._radiusPosition!=t&&(this._radiusPosition=t,this.updateBaseData())}updateValueScope(){this.initValueScope()}isPointInPath(t,e){return!1}isPointInStroke(t,e){return this.path&&this.mainCanvas?(this.setOverlayStyles(D.ctx),this.isDraggable&&(D.ctx.lineWidth=Math.max(D.ctx.lineWidth,20)),D.ctx.isPointInStroke(this.path,t,e)):!1}isPointInAnywhere(t,e){return(s=>{if(!s)return!1;let a=!1;return this.handlePointsArr.forEach(o=>{a?o.isHover&&o.notifyHover(!1):(a=o.isPointInAnywhere(t,e),a!=o.isHover&&o.notifyHover(a))}),a})(this.isClick&&this.isShowHandlePoint)||super.isPointInAnywhere(t,e)}get cursorStyle(){var e;const t=(e=this.handlePoints)==null?void 0:e.radius.isHover;return this.isDraggable?"_nhanh_canvas_hover_overlay_draggable"+(t?"_ns":""):"_nhanh_canvas_hover_overlay"}setOverlayStyles(t){var a;const e=this.mainCanvas,i=e.style[e.theme].arcTo;let s={};return typeof this.style=="string"?s=((a=e.style[this.style])==null?void 0:a.arcTo)||i:typeof this.style=="object"?s=nt(JSON.parse(JSON.stringify(i)),this.style):s=i,t&&this.setBaseLineStyle(t,s.stroke),s}get computedValueScopeStyles(){return this.setOverlayStyles()}updateHandlePoints(){var h,c;let{value:t,position:e,dynamicPosition:i,isHandlePointsVisible:s}=this;if(!i||!s)return;const a=()=>new $({mainCanvas:this.mainCanvas,isDraggable:!0,notifyReload:()=>{var u;return(u=this.notifyReload)==null?void 0:u.call(this)}}),o=((h=this.handlePoints)==null?void 0:h.other)||[];t==null||t.forEach((u,f)=>{o[f]||o.push(a()),o[f].internalUpdate({value:t[f],position:e[f],dynamicPosition:i[f]},!0)}),o.length=t.length;const l=((c=this.handlePoints)==null?void 0:c.radius)||a();this.handlePoints={radius:l,other:o}}updateBaseData(){if(!this.mainCanvas)return;let{value:t,position:e}=this;const[i,s]=[yt(t)&&t.length>1,yt(e)&&e.length>1];if(!i&&!s)return this.handlePoints=void 0,this.internalUpdate({dynamicPosition:void 0});if(i){e=[];for(let o=0;o<t.length;o++){const l=t[o],h=this.mainCanvas.getAxisPointByValue(l[0],l[1],!0);e.push([h.x,h.y])}}else{t=[];for(let o=0;o<e.length;o++){const l=e[o],h=this.mainCanvas.getAxisValueByPoint(l[0],l[1],!0);t.push([h.xV,h.yV])}}const a=this.mainCanvas.transformPosition(e);this.internalUpdate({value:t,position:e,dynamicPosition:a}),this.updateHandlePoints()}draw(t){const{dynamicPosition:e,mainCanvas:i,radiusValue:s}=this}getDraw(){if(this.isNeedRender){if(this.isRecalculate){const{position:t,mainCanvas:e}=this,i=this.dynamicPosition,s=e.transformPosition(t);if(this.internalUpdate({dynamicPosition:s}),this.isHandlePointsVisible)if(e!=null&&e.isScaleUpdated)this.updateHandlePoints();else{const a=s[0][0]-i[0][0],o=s[0][1]-i[0][1];this.handlePointsArr.forEach(l=>{const h=l.dynamicPosition[0]+a,c=l.dynamicPosition[1]+o;l.internalUpdate({dynamicPosition:[h,c]})})}}return[this.draw,this]}}}class U extends at{constructor(t){super(t);d(this,"overlays",new Set);this.setNotifyReload(t.notifyReload)}setMainCanvas(t){var e;super.setMainCanvas(t),this.overlays.forEach(i=>{i.setMainCanvas(t),i.parent=this}),t&&this.overlays.size&&((e=this.notifyReload)==null||e.call(this))}setNotifyReload(t){this.notifyReload=t?e=>{e&&(this.isRecalculate=!0),(e||this.shouldRender()&&this.overlays.size)&&t()}:void 0,this.overlays.forEach(e=>e.setNotifyReload(this.notifyReload))}addOverlays(t){var e;[t].flat().forEach(i=>{i.setNotifyReload(this.notifyReload),i.setMainCanvas(this.mainCanvas),i.parent=this,this.overlays.add(i)}),(e=this.notifyReload)==null||e.call(this)}hasOverlay(t){return this.overlays.has(t)}removeOverlays(t){var e;[t].flat().forEach(i=>{this.overlays.delete(i),i.setNotifyReload(),i.setMainCanvas(),i.parent=void 0}),(e=this.notifyReload)==null||e.call(this)}clearOverlays(){var t;(t=this.notifyReload)==null||t.call(this),this.overlays.forEach(e=>{e.setNotifyReload(),e.setMainCanvas(),e.parent=void 0}),this.overlays.clear()}getOverlaysDrawingMethod(){const t=[];return this.shouldRender()&&this.overlays.size&&Array.from(this.overlays.values()).sort((e,i)=>e.zIndex-i.zIndex).forEach(e=>{if(e.equalsMainCanvas(this.mainCanvas)){const i=e.getDraw();i&&t.push([Number(e.zIndex)||0,i])}else this.overlays.delete(e)}),t}}class F extends at{constructor(t){super(t);d(this,"zIndex",4);d(this,"canvas",document.createElement("canvas"));d(this,"ctx",this.canvas.getContext("2d"));d(this,"isReload",!1);d(this,"groups",new Map);d(this,"currentDrawOverlays",[]);this.setNotifyReload(t.notifyReload)}setMainCanvas(t){super.setMainCanvas(t),this.canvas.width=(t==null?void 0:t.rect.width)||0,this.canvas.height=(t==null?void 0:t.rect.height)||0,this.groups.forEach(e=>{e.setMainCanvas(t),e.parent=this})}setNotifyReload(t){this.notifyReload=t?e=>{e&&(this.isRecalculate=!0),(e||this.shouldRender()&&this.groups.size)&&t()}:void 0,this.groups.forEach(e=>this.setGroupNotifyReload(e))}setGroupNotifyReload(t){t.setNotifyReload(this.notifyReload?()=>{var e;(e=this.notifyReload)==null||e.call(this),this.isReload=!0}:void 0)}getGroup(t){return this.groups.get(t)}addGroup(t){[t].flat().forEach(e=>{e instanceof U&&(this.setGroupNotifyReload(e),e.setMainCanvas(this.mainCanvas),e.parent=this,this.groups.set(e.name,e))})}removeGroup(t){var i;let e=!1;[t].flat().forEach(s=>{s instanceof U&&(this.groups.delete(s.name),s.setNotifyReload(),s.setMainCanvas(),s.parent=void 0,e=!0)}),e&&((i=this.notifyReload)==null||i.call(this))}clearGroup(){var t;this.groups.size&&(this.groups.forEach(e=>{e.setNotifyReload(),e.setMainCanvas(),e.parent=void 0}),this.groups.clear(),(t=this.notifyReload)==null||t.call(this))}setzIndex(t){var e;t!=this.zIndex&&(this.zIndex=t,(e=this.notifyReload)==null||e.call(this,!1))}getCanvas(){if(!this.mainCanvas)return;const{rect:t,isThemeUpdated:e}=this.mainCanvas,i=this.shouldRender(),s=this.groups.size;if(i&&s){if(this.isReload||this.isRecalculate||e){this.currentDrawOverlays=[],this.isReload=!1,this.canvas.width=t.width||0,this.canvas.height=t.height||0;const a=[];this.groups.forEach(o=>{o.equalsMainCanvas(this.mainCanvas)?a.push(...o.getOverlaysDrawingMethod()):this.groups.delete(o.name)}),a.sort((o,l)=>o[0]-l[0]),a.forEach(([o,[l,h]])=>{l.call(h,this.ctx),this.currentDrawOverlays.push([[Number(this.zIndex)||0,o],h])})}return[Number(this.zIndex)||0,this.canvas,this.currentDrawOverlays]}}}class it extends at{constructor(t){super(t);d(this,"layers",new Map);d(this,"defaultContextmenu",(t,e)=>t.stopPropagation());d(this,"defaultClick",(t,e)=>t.stopPropagation());d(this,"defaultDoubleClick",(t,e)=>t.stopPropagation());d(this,"defaultHover",(t,e)=>t.stopPropagation());d(this,"defaultDragg",(t,e)=>t.stopPropagation());d(this,"defaultDown",(t,e)=>t.stopPropagation());this.inheritOpacity=!1,this.setNotifyReload(t.notifyReload),this.addEventListener("contextmenu",this.defaultContextmenu),this.addEventListener("click",this.defaultClick),this.addEventListener("doubleClick",this.defaultDoubleClick),this.addEventListener("hover",this.defaultHover),this.addEventListener("dragg",this.defaultDragg),this.addEventListener("down",this.defaultDown)}setMainCanvas(t){super.setMainCanvas(t),this.layers.forEach(e=>{e.setMainCanvas(t),e.parent=this})}setNotifyReload(t){this.notifyReload=t?e=>{e&&(this.isRecalculate=!0),(e||this.shouldRender()&&this.layers.size)&&t()}:void 0,this.layers.forEach(e=>e.setNotifyReload(this.notifyReload))}getLayer(t){return this.layers.get(t)}addLayer(t){[t].flat().forEach(e=>{e instanceof F&&(e.setNotifyReload(this.notifyReload),e.setMainCanvas(this.mainCanvas),e.parent=this,this.layers.set(e.name,e))})}removeLayer(t){var i;let e=!1;[t].flat().forEach(s=>{s instanceof F&&(this.layers.delete(s.name),s.setNotifyReload(),s.setMainCanvas(),s.parent=void 0,e=!0)}),e&&((i=this.notifyReload)==null||i.call(this))}clearLayers(){var t;this.layers.size&&(this.layers.forEach(e=>{e.setNotifyReload(),e.setMainCanvas(),e.parent=void 0}),this.layers.clear(),(t=this.notifyReload)==null||t.call(this))}fetchCanvas(){if(this.shouldRender()&&this.layers.size){const t=[];return this.layers.forEach(e=>{if(e.equalsMainCanvas(this.mainCanvas)){const i=e.getCanvas();i&&t.push(i)}else this.layers.delete(e.name)}),t}return[]}}class hi extends at{constructor(t){super(t);d(this,"canvas");d(this,"ctx");d(this,"_rectValueIsUpdated",!1);d(this,"_rect");d(this,"offset",{x:0,y:0});d(this,"center",{x:0,y:0});d(this,"defaultCenter",{top:void 0,bottom:void 0,left:void 0,right:void 0});d(this,"accuracy",5);d(this,"scale",1);d(this,"defaultScale",1);d(this,"percentage",1);d(this,"axisConfig",{count:2,min:100,size:100,x:1,y:1});d(this,"cycle",10);d(this,"delta",.02);d(this,"_redrawInNextRenderFrame",!1);d(this,"isAuto",!1);d(this,"isRendering",!1);d(this,"drawAxis");d(this,"layerGroups",new Map);d(this,"isScaleUpdated",!1);d(this,"nowGridCount");const{id:e,axisConfig:i,defaultCenter:s,offset:a,defaultScale:o}=t,l=document.getElementById(e);if(l instanceof HTMLCanvasElement)if(l.getContext){this.canvas=l,this.ctx=l.getContext("2d");const{clientWidth:h,clientHeight:c}=l;[l.width,l.height]=[h,c]}else throw new Error("canvas-unsupported code here");else throw new Error("canvas is not HTMLCanvasElement");i&&this.setAxis(i),a&&(this.offset.x=a.x||0,this.offset.y=a.y||0),s&&this.setDefaultCenter(s),o&&(this.updateCenter(),this.setScale("center",o-1),this.defaultScale=o)}get rect(){return this._rectValueIsUpdated&&this._rect?this._rect:(this._rectValueIsUpdated=!0,Promise.resolve().then(()=>this._rectValueIsUpdated=!1),this._rect=this.canvas.getBoundingClientRect(),this._rect)}get redrawInNextRenderFrame(){return this._redrawInNextRenderFrame}set redrawInNextRenderFrame(t){this._redrawInNextRenderFrame=t}setNotifyReload(t){this.notifyReload=t}getDefaultCenterLocation(){const{canvas:t,rect:e,defaultCenter:i}=this;if(!t)return console.error("canvas is not HTMLCanvasElement");const{width:s,height:a}=e,{top:o,bottom:l,left:h,right:c}=i,u={vertical:(p,v)=>{if([0,"0","0%"].includes(p))return 0;if(!(p==1/0||p==-1/0))return typeof p=="number"?p:["top","left"].includes(p)?0:["bottom","right"].includes(p)?v:["middle","center"].includes(p)?v/2:/^(-?\d+)%$/.test(p)?(p=p.match(/^(-?\d+)%$/)[1],v*Number(p)/100):Number(p)||void 0},reverse:(p,v)=>{if([0,"0","0%"].includes(p))return v;if(p==1/0||p==-1/0)return;if(typeof p=="number")return v-p;const w=u.vertical(p,v);return w?v-w:void 0}},f=(p,v,w)=>{if(p!==void 0){const S=u.vertical(p,w);if(S!==void 0)return S}if(v!==void 0){const S=u.reverse(v,w);if(S!==void 0)return S}return w/2},g=f(o,l,a);return{x:f(h,c,s),y:g}}updateCenter(){const t=this.getDefaultCenterLocation();if(!t)return;const{x:e,y:i}=t;this.center={x:Math.floor(e+this.offset.x),y:Math.floor(i+this.offset.y)}}updateSize(){const{scale:t,axisConfig:e}=this;e.size=this.getGridSize(t),this.percentage=this.getAxisPointByValue(e.count,0).x/e.min}setScale(t,e){const{canvas:i,isWheelable:s,axisConfig:a,rect:o}=this;if(!s||!i)return console.error("canvas is not HTMLCanvasElement");let l,h;t==="center"?(l=o.left+o.width/2,h=o.top+o.height/2):[l,h]=[t.clientX,t.clientY];const c=this.getMousePositionOnAxis({clientX:l,clientY:h}),u=this.getAxisValueByPoint(c.x,c.y);this.scale=new R(this.scale).add(e).toNumber(),this.isScaleUpdated=!0,this.updateSize();const f=this.getAxisPointByValue(u.xV,u.yV);this.offset.x-=(f.x-c.x)*a.x,this.offset.y-=(f.y-c.y)*a.y,this.offset.x=Number(this.offset.x.toFixed(0)),this.offset.y=Number(this.offset.y.toFixed(0))}setAxis(t){const e={...this.axisConfig,...t},i=Object.fromEntries(Object.entries(e).map(([p,v])=>[p,Number(v)])),{x:s,y:a,count:o,min:l,size:h}=i,c=[1,-1].includes(s),u=[1,-1].includes(a),f=o>0,g=l>0,y=h>=l&&h<=l*2;if(!c||!u||!f||!g||!y){console.warn("Invalid axis configuration:",{x:s,y:a,count:o,min:l,size:h});return}this.axisConfig=i}setDefaultCenter(t){Object.assign(this.defaultCenter,t),this.updateCenter()}getGridSize(t){const{cycle:e,delta:i,axisConfig:s}=this;let a=new R(t).sub(1).abs().mod(e*i).div(i).toNumber();return a=t<1&&a!=0?e-a:a,Number(((a/e+1)*s.min).toFixed(0))}getGridCount(t){const{axisConfig:e,cycle:i,delta:s}=this,a=e.count,o=i*s;if(t===1)return a;if(t>1){const l=new R(t).sub(1).div(o).floor();return new R(a).div(new R(2).pow(l)).toNumber()}else{const l=new R(1).sub(t).div(o).ceil();return new R(a).mul(new R(2).pow(l)).toNumber()}}get getNowGridCount(){const{scale:t,nowGridCount:e,isRendering:i}=this;return e&&i?e:(this.nowGridCount=this.getGridCount(t),i&&Promise.resolve().then(()=>this.nowGridCount=void 0),this.nowGridCount)}getMousePositionOnAxis(t){const{canvas:e,center:i,rect:s,axisConfig:a}=this;if(!e)return console.error("canvas is not HTMLCanvasElement");const{clientX:o,clientY:l}=t,{left:h,top:c}=s,u=(o-h-i.x)*a.x,f=(l-c-i.y)*a.y;return{x:u,y:f}}getAxisValueByPoint(t,e,i){const{axisConfig:s}=this;if(i)return{xV:t/s.min*s.count,yV:e/s.min*s.count};const a=this.getNowGridCount,o=new R(t).div(s.size).mul(a).toFixed(8),l=new R(e).div(s.size).mul(a).toFixed(8);return{xV:Number(o),yV:Number(l)}}getAxisPointByValue(t,e,i){const{axisConfig:s}=this;if(i)return{x:t/s.count*s.min,y:e/s.count*s.min};const a=this.getNowGridCount,o=new R(t).div(a).mul(s.size).toFixed(3),l=new R(e).div(a).mul(s.size).toFixed(3);return{x:Number(o),y:Number(l)}}getMaxMinValue(t){t=t||this.rect;const{left:e,top:i,right:s,bottom:a}=t,{axisConfig:o}=this,{x:l,y:h}=this.getMousePositionOnAxis({clientX:o.x==1?e:s,clientY:o.y==1?i:a}),{xV:c,yV:u}=this.getAxisValueByPoint(l,h),{x:f,y:g}=this.getMousePositionOnAxis({clientX:o.x==1?s:e,clientY:o.y==1?a:i}),{xV:y,yV:p}=this.getAxisValueByPoint(f,g);return{minXV:c,maxXV:y,minYV:u,maxYV:p}}transformPosition(t){const{center:e,percentage:i,axisConfig:s}=this,a=i*s.x,o=i*s.y,l=h=>[e.x+h[0]*a,e.y+h[1]*o];return Array.isArray(t[0])?t.map(h=>l(h)):l(t)}}class ci extends hi{constructor(t){super(t);d(this,"theme","light");d(this,"isThemeUpdated",!1);d(this,"style",{light:{background:"#fff",text:{color:"#222",secondary:"#909399",stroke:"#fff",size:12,family:"monospace",bold:!0},grid:{axis:"#222",grid:"#666",innerGrid:"#e5e5e5"},point:{radius:5,fill:"#d03050",width:14,stroke:"#d0305080"},line:{stroke:{color:"#f0a020",color_hover:"#f2c97d",width:4,dash:!1,dashGap:[5,10],dashOffset:0,cap:"round",join:"round"},point:{radius:5,stroke:"#f0a02080",width:14,fill:"#f0a020"}},arc:{fill:"#f0a02030",fill_hover:"#f2c97d60",stroke:{color:"#f0a020",color_hover:"#f2c97d",width:4,dash:!1,dashGap:[5,10],dashOffset:0,cap:"round",join:"round"},point:{radius:5,stroke:"#f0a02080",width:14,fill:"#f0a020"}},arcTo:{stroke:{color:"#f0a020",color_hover:"#f2c97d",width:4,dash:!1,dashGap:[5,10],dashOffset:0,cap:"round",join:"round"},point:{radius:5,stroke:"#f0a02080",width:14,fill:"#f0a020"}},polygon:{fill:"#18a05830",fill_hover:"#03693360",stroke:{color:"#18a058",color_hover:"#036933",width:1,dash:!1,dashGap:[5,10],dashOffset:0,cap:"round",join:"round"},point:{radius:5,stroke:"#03693380",width:14,fill:"#036933"}}},dark:{background:"#000",text:{color:"#aeaeae",secondary:"#8c8c8c",stroke:"#000",size:12,family:"monospace",bold:!0},grid:{axis:"#aeaeae",grid:"#666",innerGrid:"#454545"},point:{radius:5,fill:"#e88080",width:14,stroke:"#e8808070"},line:{stroke:{color:"#f2c97d",color_hover:"#f0a020",width:4,dash:!1,dashGap:[5,10],dashOffset:0,cap:"round",join:"round"},point:{radius:5,stroke:"#f2c97d80",width:14,fill:"#f2c97d"}},arc:{fill:"#f2c97d30",fill_hover:"#f0a02060",stroke:{color:"#f2c97d",color_hover:"#f0a020",width:4,dash:!1,dashGap:[5,10],dashOffset:0,cap:"round",join:"round"},point:{radius:5,stroke:"#f2c97d80",width:14,fill:"#f2c97d"}},arcTo:{stroke:{color:"#f2c97d",color_hover:"#f0a020",width:4,dash:!1,dashGap:[5,10],dashOffset:0,cap:"round",join:"round"},point:{radius:5,stroke:"#f2c97d80",width:14,fill:"#f2c97d"}},polygon:{fill:"#63e2b730",fill_hover:"#7efbd160",stroke:{color:"#63e2b7",color_hover:"#63e2b7",width:1,dash:!1,dashGap:[5,10],dashOffset:0,cap:"round",join:"round"},point:{radius:5,stroke:"#7efbd180",width:14,fill:"#7efbd1"}}}});const{theme:e}=t;e&&this.setTheme(e),this.initStyle(),this.clearScreen()}initStyle(){const{canvas:t,ctx:e,theme:i}=this;t.classList.add("_nhanh_canvas");const s=this.style[i];e.font=`${s.text.bold?"bold":""} ${s.text.size}px ${s.text.family}`}clearScreen(t=!0){const{ctx:e,theme:i,rect:s}=this,{width:a,height:o}=s;e.clearRect(0,0,a,o),t&&this.style[i].background&&(e.fillStyle=this.style[i].background,e.fillRect(0,0,a,o))}setStyle(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e)){const i=ne(this.style[e]||this.style[this.theme]);nt(i,t[e]),this.style[e]=i}this.initStyle()}setTheme(t){t in this.style&&(this.theme=t,this.isThemeUpdated=!0)}}class ui extends ci{constructor(t){super(t);d(this,"resizeObserver");d(this,"currentDrawOverlays",[]);d(this,"rely","");d(this,"isResizeObserverFirstRun",!0);d(this,"maxMinValue",{minXV:0,maxXV:0,minYV:0,maxYV:0});d(this,"measureRedrawPerformance",ae(()=>{this.isRendering=!0,this.redraw(),this.redrawInNextRenderFrame=!1,this.isRendering=!1},[[1,"#F56C6C"],[.5,"#E6A23C"],[0,"#67C23A"]]));this.canvas&&(this.resizeObserver=new ResizeObserver(re(()=>{if(this.isResizeObserverFirstRun)return this.isResizeObserverFirstRun=!1;[this.canvas.width,this.canvas.height]=[this.rect.width,this.rect.height],this.redrawOnce()},200)),this.resizeObserver.observe(this.canvas)),this.updateRely(),this.isRecalculate=!1}updateRely(){const{center:t,scale:e,rect:i,axisConfig:s}=this,a=[t.x,t.y,e,JSON.stringify(s),i.width,i.height].join();this.isRecalculate=this.rely!==a,this.rely=a}redraw(){var s,a;if(!this.canvas)return console.warn("canvas is not HTMLCanvasElement");if(this.canvas.clientWidth==0||this.canvas.clientHeight==0)return console.warn("The image argument is a canvas element with a width or height of 0.");if(!this.shouldRender())return this.clearScreen(!1);this.ctx.globalAlpha=this.opacity??1,this.updateCenter(),this.updateRely(),this.maxMinValue=this.getMaxMinValue(),this.clearScreen();const t=[];let e=[];const i=(s=this.drawAxis)==null?void 0:s.drawAxisAndGrid();i&&e.push([0,i,[]]),this.layerGroups.forEach(o=>e.push(...o.fetchCanvas())),e.sort((o,l)=>o[0]-l[0]),e.forEach(([,o,l],h)=>{this.ctx.drawImage(o,0,0),l.forEach(([[c,u],f])=>{t.push([[c+h,u],f])})}),t.sort(([[o,l],h],[[c,u],f])=>{if(o!==c)return c-o;if(l!==u)return u-l;const g=y=>y instanceof mt?5:y instanceof dt?4:y instanceof $?3:y instanceof gt||y instanceof Nt||y instanceof Ht?2:y instanceof pt?1:0;return g(f)-g(h)}),this.currentDrawOverlays=t.map(([,o])=>o),this.isRecalculate=!1,this.isThemeUpdated=!1,this.isScaleUpdated=!1,(a=this.notifyReload)==null||a.call(this)}redrawOnce(){this.redrawInNextRenderFrame||(this.redrawInNextRenderFrame=!0,Promise.resolve().then(()=>{var t;(t=this.measureRedrawPerformance)==null||t.call(this)}))}findOverlayByPoint(t){const{offsetX:e,offsetY:i,clientX:s,clientY:a}=t,{x:o,y:l}=this.axisConfig,h=this.getMousePositionOnAxis({clientX:s-10*o,clientY:a-10*l}),c=this.getMousePositionOnAxis({clientX:s+10*o,clientY:a+10*l}),u=this.getAxisValueByPoint(h.x,h.y),f=this.getAxisValueByPoint(c.x,c.y);return[...this.currentDrawOverlays].sort((g,y)=>(g.isDraggable&&g.isClick?0:1)-(y.isDraggable&&y.isClick?0:1)).find(g=>{const y=g.valueScope;return y&&(y.maxX<u.xV||y.minX>f.xV||y.maxY<u.yV||y.minY>f.yV)?!1:g.isPointInAnywhere(e,i)})}destroy(){var t;(t=this.resizeObserver)==null||t.disconnect()}}class fi extends ui{constructor(t){super(t);d(this,"mouseInCanvas",!1);d(this,"mouseIsDown",!1);d(this,"mouseLastPosition",{x:0,y:0});d(this,"unBind");d(this,"lastClickedOverlay");d(this,"lockNotifyClick",!1);d(this,"lastContextmenuOverlay");d(this,"defaultContextmenu",(t,e)=>{const i=this.lastClickedOverlay;i!=null&&i.isDraggable&&i.notifyClick(!1,e)});d(this,"lastPressedKey",{key:"",keyupTime:0,doubleClick:!1});d(this,"defaultWheel",(t,e)=>{this.setScale(e,t.data),this.redrawOnce()});d(this,"lastDownOverlay");d(this,"defaultDown",(t,e)=>{(e==null?void 0:e.button)==0&&(this.mouseIsDown=!0)});d(this,"lastHoverOverlay");d(this,"lastCursorStyle");d(this,"oldClientX",[]);d(this,"oldClientY",[]);this.initEvent(),this.addEventListener("contextmenu",this.defaultContextmenu),this.addEventListener("down",this.defaultDown),this.addEventListener("wheel",this.defaultWheel)}initEvent(){const{canvas:t}=this;if(!t)return console.error("canvas is not HTMLCanvasElement");const e=[{type:"click",handler:this.click.bind(this)},{type:"contextmenu",handler:this.contextmenu.bind(this)},{type:"mouseenter",handler:this.mouseenter.bind(this)},{type:"mouseleave",handler:this.mouseleave.bind(this)},{type:"keydown",handler:this.keydown.bind(this),target:window},{type:"keyup",handler:this.keyup.bind(this),target:window},{type:"wheel",handler:this.wheel.bind(this)},{type:"mousedown",handler:this.mousedown.bind(this)},{type:"mouseup",handler:this.mouseup.bind(this),target:window},{type:"mousemove",handler:this.mousemove.bind(this),target:window},{type:"touchend",handler:this.touchend.bind(this)},{type:"touchmove",handler:this.touchmove.bind(this)}];e.forEach(({type:i,handler:s,target:a=t})=>{a.addEventListener(i,s)}),this.unBind=()=>{e.forEach(({type:i,handler:s,target:a=t})=>{a.removeEventListener(i,s)})}}click(t){var i;if(!this.isClickable)return;if(this.lockNotifyClick)return this.lockNotifyClick=!1;const e=this.findOverlayByPoint(t);this.lastClickedOverlay!=e&&((i=this.lastClickedOverlay)==null||i.notifyClick(!1,t)),e==null||e.notifyClick(!0,t),this.lastClickedOverlay=e,this.notifyClick(!0,t)}contextmenu(t){var i;if(!this.isContextmenuable)return;t.preventDefault();const e=this.findOverlayByPoint(t);this.lastContextmenuOverlay!=e&&((i=this.lastContextmenuOverlay)==null||i.notifyContextmenu(!1,t)),e==null||e.notifyContextmenu(!0,t),this.lastContextmenuOverlay=e,this.notifyContextmenu(!0,t)}mouseenter(t){this.mouseInCanvas=!0}mouseleave(t){this.mouseInCanvas=!1}getStep(t){const{lastPressedKey:e}=this;return e.doubleClick?4:e.key===t&&Date.now()-e.keyupTime<300?(e.doubleClick=!0,4):1}keydown(t){const{mouseInCanvas:e,offset:i,delta:s,axisConfig:a}=this,o=t.key;if(!e||!this.isDraggable||this.isAuto)return;const l=this.getStep(o),h=this.lastClickedOverlay,u=(h==null?void 0:h.isDraggable)&&this.currentDrawOverlays.includes(h)&&(yt(h.value)?"Matrix":Gt(h.value)?"Single":!1),f=(v,w)=>{if(!u)return i.x+=v*l,i.y+=w*l,!0;const S=this.getAxisValueByPoint(l,0).xV,[b,V]=[S*a.x,S*a.y];if(u==="Single"){const M=h.value;M[0]+=v*b,M[1]+=w*V}else h.value.forEach(M=>{M[0]+=v*b,M[1]+=w*V});return h.value=[...h.value],!0},g=v=>(this.setScale("center",v*s),!0),p={ArrowUp:()=>f(0,-1),ArrowDown:()=>f(0,1),ArrowLeft:()=>f(-1,0),ArrowRight:()=>f(1,0),"+":()=>g(1),"-":()=>g(-1)}[o];p!=null&&p()&&(this.redrawOnce(),t.preventDefault())}keyup(t){const{mouseInCanvas:e,lastPressedKey:i}=this;if(e){const s=t.key;i.key=s,i.keyupTime=Date.now(),i.doubleClick=!1}}wheel(t){if(!this.isWheelable)return;t.preventDefault();const{delta:e,isAuto:i}=this;if(i)return;const s=t.deltaY<0?e:-e,a=this.findOverlayByPoint(t);a==null||a.notifyWheel(s,t),this.notifyWheel(s,t)}mousedown(t){var a;if(!this.isDownable)return;const{clientX:e,clientY:i}=t;this.mouseLastPosition={x:e,y:i};const s=this.findOverlayByPoint(t);this.lastDownOverlay!=s&&((a=this.lastDownOverlay)==null||a.notifyDown(!1,t),s==null||s.notifyDown(!0,t)),this.lastDownOverlay=s,this.notifyDown(!0,t)}mouseup(t){this.mouseIsDown=!1,this.lastDownOverlay=void 0}mousemove(t){this.isAuto||(this.canvas.classList.toggle("_nhanh_canvas_draggable",this.isDraggable),this.mouseIsDown?this.handleDragMove(t):this.handleHover(t))}handleDragMove(t){if(!this.isDraggable)return;const{lastDownOverlay:e}=this;if(!this.isDraggable)return;e!=null&&e.isDraggable?this.notifyDraggOverlays(t):this.handleCanvasPan(t);const{clientX:i,clientY:s}=t;this.mouseLastPosition={x:i,y:s},this.lockNotifyClick=!0}notifyDraggOverlays(t){const e=this.lastDownOverlay,{mouseLastPosition:i}=this,{clientX:s,clientY:a}=t;e.notifyDragg({offsetX:s-i.x,offsetY:a-i.y},t)}handleCanvasPan(t){const{clientX:e,clientY:i}=t,{offset:s,mouseLastPosition:a}=this,o=e-a.x,l=i-a.y;s.x+=o,s.y+=l,this.redrawOnce(),this.notifyDragg({offsetX:o,offsetY:l},t)}handleHover(t){if(!this.isHoverable||t.target!=this.canvas)return;const e=this.findOverlayByPoint(t);this.updateHoverState(e,t),this.notifyHover(!0,t)}updateHoverState(t,e){if(this.lastHoverOverlay===t){const s=t==null?void 0:t.cursorStyle;s!==this.lastCursorStyle&&(this.lastCursorStyle&&this.canvas.classList.remove(this.lastCursorStyle),s&&this.canvas.classList.add(s),this.lastCursorStyle=s);return}this.lastHoverOverlay&&t&&t.hasController("hover",this.lastHoverOverlay)||(this.clearHoverState(e),this.applyHoverState(t,e)),this.lastHoverOverlay=t}clearHoverState(t){this.lastHoverOverlay&&(this.lastHoverOverlay.notifyHover(!1,t),this.lastHoverOverlay.cursorStyle&&this.canvas.classList.remove(this.lastHoverOverlay.cursorStyle))}applyHoverState(t,e){t&&(t.notifyHover(!0,e),this.lastCursorStyle=t.cursorStyle,this.lastCursorStyle&&this.canvas.classList.add(this.lastCursorStyle))}touchend(t){this.oldClientX=this.oldClientY=[]}touchmove(t){if(!this.isDraggable)return;const e=t.touches;t.preventDefault();const{oldClientX:i,oldClientY:s,offset:a,delta:o,isAuto:l,isDraggable:h}=this;if(h&&!l){if(e.length===1){const{clientX:c,clientY:u}=e[0];i.length&&(a.x+=c-i[0],a.y+=u-s[0],this.redrawOnce()),this.oldClientX=[c],this.oldClientY=[u]}else if(e.length===2){const{clientX:c,clientY:u}=e[0],{clientX:f,clientY:g}=e[1];if(i.length==2){const y=Mt(i[0],s[0],i[1],s[1]),p=Mt(c,u,f,g),{x:v,y:w}=Xt(c,u,f,g);this.setScale({clientX:v,clientY:w},p>y?o:-o),this.redrawOnce()}this.oldClientX=[c,f],this.oldClientY=[u,g]}}}destroy(){var t;super.destroy(),(t=this.unBind)==null||t.call(this)}}class di extends fi{getDefaultOverlayGroup(){var o,l,h,c,u;const n=this.layerGroups.get("");if(!n)return;const t=(o=n.getLayer(""))==null?void 0:o.getGroup(""),e=(l=n.getLayer(""))==null?void 0:l.getGroup(""),i=(h=n.getLayer(""))==null?void 0:h.getGroup(""),s=(c=n.getLayer(""))==null?void 0:c.getGroup(""),a=(u=n.getLayer(""))==null?void 0:u.getGroup("");return{overlays_text:s,overlays_point:t,overlays_line:e,overlays_polygon:i,overlays_custom:a}}getAllOverlays(n){const t=[],e=n!==void 0?Array.isArray(n)?[...n]:[n]:Array.from(this.layerGroups.values());for(;e.length>0;){const i=e.pop();if(i instanceof it){if(!i.isVisible)continue;e.push(...i.layers.values())}else if(i instanceof F){if(!i.isVisible)continue;e.push(...i.groups.values())}else if(i instanceof U){if(!i.isVisible)continue;e.push(...i.overlays.values())}else i.isVisible&&t.push(i)}return t}}class gi extends di{zoom(n){const{canvas:t,rect:e}=this;if(!t||!e)return console.error("canvas is not HTMLCanvasElement");this.setScale("center",n),this.redrawOnce()}zoomIn(){this.zoom(this.delta)}zoomOut(){this.zoom(-this.delta)}setStyle(n){super.setStyle(n),this.redrawOnce()}setTheme(n){super.setTheme(n),this.redrawOnce()}setAxis(n){super.setAxis(n),this.redrawOnce()}setDefaultCenter(n){super.setDefaultCenter(n),this.redrawOnce()}}class pi extends gi{setFitView(n=void 0,t=!1,e=[60,60,60,60],i){const s=this.getAllOverlays(n);if(s.length===0)return;const{minX:a,maxX:o,minY:l,maxY:h}=this.calculateBoundingBox(s),c=o-a,u=h-l,f=this.calculateOptimalScale(c,u,e,i),g=this.calculateOffsetDifference(a,o,l,h,e);f==this.scale&&g.x==0&&g.y==0||(t?this.applyTransformImmediately(f,g):this.animateTransform(f,g))}calculateBoundingBox(n){let t=1/0,e=-1/0,i=1/0,s=-1/0;for(const a of n){const o=a.valueScope;t=Math.min(t,o.minX),e=Math.max(e,o.maxX),i=Math.min(i,o.minY),s=Math.max(s,o.maxY)}return{minX:t,maxX:e,minY:i,maxY:s}}calculateOptimalScale(n,t,e,i){const{cycle:s,delta:a,axisConfig:o,rect:l}=this,{width:h,height:c}=l,u=Math.max(0,h-e[1]-e[3])||h,f=Math.max(0,c-e[0]-e[2])||c;if(u<=0||f<=0)return console.warn(""),this.scale;const g=n/u,y=t/f,p=Math.max(g,y),v=o.count,w=v/o.min,S=s*a;let b;if(p>w){const V=Math.ceil(p/w);b=1-((v*V/p-o.min)/o.min+(V-2))*S}else{const V=(K,W,Q)=>K<W?Q-1:V(K/2,W,Q+1),M=V(w,p,0),L=Math.pow(2,M);b=1+((v/L/p-o.min)/o.min+M)*S}return i!==void 0&&(b=Math.min(i,b)),b=new R(b).div(a).round().mul(a).toNumber(),b}calculateOffsetDifference(n,t,e,i,s){const{width:a,height:o}=this.rect,{axisConfig:l,center:h}=this,c=(t+n)/2,u=(i+e)/2,f=this.getAxisPointByValue(c,u),g=this.getAxisValueByPoint((a/2-h.x)*l.x,(o/2-h.y)*l.y),y=this.getAxisPointByValue(g.xV,g.yV);return{x:Math.round(-(f.x+(s[3]-s[1])-y.x)*l.x),y:Math.round(-(f.y+(s[0]-s[2])-y.y)*l.y)}}applyTransformImmediately(n,t){this.offset={x:this.offset.x+t.x,y:this.offset.y+t.y},this.scale=n,this.updateSize(),this.redrawOnce()}animateTransform(n,t){const e=this.scale,i={...this.offset},s=300;this.isAuto=!0;const a=()=>this.isAuto=!1;(h=>this.animateOffset(i,t,s,h||a))(h=>this.animateScale(e,n,s,h||a))}animateScale(n,t,e,i){const s=t-n;let a=0;vt(o=>{!this.isAuto||!this.canvas||!this.isInteractive||(this.setScale("center",(o-a)*s),a=o,this.redrawOnce(),o===1&&i())},e)}animateOffset(n,t,e,i){vt(s=>{!this.isAuto||!this.canvas||!this.isInteractive||(this.offset={x:Number((n.x+t.x*s).toFixed(0)),y:Number((n.y+t.y*s).toFixed(0))},this.redrawOnce(),s===1&&i())},e)}returnToOrigin(){if(!this.isInteractive||this.scale==this.defaultScale&&this.offset.x==0&&this.offset.y==0)return;const{rect:n,axisConfig:t}=this,e=this.getDefaultCenterLocation(),i=(n.width/2-e.x)*t.x,s=(n.height/2-e.y)*t.y,a=this.getAxisValueByPoint(i,s,!0),o=this.getMousePositionOnAxis({clientX:n.x+n.width/2,clientY:n.y+n.height/2}),l=this.getAxisValueByPoint(o.x,o.y),h=t.size/this.getNowGridCount,c=Math.round((l.xV-a.xV)*t.x*h),u=Math.round((l.yV-a.yV)*t.y*h);c==0&&u==0||this.animateTransform(this.defaultScale,{x:c,y:u})}}class mi extends pi{toggleAxis(n){this.drawAxis.toggleAxis(n),this.redrawOnce()}togglePoint(n){const{overlays_point:t}=this.getDefaultOverlayGroup()||{};return t?(t.isVisible=n??!t.isVisible,this.redrawOnce(),t.isVisible):!1}toggleLine(n){const{overlays_line:t}=this.getDefaultOverlayGroup()||{};return t?(t.isVisible=n??!t.isVisible,this.redrawOnce(),t.isVisible):!1}togglePolygon(n){const{overlays_polygon:t}=this.getDefaultOverlayGroup()||{};return t?(t.isVisible=n??!t.isVisible,this.redrawOnce(),t.isVisible):!1}toggleLock(n){return this.isInteractive=n??!this.isInteractive,this.isInteractive}}class yi extends mi{static clearPathRegion(n,t){const{width:e,height:i}=n.canvas;n.save(),n.beginPath(),n.clip(t),n.clearRect(0,0,e,i),n.restore()}}class vi extends yi{}function ct(r){return[r].flat(1/0)}class G extends vi{constructor(n){super(n),this.drawAxis=new ti(this),"axisShow"in n&&this.toggleAxis(n.axisShow),this.initLayerGroups(),this.updateCenter()}initLayerGroups(){const n=new F({name:""});n.addGroup(new U({name:""})),n.setzIndex(1);const t=new F({name:""});t.addGroup(new U({name:""})),t.setzIndex(2);const e=new F({name:""});e.addGroup(new U({name:""})),e.setzIndex(3);const i=new F({name:""});i.addGroup(new U({name:""})),i.setzIndex(4);const s=new F({name:""});s.addGroup(new U({name:""})),s.setzIndex(5);const a=new it({name:""});a.addLayer([i,e,t,n,s]),this.setLayerGroup(a)}gteLayerGroups(n=""){return this.layerGroups.get(n)}setLayerGroup(n){n instanceof it&&(this.layerGroups.set(n.name,n),n.setNotifyReload(()=>this.redrawOnce()),n.setMainCanvas(this),n.parent=this)}removeLayerGroup(n){n instanceof it&&(this.layerGroups.delete(n.name),n.setNotifyReload(),n.setMainCanvas(),n.parent=void 0,this.redrawOnce())}addLayer(n){const t=this.layerGroups.get("");t&&t.addLayer(ct(n))}removeLayer(n){const t=this.layerGroups.get("");t&&t.removeLayer(ct(n))}addOverlay(n){const{overlays_text:t,overlays_point:e,overlays_line:i,overlays_polygon:s,overlays_custom:a}=this.getDefaultOverlayGroup()||{};ct(n).forEach(o=>{o instanceof dt?t==null||t.addOverlays(o):o instanceof $?e==null||e.addOverlays(o):o instanceof gt||o instanceof Nt||o instanceof Ht?i==null||i.addOverlays(o):o instanceof pt?s==null||s.addOverlays(o):o instanceof mt&&(a==null||a.addOverlays(o))})}removeOverlay(n){const{overlays_text:t,overlays_point:e,overlays_line:i,overlays_polygon:s,overlays_custom:a}=this.getDefaultOverlayGroup()||{};ct(n).forEach(o=>{o instanceof dt?t==null||t.removeOverlays(o):o instanceof $?e==null||e.removeOverlays(o):o instanceof gt?i==null||i.removeOverlays(o):o instanceof pt?s==null||s.removeOverlays(o):o instanceof mt&&(a==null||a.addOverlays(o))})}destroy(){super.destroy()}}d(G,"LayerGroup",it),d(G,"Layer",F),d(G,"OverlayGroup",U),d(G,"Text",dt),d(G,"Point",$),d(G,"Line",gt),d(G,"Polygon",pt),d(G,"Custom",mt),d(G,"Arc",Nt),d(G,"ArcTo",Ht);export{G as _};
