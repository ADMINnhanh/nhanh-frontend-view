var Be=Object.defineProperty;var Re=r=>{throw TypeError(r)};var Me=(r,e,t)=>e in r?Be(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var c=(r,e,t)=>Me(r,typeof e!="symbol"?e+"":e,t),we=(r,e,t)=>e.has(r)||Re("Cannot "+t);var g=(r,e,t)=>(we(r,e,"read from private field"),t?t.call(r):e.get(r)),_=(r,e,t)=>e.has(r)?Re("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),ee=(r,e,t,i)=>(we(r,e,"write to private field"),i?i.call(r,t):e.set(r,t),t);import{d as q,c as J,o as U,W as O,bg as Oe,b5 as Ie,az as me,b as h,w as m,u as f,e as R,_ as le,ao as pe,p as k,aw as Ue,bh as Ve,at as Ae,bd as Ne,bi as _e,A as ve,ae as Fe,Z as ge,af as Ce,t as S,a1 as ce,as as B,B as de,a3 as fe,bj as ke}from"./index-DiLUuH_l.js";import{R as We}from"./ResponsiveDirectionLayout-DMs082Zs.js";import{N as F}from"./InputGroupLabel-DYxiEpZh.js";import{N as he}from"./Select-ET3yBQ1m.js";import{N as te}from"./InputGroup-BcN5wEtj.js";import{N as ze}from"./InputNumber-DRZNx51L.js";import{N as $e}from"./Slider-B55rTTGE.js";import{N as Ge}from"./Image-CRIZwNcf.js";import{N as ae}from"./text-CjcDvT9j.js";import{S as Xe}from"./Scrollbar--aDGNcBh.js";import{a as Ye}from"./headers-DItnrsEQ.js";import{N as He}from"./ButtonGroup-CQodCMYN.js";import{N as je,a as Ke,b as qe}from"./Upload-CVvdxsHY.js";import{A as Je}from"./Add-W4F0wfxs.js";import{C as Ze}from"./CloudDownloadOutline-C-tdVabl.js";import"./Suffix-CA9ZK8zK.js";import"./attribute-Cz32yFEB.js";import"./Empty-O7ecwSWW.js";import"./use-locale-DjTo9B-1.js";import"./Input-SndmBNkk.js";import"./_createCompounder-782NHAa-.js";import"./Progress-C-MXlDk6.js";const Qe={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},et=O("path",{d:"M112 111v290c0 17.44 17 28.52 31 20.16l247.9-148.37c12.12-7.25 12.12-26.33 0-33.58L143 90.84c-14-8.36-31 2.72-31 20.16z",fill:"none",stroke:"currentColor","stroke-miterlimit":"10","stroke-width":"32"},null,-1),tt=[et],at=q({name:"PlayOutline",render:function(e,t){return U(),J("svg",Qe,tt)}}),it={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},nt=O("rect",{x:"96",y:"96",width:"320",height:"320",rx:"24",ry:"24",fill:"none",stroke:"currentColor","stroke-linejoin":"round","stroke-width":"32"},null,-1),rt=[nt],st=q({name:"StopOutline",render:function(e,t){return U(),J("svg",it,rt)}});var z=(r=>(r.LE="le",r.BE="be",r.LittleEndian="le",r.BigEndian="be",r))(z||{});const Te=r=>r.toString().padStart(2,"0");function K(r){return`${Te(Math.floor(r/60))}:${Te((r%60).toFixed(0))}`}function ot(r,e){const{audioBasicInfo:t,fileSize:i,fileName:a}=r,n=a.lastIndexOf("."),s=n>0?a.substring(n+1):"异常！",o=K(t.startTime||0);return{...t,name:a,currentTime:o,totalDuration:K(e),size:Oe(i),type:s.toLocaleUpperCase()}}const lt={class:"options-panel"},ut=q({__name:"options",props:{volume:{required:!0},volumeModifiers:{},options:{required:!0},optionsModifiers:{}},emits:["update:volume","update:options"],setup(r){const e=Ie(r,"volume"),t=Ie(r,"options");return(i,a)=>(U(),J("div",lt,[me(i.$slots,"prefix",{},void 0,!0),h(f(te),null,{default:m(()=>[h(f(F),null,{default:m(()=>[...a[5]||(a[5]=[R("采样率",-1)])]),_:1}),h(f(he),{value:t.value.sampleRate,"onUpdate:value":a[0]||(a[0]=n=>t.value.sampleRate=n),options:[8e3,16e3,22050,24e3,44100,48e3,96e3,192e3].map(n=>({label:String(n),value:n}))},null,8,["value","options"]),h(f(F),null,{default:m(()=>[...a[6]||(a[6]=[R("Hz",-1)])]),_:1})]),_:1}),h(f(te),null,{default:m(()=>[h(f(F),null,{default:m(()=>[...a[7]||(a[7]=[R("位深",-1)])]),_:1}),h(f(he),{value:t.value.bitDepth,"onUpdate:value":a[1]||(a[1]=n=>t.value.bitDepth=n),options:[8,16,24,32].map(n=>({label:String(n),value:n}))},null,8,["value","options"]),h(f(F),null,{default:m(()=>[...a[8]||(a[8]=[R("bit",-1)])]),_:1})]),_:1}),h(f(te),null,{default:m(()=>[h(f(F),null,{default:m(()=>[...a[9]||(a[9]=[R("声道数",-1)])]),_:1}),h(f(ze),{value:t.value.channelCount,"onUpdate:value":a[2]||(a[2]=n=>t.value.channelCount=n),min:1,precision:0},null,8,["value"]),h(f(F),null,{default:m(()=>[...a[10]||(a[10]=[R("ch",-1)])]),_:1})]),_:1}),h(f(te),null,{default:m(()=>[h(f(F),null,{default:m(()=>[...a[11]||(a[11]=[R("字节序",-1)])]),_:1}),h(f(he),{value:t.value.endianness,"onUpdate:value":a[3]||(a[3]=n=>t.value.endianness=n),options:[{label:"小端序",value:f(z).LE},{label:"大端序",value:f(z).BE}]},null,8,["value","options"])]),_:1}),h(f(te),null,{default:m(()=>[h(f(F),null,{default:m(()=>[...a[12]||(a[12]=[R("音量",-1)])]),_:1}),h(f($e),{value:e.value,"onUpdate:value":a[4]||(a[4]=n=>e.value=n),min:0,max:1,step:.01},null,8,["value"])]),_:1}),me(i.$slots,"suffix",{},void 0,!0)]))}}),ct=le(ut,[["__scopeId","data-v-4f7165fd"]]),dt=["id"],ft=q({__name:"HandleFileDrag",emits:["drop-callback"],setup(r,{emit:e}){const t=e,i=pe("handle-file-drag-"),a=k(!1);function n(u){if(u.preventDefault(),u.stopPropagation(),!u.dataTransfer){a.value=!1;return}const l=u.dataTransfer.types;a.value=l.includes("Files")}function s(u){n(u)}function o(u){u.target.id==i&&(a.value=!1)}function d(u){var v;u.preventDefault(),u.stopPropagation(),a.value=!1;const l=(v=u.dataTransfer)==null?void 0:v.files;t("drop-callback",Array.from(l||[]))}return(u,l)=>{var v,b;return U(),J("div",{id:f(i),class:Ae(["handle-file-drag",a.value&&"file-drop-hint"]),style:Ue({"--color":((b=(v=f(Ve).theme)==null?void 0:v.common)==null?void 0:b.successColor)||"#63e2b7"}),"drag-tip":"请将音频文件拖拽至此",onDragenter:n,onDragover:s,onDragleave:o,onDrop:d},[me(u.$slots,"default",{},void 0,!0)],46,dt)}}}),ht=le(ft,[["__scopeId","data-v-bf2639f9"]]);class mt{constructor(){c(this,"config");c(this,"barWidth",2);c(this,"barGap",2);c(this,"barCount",0);c(this,"barColor","#2080f0");c(this,"amplitudeValues",[]);c(this,"amplitudeBarMetrics",[]);c(this,"lastTimelineX")}init(e){this.config=e,this.lastTimelineX=void 0,this.calculateAmplitudeData(),this.calculateAmplitudeBarMetrics(),this.render(0)}render(e){if(!this.config)return;const{canvasContext:t}=this.config,{amplitudeBarMetrics:i,barColor:a,barWidth:n}=this,{width:s,height:o}=t.canvas,d=Math.floor((s-2)*e/100);this.lastTimelineX!=d&&(this.lastTimelineX=d,t.clearRect(0,0,s,o),t.fillStyle=a,i.forEach(({x:u,y:l,height:v})=>{d<=u&&(t.fillStyle="#B1B1B1FF"),t.fillRect(u,l,n,v)}),t.fillStyle=a,t.fillRect(d,0,2,o))}calculateAmplitudeData(){if(!this.config)return;const{canvasContext:e,audioBuffer:t,channelCount:i}=this.config,{barWidth:a,barGap:n}=this;this.barCount=Math.ceil(e.canvas.width/(a+n));const s=t.length,o=Array.from({length:i},(u,l)=>t.getChannelData(l)),d=Math.floor(s/this.barCount);this.amplitudeValues=[];for(let u=0;u<this.barCount;u++){const l=u*d,v=o.reduce((b,I)=>{const V=I.slice(l,l+d).reduce((Q,N)=>Q+N**2,0),Z=Math.sqrt(V/d);return Math.max(b,Z)},0);this.amplitudeValues.push(v)}}calculateAmplitudeBarMetrics(){var u;const e=(u=this.config)==null?void 0:u.canvasContext.canvas;if(!e)return;const{barWidth:t,barGap:i,barCount:a,amplitudeValues:n}=this,s=e.height,o=e.height/2;let d=0;this.amplitudeBarMetrics=[];for(let l=0;l<a;l++){const v=s*n[l];this.amplitudeBarMetrics.push({x:d,y:o-v/2,height:v}),d+=t+i}}clear(){this.amplitudeValues=[],this.amplitudeBarMetrics=[]}}class pt{constructor(){c(this,"config");c(this,"channelColors",["#5470c6","#91cc75","#fac858","#ee6666","#73c0de","#3ba272","#fc8452","#9a60b4","#ea7ccc"]);c(this,"channelRenderHeight",0);c(this,"waveformDataSize",0);c(this,"waveformDataCount",0);c(this,"channelAmplitudeData",[]);c(this,"lastRenderedStartIndex")}init(e){this.config=e,this.lastRenderedStartIndex=void 0,this.channelRenderHeight=Math.floor(e.canvasContext.canvas.height/e.channelCount),this.preprocessAudioData(),this.renderChannelBaseLines()}renderChannelBaseLines(){const{config:e,channelColors:t,channelRenderHeight:i}=this;if(!e)return;const{channelCount:a,canvasContext:n}=e,{width:s}=n.canvas;n.clearRect(0,0,s,n.canvas.height);for(let o=0;o<a;o++){const d=t[o%t.length];n.fillStyle=d;const u=o*i+i/2;n.fillRect(0,u,s,1)}}render(e){const{channelRenderHeight:t,channelAmplitudeData:i,config:a,channelColors:n,waveformDataSize:s,waveformDataCount:o}=this;if(!a||!i.length)return;const{channelCount:d,canvasContext:u}=a,{width:l,height:v}=u.canvas,b=Math.floor(o*e/100);if(this.lastRenderedStartIndex!==b){this.lastRenderedStartIndex=b,u.clearRect(0,0,l,v);for(let I=0;I<d;I++){const V=n[I%n.length];u.fillStyle=V;const Z=t*I+t/2,Q=i[I][b];for(let N=0;N<s;N++){const ie=Math.floor(Z-t/2*Q[N]);u.fillRect(N,ie,1,1)}}}}preprocessAudioData(){if(!this.config)return;const{canvasContext:e,audioBuffer:t,channelCount:i}=this.config,a=Math.floor(e.canvas.width),n=Math.floor(t.length/a);this.waveformDataSize=a,this.waveformDataCount=n,this.channelAmplitudeData=Array.from({length:i}).map(()=>new Array(n));for(let s=0;s<i;s++){const o=t.getChannelData(s);for(let d=0;d<n;d++){const u=d*a;this.channelAmplitudeData[s][d]=o.slice(u,u+a)}}}clear(){this.channelAmplitudeData=[]}}class vt{constructor(){c(this,"audioContext");c(this,"isPlaying",!1);c(this,"source");c(this,"audioBuffer");c(this,"gainNode");c(this,"currentVolume",1);c(this,"startTime",0);c(this,"duration",0);c(this,"playStartTime",0);c(this,"offsetTime");c(this,"options",{sampleRate:16e3,channelCount:1,bitDepth:16,startTime:0,duration:0,endianness:z.LE,volume:1});c(this,"onPlayCompleted");c(this,"playProgressCallback")}get totalDuration(){return this.audioBuffer?this.audioBuffer.duration:0}get ready(){return!!this.audioContext}setVolume(e){if(!this.gainNode){console.warn("增益节点未初始化，请先调用 init()");return}const t=Math.max(0,Math.min(1,e));this.currentVolume=t,this.gainNode.gain.value=t}init(){if(!this.audioContext){const e=window.AudioContext||window.webkitAudioContext;this.audioContext=new e,this.gainNode=this.audioContext.createGain(),this.gainNode.connect(this.audioContext.destination),this.gainNode.gain.value=this.currentVolume}}async initPCM(e,t={}){if(this.init(),!this.audioContext){console.error("音频上下文初始化失败");return}Object.assign(this.options,t);const{sampleRate:i,channelCount:a,bitDepth:n,startTime:s,duration:o,endianness:d,volume:u}=this.options;this.startTime=s,this.duration=o,this.offsetTime=void 0,this.setVolume(u),await this.stop();try{const l=this.convertPCMToFloat32(e,n,d);this.audioBuffer=this.audioContext.createBuffer(a,l.length/a,i);for(let v=0;v<a;v++){const b=this.audioBuffer.getChannelData(v);for(let I=0;I<b.length;I++)b[I]=l[I*a+v]}}catch(l){console.error("播放 PCM 失败：",l)}}convertPCMToFloat32(e,t,i=z.LE){const a=new DataView(e),n=t/8,s=i===z.LE,o=Math.floor(e.byteLength/n),d=new Float32Array(o);for(let u=0;u<o;u++){const l=u*n;switch(t){case 8:d[u]=(a.getUint8(l)-128)/128;break;case 16:d[u]=a.getInt16(l,s)/32768;break;case 24:let v;s?v=a.getUint8(l)|a.getUint8(l+1)<<8|a.getUint8(l+2)<<16:v=a.getUint8(l)<<16|a.getUint8(l+1)<<8|a.getUint8(l+2),v&8388608&&(v|=4278190080),d[u]=v/8388608;break;case 32:d[u]=a.getInt32(l,s)/2147483648;break}}return d}async playFromPosition(e=0,t=0){if(!this.audioBuffer||!this.audioContext){console.error("请先加载 PCM 数据");return}this.isPlaying&&await this.stop();const i=this.audioBuffer.duration,a=Math.max(0,Math.min(e,i)),n=t>0?Math.min(t,i-a):void 0;this.source=this.audioContext.createBufferSource(),this.source.buffer=this.audioBuffer,this.source.connect(this.gainNode),this.source.start(0,a,n),this.isPlaying=!0,this.playStartTime=this.audioContext.currentTime,this.source.onended=()=>{var s,o;this.isPlaying=!1,typeof this.offsetTime=="number"&&(this.offsetTime+=(((s=this.audioContext)==null?void 0:s.currentTime)||0)-this.playStartTime),(o=this.onPlayCompleted)==null||o.call(this)}}updatePlayProgress(){const{isPlaying:e,audioContext:t,audioBuffer:i,offsetTime:a,playStartTime:n,playProgressCallback:s}=this;if(!e||!t||!i||!s)return;const o=(a||0)+(t.currentTime-n),d=o/i.duration*100,u=o.toFixed(2),l=i.duration.toFixed(2),v=d.toFixed(8);s(u,l,v),requestAnimationFrame(()=>this.updatePlayProgress())}async play(e){if(typeof e=="number")await this.stop(),this.offsetTime=e;else{if(this.isPlaying)return;const{startTime:t,offsetTime:i}=this;(!i||i+t>=this.totalDuration)&&(this.offsetTime=0)}this.playFromPosition(this.startTime+this.offsetTime,this.duration),this.updatePlayProgress()}async stop(){this.source&&(this.source.stop(),this.source.disconnect(),this.source=void 0,await Ne(()=>!this.isPlaying,500))}clear(){this.stop(),this.isPlaying=!1,this.audioBuffer=void 0}}class gt{constructor(){c(this,"audioSpectrum",new mt);c(this,"audioSpectrumCanvas",document.createElement("canvas"));c(this,"audioSpectrumCtx",this.audioSpectrumCanvas.getContext("2d"));c(this,"audioSpectrumHeight",100);c(this,"audioWaveform",new pt);c(this,"audioWaveformCanvas",document.createElement("canvas"));c(this,"audioWaveformCtx",this.audioWaveformCanvas.getContext("2d"));c(this,"audioWaveformHeight",100);c(this,"audioPlayer",new vt);c(this,"canvas");c(this,"ctx");c(this,"onPlayCompleted");c(this,"playProgressCallback");this.audioPlayer.onPlayCompleted=()=>{var e;(e=this.onPlayCompleted)==null||e.call(this)},this.audioPlayer.playProgressCallback=(e,t,i)=>{var n;const a=Number(i);this.render(a),(n=this.playProgressCallback)==null||n.call(this,e,t,i)}}get totalDuration(){return this.audioPlayer.totalDuration}async init(e){await this.initPCM(e),this.audioPlayer.ready&&this.initCanvas(e)}async initPCM(e){const{audioPlayer:t}=this,{pcmData:i,pcmOptions:a}=e;await t.initPCM(i,a)}initCanvas(e){const{audioPlayer:t,audioSpectrumCanvas:i,audioSpectrumCtx:a,audioSpectrumHeight:n,audioWaveformCanvas:s,audioWaveformCtx:o,audioWaveformHeight:d}=this,{canvas:u}=e,l=t.options.channelCount,v=t.audioBuffer,b=t.totalDuration,I=Math.floor(u.getBoundingClientRect().width);if(u.width=I,u.height=d*l+n,this.canvas=u,this.ctx=u.getContext("2d"),!this.ctx||!a||!o){console.error("Canvas 上下文不可用。");return}i.width=I,i.height=n,s.width=I,s.height=d*l;const V={channelCount:l,audioBuffer:v,duration:b};this.audioWaveform.init({...V,canvasContext:o}),this.audioSpectrum.init({...V,canvasContext:a}),this.ctx.drawImage(s,0,0),this.ctx.drawImage(i,0,s.height)}render(e){const{canvas:t,ctx:i,audioSpectrum:a,audioSpectrumCanvas:n,audioWaveform:s,audioWaveformCanvas:o}=this;if(!t||!i){console.error("Canvas 不可用。");return}i.clearRect(0,0,t.width,t.height),a.render(e),s.render(e),i.drawImage(o,0,0),i.drawImage(n,0,o.height)}setVolume(e){this.audioPlayer.setVolume(e)}play(e){return this.audioPlayer.play(e)}stop(){this.audioPlayer.stop()}clear(){this.audioPlayer.clear(),this.audioSpectrum.clear(),this.audioWaveform.clear();const{ctx:e,canvas:t}=this;e&&t&&e.clearRect(0,0,t.width,t.height)}}const be=["Blues","Classic Rock","Country","Dance","Disco","Funk","Grunge","Hip-Hop","Jazz","Metal","New Age","Oldies","Other","Pop","R&B","Rap","Reggae","Rock","Techno","Industrial","Alternative","Ska","Death Metal","Pranks","Soundtrack","Euro-Techno","Ambient","Trip-Hop","Vocal","Jazz+Funk","Fusion"];function Y(r,e,t){const i=r.subarray(e,t),a=i.findIndex(o=>o===0),n=a===-1?i:i.subarray(0,a),s=new TextDecoder("ascii").decode(n).trim();return s===""?"-":s}function Ct(r){return r<be.length?be[r]:"Unknown"}function yt(r){const e=new Uint8Array(r);if(e.length<128)return null;const t=e.subarray(e.length-128);if(t[0]!==84||t[1]!==65||t[2]!==71)return null;const i=t[125],a=t[126];let n=i===0;if(n&&(a<1||a>99)&&(n=!1),n){const d=t.subarray(97,125);Array.from(d).every(l=>l===0||l===32)&&a!==0&&a!==32&&(n=!1)}let s,o;return n?(s=Y(t,97,125),o=a):(s=Y(t,97,127),o=0),{title:Y(t,3,33),artist:Y(t,33,63),album:Y(t,63,93),year:Y(t,93,97),comment:s,track:o,genre:Ct(t[127]),isID3v1_1:n}}const De={2.2:{TT2:"标题",TP1:"艺术家",TAL:"专辑",TYE:"年份",COM:"评论",TRK:"音轨号",TCO:"流派",PIC:"附加图片",TCM:"作曲家",TCR:"版权信息",TBP:"播放速度",TLE:"时长",TLA:"语言",TPB:"发行商"},2.3:{TIT2:"标题",TPE1:"艺术家",TALB:"专辑",TYER:"年份",COMM:"评论",TRCK:"音轨号",TCON:"流派",APIC:"附加图片",TCOM:"作曲家",TCOP:"版权信息",TBPM:"播放速度",TLEN:"时长",TLAN:"语言",TPUB:"发行商",TIT3:"副标题",TPE2:"乐队",TPE3:"指挥",TPE4:"改编者",TOPE:"原艺术家",TOAL:"原专辑",TSRC:"ISRC码",TENC:"编码者",TEXT:"歌词作者",TOWN:"文件所有者",TPOS:"音轨集位置",TRDA:"录制日期",TXXX:"用户自定义文本",USLT:"非同步歌词",SYLT:"同步歌词",UFID:"唯一文件标识",RBUF:"推荐缓冲区大小",RVAD:"相对音量调整",RVRB:"混响",ETCO:"事件定时码",MLLT:"MPEG位置查找表",SYTC:"同步节奏码",IPLS:"参与人员列表",MCDI:"音乐CD标识符",GEOB:"通用封装对象",PCNT:"播放计数器",POPM:"流行度计量",AENC:"音频加密",LINK:"链接信息",POSS:"位置同步帧",USER:"使用条款",OWNE:"所有权帧",ENCR:"加密方法注册",GRID:"组标识注册",PRIV:"私有帧",COMR:"商业帧",EQUA:"均衡器",WCOM:"商业信息URL",WCOP:"版权信息URL",WOAF:"官方音频文件URL",WOAR:"官方艺术家URL",WOAS:"官方音频源URL",WORS:"官方电台URL",WPAY:"支付信息URL",WPUB:"官方发行商URL",WXXX:"用户自定义URL"},2.4:{TIT2:"标题",TPE1:"艺术家",TALB:"专辑",TYER:"年份",COMM:"评论",TRCK:"音轨号",TCON:"流派",APIC:"附加图片",TCOM:"作曲家",TCOP:"版权信息",TBPM:"播放速度",TLEN:"时长",TLAN:"语言",TPUB:"发行商",TIT3:"副标题",TPE2:"乐队",TPE3:"指挥",TPE4:"改编者",TOPE:"原艺术家",TOAL:"原专辑",TSRC:"ISRC码",TENC:"编码者",TEXT:"歌词作者",TOWN:"文件所有者",TPOS:"音轨集位置",TRDA:"录制日期",TXXX:"用户自定义文本",USLT:"非同步歌词",SYLT:"同步歌词",UFID:"唯一文件标识",RBUF:"推荐缓冲区大小",RVAD:"相对音量调整",RVRB:"混响",ETCO:"事件定时码",MLLT:"MPEG位置查找表",SYTC:"同步节奏码",IPLS:"参与人员列表",MCDI:"音乐CD标识符",GEOB:"通用封装对象",PCNT:"播放计数器",POPM:"流行度计量",AENC:"音频加密",LINK:"链接信息",POSS:"位置同步帧",USER:"使用条款",OWNE:"所有权帧",ENCR:"加密方法注册",GRID:"组标识注册",PRIV:"私有帧",COMR:"商业帧",EQUA:"均衡器",WCOM:"商业信息URL",WCOP:"版权信息URL",WOAF:"官方音频文件URL",WOAR:"官方艺术家URL",WOAS:"官方音频源URL",WORS:"官方电台URL",WPAY:"支付信息URL",WPUB:"官方发行商URL",WXXX:"用户自定义URL"}};class Et{constructor(e,t=0){c(this,"buffer");c(this,"offset",0);c(this,"offsetBase",0);c(this,"version","");c(this,"frameIdMap",{});this.buffer=e,this.offsetBase=t}initVersion(e){return this.version=`2.${e}`,this.frameIdMap=De[this.version],!!this.frameIdMap}syncSafeInteger(e){return e[0]<<21|e[1]<<14|e[2]<<7|e[3]}cleanString(e){return e.replace(/\0/g,"").trim()}readID3String(e,t){if(t<=0)return"";const i=new Uint8Array(this.buffer,e,t);let a="";switch(i[0]){case 1:if(t>=2)try{a=new TextDecoder("utf-16",{ignoreBOM:!0}).decode(i.subarray(1))}catch{a=this.readIso88591String(e+1,t-1)}break;case 2:if(t>=2)try{a=new TextDecoder("utf-16be").decode(i.subarray(1))}catch{a=this.readIso88591String(e+1,t-1)}break;case 3:if(t>=2)try{a=new TextDecoder("utf-8").decode(i.subarray(1))}catch{a=this.readIso88591String(e+1,t-1)}break;case 0:a=this.readIso88591String(e+1,t-1);break;default:try{a=new TextDecoder("utf-8",{fatal:!0}).decode(i)}catch{a=this.readIso88591String(e,t)}break}return this.cleanString(a)}readIso88591String(e,t){const i=new Uint8Array(this.buffer,e,t);return Array.from(i).map(a=>String.fromCharCode(a)).join("")}readAsciiString(e,t){const i=new Uint8Array(this.buffer,e,t);return Array.from(i).map(a=>a===0?"":String.fromCharCode(a)).join("")}readUInt24BE(e){const t=new Uint8Array(this.buffer);return t[e]<<16|t[e+1]<<8|t[e+2]}readUInt32BE(e){return new DataView(this.buffer).getUint32(e,!1)}parseAPICFrame(e,t){if(t<=0)return null;const i=new Uint8Array(this.buffer,e,t);let a=0;if(this.version!=="2.2"&&(a+=1,a>=t))return null;const n=i.subarray(a).findIndex(d=>d===0);if(n===-1)return null;let s=this.readAsciiString(e+a,n);if(a+=n+1,a>=t||(s==="JPG"||s==="JPEG"?s="image/jpeg":s==="PNG"?s="image/png":s==="GIF"&&(s="image/gif"),a+=1,a>=t))return null;const o=i.subarray(a).findIndex(d=>d===0);return o===-1||(a+=o+1,a>=t)?null:{mime:s,data:this.buffer.slice(e+a,e+t)}}parseFrame(e,t,i,a){const n=this.readID3String(i,a),s=this.frameIdMap[t]||t;let o=n;t=="TRCK"?o=parseInt(n)||0:t=="APIC"&&(o=this.parseAPICFrame(i,a),e.audioCover=o),e[s]=o}validateTagId(){return this.readAsciiString(this.offset,3)==="ID3"}getVersion(){if(this.offset=this.offsetBase,this.buffer.byteLength<this.offset+10||!this.validateTagId())return null;const i=`2.${new Uint8Array(this.buffer)[this.offset+3]}`;return De[i]?i:null}commonParse(e,t,i){this.offset=this.offsetBase;try{if(this.buffer.byteLength<this.offset+10||!this.validateTagId())return null;const a=new Uint8Array(this.buffer),n=a[this.offset+3];if(!this.initVersion(n))return null;const s=this.calculateTagSize(a),o={版本:this.version,标签大小:s+10};let d=this.offset+10;const u=this.offset+10+s;for(;d+t<=u&&d+t<=this.buffer.byteLength;){const l=this.readAsciiString(d,e);if(!l||l.replace(/\0/g,"")==="")break;const v=i(d+e);if(v<=0||d+t+v>this.buffer.byteLength){d+=t+v;continue}this.parseFrame(o,l,d+t,v),d+=t+v}return o}catch(a){return console.error(`ID3v${this.version} 解析失败:`,a),null}}calculateTagSize(e){if(this.version==="2.2")return this.readUInt24BE(this.offset+6);{const t=[e[this.offset+6],e[this.offset+7],e[this.offset+8],e[this.offset+9]];return this.syncSafeInteger(t)}}}class Rt extends Et{ID3v22Parser(){return this.commonParse(3,6,e=>this.readUInt24BE(e))}ID3v23Parser(){return this.commonParse(4,10,e=>this.readUInt32BE(e))}ID3v24Parser(){return this.commonParse(4,10,e=>this.readUInt32BE(e))}parse(){const e=this.getVersion();if(!e)return null;switch(e){case"2.4":return this.ID3v24Parser();case"2.3":return this.ID3v23Parser();case"2.2":return this.ID3v22Parser();default:return null}}}function wt(r){return new Rt(r).parse()}const H={offset:-1,isValid:!1,syncWord:0,mpegVersion:"Unknown",layer:"Unknown",protectionBit:!1,crcValid:null,bitrateIndex:-1,bitrate:0,sampleRateIndex:-1,sampleRate:0,sampleRateExtension:!1,bitrateExtension:!1,paddingBit:!1,privateBit:!1,frameSize:0,frameDuration:0,channelMode:"Unknown",modeExtension:-1,copyright:!1,original:!1,emphasis:-1},x=class x{constructor(e){c(this,"dataView");this.dataView=new DataView(e)}parseFrameHeaderWithError(e){var d,u;if(e+4>this.dataView.byteLength){const l={offset:e,errorType:"偏移量越界",errorMsg:`偏移量${e}超出buffer范围（总长度${this.dataView.byteLength}）`};return{frameHeader:{...H,offset:e},errorDetail:l}}const t=this.readHeaderBytes(e);if(t===null){const l={offset:e,errorType:"其他解析错误",errorMsg:"读取帧头4字节失败"};return{frameHeader:{...H,offset:e},errorDetail:l}}const i=(t&x.SYNC_WORD_MASK)>>>20;if((t&x.SYNC_WORD_VALUE)>>>0!==x.SYNC_WORD_VALUE){const l={offset:e,errorType:"同步字无效",errorMsg:`同步字${i.toString(16)}无效，预期0xFFE`};return{frameHeader:{...H,offset:e,syncWord:i},errorDetail:l}}const a={...H,offset:e,isValid:!0,syncWord:i};a.mpegVersion=this.parseMpegVersion(t>>19&3),a.layer=this.parseLayer(t>>17&3),a.protectionBit=(t>>16&1)===1,a.bitrateIndex=t>>12&15,a.sampleRateIndex=t>>10&3,a.paddingBit=(t>>9&1)===1,a.privateBit=(t>>8&1)===1,a.channelMode=this.parseChannelMode(t>>6&3),a.modeExtension=t>>4&3,a.copyright=(t>>3&1)===1,a.original=(t>>2&1)===1,a.emphasis=t&3;const n=this.parseBitrate(a.mpegVersion,a.layer,a.bitrateIndex);a.bitrate=n.bitrate,a.bitrateExtension=n.isExtended;const s=this.parseSampleRate(a.mpegVersion,a.sampleRateIndex);if(a.sampleRate=s.sampleRate,a.sampleRateExtension=s.isExtended,a.bitrate===0||a.sampleRate===0){const l={offset:e,errorType:"比特率/采样率为0",errorMsg:`比特率${a.bitrate}kbps/采样率${a.sampleRate}Hz无效`};return a.isValid=!1,{frameHeader:a,errorDetail:l}}if(a.protectionBit)a.crcValid=null;else{const l=this.validateCrc(e,t);if(a.crcValid=l.isValid,a.crcValue=l.crcValue,!l.isValid){const v={offset:e,errorType:"CRC校验失败",errorMsg:`CRC校验失败，实际值${((d=l.crcValue)==null?void 0:d.toString(16))||"未知"}，计算值${((u=l.calculatedCrc)==null?void 0:u.toString(16))||"未知"}`};return a.isValid=!1,{frameHeader:a,errorDetail:v}}}const o=new Se;if(a.frameSize=o.calculateFrameSize(a),a.frameDuration=o.calculateFrameDuration(a),a.frameSize<=0||a.frameSize>this.dataView.byteLength-e){const l={offset:e,errorType:"帧大小计算异常",errorMsg:`帧大小${a.frameSize}字节无效（超出剩余buffer长度）`};return a.isValid=!1,{frameHeader:a,errorDetail:l}}return{frameHeader:a,errorDetail:null}}readHeaderBytes(e){try{return this.dataView.getUint32(e,!1)}catch{return null}}parseMpegVersion(e){switch(e){case 0:return"MPEG Version 2.5";case 1:return"Unknown";case 2:return"MPEG Version 2";case 3:return"MPEG Version 1";default:return"Unknown"}}parseLayer(e){switch(e){case 0:return"Unknown";case 1:return"Layer III";case 2:return"Layer II";case 3:return"Layer I";default:return"Unknown"}}parseChannelMode(e){switch(e){case 0:return"Stereo";case 1:return"Joint Stereo";case 2:return"Dual Channel";case 3:return"Mono";default:return"Unknown"}}parseBitrate(e,t,i){var s,o;if(e==="Unknown"||t==="Unknown"||i>15||i<0)return{bitrate:0,isExtended:!1};const a=((o=(s=x.BITRATE_TABLE[e])==null?void 0:s[t])==null?void 0:o[i])||0;return{bitrate:a||0,isExtended:a===0&&i!==0}}parseSampleRate(e,t){var n;if(e==="Unknown"||t>3||t<0)return{sampleRate:0,isExtended:!1};const i=((n=x.SAMPLE_RATE_TABLE[e])==null?void 0:n[t])||0;return{sampleRate:i||0,isExtended:i===0&&t!==3}}validateCrc(e,t){try{const i=this.dataView.getUint16(e+4,!1),a=t&4294967292,n=new Uint8Array(4);n[0]=a>>24&255,n[1]=a>>16&255,n[2]=a>>8&255,n[3]=a&255;const o=new Se().calculateFrameSize({...H,mpegVersion:this.parseMpegVersion(t>>19&3),layer:this.parseLayer(t>>17&3),bitrate:this.parseBitrate(this.parseMpegVersion(t>>19&3),this.parseLayer(t>>17&3),t>>12&15).bitrate,sampleRate:this.parseSampleRate(this.parseMpegVersion(t>>19&3),t>>10&3).sampleRate,paddingBit:(t>>9&1)===1,isValid:!0})-6;if(o<=0||e+6+o>this.dataView.byteLength)return{isValid:!1,crcValue:i};const d=new Uint8Array(this.dataView.buffer,e+6,o),u=new Uint8Array(4+d.length);u.set(n,0),u.set(d,4);const l=this.calculateCrc16(u);return{isValid:(l^65535)===i,crcValue:i,calculatedCrc:l}}catch(i){return console.error("CRC校验计算失败:",i),{isValid:!1}}}calculateCrc16(e){let t=65535;const i=4129;for(let a=0;a<e.length;a++){t^=e[a]<<8&65280;for(let n=0;n<8;n++)t&32768?t=t<<1^i:t<<=1,t&=65535}return t}};c(x,"SYNC_WORD_MASK",4292870144),c(x,"SYNC_WORD_VALUE",4292870144),c(x,"BITRATE_TABLE",{"MPEG Version 1":{"Layer I":[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,0],"Layer II":[0,32,48,64,80,96,112,128,144,160,176,192,208,224,240,256],"Layer III":[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,0]},"MPEG Version 2":{"Layer I":[0,32,48,64,80,96,112,128,144,160,176,192,208,224,240,256],"Layer II":[0,8,16,24,32,40,48,56,64,80,88,96,112,128,144,160],"Layer III":[0,8,16,24,32,40,48,56,64,80,88,96,112,128,144,160]},"MPEG Version 2.5":{"Layer I":[0,32,48,64,80,96,112,128,144,160,176,192,208,224,240,256],"Layer II":[0,8,16,24,32,40,48,56,64,80,88,96,112,128,144,160],"Layer III":[0,8,16,24,32,40,48,56,64,80,88,96,112,128,144,160]}}),c(x,"SAMPLE_RATE_TABLE",{"MPEG Version 1":[44100,48e3,32e3,0],"MPEG Version 2":[22050,24e3,16e3,0],"MPEG Version 2.5":[11025,12e3,8e3,0],Unknown:[0,0,0,0]});let ye=x;class Se{calculateFrameSize(e){if(!e.isValid||e.bitrate===0||e.sampleRate===0)return 0;const t=e.bitrate,i=e.sampleRate,a=e.paddingBit?1:0;switch(e.layer){case"Layer I":return Math.floor(12*t*1e3/i+a*4);case"Layer II":case"Layer III":return Math.floor(144*t*1e3/i+a);default:return 0}}calculateFrameDuration(e){if(!e.isValid||e.sampleRate===0)return 0;let t=0;switch(e.layer){case"Layer I":t=384;break;case"Layer II":t=1152;break;case"Layer III":t=e.mpegVersion==="MPEG Version 1"?1152:576;break;default:return 0}return t/e.sampleRate*1e3}}class It{constructor(e,t,i){c(this,"dataView");c(this,"frameParser");c(this,"audioStartOffset");c(this,"audioEndOffset");this.dataView=new DataView(e),this.frameParser=new ye(e),this.audioStartOffset=Math.max(0,t),this.audioEndOffset=this.dataView.byteLength-(i?128:0)}findAllFramesWithError(){const e=[],t=[];let i=this.audioStartOffset,a=0;for(;i<this.audioEndOffset-4;){a++;const{frameHeader:n,errorDetail:s}=this.frameParser.parseFrameHeaderWithError(i);s?(t.push(s),i+=1):(e.push(n),i+=n.frameSize||1)}return{validFrames:e,totalFrameCount:a,errorFrameDetails:t}}}const se=class se{constructor(e,t,i){c(this,"frameFinder");this.frameFinder=new It(e,t,i)}parseComplete(){const{validFrames:e,totalFrameCount:t,errorFrameDetails:i}=this.frameFinder.findAllFramesWithError(),a=e.find(s=>s.isValid)||H,n={sampleRate:a.sampleRate,bitrate:a.bitrate,channelCount:a.channelMode==="Mono"?1:2,totalDuration:e.reduce((s,o)=>s+o.frameDuration,0),bitDepth:se.DEFAULT_BIT_DEPTH};return{frameHeader:a,frameCount:t,errorFrameCount:i.length,errorFrameDetails:i,audioBasicInfo:n}}};c(se,"DEFAULT_BIT_DEPTH",16);let Ee=se;var C;(function(r){r.LOAD="LOAD",r.EXEC="EXEC",r.FFPROBE="FFPROBE",r.WRITE_FILE="WRITE_FILE",r.READ_FILE="READ_FILE",r.DELETE_FILE="DELETE_FILE",r.RENAME="RENAME",r.CREATE_DIR="CREATE_DIR",r.LIST_DIR="LIST_DIR",r.DELETE_DIR="DELETE_DIR",r.ERROR="ERROR",r.DOWNLOAD="DOWNLOAD",r.PROGRESS="PROGRESS",r.LOG="LOG",r.MOUNT="MOUNT",r.UNMOUNT="UNMOUNT"})(C||(C={}));const Tt=(()=>{let r=0;return()=>r++})(),bt=new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first"),Dt=new Error("called FFmpeg.terminate()");var P,W,M,$,G,oe,D;class St{constructor(){_(this,P,null);_(this,W,{});_(this,M,{});_(this,$,[]);_(this,G,[]);c(this,"loaded",!1);_(this,oe,()=>{g(this,P)&&(g(this,P).onmessage=({data:{id:e,type:t,data:i}})=>{switch(t){case C.LOAD:this.loaded=!0,g(this,W)[e](i);break;case C.MOUNT:case C.UNMOUNT:case C.EXEC:case C.FFPROBE:case C.WRITE_FILE:case C.READ_FILE:case C.DELETE_FILE:case C.RENAME:case C.CREATE_DIR:case C.LIST_DIR:case C.DELETE_DIR:g(this,W)[e](i);break;case C.LOG:g(this,$).forEach(a=>a(i));break;case C.PROGRESS:g(this,G).forEach(a=>a(i));break;case C.ERROR:g(this,M)[e](i);break}delete g(this,W)[e],delete g(this,M)[e]})});_(this,D,({type:e,data:t},i=[],a)=>g(this,P)?new Promise((n,s)=>{const o=Tt();g(this,P)&&g(this,P).postMessage({id:o,type:e,data:t},i),g(this,W)[o]=n,g(this,M)[o]=s,a==null||a.addEventListener("abort",()=>{s(new DOMException(`Message # ${o} was aborted`,"AbortError"))},{once:!0})}):Promise.reject(bt));c(this,"load",({classWorkerURL:e,...t}={},{signal:i}={})=>(g(this,P)||(ee(this,P,e?new Worker(new URL(e,import.meta.url),{type:"module"}):new Worker(new URL(""+new URL("worker-BAOIWoxA.js",import.meta.url).href,import.meta.url),{type:"module"})),g(this,oe).call(this)),g(this,D).call(this,{type:C.LOAD,data:t},void 0,i)));c(this,"exec",(e,t=-1,{signal:i}={})=>g(this,D).call(this,{type:C.EXEC,data:{args:e,timeout:t}},void 0,i));c(this,"ffprobe",(e,t=-1,{signal:i}={})=>g(this,D).call(this,{type:C.FFPROBE,data:{args:e,timeout:t}},void 0,i));c(this,"terminate",()=>{const e=Object.keys(g(this,M));for(const t of e)g(this,M)[t](Dt),delete g(this,M)[t],delete g(this,W)[t];g(this,P)&&(g(this,P).terminate(),ee(this,P,null),this.loaded=!1)});c(this,"writeFile",(e,t,{signal:i}={})=>{const a=[];return t instanceof Uint8Array&&a.push(t.buffer),g(this,D).call(this,{type:C.WRITE_FILE,data:{path:e,data:t}},a,i)});c(this,"mount",(e,t,i)=>{const a=[];return g(this,D).call(this,{type:C.MOUNT,data:{fsType:e,options:t,mountPoint:i}},a)});c(this,"unmount",e=>{const t=[];return g(this,D).call(this,{type:C.UNMOUNT,data:{mountPoint:e}},t)});c(this,"readFile",(e,t="binary",{signal:i}={})=>g(this,D).call(this,{type:C.READ_FILE,data:{path:e,encoding:t}},void 0,i));c(this,"deleteFile",(e,{signal:t}={})=>g(this,D).call(this,{type:C.DELETE_FILE,data:{path:e}},void 0,t));c(this,"rename",(e,t,{signal:i}={})=>g(this,D).call(this,{type:C.RENAME,data:{oldPath:e,newPath:t}},void 0,i));c(this,"createDir",(e,{signal:t}={})=>g(this,D).call(this,{type:C.CREATE_DIR,data:{path:e}},void 0,t));c(this,"listDir",(e,{signal:t}={})=>g(this,D).call(this,{type:C.LIST_DIR,data:{path:e}},void 0,t));c(this,"deleteDir",(e,{signal:t}={})=>g(this,D).call(this,{type:C.DELETE_DIR,data:{path:e}},void 0,t))}on(e,t){e==="log"?g(this,$).push(t):e==="progress"&&g(this,G).push(t)}off(e,t){e==="log"?ee(this,$,g(this,$).filter(i=>i!==t)):e==="progress"&&ee(this,G,g(this,G).filter(i=>i!==t))}}P=new WeakMap,W=new WeakMap,M=new WeakMap,$=new WeakMap,G=new WeakMap,oe=new WeakMap,D=new WeakMap;var Pe;(function(r){r.MEMFS="MEMFS",r.NODEFS="NODEFS",r.NODERAWFS="NODERAWFS",r.IDBFS="IDBFS",r.WORKERFS="WORKERFS",r.PROXYFS="PROXYFS"})(Pe||(Pe={}));const Pt=r=>new Promise((e,t)=>{const i=new FileReader;i.onload=()=>{const{result:a}=i;a instanceof ArrayBuffer?e(new Uint8Array(a)):e(new Uint8Array)},i.onerror=a=>{var n,s;t(Error(`File could not be read! Code=${((s=(n=a==null?void 0:a.target)==null?void 0:n.error)==null?void 0:s.code)||-1}`))},i.readAsArrayBuffer(r)}),Lt=async r=>{let e;if(typeof r=="string")/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(r)?e=atob(r.split(",")[1]).split("").map(t=>t.charCodeAt(0)):e=await(await fetch(r)).arrayBuffer();else if(r instanceof URL)e=await(await fetch(r)).arrayBuffer();else if(r instanceof File||r instanceof Blob)e=await Pt(r);else return new Uint8Array;return new Uint8Array(e)},j=new St;j.load();async function At(r,e){const t=r.name,i="output_s16le.pcm";try{await j.writeFile(t,await Lt(r)),await j.exec(["-i",t,"-f","s16le","-acodec","pcm_s16le","-ac",e.channelCount.toString(),"-ar",e.sampleRate.toString(),i]);const a=await j.readFile(i);return typeof a=="string"?(console.warn("PCM 文件读取结果为字符串，转换失败"),null):a.buffer}catch(a){return console.error("MPEG 转 PCM 失败：",a),null}finally{try{await j.deleteFile(t),await j.deleteFile(i)}catch(a){console.warn("清理虚拟文件失败：",a)}}}async function xt(r){const e=await r.arrayBuffer(),t=e.byteLength,i=wt(e);if(!i)return null;const a=yt(e),n=a?128:0,s=t-i.标签大小-n,o=new Ee(e,i.标签大小,!!a).parseComplete(),d=await At(r,o.audioBasicInfo);return d?{id3v2:i,id3v1:a,audioSize:s,fileSize:t,mpegAudio:o,pcm:d}:null}const Bt={class:"flex-box"},Mt={class:"img-box"},Ot=q({__name:"audioBasicInfo",props:{isRunning:{type:Boolean},info:{},getMetadata:{type:Function}},setup(r){const e=r,t=k(""),i=_e();function a(){n();const s=e.getMetadata();if(s){const{mp3Info:o}=s;if(o){const d=o.id3v2.audioCover;if(i.value=o.id3v2,d&&typeof d=="object"){const u=new Blob([d.data],{type:d.mime});t.value=URL.createObjectURL(u)}}}}function n(){t.value&&URL.revokeObjectURL(t.value),i.value=void 0,t.value=""}return ve(()=>e.info,a,{immediate:!0}),Fe(n),(s,o)=>(U(),J("div",Bt,[O("div",{class:Ae([r.isRunning&&"running","record-player"])},[O("div",Mt,[t.value?(U(),ge(f(Ge),{key:0,src:t.value},null,8,["src"])):Ce("",!0)]),o[0]||(o[0]=O("div",{class:"tonarm-lift"},null,-1))],2),h(f(ce),{vertical:""},{default:m(()=>[h(f(ae),null,{default:m(()=>[R(S(r.info.name),1)]),_:1}),i.value?(U(),ge(f(ce),{key:0},{default:m(()=>[h(f(B),null,{default:m(()=>[R(" 标题： "+S(i.value.标题),1)]),_:1}),h(f(B),null,{default:m(()=>[R(" 专辑： "+S(i.value.专辑),1)]),_:1}),h(f(B),null,{default:m(()=>[R(" 艺术家: "+S(i.value.艺术家),1)]),_:1})]),_:1})):Ce("",!0),h(f(ce),null,{default:m(()=>[h(f(B),{type:"info"},{default:m(()=>[R(S(r.info.type),1)]),_:1}),h(f(B),{color:{color:"#8a2be21a",textColor:"#9339E7FF",borderColor:"#9339E7FF"}},{default:m(()=>[R(S(r.info.size),1)]),_:1}),h(f(B),{type:"success"},{default:m(()=>[R(S(r.info.totalDuration),1)]),_:1}),h(f(B),{type:"warning"},{default:m(()=>[R(S(r.info.sampleRate)+"Hz ",1)]),_:1}),h(f(B),null,{default:m(()=>[R(S(r.info.channelCount)+"ch ",1)]),_:1}),h(f(B),null,{default:m(()=>[R(S(r.info.bitDepth)+"bit ",1)]),_:1})]),_:1})]),_:1})]))}}),Ut=le(Ot,[["__scopeId","data-v-782eea2e"]]),Vt={key:0,class:"audio-player-container"},Nt={class:"canvas-container"},_t=["id"],Ft={class:"time-container"},Le=".mp3,.pcm,.wav",kt=q({__name:"index",setup(r){const e=pe("audio-player-"),t=pe("file-list-"),i=k(!1),a=k(void 0),n=k([]),s=new Map,o=k(.2),d=k({sampleRate:16e3,bitDepth:16,channelCount:1,startTime:0,duration:0,endianness:z.LE}),u=k(),l=new gt;l.onPlayCompleted=()=>{i.value=!1},l.playProgressCallback=w=>{u.value.currentTime=K(Number(w))},ve([d,a],async([w,p])=>{if(typeof p=="number"){const E=n.value[p],y=s.get(E.id);u.value=ot(y,0),requestAnimationFrame(async()=>{const T=document.getElementById(e),A=y.pcm;await l.init({canvas:T,pcmData:A,pcmOptions:w}),u.value.currentTime=K(0),u.value.totalDuration=K(Number(l.totalDuration))})}},{deep:!0}),ve(o,w=>{l.setVolume(w)});function v(){l.play(),i.value=!0}function b(){l.stop(),i.value=!1}async function I(w){const{offsetX:p,target:E}=w,y=E.clientWidth,T=p/y*l.totalDuration;await l.play(T),i.value=!0}function V(w){const{offsetX:p,target:E}=w,y=E,T=y.clientWidth,A=p/T*l.totalDuration;y.dataset.time=K(A),y.style.setProperty("--after-x",p-46/2+"px")}function Z(){if(a.value===void 0)return;const w=n.value[a.value];return s.get(w.id)}function Q(w){const p=y=>Le.split(",").some(T=>y.endsWith(T)),E=w.filter(y=>p(y.name));E.length>0?E.forEach(y=>{const T=String(y.lastModified);n.value.push({id:T,name:y.name,status:"finished",file:y})}):window.$message.warning("请拖拽音频文件")}function N(){ke.get("./multimedia/Jay Chou.pcm",{responseType:"blob"}).then(async w=>{const p=new File([w.data],"Jay Chou.pcm"),E=await p.arrayBuffer(),y=String(p.lastModified);s.set(y,{fileName:p.name,fileSize:p.size,audioBasicInfo:{sampleRate:24e3,bitDepth:16,channelCount:2,endianness:z.LE},pcm:E}),n.value.push({id:y,name:p.name,status:"finished"}),ie(n.value.length-1)})}async function ie(w){const p=n.value[w];let E=s.get(p.id);const y=window.$message.loading("解析中... 希望不会太久~",{duration:0}),T=()=>{setTimeout(()=>{y.type="success",y.content="解析完成。久等了~",setTimeout(()=>y.destroy(),3e3)},1e3)},A=L=>{y.type="error",y.content=`解析失败，${L}。额~`,setTimeout(()=>y.destroy(),3e3)};if(!E){const L=p.file;if(!L)return A("数据异常");const ne=L.name.lastIndexOf("."),re=L.name.slice(ne+1);if(re.toLocaleLowerCase()=="mp3"){const X=await xt(L);if(X){const{audioBasicInfo:ue}=X.mpegAudio;s.set(p.id,{fileName:L.name,fileSize:L.size,audioBasicInfo:{sampleRate:ue.sampleRate,channelCount:ue.channelCount,bitDepth:ue.bitDepth},pcm:X.pcm,mp3Info:X})}else return A("MP3文件解析失败")}else if(re.toLocaleLowerCase()=="pcm"){const X=await L.arrayBuffer();s.set(p.id,{fileName:L.name,fileSize:L.size,audioBasicInfo:{sampleRate:8e3,channelCount:2,bitDepth:16},pcm:X})}else return A("敬请期待");E=s.get(p.id)}a.value=w,T(),Object.assign(d.value,E.audioBasicInfo),setTimeout(()=>{document.querySelectorAll(`#${t} .n-upload-file`).forEach((ne,re)=>{ne.classList.remove("active"),re==w&&ne.classList.add("active")})},100)}function xe(w){const p=w.target.closest(".n-button"),E=w.target.closest(".n-upload-file");if(!E)return;const y=document.querySelectorAll(`#${t} .n-upload-file`),T=Array.from(y).findIndex(A=>A===E);if(p){const A=n.value[T];s.delete(A.id),T==a.value&&(a.value=void 0,i.value=!1,l.clear());return}T!=-1&&ie(T)}return(w,p)=>(U(),ge(ht,{onDropCallback:Q},{default:m(()=>[h(We,{"default-size":.35,min:0},{left:m(()=>[h(f(Xe),null,{default:m(()=>[h(f(Ye),{prefix:"bar"},{default:m(()=>[h(f(ae),{type:"success"},{default:m(()=>[p[5]||(p[5]=R(" PCM / MP3 / ",-1)),h(f(ae),{type:"warning"},{default:m(()=>[...p[4]||(p[4]=[R("WAV(额~)",-1)])]),_:1}),p[6]||(p[6]=R(" 音频可视化播放器 ",-1))]),_:1})]),_:1}),h(ct,{options:d.value,"onUpdate:options":p[2]||(p[2]=E=>d.value=E),volume:o.value,"onUpdate:volume":p[3]||(p[3]=E=>o.value=E)},{prefix:m(()=>[h(f(je),{"file-list":n.value,"onUpdate:fileList":p[0]||(p[0]=E=>n.value=E),abstract:"",accept:Le,multiple:""},{default:m(()=>[h(f(He),null,{default:m(()=>[h(f(Ke),{abstract:""},{default:m(({handleClick:E})=>[h(f(de),{type:"info",onClick:E},{icon:m(()=>[h(f(fe),{component:f(Je)},null,8,["component"])]),default:m(()=>[p[7]||(p[7]=R(" 选择或拖入文件 ",-1))]),_:1},8,["onClick"])]),_:1}),h(f(de),{type:"info",ghost:"",onClick:N},{icon:m(()=>[h(f(fe),{component:f(Ze)},null,8,["component"])]),default:m(()=>[p[8]||(p[8]=R(" 加载样例 ",-1))]),_:1})]),_:1}),h(f(qe),{id:f(t),onClickCapture:xe},null,8,["id"])]),_:1},8,["file-list"])]),suffix:m(()=>[h(f(de),{disabled:typeof a.value!="number",type:i.value?"error":"success",ghost:"",onClick:p[1]||(p[1]=E=>i.value?b():v())},{icon:m(()=>[h(f(fe),{component:i.value?f(st):f(at)},null,8,["component"])]),default:m(()=>[R(" "+S(i.value?"暂停":"播放"),1)]),_:1},8,["disabled","type"])]),_:1},8,["options","volume"])]),_:1})]),right:m(()=>[u.value?(U(),J("div",Vt,[h(Ut,{"is-running":i.value,info:u.value,getMetadata:Z},null,8,["is-running","info"]),O("div",Nt,[O("canvas",{id:f(e)},null,8,_t),O("div",{class:"progress",onMousemove:V,onClick:I},null,32)]),O("div",Ft,[h(f(ae),null,{default:m(()=>[R(S(u.value.currentTime),1)]),_:1}),h(f(ae),null,{default:m(()=>[R(S(u.value.totalDuration),1)]),_:1})])])):Ce("",!0)]),_:1})]),_:1}))}}),ca=le(kt,[["__scopeId","data-v-55b539a3"]]);export{ca as default};
