var Ot=Object.defineProperty;var Rt=r=>{throw TypeError(r)};var Ut=(r,t,e)=>t in r?Ot(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var d=(r,t,e)=>Ut(r,typeof t!="symbol"?t+"":t,e),It=(r,t,e)=>t.has(r)||Rt("Cannot "+e);var g=(r,t,e)=>(It(r,t,"read from private field"),e?e.call(r):t.get(r)),k=(r,t,e)=>t.has(r)?Rt("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(r):t.set(r,e),tt=(r,t,e,n)=>(It(r,t,"write to private field"),n?n.call(r,e):t.set(r,e),e);import{d as J,c as U,o as A,W as V,bg as Vt,b5 as wt,az as pt,b as h,w as m,u as f,e as R,_ as ct,ao as vt,p as W,aw as Nt,bh as _t,at as Lt,bd as kt,bi as Ft,A as gt,ae as At,Z as Ct,af as xt,t as L,a1 as ft,R as ht,ag as Wt,as as $,B as st,a7 as zt,a8 as $t,a3 as ot,a9 as Gt,bj as Xt,bk as Yt}from"./index-Dn-EKhws.js";import{R as jt}from"./ResponsiveDirectionLayout-Bg8O43vv.js";import{N as F}from"./InputGroupLabel-BeFBzfLO.js";import{N as mt}from"./Select-mpCL1ykS.js";import{N as et}from"./InputGroup-DYX4nf58.js";import{N as Ht}from"./InputNumber-6KhDpw3g.js";import{N as Kt}from"./Slider-CG2DFlfp.js";import{S as Bt}from"./Scrollbar-BRzdvHQR.js";import{N as qt}from"./Image-Co1gBIq6.js";import{N as at}from"./text-Dtl52BXd.js";import{a as Jt}from"./headers-_QRbljUp.js";import{N as Zt}from"./ButtonGroup-CP49LPmk.js";import{N as Qt,a as te,b as ee}from"./Upload-BP7aI61z.js";import{A as ae}from"./Add--F6a5GYI.js";import{C as ne}from"./CloudDownloadOutline-Ds1RdiLD.js";import"./Suffix-DyrqX6KW.js";import"./attribute-Cz32yFEB.js";import"./Empty-D-xfAB5F.js";import"./use-locale-BorJ0mpQ.js";import"./Input-Cd6qrK1z.js";import"./_createCompounder-BHtMwzJe.js";import"./Progress-NNKWn2Gm.js";const ie={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},re=V("path",{d:"M112 111v290c0 17.44 17 28.52 31 20.16l247.9-148.37c12.12-7.25 12.12-26.33 0-33.58L143 90.84c-14-8.36-31 2.72-31 20.16z",fill:"none",stroke:"currentColor","stroke-miterlimit":"10","stroke-width":"32"},null,-1),se=[re],oe=J({name:"PlayOutline",render:function(t,e){return A(),U("svg",ie,se)}}),le={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},ue=V("rect",{x:"96",y:"96",width:"320",height:"320",rx:"24",ry:"24",fill:"none",stroke:"currentColor","stroke-linejoin":"round","stroke-width":"32"},null,-1),ce=[ue],de=J({name:"StopOutline",render:function(t,e){return A(),U("svg",le,ce)}});var M=(r=>(r.LE="le",r.BE="be",r.LittleEndian="le",r.BigEndian="be",r))(M||{});function q(r){const t=n=>n.toString().padStart(2,"0");return`${t(Math.floor(r/60))}:${t(Math.floor(r%60))}`}function fe(r,t){const{audioBasicInfo:e,fileSize:n,fileName:a}=r,i=a.lastIndexOf("."),s=i>0?a.substring(i+1):"异常！",l=q(e.startTime||0);return{...e,name:a,currentTime:l,totalDuration:q(t),size:Vt(n),type:s.toLocaleUpperCase()}}const he={class:"options-panel"},me=J({__name:"options",props:{volume:{required:!0},volumeModifiers:{},options:{required:!0},optionsModifiers:{}},emits:["update:volume","update:options"],setup(r){const t=wt(r,"volume"),e=wt(r,"options");return(n,a)=>(A(),U("div",he,[pt(n.$slots,"prefix",{},void 0,!0),h(f(et),null,{default:m(()=>[h(f(F),null,{default:m(()=>[...a[5]||(a[5]=[R("采样率",-1)])]),_:1}),h(f(mt),{value:e.value.sampleRate,"onUpdate:value":a[0]||(a[0]=i=>e.value.sampleRate=i),options:[8e3,16e3,22050,24e3,44100,48e3,96e3,192e3].map(i=>({label:String(i),value:i}))},null,8,["value","options"]),h(f(F),null,{default:m(()=>[...a[6]||(a[6]=[R("Hz",-1)])]),_:1})]),_:1}),h(f(et),null,{default:m(()=>[h(f(F),null,{default:m(()=>[...a[7]||(a[7]=[R("位深",-1)])]),_:1}),h(f(mt),{value:e.value.bitDepth,"onUpdate:value":a[1]||(a[1]=i=>e.value.bitDepth=i),options:[8,16,24,32].map(i=>({label:String(i),value:i}))},null,8,["value","options"]),h(f(F),null,{default:m(()=>[...a[8]||(a[8]=[R("bit",-1)])]),_:1})]),_:1}),h(f(et),null,{default:m(()=>[h(f(F),null,{default:m(()=>[...a[9]||(a[9]=[R("声道数",-1)])]),_:1}),h(f(Ht),{value:e.value.channelCount,"onUpdate:value":a[2]||(a[2]=i=>e.value.channelCount=i),min:1,precision:0},null,8,["value"]),h(f(F),null,{default:m(()=>[...a[10]||(a[10]=[R("ch",-1)])]),_:1})]),_:1}),h(f(et),null,{default:m(()=>[h(f(F),null,{default:m(()=>[...a[11]||(a[11]=[R("字节序",-1)])]),_:1}),h(f(mt),{value:e.value.endianness,"onUpdate:value":a[3]||(a[3]=i=>e.value.endianness=i),options:[{label:"小端序",value:f(M).LE},{label:"大端序",value:f(M).BE}]},null,8,["value","options"])]),_:1}),h(f(et),null,{default:m(()=>[h(f(F),null,{default:m(()=>[...a[12]||(a[12]=[R("音量",-1)])]),_:1}),h(f(Kt),{value:t.value,"onUpdate:value":a[4]||(a[4]=i=>t.value=i),min:0,max:1,step:.01},null,8,["value"])]),_:1}),pt(n.$slots,"suffix",{},void 0,!0)]))}}),pe=ct(me,[["__scopeId","data-v-4f7165fd"]]),ve=["id"],ge=J({__name:"HandleFileDrag",emits:["drop-callback"],setup(r,{emit:t}){const e=t,n=vt("handle-file-drag-"),a=W(!1);function i(u){if(u.preventDefault(),u.stopPropagation(),!u.dataTransfer){a.value=!1;return}const o=u.dataTransfer.types;a.value=o.includes("Files")}function s(u){i(u)}function l(u){u.target.id==n&&(a.value=!1)}function c(u){var v;u.preventDefault(),u.stopPropagation(),a.value=!1;const o=(v=u.dataTransfer)==null?void 0:v.files;e("drop-callback",Array.from(o||[]))}return(u,o)=>{var v,D;return A(),U("div",{id:f(n),class:Lt(["handle-file-drag",a.value&&"file-drop-hint"]),style:Nt({"--color":((D=(v=f(_t).theme)==null?void 0:v.common)==null?void 0:D.successColor)||"#63e2b7"}),"drag-tip":"请将音频文件拖拽至此",onDragenter:i,onDragover:s,onDragleave:l,onDrop:c},[pt(u.$slots,"default",{},void 0,!0)],46,ve)}}}),Ce=ct(ge,[["__scopeId","data-v-bf2639f9"]]);class ye{constructor(){d(this,"config");d(this,"barWidth",2);d(this,"barGap",2);d(this,"barCount",0);d(this,"barColor","#2080f0");d(this,"amplitudeValues",[]);d(this,"amplitudeBarMetrics",[]);d(this,"lastTimelineX")}init(t){this.config=t,this.lastTimelineX=void 0,this.calculateAmplitudeData(),this.calculateAmplitudeBarMetrics(),this.render(0)}render(t){if(!this.config)return;const{canvasContext:e}=this.config,{amplitudeBarMetrics:n,barColor:a,barWidth:i}=this,{width:s,height:l}=e.canvas,c=Math.floor((s-2)*t);this.lastTimelineX!=c&&(this.lastTimelineX=c,e.clearRect(0,0,s,l),e.fillStyle=a,n.forEach(({x:u,y:o,height:v})=>{c<=u&&(e.fillStyle="#B1B1B1FF"),e.fillRect(u,o,i,v)}),e.fillStyle=a,e.fillRect(c,0,2,l))}calculateAmplitudeData(){if(!this.config)return;const{canvasContext:t,audioBuffer:e,channelCount:n}=this.config,{barWidth:a,barGap:i}=this;this.barCount=Math.floor(t.canvas.width/(a+i));const s=e.length,l=Array.from({length:n},(u,o)=>e.getChannelData(o)),c=Math.floor(s/this.barCount);this.amplitudeValues=[];for(let u=0;u<this.barCount;u++){const o=u*c,v=l.reduce((D,w)=>{const N=w.slice(o,o+c).reduce((Q,_)=>Q+_**2,0),Z=Math.sqrt(N/c);return D+Z},0);this.amplitudeValues.push(v)}}calculateAmplitudeBarMetrics(){var u;const t=(u=this.config)==null?void 0:u.canvasContext.canvas;if(!t)return;const{barWidth:e,barGap:n,barCount:a,amplitudeValues:i}=this,s=t.height,l=t.height/2;let c=0;this.amplitudeBarMetrics=[];for(let o=0;o<a;o++){const v=s*i[o];this.amplitudeBarMetrics.push({x:c,y:l-v/2,height:v}),c+=e+n}}clear(){this.amplitudeValues=[],this.amplitudeBarMetrics=[]}}class Ee{constructor(){d(this,"config");d(this,"channelColors",["#5470c6","#91cc75","#fac858","#ee6666","#73c0de","#3ba272","#fc8452","#9a60b4","#ea7ccc"]);d(this,"channelRenderHeight",0);d(this,"waveformDataSize",0);d(this,"waveformDataCount",0);d(this,"channelAmplitudeData",[]);d(this,"lastRenderedStartIndex")}init(t){this.config=t,this.lastRenderedStartIndex=void 0,this.channelRenderHeight=Math.floor(t.canvasContext.canvas.height/t.channelCount),this.preprocessAudioData(),this.renderChannelBaseLines()}renderChannelBaseLines(){const{config:t,channelColors:e,channelRenderHeight:n}=this;if(!t)return;const{channelCount:a,canvasContext:i}=t,{width:s}=i.canvas;i.clearRect(0,0,s,i.canvas.height);for(let l=0;l<a;l++){const c=e[l%e.length];i.fillStyle=c;const u=l*n+n/2;i.fillRect(0,u,s,1)}}render(t){const{channelRenderHeight:e,channelAmplitudeData:n,config:a,channelColors:i,waveformDataSize:s,waveformDataCount:l}=this;if(!a||!n.length)return;const{channelCount:c,canvasContext:u}=a,{width:o,height:v}=u.canvas,D=Math.floor(Math.min(l*t,l-1));if(this.lastRenderedStartIndex!==D){this.lastRenderedStartIndex=D,u.clearRect(0,0,o,v);for(let w=0;w<c;w++){const N=i[w%i.length];u.fillStyle=N;const Z=e*w+e/2,Q=n[w][D];for(let _=0;_<s;_++){const nt=Math.floor(Z-e/2*Q[_]);u.fillRect(_,nt,1,1)}}}}preprocessAudioData(){if(!this.config)return;const{canvasContext:t,audioBuffer:e,channelCount:n}=this.config,a=Math.floor(t.canvas.width),i=Math.floor(e.length/a);this.waveformDataSize=a,this.waveformDataCount=i,this.channelAmplitudeData=Array.from({length:n}).map(()=>new Array(i));for(let s=0;s<n;s++){const l=e.getChannelData(s);for(let c=0;c<i;c++){const u=c*a;this.channelAmplitudeData[s][c]=l.slice(u,u+a)}}}clear(){this.channelAmplitudeData=[]}}class Re{constructor(){d(this,"audioContext");d(this,"isPlaying",!1);d(this,"source");d(this,"audioBuffer");d(this,"gainNode");d(this,"currentVolume",1);d(this,"startTime",0);d(this,"duration",0);d(this,"playStartTime",0);d(this,"offsetTime");d(this,"options",{sampleRate:16e3,channelCount:1,bitDepth:16,startTime:0,duration:0,endianness:M.LE,volume:1});d(this,"onPlayCompleted");d(this,"playProgressCallback")}get totalDuration(){return this.audioBuffer?this.audioBuffer.duration:0}get ready(){return!!this.audioContext}setVolume(t){if(!this.gainNode){console.warn("增益节点未初始化，请先调用 init()");return}const e=Math.max(0,Math.min(1,t));this.currentVolume=e,this.gainNode.gain.value=e}init(){if(!this.audioContext){const t=window.AudioContext||window.webkitAudioContext;this.audioContext=new t,this.gainNode=this.audioContext.createGain(),this.gainNode.connect(this.audioContext.destination),this.gainNode.gain.value=this.currentVolume}}async initPCM(t,e={}){if(this.init(),!this.audioContext){console.error("音频上下文初始化失败");return}Object.assign(this.options,e);const{sampleRate:n,channelCount:a,bitDepth:i,startTime:s,duration:l,endianness:c,volume:u}=this.options;this.startTime=s,this.duration=l,this.offsetTime=void 0,this.setVolume(u),await this.stop();try{const o=this.convertPCMToFloat32(t,i,c);this.audioBuffer=this.audioContext.createBuffer(a,o.length/a,n);for(let v=0;v<a;v++){const D=this.audioBuffer.getChannelData(v);for(let w=0;w<D.length;w++)D[w]=o[w*a+v]}}catch(o){console.error("播放 PCM 失败：",o)}}convertPCMToFloat32(t,e,n=M.LE){const a=new DataView(t),i=e/8,s=n===M.LE,l=Math.floor(t.byteLength/i),c=new Float32Array(l);for(let u=0;u<l;u++){const o=u*i;switch(e){case 8:c[u]=(a.getUint8(o)-128)/128;break;case 16:c[u]=a.getInt16(o,s)/32768;break;case 24:let v;s?v=a.getUint8(o)|a.getUint8(o+1)<<8|a.getUint8(o+2)<<16:v=a.getUint8(o)<<16|a.getUint8(o+1)<<8|a.getUint8(o+2),v&8388608&&(v|=4278190080),c[u]=v/8388608;break;case 32:c[u]=a.getInt32(o,s)/2147483648;break}}return c}async playFromPosition(t=0,e=0){if(!this.audioBuffer||!this.audioContext){console.error("请先加载 PCM 数据");return}this.isPlaying&&await this.stop();const n=this.audioBuffer.duration,a=Math.max(0,Math.min(t,n)),i=e>0?Math.min(e,n-a):void 0;this.source=this.audioContext.createBufferSource(),this.source.buffer=this.audioBuffer,this.source.connect(this.gainNode),this.source.start(0,a,i),this.isPlaying=!0,this.playStartTime=this.audioContext.currentTime,this.source.onended=()=>{var s,l;this.updatePlayProgress(),this.isPlaying=!1,typeof this.offsetTime=="number"&&(this.offsetTime+=(((s=this.audioContext)==null?void 0:s.currentTime)||0)-this.playStartTime),(l=this.onPlayCompleted)==null||l.call(this)}}updatePlayProgress(){const{isPlaying:t,audioContext:e,audioBuffer:n,offsetTime:a,playStartTime:i,playProgressCallback:s}=this;if(!t||!e||!n||!s)return;const l=(a||0)+(e.currentTime-i),c=l/n.duration,u=l.toFixed(2),o=n.duration.toFixed(2),v=Math.min(1,c).toFixed(6);s(u,o,v),requestAnimationFrame(()=>this.updatePlayProgress())}async play(t){if(typeof t=="number")await this.stop(),this.offsetTime=t;else{if(this.isPlaying)return;const{startTime:e,offsetTime:n}=this;(!n||n+e>=this.totalDuration)&&(this.offsetTime=0)}this.playFromPosition(this.startTime+this.offsetTime,this.duration),this.updatePlayProgress()}async stop(){this.source&&(this.source.stop(),this.source.disconnect(),this.source=void 0,await kt(()=>!this.isPlaying,500))}clear(){this.stop(),this.isPlaying=!1,this.audioBuffer=void 0}}class Ie{constructor(){d(this,"audioSpectrum",new ye);d(this,"audioSpectrumCanvas",document.createElement("canvas"));d(this,"audioSpectrumCtx",this.audioSpectrumCanvas.getContext("2d"));d(this,"audioSpectrumHeight",100);d(this,"audioWaveform",new Ee);d(this,"audioWaveformCanvas",document.createElement("canvas"));d(this,"audioWaveformCtx",this.audioWaveformCanvas.getContext("2d"));d(this,"audioWaveformHeight",100);d(this,"audioPlayer",new Re);d(this,"canvas");d(this,"ctx");d(this,"onPlayCompleted");d(this,"playProgressCallback");this.audioPlayer.onPlayCompleted=()=>{var t;(t=this.onPlayCompleted)==null||t.call(this)},this.audioPlayer.playProgressCallback=(t,e,n)=>{var i;const a=Number(n);this.render(a),(i=this.playProgressCallback)==null||i.call(this,t,e,n)}}get totalDuration(){return this.audioPlayer.totalDuration}async init(t){await this.initPCM(t),this.audioPlayer.ready&&this.initCanvas(t)}async initPCM(t){const{audioPlayer:e}=this,{pcmData:n,pcmOptions:a}=t;await e.initPCM(n,a)}initCanvas(t){const{audioPlayer:e,audioSpectrumCanvas:n,audioSpectrumCtx:a,audioSpectrumHeight:i,audioWaveformCanvas:s,audioWaveformCtx:l,audioWaveformHeight:c}=this,{canvas:u}=t,o=e.options.channelCount,v=e.audioBuffer,D=e.totalDuration,w=Math.floor(u.getBoundingClientRect().width);if(u.width=w,u.height=c*o+i,this.canvas=u,this.ctx=u.getContext("2d"),!this.ctx||!a||!l){console.error("Canvas 上下文不可用。");return}n.width=w,n.height=i,s.width=w,s.height=c*o;const N={channelCount:o,audioBuffer:v,duration:D};this.audioWaveform.init({...N,canvasContext:l}),this.audioSpectrum.init({...N,canvasContext:a}),this.ctx.drawImage(s,0,0),this.ctx.drawImage(n,0,s.height)}render(t){const{canvas:e,ctx:n,audioSpectrum:a,audioSpectrumCanvas:i,audioWaveform:s,audioWaveformCanvas:l}=this;if(!e||!n){console.error("Canvas 不可用。");return}n.clearRect(0,0,e.width,e.height),a.render(t),s.render(t),n.drawImage(l,0,0),n.drawImage(i,0,l.height)}setVolume(t){this.audioPlayer.setVolume(t)}play(t){return this.audioPlayer.play(t)}stop(){this.audioPlayer.stop()}clear(){this.audioPlayer.clear(),this.audioSpectrum.clear(),this.audioWaveform.clear();const{ctx:t,canvas:e}=this;t&&e&&t.clearRect(0,0,e.width,e.height)}}const bt=["Blues","Classic Rock","Country","Dance","Disco","Funk","Grunge","Hip-Hop","Jazz","Metal","New Age","Oldies","Other","Pop","R&B","Rap","Reggae","Rock","Techno","Industrial","Alternative","Ska","Death Metal","Pranks","Soundtrack","Euro-Techno","Ambient","Trip-Hop","Vocal","Jazz+Funk","Fusion"];function j(r,t,e){const n=r.subarray(t,e),a=n.findIndex(l=>l===0),i=a===-1?n:n.subarray(0,a),s=new TextDecoder("ascii").decode(i).trim();return s===""?"-":s}function we(r){return r<bt.length?bt[r]:"Unknown"}function be(r){const t=new Uint8Array(r);if(t.length<128)return null;const e=t.subarray(t.length-128);if(e[0]!==84||e[1]!==65||e[2]!==71)return null;const n=e[125],a=e[126];let i=n===0;if(i&&(a<1||a>99)&&(i=!1),i){const c=e.subarray(97,125);Array.from(c).every(o=>o===0||o===32)&&a!==0&&a!==32&&(i=!1)}let s,l;return i?(s=j(e,97,125),l=a):(s=j(e,97,127),l=0),{title:j(e,3,33),artist:j(e,33,63),album:j(e,63,93),year:j(e,93,97),comment:s,track:l,genre:we(e[127]),isID3v1_1:i}}const Dt={2.2:{TT2:"标题",TP1:"艺术家",TAL:"专辑",TYE:"年份",COM:"评论",TRK:"音轨号",TCO:"流派",PIC:"附加图片",TCM:"作曲家",TCR:"版权信息",TBP:"播放速度",TLE:"时长",TLA:"语言",TPB:"发行商"},2.3:{TIT2:"标题",TPE1:"艺术家",TALB:"专辑",TYER:"年份",COMM:"评论",TRCK:"音轨号",TCON:"流派",APIC:"附加图片",TCOM:"作曲家",TCOP:"版权信息",TBPM:"播放速度",TLEN:"时长",TLAN:"语言",TPUB:"发行商",TIT3:"副标题",TPE2:"乐队",TPE3:"指挥",TPE4:"改编者",TOPE:"原艺术家",TOAL:"原专辑",TSRC:"ISRC码",TENC:"编码者",TEXT:"歌词作者",TOWN:"文件所有者",TPOS:"音轨集位置",TRDA:"录制日期",TXXX:"用户自定义文本",USLT:"非同步歌词",SYLT:"同步歌词",UFID:"唯一文件标识",RBUF:"推荐缓冲区大小",RVAD:"相对音量调整",RVRB:"混响",ETCO:"事件定时码",MLLT:"MPEG位置查找表",SYTC:"同步节奏码",IPLS:"参与人员列表",MCDI:"音乐CD标识符",GEOB:"通用封装对象",PCNT:"播放计数器",POPM:"流行度计量",AENC:"音频加密",LINK:"链接信息",POSS:"位置同步帧",USER:"使用条款",OWNE:"所有权帧",ENCR:"加密方法注册",GRID:"组标识注册",PRIV:"私有帧",COMR:"商业帧",EQUA:"均衡器",WCOM:"商业信息URL",WCOP:"版权信息URL",WOAF:"官方音频文件URL",WOAR:"官方艺术家URL",WOAS:"官方音频源URL",WORS:"官方电台URL",WPAY:"支付信息URL",WPUB:"官方发行商URL",WXXX:"用户自定义URL"},2.4:{TIT2:"标题",TPE1:"艺术家",TALB:"专辑",TYER:"年份",COMM:"评论",TRCK:"音轨号",TCON:"流派",APIC:"附加图片",TCOM:"作曲家",TCOP:"版权信息",TBPM:"播放速度",TLEN:"时长",TLAN:"语言",TPUB:"发行商",TIT3:"副标题",TPE2:"乐队",TPE3:"指挥",TPE4:"改编者",TOPE:"原艺术家",TOAL:"原专辑",TSRC:"ISRC码",TENC:"编码者",TEXT:"歌词作者",TOWN:"文件所有者",TPOS:"音轨集位置",TRDA:"录制日期",TXXX:"用户自定义文本",USLT:"非同步歌词",SYLT:"同步歌词",UFID:"唯一文件标识",RBUF:"推荐缓冲区大小",RVAD:"相对音量调整",RVRB:"混响",ETCO:"事件定时码",MLLT:"MPEG位置查找表",SYTC:"同步节奏码",IPLS:"参与人员列表",MCDI:"音乐CD标识符",GEOB:"通用封装对象",PCNT:"播放计数器",POPM:"流行度计量",AENC:"音频加密",LINK:"链接信息",POSS:"位置同步帧",USER:"使用条款",OWNE:"所有权帧",ENCR:"加密方法注册",GRID:"组标识注册",PRIV:"私有帧",COMR:"商业帧",EQUA:"均衡器",WCOM:"商业信息URL",WCOP:"版权信息URL",WOAF:"官方音频文件URL",WOAR:"官方艺术家URL",WOAS:"官方音频源URL",WORS:"官方电台URL",WPAY:"支付信息URL",WPUB:"官方发行商URL",WXXX:"用户自定义URL"}};class De{constructor(t,e=0){d(this,"buffer");d(this,"offset",0);d(this,"offsetBase",0);d(this,"version","");d(this,"frameIdMap",{});this.buffer=t,this.offsetBase=e}initVersion(t){return this.version=`2.${t}`,this.frameIdMap=Dt[this.version],!!this.frameIdMap}syncSafeInteger(t){return t[0]<<21|t[1]<<14|t[2]<<7|t[3]}cleanString(t){return t.replace(/\0/g,"").trim()}readID3String(t,e){if(e<=0)return"";const n=new Uint8Array(this.buffer,t,e);let a="";switch(n[0]){case 1:if(e>=2)try{a=new TextDecoder("utf-16",{ignoreBOM:!0}).decode(n.subarray(1))}catch{a=this.readIso88591String(t+1,e-1)}break;case 2:if(e>=2)try{a=new TextDecoder("utf-16be").decode(n.subarray(1))}catch{a=this.readIso88591String(t+1,e-1)}break;case 3:if(e>=2)try{a=new TextDecoder("utf-8").decode(n.subarray(1))}catch{a=this.readIso88591String(t+1,e-1)}break;case 0:a=this.readIso88591String(t+1,e-1);break;default:try{a=new TextDecoder("utf-8",{fatal:!0}).decode(n)}catch{a=this.readIso88591String(t,e)}break}return this.cleanString(a)}readIso88591String(t,e){const n=new Uint8Array(this.buffer,t,e);return Array.from(n).map(a=>String.fromCharCode(a)).join("")}readAsciiString(t,e){const n=new Uint8Array(this.buffer,t,e);return Array.from(n).map(a=>a===0?"":String.fromCharCode(a)).join("")}readUInt24BE(t){const e=new Uint8Array(this.buffer);return e[t]<<16|e[t+1]<<8|e[t+2]}readUInt32BE(t){return new DataView(this.buffer).getUint32(t,!1)}parseAPICFrame(t,e){if(e<=0)return null;const n=new Uint8Array(this.buffer,t,e);let a=0;if(this.version!=="2.2"&&(a+=1,a>=e))return null;const i=n.subarray(a).findIndex(c=>c===0);if(i===-1)return null;let s=this.readAsciiString(t+a,i);if(a+=i+1,a>=e||(s==="JPG"||s==="JPEG"?s="image/jpeg":s==="PNG"?s="image/png":s==="GIF"&&(s="image/gif"),a+=1,a>=e))return null;const l=n.subarray(a).findIndex(c=>c===0);return l===-1||(a+=l+1,a>=e)?null:{mime:s,data:this.buffer.slice(t+a,t+e)}}parseFrame(t,e,n,a){const i=this.readID3String(n,a),s=this.frameIdMap[e]||e;let l=i;e=="TRCK"?l=parseInt(i)||0:e=="APIC"&&(l=this.parseAPICFrame(n,a),t.audioCover=l),t[s]=l}validateTagId(){return this.readAsciiString(this.offset,3)==="ID3"}getVersion(){if(this.offset=this.offsetBase,this.buffer.byteLength<this.offset+10||!this.validateTagId())return null;const n=`2.${new Uint8Array(this.buffer)[this.offset+3]}`;return Dt[n]?n:null}commonParse(t,e,n){this.offset=this.offsetBase;try{if(this.buffer.byteLength<this.offset+10||!this.validateTagId())return null;const a=new Uint8Array(this.buffer),i=a[this.offset+3];if(!this.initVersion(i))return null;const s=this.calculateTagSize(a),l={版本:this.version,标签大小:s+10};let c=this.offset+10;const u=this.offset+10+s;for(;c+e<=u&&c+e<=this.buffer.byteLength;){const o=this.readAsciiString(c,t);if(!o||o.replace(/\0/g,"")==="")break;const v=n(c+t);if(v<=0||c+e+v>this.buffer.byteLength){c+=e+v;continue}this.parseFrame(l,o,c+e,v),c+=e+v}return l}catch(a){return console.error(`ID3v${this.version} 解析失败:`,a),null}}calculateTagSize(t){if(this.version==="2.2")return this.readUInt24BE(this.offset+6);{const e=[t[this.offset+6],t[this.offset+7],t[this.offset+8],t[this.offset+9]];return this.syncSafeInteger(e)}}}class Te extends De{ID3v22Parser(){return this.commonParse(3,6,t=>this.readUInt24BE(t))}ID3v23Parser(){return this.commonParse(4,10,t=>this.readUInt32BE(t))}ID3v24Parser(){return this.commonParse(4,10,t=>this.readUInt32BE(t))}parse(){const t=this.getVersion();if(!t)return null;switch(t){case"2.4":return this.ID3v24Parser();case"2.3":return this.ID3v23Parser();case"2.2":return this.ID3v22Parser();default:return null}}}function Pe(r){return new Te(r).parse()}const H={offset:-1,isValid:!1,syncWord:0,mpegVersion:"Unknown",layer:"Unknown",protectionBit:!1,crcValid:null,bitrateIndex:-1,bitrate:0,sampleRateIndex:-1,sampleRate:0,sampleRateExtension:!1,bitrateExtension:!1,paddingBit:!1,privateBit:!1,frameSize:0,frameDuration:0,channelMode:"Unknown",modeExtension:-1,copyright:!1,original:!1,emphasis:-1},B=class B{constructor(t){d(this,"dataView");this.dataView=new DataView(t)}parseFrameHeaderWithError(t){var c,u;if(t+4>this.dataView.byteLength){const o={offset:t,errorType:"偏移量越界",errorMsg:`偏移量${t}超出buffer范围（总长度${this.dataView.byteLength}）`};return{frameHeader:{...H,offset:t},errorDetail:o}}const e=this.readHeaderBytes(t);if(e===null){const o={offset:t,errorType:"其他解析错误",errorMsg:"读取帧头4字节失败"};return{frameHeader:{...H,offset:t},errorDetail:o}}const n=(e&B.SYNC_WORD_MASK)>>>20;if((e&B.SYNC_WORD_VALUE)>>>0!==B.SYNC_WORD_VALUE){const o={offset:t,errorType:"同步字无效",errorMsg:`同步字${n.toString(16)}无效，预期0xFFE`};return{frameHeader:{...H,offset:t,syncWord:n},errorDetail:o}}const a={...H,offset:t,isValid:!0,syncWord:n};a.mpegVersion=this.parseMpegVersion(e>>19&3),a.layer=this.parseLayer(e>>17&3),a.protectionBit=(e>>16&1)===1,a.bitrateIndex=e>>12&15,a.sampleRateIndex=e>>10&3,a.paddingBit=(e>>9&1)===1,a.privateBit=(e>>8&1)===1,a.channelMode=this.parseChannelMode(e>>6&3),a.modeExtension=e>>4&3,a.copyright=(e>>3&1)===1,a.original=(e>>2&1)===1,a.emphasis=e&3;const i=this.parseBitrate(a.mpegVersion,a.layer,a.bitrateIndex);a.bitrate=i.bitrate,a.bitrateExtension=i.isExtended;const s=this.parseSampleRate(a.mpegVersion,a.sampleRateIndex);if(a.sampleRate=s.sampleRate,a.sampleRateExtension=s.isExtended,a.bitrate===0||a.sampleRate===0){const o={offset:t,errorType:"比特率/采样率为0",errorMsg:`比特率${a.bitrate}kbps/采样率${a.sampleRate}Hz无效`};return a.isValid=!1,{frameHeader:a,errorDetail:o}}if(a.protectionBit)a.crcValid=null;else{const o=this.validateCrc(t,e);if(a.crcValid=o.isValid,a.crcValue=o.crcValue,!o.isValid){const v={offset:t,errorType:"CRC校验失败",errorMsg:`CRC校验失败，实际值${((c=o.crcValue)==null?void 0:c.toString(16))||"未知"}，计算值${((u=o.calculatedCrc)==null?void 0:u.toString(16))||"未知"}`};return a.isValid=!1,{frameHeader:a,errorDetail:v}}}const l=new Tt;if(a.frameSize=l.calculateFrameSize(a),a.frameDuration=l.calculateFrameDuration(a),a.frameSize<=0||a.frameSize>this.dataView.byteLength-t){const o={offset:t,errorType:"帧大小计算异常",errorMsg:`帧大小${a.frameSize}字节无效（超出剩余buffer长度）`};return a.isValid=!1,{frameHeader:a,errorDetail:o}}return{frameHeader:a,errorDetail:null}}readHeaderBytes(t){try{return this.dataView.getUint32(t,!1)}catch{return null}}parseMpegVersion(t){switch(t){case 0:return"MPEG Version 2.5";case 1:return"Unknown";case 2:return"MPEG Version 2";case 3:return"MPEG Version 1";default:return"Unknown"}}parseLayer(t){switch(t){case 0:return"Unknown";case 1:return"Layer III";case 2:return"Layer II";case 3:return"Layer I";default:return"Unknown"}}parseChannelMode(t){switch(t){case 0:return"Stereo";case 1:return"Joint Stereo";case 2:return"Dual Channel";case 3:return"Mono";default:return"Unknown"}}parseBitrate(t,e,n){var s,l;if(t==="Unknown"||e==="Unknown"||n>15||n<0)return{bitrate:0,isExtended:!1};const a=((l=(s=B.BITRATE_TABLE[t])==null?void 0:s[e])==null?void 0:l[n])||0;return{bitrate:a||0,isExtended:a===0&&n!==0}}parseSampleRate(t,e){var i;if(t==="Unknown"||e>3||e<0)return{sampleRate:0,isExtended:!1};const n=((i=B.SAMPLE_RATE_TABLE[t])==null?void 0:i[e])||0;return{sampleRate:n||0,isExtended:n===0&&e!==3}}validateCrc(t,e){try{const n=this.dataView.getUint16(t+4,!1),a=e&4294967292,i=new Uint8Array(4);i[0]=a>>24&255,i[1]=a>>16&255,i[2]=a>>8&255,i[3]=a&255;const l=new Tt().calculateFrameSize({...H,mpegVersion:this.parseMpegVersion(e>>19&3),layer:this.parseLayer(e>>17&3),bitrate:this.parseBitrate(this.parseMpegVersion(e>>19&3),this.parseLayer(e>>17&3),e>>12&15).bitrate,sampleRate:this.parseSampleRate(this.parseMpegVersion(e>>19&3),e>>10&3).sampleRate,paddingBit:(e>>9&1)===1,isValid:!0})-6;if(l<=0||t+6+l>this.dataView.byteLength)return{isValid:!1,crcValue:n};const c=new Uint8Array(this.dataView.buffer,t+6,l),u=new Uint8Array(4+c.length);u.set(i,0),u.set(c,4);const o=this.calculateCrc16(u);return{isValid:(o^65535)===n,crcValue:n,calculatedCrc:o}}catch(n){return console.error("CRC校验计算失败:",n),{isValid:!1}}}calculateCrc16(t){let e=65535;const n=4129;for(let a=0;a<t.length;a++){e^=t[a]<<8&65280;for(let i=0;i<8;i++)e&32768?e=e<<1^n:e<<=1,e&=65535}return e}};d(B,"SYNC_WORD_MASK",4292870144),d(B,"SYNC_WORD_VALUE",4292870144),d(B,"BITRATE_TABLE",{"MPEG Version 1":{"Layer I":[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,0],"Layer II":[0,32,48,64,80,96,112,128,144,160,176,192,208,224,240,256],"Layer III":[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,0]},"MPEG Version 2":{"Layer I":[0,32,48,64,80,96,112,128,144,160,176,192,208,224,240,256],"Layer II":[0,8,16,24,32,40,48,56,64,80,88,96,112,128,144,160],"Layer III":[0,8,16,24,32,40,48,56,64,80,88,96,112,128,144,160]},"MPEG Version 2.5":{"Layer I":[0,32,48,64,80,96,112,128,144,160,176,192,208,224,240,256],"Layer II":[0,8,16,24,32,40,48,56,64,80,88,96,112,128,144,160],"Layer III":[0,8,16,24,32,40,48,56,64,80,88,96,112,128,144,160]}}),d(B,"SAMPLE_RATE_TABLE",{"MPEG Version 1":[44100,48e3,32e3,0],"MPEG Version 2":[22050,24e3,16e3,0],"MPEG Version 2.5":[11025,12e3,8e3,0],Unknown:[0,0,0,0]});let yt=B;class Tt{calculateFrameSize(t){if(!t.isValid||t.bitrate===0||t.sampleRate===0)return 0;const e=t.bitrate,n=t.sampleRate,a=t.paddingBit?1:0;switch(t.layer){case"Layer I":return Math.floor(12*e*1e3/n+a*4);case"Layer II":case"Layer III":return Math.floor(144*e*1e3/n+a);default:return 0}}calculateFrameDuration(t){if(!t.isValid||t.sampleRate===0)return 0;let e=0;switch(t.layer){case"Layer I":e=384;break;case"Layer II":e=1152;break;case"Layer III":e=t.mpegVersion==="MPEG Version 1"?1152:576;break;default:return 0}return e/t.sampleRate*1e3}}class Se{constructor(t,e,n){d(this,"dataView");d(this,"frameParser");d(this,"audioStartOffset");d(this,"audioEndOffset");this.dataView=new DataView(t),this.frameParser=new yt(t),this.audioStartOffset=Math.max(0,e),this.audioEndOffset=this.dataView.byteLength-(n?128:0)}findAllFramesWithError(){const t=[],e=[];let n=this.audioStartOffset,a=0;for(;n<this.audioEndOffset-4;){a++;const{frameHeader:i,errorDetail:s}=this.frameParser.parseFrameHeaderWithError(n);s?(e.push(s),n+=1):(t.push(i),n+=i.frameSize||1)}return{validFrames:t,totalFrameCount:a,errorFrameDetails:e}}}const lt=class lt{constructor(t,e,n){d(this,"frameFinder");this.frameFinder=new Se(t,e,n)}parseComplete(){const{validFrames:t,totalFrameCount:e,errorFrameDetails:n}=this.frameFinder.findAllFramesWithError(),a=t.find(s=>s.isValid)||H,i={sampleRate:a.sampleRate,bitrate:a.bitrate,channelCount:a.channelMode==="Mono"?1:2,totalDuration:t.reduce((s,l)=>s+l.frameDuration,0),bitDepth:lt.DEFAULT_BIT_DEPTH};return{frameHeader:a,frameCount:e,errorFrameCount:n.length,errorFrameDetails:n,audioBasicInfo:i}}};d(lt,"DEFAULT_BIT_DEPTH",16);let Et=lt;var C;(function(r){r.LOAD="LOAD",r.EXEC="EXEC",r.FFPROBE="FFPROBE",r.WRITE_FILE="WRITE_FILE",r.READ_FILE="READ_FILE",r.DELETE_FILE="DELETE_FILE",r.RENAME="RENAME",r.CREATE_DIR="CREATE_DIR",r.LIST_DIR="LIST_DIR",r.DELETE_DIR="DELETE_DIR",r.ERROR="ERROR",r.DOWNLOAD="DOWNLOAD",r.PROGRESS="PROGRESS",r.LOG="LOG",r.MOUNT="MOUNT",r.UNMOUNT="UNMOUNT"})(C||(C={}));const Le=(()=>{let r=0;return()=>r++})(),Ae=new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first"),xe=new Error("called FFmpeg.terminate()");var P,z,O,G,X,ut,T;class Be{constructor(){k(this,P,null);k(this,z,{});k(this,O,{});k(this,G,[]);k(this,X,[]);d(this,"loaded",!1);k(this,ut,()=>{g(this,P)&&(g(this,P).onmessage=({data:{id:t,type:e,data:n}})=>{switch(e){case C.LOAD:this.loaded=!0,g(this,z)[t](n);break;case C.MOUNT:case C.UNMOUNT:case C.EXEC:case C.FFPROBE:case C.WRITE_FILE:case C.READ_FILE:case C.DELETE_FILE:case C.RENAME:case C.CREATE_DIR:case C.LIST_DIR:case C.DELETE_DIR:g(this,z)[t](n);break;case C.LOG:g(this,G).forEach(a=>a(n));break;case C.PROGRESS:g(this,X).forEach(a=>a(n));break;case C.ERROR:g(this,O)[t](n);break}delete g(this,z)[t],delete g(this,O)[t]})});k(this,T,({type:t,data:e},n=[],a)=>g(this,P)?new Promise((i,s)=>{const l=Le();g(this,P)&&g(this,P).postMessage({id:l,type:t,data:e},n),g(this,z)[l]=i,g(this,O)[l]=s,a==null||a.addEventListener("abort",()=>{s(new DOMException(`Message # ${l} was aborted`,"AbortError"))},{once:!0})}):Promise.reject(Ae));d(this,"load",({classWorkerURL:t,...e}={},{signal:n}={})=>(g(this,P)||(tt(this,P,t?new Worker(new URL(t,import.meta.url),{type:"module"}):new Worker(new URL("/nhanh-frontend-view/assets/worker-BAOIWoxA.js",import.meta.url),{type:"module"})),g(this,ut).call(this)),g(this,T).call(this,{type:C.LOAD,data:e},void 0,n)));d(this,"exec",(t,e=-1,{signal:n}={})=>g(this,T).call(this,{type:C.EXEC,data:{args:t,timeout:e}},void 0,n));d(this,"ffprobe",(t,e=-1,{signal:n}={})=>g(this,T).call(this,{type:C.FFPROBE,data:{args:t,timeout:e}},void 0,n));d(this,"terminate",()=>{const t=Object.keys(g(this,O));for(const e of t)g(this,O)[e](xe),delete g(this,O)[e],delete g(this,z)[e];g(this,P)&&(g(this,P).terminate(),tt(this,P,null),this.loaded=!1)});d(this,"writeFile",(t,e,{signal:n}={})=>{const a=[];return e instanceof Uint8Array&&a.push(e.buffer),g(this,T).call(this,{type:C.WRITE_FILE,data:{path:t,data:e}},a,n)});d(this,"mount",(t,e,n)=>{const a=[];return g(this,T).call(this,{type:C.MOUNT,data:{fsType:t,options:e,mountPoint:n}},a)});d(this,"unmount",t=>{const e=[];return g(this,T).call(this,{type:C.UNMOUNT,data:{mountPoint:t}},e)});d(this,"readFile",(t,e="binary",{signal:n}={})=>g(this,T).call(this,{type:C.READ_FILE,data:{path:t,encoding:e}},void 0,n));d(this,"deleteFile",(t,{signal:e}={})=>g(this,T).call(this,{type:C.DELETE_FILE,data:{path:t}},void 0,e));d(this,"rename",(t,e,{signal:n}={})=>g(this,T).call(this,{type:C.RENAME,data:{oldPath:t,newPath:e}},void 0,n));d(this,"createDir",(t,{signal:e}={})=>g(this,T).call(this,{type:C.CREATE_DIR,data:{path:t}},void 0,e));d(this,"listDir",(t,{signal:e}={})=>g(this,T).call(this,{type:C.LIST_DIR,data:{path:t}},void 0,e));d(this,"deleteDir",(t,{signal:e}={})=>g(this,T).call(this,{type:C.DELETE_DIR,data:{path:t}},void 0,e))}on(t,e){t==="log"?g(this,G).push(e):t==="progress"&&g(this,X).push(e)}off(t,e){t==="log"?tt(this,G,g(this,G).filter(n=>n!==e)):t==="progress"&&tt(this,X,g(this,X).filter(n=>n!==e))}}P=new WeakMap,z=new WeakMap,O=new WeakMap,G=new WeakMap,X=new WeakMap,ut=new WeakMap,T=new WeakMap;var Pt;(function(r){r.MEMFS="MEMFS",r.NODEFS="NODEFS",r.NODERAWFS="NODERAWFS",r.IDBFS="IDBFS",r.WORKERFS="WORKERFS",r.PROXYFS="PROXYFS"})(Pt||(Pt={}));const Me=r=>new Promise((t,e)=>{const n=new FileReader;n.onload=()=>{const{result:a}=n;a instanceof ArrayBuffer?t(new Uint8Array(a)):t(new Uint8Array)},n.onerror=a=>{var i,s;e(Error(`File could not be read! Code=${((s=(i=a==null?void 0:a.target)==null?void 0:i.error)==null?void 0:s.code)||-1}`))},n.readAsArrayBuffer(r)}),Oe=async r=>{let t;if(typeof r=="string")/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(r)?t=atob(r.split(",")[1]).split("").map(e=>e.charCodeAt(0)):t=await(await fetch(r)).arrayBuffer();else if(r instanceof URL)t=await(await fetch(r)).arrayBuffer();else if(r instanceof File||r instanceof Blob)t=await Me(r);else return new Uint8Array;return new Uint8Array(t)},K=new Be;K.load();async function Ue(r,t){const e=r.name,n="output_s16le.pcm";try{await K.writeFile(e,await Oe(r)),await K.exec(["-i",e,"-f","s16le","-acodec","pcm_s16le","-ac",t.channelCount.toString(),"-ar",t.sampleRate.toString(),n]);const a=await K.readFile(n);return typeof a=="string"?(console.warn("PCM 文件读取结果为字符串，转换失败"),null):a.buffer}catch(a){return console.error("MPEG 转 PCM 失败：",a),null}finally{try{await K.deleteFile(e),await K.deleteFile(n)}catch(a){console.warn("清理虚拟文件失败：",a)}}}async function Ve(r){const t=await r.arrayBuffer(),e=t.byteLength,n=Pe(t),a=be(t),i=a?128:0,s=n&&e-n.标签大小-i,l=n&&new Et(t,n.标签大小,!!a).parseComplete(),c={bitDepth:16,bitrate:340,channelCount:2,sampleRate:44100,totalDuration:0},u=(l==null?void 0:l.audioBasicInfo)||c,o=await Ue(r,u);return o?{id3v2:n,id3v1:a,audioSize:s,fileSize:e,mpegAudio:l,pcm:o,audioBasicInfo:u}:null}const Ne={class:"flex-box"},_e={class:"img-box"},ke=J({__name:"audioBasicInfo",props:{isRunning:{type:Boolean},info:{},getMetadata:{type:Function}},setup(r){const t=r,e=W(""),n=Ft([]);function a(){i();const s=t.getMetadata();if(s){const{mp3Info:l}=s;if(l){const{id3v2:c}=l;if(!c)return;const u=c.audioCover;if(n.value=Object.keys(c).filter(o=>{if(/^[\u4e00-\u9fa5]+$/.test(o))return typeof c[o]=="string"}).map(o=>`${o}：${c[o]}`),u&&typeof u=="object"){const o=new Blob([u.data],{type:u.mime});e.value=URL.createObjectURL(o)}}}}function i(){e.value&&URL.revokeObjectURL(e.value),n.value=[],e.value=""}return gt(()=>t.info,a,{immediate:!0}),At(i),(s,l)=>(A(),U("div",Ne,[V("div",{class:Lt([r.isRunning&&"running","record-player"])},[V("div",_e,[e.value?(A(),Ct(f(qt),{key:0,src:e.value},null,8,["src"])):xt("",!0)]),l[0]||(l[0]=V("div",{class:"tonarm-lift"},null,-1))],2),h(f(ft),{vertical:""},{default:m(()=>[h(f(at),null,{default:m(()=>[R(L(r.info.name),1)]),_:1}),h(f(Bt),{style:{"max-height":"100px"}},{default:m(()=>[h(f(ft),null,{default:m(()=>[(A(!0),U(ht,null,Wt(n.value,c=>(A(),Ct(f($),{key:c},{default:m(()=>[c.length>30?(A(),U(ht,{key:0},[R(L(c.slice(0,28))+".. ",1),h(f(st),{type:"info",text:"",onClick:u=>f(zt).success("复制完成").error("复制失败").run(f($t)(c))},{default:m(()=>[h(f(ot),{component:f(Gt)},null,8,["component"])]),_:1},8,["onClick"])],64)):(A(),U(ht,{key:1},[R(L(c),1)],64))]),_:2},1024))),128))]),_:1})]),_:1}),h(f(ft),null,{default:m(()=>[h(f($),{type:"info"},{default:m(()=>[R(L(r.info.type),1)]),_:1}),h(f($),{color:{color:"#8a2be21a",textColor:"#9339E7FF",borderColor:"#9339E7FF"}},{default:m(()=>[R(L(r.info.size),1)]),_:1}),h(f($),{type:"success"},{default:m(()=>[R(L(r.info.totalDuration),1)]),_:1}),h(f($),{type:"warning"},{default:m(()=>[R(L(r.info.sampleRate)+"Hz ",1)]),_:1}),h(f($),null,{default:m(()=>[R(L(r.info.channelCount)+"ch ",1)]),_:1}),h(f($),null,{default:m(()=>[R(L(r.info.bitDepth)+"bit ",1)]),_:1})]),_:1})]),_:1})]))}}),Fe=ct(ke,[["__scopeId","data-v-1bcf6b4f"]]),We={key:0,class:"audio-player-container"},ze={class:"canvas-container"},$e=["id"],Ge={class:"time-container"},St=".mp3,.pcm,.wav",Xe=J({__name:"index",setup(r){const t=vt("audio-player-"),e=vt("file-list-"),n=W(!1),a=W(void 0),i=W([]),s=new Map,l=W(.2),c=W({sampleRate:16e3,bitDepth:16,channelCount:1,startTime:0,duration:0,endianness:M.LE}),u=W(),o=new Ie;o.onPlayCompleted=()=>{n.value=!1},o.playProgressCallback=I=>{u.value.currentTime=q(Number(I))},gt([c,a],async([I,p])=>{if(typeof p=="number"){const E=i.value[p],y=s.get(E.id);u.value=fe(y,0),requestAnimationFrame(async()=>{const b=document.getElementById(t),x=y.pcm;await o.init({canvas:b,pcmData:x,pcmOptions:{volume:l.value,...I}}),u.value.currentTime=q(0),u.value.totalDuration=q(Number(o.totalDuration))})}},{deep:!0}),gt(l,I=>{o.setVolume(I)});function v(){o.play(),n.value=!0}function D(){o.stop(),n.value=!1}async function w(I){const{offsetX:p,target:E}=I,y=E.clientWidth,b=p/y*o.totalDuration;await o.play(b),n.value=!0}function N(I){const{offsetX:p,target:E}=I,y=E,b=y.clientWidth,x=p/b*o.totalDuration;y.dataset.time=q(x),y.style.setProperty("--after-x",p-46/2+"px")}function Z(){if(a.value===void 0)return;const I=i.value[a.value];return s.get(I.id)}function Q(I){const p=y=>St.split(",").some(b=>y.endsWith(b)),E=I.filter(y=>p(y.name));E.length>0?E.forEach(y=>{const b=String(y.lastModified);i.value.push({id:b,name:y.name,status:"finished",file:y})}):window.$message.warning("请拖拽音频文件")}function _(){Yt.get("/nhanh-frontend-view/multimedia/Jay Chou.pcm",{responseType:"blob"}).then(async I=>{const p=new File([I.data],"Jay Chou.pcm"),E=await p.arrayBuffer(),y=String(p.lastModified);s.set(y,{fileName:p.name,fileSize:p.size,audioBasicInfo:{sampleRate:24e3,bitDepth:16,channelCount:2,endianness:M.LE},pcm:E}),i.value.push({id:y,name:p.name,status:"finished"}),nt(i.value.length-1)})}async function nt(I){const p=i.value[I];let E=s.get(p.id);const y=window.$message.loading("解析中... 希望不会太久~",{duration:0}),b=()=>{setTimeout(()=>{y.type="success",y.content="解析完成。久等了~",setTimeout(()=>y.destroy(),3e3)},1e3)},x=S=>{y.type="error",y.content=`解析失败，${S}。额~`,setTimeout(()=>y.destroy(),3e3)};if(!E){const S=p.file;if(!S)return x("数据异常");const it=S.name.lastIndexOf("."),rt=S.name.slice(it+1);if(rt.toLocaleLowerCase()=="mp3"){const Y=await Ve(S);if(Y){const dt=Y.audioBasicInfo;s.set(p.id,{fileName:S.name,fileSize:S.size,audioBasicInfo:{sampleRate:dt.sampleRate,channelCount:dt.channelCount,bitDepth:dt.bitDepth,endianness:M.LE},pcm:Y.pcm,mp3Info:Y})}else return x("MP3文件解析失败")}else if(rt.toLocaleLowerCase()=="pcm"){const Y=await S.arrayBuffer();s.set(p.id,{fileName:S.name,fileSize:S.size,audioBasicInfo:{sampleRate:8e3,channelCount:2,bitDepth:16,endianness:M.LE},pcm:Y})}else return x("敬请期待");E=s.get(p.id)}a.value=I,b(),Object.assign(c.value,E.audioBasicInfo),setTimeout(()=>{document.querySelectorAll(`#${e} .n-upload-file`).forEach((it,rt)=>{it.classList.remove("active"),rt==I&&it.classList.add("active")})},100)}function Mt(I){const p=I.target.closest(".n-button"),E=I.target.closest(".n-upload-file");if(!E)return;const y=document.querySelectorAll(`#${e} .n-upload-file`),b=Array.from(y).findIndex(x=>x===E);if(p){const x=i.value[b];s.delete(x.id),b==a.value&&(a.value=void 0,n.value=!1,o.clear()),u.value=void 0;return}b!=-1&&nt(b)}return Xt(()=>{o.stop()}),At(()=>{o.clear()}),(I,p)=>(A(),Ct(Ce,{onDropCallback:Q},{default:m(()=>[h(jt,{"default-size":.35,min:0},{left:m(()=>[h(f(Bt),null,{default:m(()=>[h(f(Jt),{prefix:"bar"},{default:m(()=>[h(f(at),{type:"success"},{default:m(()=>[p[5]||(p[5]=R(" PCM / MP3 / ",-1)),h(f(at),{type:"warning"},{default:m(()=>[...p[4]||(p[4]=[R("WAV(额~)",-1)])]),_:1}),p[6]||(p[6]=R(" 音频可视化播放器 ",-1))]),_:1})]),_:1}),h(pe,{options:c.value,"onUpdate:options":p[2]||(p[2]=E=>c.value=E),volume:l.value,"onUpdate:volume":p[3]||(p[3]=E=>l.value=E)},{prefix:m(()=>[h(f(Qt),{"file-list":i.value,"onUpdate:fileList":p[0]||(p[0]=E=>i.value=E),abstract:"",accept:St,multiple:""},{default:m(()=>[h(f(Zt),null,{default:m(()=>[h(f(te),{abstract:""},{default:m(({handleClick:E})=>[h(f(st),{type:"info",onClick:E},{icon:m(()=>[h(f(ot),{component:f(ae)},null,8,["component"])]),default:m(()=>[p[7]||(p[7]=R(" 选择或拖入文件 ",-1))]),_:1},8,["onClick"])]),_:1}),h(f(st),{type:"info",ghost:"",onClick:_},{icon:m(()=>[h(f(ot),{component:f(ne)},null,8,["component"])]),default:m(()=>[p[8]||(p[8]=R(" 加载样例 ",-1))]),_:1})]),_:1}),h(f(ee),{id:f(e),onClickCapture:Mt},null,8,["id"])]),_:1},8,["file-list"])]),suffix:m(()=>[h(f(st),{disabled:typeof a.value!="number",type:n.value?"error":"success",ghost:"",onClick:p[1]||(p[1]=E=>n.value?D():v())},{icon:m(()=>[h(f(ot),{component:n.value?f(de):f(oe)},null,8,["component"])]),default:m(()=>[R(" "+L(n.value?"暂停":"播放"),1)]),_:1},8,["disabled","type"])]),_:1},8,["options","volume"])]),_:1})]),right:m(()=>[u.value?(A(),U("div",We,[h(Fe,{"is-running":n.value,info:u.value,getMetadata:Z},null,8,["is-running","info"]),V("div",ze,[V("canvas",{id:f(t)},null,8,$e),V("div",{class:"progress",onMousemove:N,onClick:w},null,32)]),V("div",Ge,[h(f(at),null,{default:m(()=>[R(L(u.value.currentTime),1)]),_:1}),h(f(at),null,{default:m(()=>[R(L(u.value.totalDuration),1)]),_:1})])])):xt("",!0)]),_:1})]),_:1}))}}),pa=ct(Xe,[["__scopeId","data-v-f9a9ae2a"]]);export{pa as default};
