var Zt=Object.defineProperty;var $t=(o,n,t)=>n in o?Zt(o,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[n]=t;var d=(o,n,t)=>$t(o,typeof n!="symbol"?n+"":n,t);import{aQ as Jt,d4 as ut,cg as ft,d5 as Kt,d6 as It,d7 as dt,d8 as At,d9 as Qt,aR as te,da as ee,db as Rt}from"./index-CNq_cRb_.js";/*!
 *  decimal.js v10.5.0
 *  An arbitrary-precision Decimal type for JavaScript.
 *  https://github.com/MikeMcl/decimal.js
 *  Copyright (c) 2025 Michael Mclaughlin <M8ch88l@gmail.com>
 *  MIT Licence
 */var K=9e15,j=1e9,St="0123456789abcdef",mt="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",gt="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",Dt={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-K,maxE:K,crypto:!1},Lt,G,P=!0,vt="[DecimalError] ",U=vt+"Invalid argument: ",_t=vt+"Precision limit exceeded",Tt=vt+"crypto unavailable",Xt="[object Decimal]",H=Math.floor,R=Math.pow,ie=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,se=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,ne=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,Yt=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,L=1e7,x=7,oe=9007199254740991,re=mt.length-1,kt=gt.length-1,p={toStringTag:Xt};p.absoluteValue=p.abs=function(){var o=new this.constructor(this);return o.s<0&&(o.s=1),w(o)};p.ceil=function(){return w(new this.constructor(this),this.e+1,2)};p.clampedTo=p.clamp=function(o,n){var t,e=this,i=e.constructor;if(o=new i(o),n=new i(n),!o.s||!n.s)return new i(NaN);if(o.gt(n))throw Error(U+n);return t=e.cmp(o),t<0?o:e.cmp(n)>0?n:new i(e)};p.comparedTo=p.cmp=function(o){var n,t,e,i,s=this,r=s.d,a=(o=new s.constructor(o)).d,l=s.s,h=o.s;if(!r||!a)return!l||!h?NaN:l!==h?l:r===a?0:!r^l<0?1:-1;if(!r[0]||!a[0])return r[0]?l:a[0]?-h:0;if(l!==h)return l;if(s.e!==o.e)return s.e>o.e^l<0?1:-1;for(e=r.length,i=a.length,n=0,t=e<i?e:i;n<t;++n)if(r[n]!==a[n])return r[n]>a[n]^l<0?1:-1;return e===i?0:e>i^l<0?1:-1};p.cosine=p.cos=function(){var o,n,t=this,e=t.constructor;return t.d?t.d[0]?(o=e.precision,n=e.rounding,e.precision=o+Math.max(t.e,t.sd())+x,e.rounding=1,t=ae(e,qt(e,t)),e.precision=o,e.rounding=n,w(G==2||G==3?t.neg():t,o,n,!0)):new e(1):new e(NaN)};p.cubeRoot=p.cbrt=function(){var o,n,t,e,i,s,r,a,l,h,c=this,u=c.constructor;if(!c.isFinite()||c.isZero())return new u(c);for(P=!1,s=c.s*R(c.s*c,1/3),!s||Math.abs(s)==1/0?(t=E(c.d),o=c.e,(s=(o-t.length+1)%3)&&(t+=s==1||s==-2?"0":"00"),s=R(t,1/3),o=H((o+1)/3)-(o%3==(o<0?-1:2)),s==1/0?t="5e"+o:(t=s.toExponential(),t=t.slice(0,t.indexOf("e")+1)+o),e=new u(t),e.s=c.s):e=new u(s.toString()),r=(o=u.precision)+3;;)if(a=e,l=a.times(a).times(a),h=l.plus(c),e=D(h.plus(c).times(a),h.plus(l),r+2,1),E(a.d).slice(0,r)===(t=E(e.d)).slice(0,r))if(t=t.slice(r-3,r+1),t=="9999"||!i&&t=="4999"){if(!i&&(w(a,o+1,0),a.times(a).times(a).eq(c))){e=a;break}r+=4,i=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(w(e,o+1,1),n=!e.times(e).times(e).eq(c));break}return P=!0,w(e,o,u.rounding,n)};p.decimalPlaces=p.dp=function(){var o,n=this.d,t=NaN;if(n){if(o=n.length-1,t=(o-H(this.e/x))*x,o=n[o],o)for(;o%10==0;o/=10)t--;t<0&&(t=0)}return t};p.dividedBy=p.div=function(o){return D(this,new this.constructor(o))};p.dividedToIntegerBy=p.divToInt=function(o){var n=this,t=n.constructor;return w(D(n,new t(o),0,1,1),t.precision,t.rounding)};p.equals=p.eq=function(o){return this.cmp(o)===0};p.floor=function(){return w(new this.constructor(this),this.e+1,3)};p.greaterThan=p.gt=function(o){return this.cmp(o)>0};p.greaterThanOrEqualTo=p.gte=function(o){var n=this.cmp(o);return n==1||n===0};p.hyperbolicCosine=p.cosh=function(){var o,n,t,e,i,s=this,r=s.constructor,a=new r(1);if(!s.isFinite())return new r(s.s?1/0:NaN);if(s.isZero())return a;t=r.precision,e=r.rounding,r.precision=t+Math.max(s.e,s.sd())+4,r.rounding=1,i=s.d.length,i<32?(o=Math.ceil(i/3),n=(1/wt(4,o)).toString()):(o=16,n="2.3283064365386962890625e-10"),s=tt(r,1,s.times(n),new r(1),!0);for(var l,h=o,c=new r(8);h--;)l=s.times(s),s=a.minus(l.times(c.minus(l.times(c))));return w(s,r.precision=t,r.rounding=e,!0)};p.hyperbolicSine=p.sinh=function(){var o,n,t,e,i=this,s=i.constructor;if(!i.isFinite()||i.isZero())return new s(i);if(n=s.precision,t=s.rounding,s.precision=n+Math.max(i.e,i.sd())+4,s.rounding=1,e=i.d.length,e<3)i=tt(s,2,i,i,!0);else{o=1.4*Math.sqrt(e),o=o>16?16:o|0,i=i.times(1/wt(5,o)),i=tt(s,2,i,i,!0);for(var r,a=new s(5),l=new s(16),h=new s(20);o--;)r=i.times(i),i=i.times(a.plus(r.times(l.times(r).plus(h))))}return s.precision=n,s.rounding=t,w(i,n,t,!0)};p.hyperbolicTangent=p.tanh=function(){var o,n,t=this,e=t.constructor;return t.isFinite()?t.isZero()?new e(t):(o=e.precision,n=e.rounding,e.precision=o+7,e.rounding=1,D(t.sinh(),t.cosh(),e.precision=o,e.rounding=n)):new e(t.s)};p.inverseCosine=p.acos=function(){var o=this,n=o.constructor,t=o.abs().cmp(1),e=n.precision,i=n.rounding;return t!==-1?t===0?o.isNeg()?T(n,e,i):new n(0):new n(NaN):o.isZero()?T(n,e+4,i).times(.5):(n.precision=e+6,n.rounding=1,o=new n(1).minus(o).div(o.plus(1)).sqrt().atan(),n.precision=e,n.rounding=i,o.times(2))};p.inverseHyperbolicCosine=p.acosh=function(){var o,n,t=this,e=t.constructor;return t.lte(1)?new e(t.eq(1)?0:NaN):t.isFinite()?(o=e.precision,n=e.rounding,e.precision=o+Math.max(Math.abs(t.e),t.sd())+4,e.rounding=1,P=!1,t=t.times(t).minus(1).sqrt().plus(t),P=!0,e.precision=o,e.rounding=n,t.ln()):new e(t)};p.inverseHyperbolicSine=p.asinh=function(){var o,n,t=this,e=t.constructor;return!t.isFinite()||t.isZero()?new e(t):(o=e.precision,n=e.rounding,e.precision=o+2*Math.max(Math.abs(t.e),t.sd())+6,e.rounding=1,P=!1,t=t.times(t).plus(1).sqrt().plus(t),P=!0,e.precision=o,e.rounding=n,t.ln())};p.inverseHyperbolicTangent=p.atanh=function(){var o,n,t,e,i=this,s=i.constructor;return i.isFinite()?i.e>=0?new s(i.abs().eq(1)?i.s/0:i.isZero()?i:NaN):(o=s.precision,n=s.rounding,e=i.sd(),Math.max(e,o)<2*-i.e-1?w(new s(i),o,n,!0):(s.precision=t=e-i.e,i=D(i.plus(1),new s(1).minus(i),t+o,1),s.precision=o+4,s.rounding=1,i=i.ln(),s.precision=o,s.rounding=n,i.times(.5))):new s(NaN)};p.inverseSine=p.asin=function(){var o,n,t,e,i=this,s=i.constructor;return i.isZero()?new s(i):(n=i.abs().cmp(1),t=s.precision,e=s.rounding,n!==-1?n===0?(o=T(s,t+4,e).times(.5),o.s=i.s,o):new s(NaN):(s.precision=t+6,s.rounding=1,i=i.div(new s(1).minus(i.times(i)).sqrt().plus(1)).atan(),s.precision=t,s.rounding=e,i.times(2)))};p.inverseTangent=p.atan=function(){var o,n,t,e,i,s,r,a,l,h=this,c=h.constructor,u=c.precision,f=c.rounding;if(h.isFinite()){if(h.isZero())return new c(h);if(h.abs().eq(1)&&u+4<=kt)return r=T(c,u+4,f).times(.25),r.s=h.s,r}else{if(!h.s)return new c(NaN);if(u+4<=kt)return r=T(c,u+4,f).times(.5),r.s=h.s,r}for(c.precision=a=u+10,c.rounding=1,t=Math.min(28,a/x+2|0),o=t;o;--o)h=h.div(h.times(h).plus(1).sqrt().plus(1));for(P=!1,n=Math.ceil(a/x),e=1,l=h.times(h),r=new c(h),i=h;o!==-1;)if(i=i.times(l),s=r.minus(i.div(e+=2)),i=i.times(l),r=s.plus(i.div(e+=2)),r.d[n]!==void 0)for(o=n;r.d[o]===s.d[o]&&o--;);return t&&(r=r.times(2<<t-1)),P=!0,w(r,c.precision=u,c.rounding=f,!0)};p.isFinite=function(){return!!this.d};p.isInteger=p.isInt=function(){return!!this.d&&H(this.e/x)>this.d.length-2};p.isNaN=function(){return!this.s};p.isNegative=p.isNeg=function(){return this.s<0};p.isPositive=p.isPos=function(){return this.s>0};p.isZero=function(){return!!this.d&&this.d[0]===0};p.lessThan=p.lt=function(o){return this.cmp(o)<0};p.lessThanOrEqualTo=p.lte=function(o){return this.cmp(o)<1};p.logarithm=p.log=function(o){var n,t,e,i,s,r,a,l,h=this,c=h.constructor,u=c.precision,f=c.rounding,m=5;if(o==null)o=new c(10),n=!0;else{if(o=new c(o),t=o.d,o.s<0||!t||!t[0]||o.eq(1))return new c(NaN);n=o.eq(10)}if(t=h.d,h.s<0||!t||!t[0]||h.eq(1))return new c(t&&!t[0]?-1/0:h.s!=1?NaN:t?0:1/0);if(n)if(t.length>1)s=!0;else{for(i=t[0];i%10===0;)i/=10;s=i!==1}if(P=!1,a=u+m,r=W(h,a),e=n?pt(c,a+10):W(o,a),l=D(r,e,a,1),it(l.d,i=u,f))do if(a+=10,r=W(h,a),e=n?pt(c,a+10):W(o,a),l=D(r,e,a,1),!s){+E(l.d).slice(i+1,i+15)+1==1e14&&(l=w(l,u+1,0));break}while(it(l.d,i+=10,f));return P=!0,w(l,u,f)};p.minus=p.sub=function(o){var n,t,e,i,s,r,a,l,h,c,u,f,m=this,v=m.constructor;if(o=new v(o),!m.d||!o.d)return!m.s||!o.s?o=new v(NaN):m.d?o.s=-o.s:o=new v(o.d||m.s!==o.s?m:NaN),o;if(m.s!=o.s)return o.s=-o.s,m.plus(o);if(h=m.d,f=o.d,a=v.precision,l=v.rounding,!h[0]||!f[0]){if(f[0])o.s=-o.s;else if(h[0])o=new v(m);else return new v(l===3?-0:0);return P?w(o,a,l):o}if(t=H(o.e/x),c=H(m.e/x),h=h.slice(),s=c-t,s){for(u=s<0,u?(n=h,s=-s,r=f.length):(n=f,t=c,r=h.length),e=Math.max(Math.ceil(a/x),r)+2,s>e&&(s=e,n.length=1),n.reverse(),e=s;e--;)n.push(0);n.reverse()}else{for(e=h.length,r=f.length,u=e<r,u&&(r=e),e=0;e<r;e++)if(h[e]!=f[e]){u=h[e]<f[e];break}s=0}for(u&&(n=h,h=f,f=n,o.s=-o.s),r=h.length,e=f.length-r;e>0;--e)h[r++]=0;for(e=f.length;e>s;){if(h[--e]<f[e]){for(i=e;i&&h[--i]===0;)h[i]=L-1;--h[i],h[e]+=L}h[e]-=f[e]}for(;h[--r]===0;)h.pop();for(;h[0]===0;h.shift())--t;return h[0]?(o.d=h,o.e=yt(h,t),P?w(o,a,l):o):new v(l===3?-0:0)};p.modulo=p.mod=function(o){var n,t=this,e=t.constructor;return o=new e(o),!t.d||!o.s||o.d&&!o.d[0]?new e(NaN):!o.d||t.d&&!t.d[0]?w(new e(t),e.precision,e.rounding):(P=!1,e.modulo==9?(n=D(t,o.abs(),0,3,1),n.s*=o.s):n=D(t,o,0,e.modulo,1),n=n.times(o),P=!0,t.minus(n))};p.naturalExponential=p.exp=function(){return Ot(this)};p.naturalLogarithm=p.ln=function(){return W(this)};p.negated=p.neg=function(){var o=new this.constructor(this);return o.s=-o.s,w(o)};p.plus=p.add=function(o){var n,t,e,i,s,r,a,l,h,c,u=this,f=u.constructor;if(o=new f(o),!u.d||!o.d)return!u.s||!o.s?o=new f(NaN):u.d||(o=new f(o.d||u.s===o.s?u:NaN)),o;if(u.s!=o.s)return o.s=-o.s,u.minus(o);if(h=u.d,c=o.d,a=f.precision,l=f.rounding,!h[0]||!c[0])return c[0]||(o=new f(u)),P?w(o,a,l):o;if(s=H(u.e/x),e=H(o.e/x),h=h.slice(),i=s-e,i){for(i<0?(t=h,i=-i,r=c.length):(t=c,e=s,r=h.length),s=Math.ceil(a/x),r=s>r?s+1:r+1,i>r&&(i=r,t.length=1),t.reverse();i--;)t.push(0);t.reverse()}for(r=h.length,i=c.length,r-i<0&&(i=r,t=c,c=h,h=t),n=0;i;)n=(h[--i]=h[i]+c[i]+n)/L|0,h[i]%=L;for(n&&(h.unshift(n),++e),r=h.length;h[--r]==0;)h.pop();return o.d=h,o.e=yt(h,e),P?w(o,a,l):o};p.precision=p.sd=function(o){var n,t=this;if(o!==void 0&&o!==!!o&&o!==1&&o!==0)throw Error(U+o);return t.d?(n=Bt(t.d),o&&t.e+1>n&&(n=t.e+1)):n=NaN,n};p.round=function(){var o=this,n=o.constructor;return w(new n(o),o.e+1,n.rounding)};p.sine=p.sin=function(){var o,n,t=this,e=t.constructor;return t.isFinite()?t.isZero()?new e(t):(o=e.precision,n=e.rounding,e.precision=o+Math.max(t.e,t.sd())+x,e.rounding=1,t=he(e,qt(e,t)),e.precision=o,e.rounding=n,w(G>2?t.neg():t,o,n,!0)):new e(NaN)};p.squareRoot=p.sqrt=function(){var o,n,t,e,i,s,r=this,a=r.d,l=r.e,h=r.s,c=r.constructor;if(h!==1||!a||!a[0])return new c(!h||h<0&&(!a||a[0])?NaN:a?r:1/0);for(P=!1,h=Math.sqrt(+r),h==0||h==1/0?(n=E(a),(n.length+l)%2==0&&(n+="0"),h=Math.sqrt(n),l=H((l+1)/2)-(l<0||l%2),h==1/0?n="5e"+l:(n=h.toExponential(),n=n.slice(0,n.indexOf("e")+1)+l),e=new c(n)):e=new c(h.toString()),t=(l=c.precision)+3;;)if(s=e,e=s.plus(D(r,s,t+2,1)).times(.5),E(s.d).slice(0,t)===(n=E(e.d)).slice(0,t))if(n=n.slice(t-3,t+1),n=="9999"||!i&&n=="4999"){if(!i&&(w(s,l+1,0),s.times(s).eq(r))){e=s;break}t+=4,i=1}else{(!+n||!+n.slice(1)&&n.charAt(0)=="5")&&(w(e,l+1,1),o=!e.times(e).eq(r));break}return P=!0,w(e,l,c.rounding,o)};p.tangent=p.tan=function(){var o,n,t=this,e=t.constructor;return t.isFinite()?t.isZero()?new e(t):(o=e.precision,n=e.rounding,e.precision=o+10,e.rounding=1,t=t.sin(),t.s=1,t=D(t,new e(1).minus(t.times(t)).sqrt(),o+10,0),e.precision=o,e.rounding=n,w(G==2||G==4?t.neg():t,o,n,!0)):new e(NaN)};p.times=p.mul=function(o){var n,t,e,i,s,r,a,l,h,c=this,u=c.constructor,f=c.d,m=(o=new u(o)).d;if(o.s*=c.s,!f||!f[0]||!m||!m[0])return new u(!o.s||f&&!f[0]&&!m||m&&!m[0]&&!f?NaN:!f||!m?o.s/0:o.s*0);for(t=H(c.e/x)+H(o.e/x),l=f.length,h=m.length,l<h&&(s=f,f=m,m=s,r=l,l=h,h=r),s=[],r=l+h,e=r;e--;)s.push(0);for(e=h;--e>=0;){for(n=0,i=l+e;i>e;)a=s[i]+m[e]*f[i-e-1]+n,s[i--]=a%L|0,n=a/L|0;s[i]=(s[i]+n)%L|0}for(;!s[--r];)s.pop();return n?++t:s.shift(),o.d=s,o.e=yt(s,t),P?w(o,u.precision,u.rounding):o};p.toBinary=function(o,n){return Nt(this,2,o,n)};p.toDecimalPlaces=p.toDP=function(o,n){var t=this,e=t.constructor;return t=new e(t),o===void 0?t:(I(o,0,j),n===void 0?n=e.rounding:I(n,0,8),w(t,o+t.e+1,n))};p.toExponential=function(o,n){var t,e=this,i=e.constructor;return o===void 0?t=X(e,!0):(I(o,0,j),n===void 0?n=i.rounding:I(n,0,8),e=w(new i(e),o+1,n),t=X(e,!0,o+1)),e.isNeg()&&!e.isZero()?"-"+t:t};p.toFixed=function(o,n){var t,e,i=this,s=i.constructor;return o===void 0?t=X(i):(I(o,0,j),n===void 0?n=s.rounding:I(n,0,8),e=w(new s(i),o+i.e+1,n),t=X(e,!1,o+e.e+1)),i.isNeg()&&!i.isZero()?"-"+t:t};p.toFraction=function(o){var n,t,e,i,s,r,a,l,h,c,u,f,m=this,v=m.d,g=m.constructor;if(!v)return new g(m);if(h=t=new g(1),e=l=new g(0),n=new g(e),s=n.e=Bt(v)-m.e-1,r=s%x,n.d[0]=R(10,r<0?x+r:r),o==null)o=s>0?n:h;else{if(a=new g(o),!a.isInt()||a.lt(h))throw Error(U+a);o=a.gt(n)?s>0?n:h:a}for(P=!1,a=new g(E(v)),c=g.precision,g.precision=s=v.length*x*2;u=D(a,n,0,1,1),i=t.plus(u.times(e)),i.cmp(o)!=1;)t=e,e=i,i=h,h=l.plus(u.times(i)),l=i,i=n,n=a.minus(u.times(i)),a=i;return i=D(o.minus(t),e,0,1,1),l=l.plus(i.times(h)),t=t.plus(i.times(e)),l.s=h.s=m.s,f=D(h,e,s,1).minus(m).abs().cmp(D(l,t,s,1).minus(m).abs())<1?[h,e]:[l,t],g.precision=c,P=!0,f};p.toHexadecimal=p.toHex=function(o,n){return Nt(this,16,o,n)};p.toNearest=function(o,n){var t=this,e=t.constructor;if(t=new e(t),o==null){if(!t.d)return t;o=new e(1),n=e.rounding}else{if(o=new e(o),n===void 0?n=e.rounding:I(n,0,8),!t.d)return o.s?t:o;if(!o.d)return o.s&&(o.s=t.s),o}return o.d[0]?(P=!1,t=D(t,o,0,n,1).times(o),P=!0,w(t)):(o.s=t.s,t=o),t};p.toNumber=function(){return+this};p.toOctal=function(o,n){return Nt(this,8,o,n)};p.toPower=p.pow=function(o){var n,t,e,i,s,r,a=this,l=a.constructor,h=+(o=new l(o));if(!a.d||!o.d||!a.d[0]||!o.d[0])return new l(R(+a,h));if(a=new l(a),a.eq(1))return a;if(e=l.precision,s=l.rounding,o.eq(1))return w(a,e,s);if(n=H(o.e/x),n>=o.d.length-1&&(t=h<0?-h:h)<=oe)return i=Gt(l,a,t,e),o.s<0?new l(1).div(i):w(i,e,s);if(r=a.s,r<0){if(n<o.d.length-1)return new l(NaN);if(o.d[n]&1||(r=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=r,a}return t=R(+a,h),n=t==0||!isFinite(t)?H(h*(Math.log("0."+E(a.d))/Math.LN10+a.e+1)):new l(t+"").e,n>l.maxE+1||n<l.minE-1?new l(n>0?r/0:0):(P=!1,l.rounding=a.s=1,t=Math.min(12,(n+"").length),i=Ot(o.times(W(a,e+t)),e),i.d&&(i=w(i,e+5,1),it(i.d,e,s)&&(n=e+10,i=w(Ot(o.times(W(a,n+t)),n),n+5,1),+E(i.d).slice(e+1,e+15)+1==1e14&&(i=w(i,e+1,0)))),i.s=r,P=!0,l.rounding=s,w(i,e,s))};p.toPrecision=function(o,n){var t,e=this,i=e.constructor;return o===void 0?t=X(e,e.e<=i.toExpNeg||e.e>=i.toExpPos):(I(o,1,j),n===void 0?n=i.rounding:I(n,0,8),e=w(new i(e),o,n),t=X(e,o<=e.e||e.e<=i.toExpNeg,o)),e.isNeg()&&!e.isZero()?"-"+t:t};p.toSignificantDigits=p.toSD=function(o,n){var t=this,e=t.constructor;return o===void 0?(o=e.precision,n=e.rounding):(I(o,1,j),n===void 0?n=e.rounding:I(n,0,8)),w(new e(t),o,n)};p.toString=function(){var o=this,n=o.constructor,t=X(o,o.e<=n.toExpNeg||o.e>=n.toExpPos);return o.isNeg()&&!o.isZero()?"-"+t:t};p.truncated=p.trunc=function(){return w(new this.constructor(this),this.e+1,1)};p.valueOf=p.toJSON=function(){var o=this,n=o.constructor,t=X(o,o.e<=n.toExpNeg||o.e>=n.toExpPos);return o.isNeg()?"-"+t:t};function E(o){var n,t,e,i=o.length-1,s="",r=o[0];if(i>0){for(s+=r,n=1;n<i;n++)e=o[n]+"",t=x-e.length,t&&(s+=q(t)),s+=e;r=o[n],e=r+"",t=x-e.length,t&&(s+=q(t))}else if(r===0)return"0";for(;r%10===0;)r/=10;return s+r}function I(o,n,t){if(o!==~~o||o<n||o>t)throw Error(U+o)}function it(o,n,t,e){var i,s,r,a;for(s=o[0];s>=10;s/=10)--n;return--n<0?(n+=x,i=0):(i=Math.ceil((n+1)/x),n%=x),s=R(10,x-n),a=o[i]%s|0,e==null?n<3?(n==0?a=a/100|0:n==1&&(a=a/10|0),r=t<4&&a==99999||t>3&&a==49999||a==5e4||a==0):r=(t<4&&a+1==s||t>3&&a+1==s/2)&&(o[i+1]/s/100|0)==R(10,n-2)-1||(a==s/2||a==0)&&(o[i+1]/s/100|0)==0:n<4?(n==0?a=a/1e3|0:n==1?a=a/100|0:n==2&&(a=a/10|0),r=(e||t<4)&&a==9999||!e&&t>3&&a==4999):r=((e||t<4)&&a+1==s||!e&&t>3&&a+1==s/2)&&(o[i+1]/s/1e3|0)==R(10,n-3)-1,r}function ot(o,n,t){for(var e,i=[0],s,r=0,a=o.length;r<a;){for(s=i.length;s--;)i[s]*=n;for(i[0]+=St.indexOf(o.charAt(r++)),e=0;e<i.length;e++)i[e]>t-1&&(i[e+1]===void 0&&(i[e+1]=0),i[e+1]+=i[e]/t|0,i[e]%=t)}return i.reverse()}function ae(o,n){var t,e,i;if(n.isZero())return n;e=n.d.length,e<32?(t=Math.ceil(e/3),i=(1/wt(4,t)).toString()):(t=16,i="2.3283064365386962890625e-10"),o.precision+=t,n=tt(o,1,n.times(i),new o(1));for(var s=t;s--;){var r=n.times(n);n=r.times(r).minus(r).times(8).plus(1)}return o.precision-=t,n}var D=function(){function o(e,i,s){var r,a=0,l=e.length;for(e=e.slice();l--;)r=e[l]*i+a,e[l]=r%s|0,a=r/s|0;return a&&e.unshift(a),e}function n(e,i,s,r){var a,l;if(s!=r)l=s>r?1:-1;else for(a=l=0;a<s;a++)if(e[a]!=i[a]){l=e[a]>i[a]?1:-1;break}return l}function t(e,i,s,r){for(var a=0;s--;)e[s]-=a,a=e[s]<i[s]?1:0,e[s]=a*r+e[s]-i[s];for(;!e[0]&&e.length>1;)e.shift()}return function(e,i,s,r,a,l){var h,c,u,f,m,v,g,y,C,S,b,k,$,_,J,Z,z,Ct,A,st,nt=e.constructor,Pt=e.s==i.s?1:-1,M=e.d,O=i.d;if(!M||!M[0]||!O||!O[0])return new nt(!e.s||!i.s||(M?O&&M[0]==O[0]:!O)?NaN:M&&M[0]==0||!O?Pt*0:Pt/0);for(l?(m=1,c=e.e-i.e):(l=L,m=x,c=H(e.e/m)-H(i.e/m)),A=O.length,z=M.length,C=new nt(Pt),S=C.d=[],u=0;O[u]==(M[u]||0);u++);if(O[u]>(M[u]||0)&&c--,s==null?(_=s=nt.precision,r=nt.rounding):a?_=s+(e.e-i.e)+1:_=s,_<0)S.push(1),v=!0;else{if(_=_/m+2|0,u=0,A==1){for(f=0,O=O[0],_++;(u<z||f)&&_--;u++)J=f*l+(M[u]||0),S[u]=J/O|0,f=J%O|0;v=f||u<z}else{for(f=l/(O[0]+1)|0,f>1&&(O=o(O,f,l),M=o(M,f,l),A=O.length,z=M.length),Z=A,b=M.slice(0,A),k=b.length;k<A;)b[k++]=0;st=O.slice(),st.unshift(0),Ct=O[0],O[1]>=l/2&&++Ct;do f=0,h=n(O,b,A,k),h<0?($=b[0],A!=k&&($=$*l+(b[1]||0)),f=$/Ct|0,f>1?(f>=l&&(f=l-1),g=o(O,f,l),y=g.length,k=b.length,h=n(g,b,y,k),h==1&&(f--,t(g,A<y?st:O,y,l))):(f==0&&(h=f=1),g=O.slice()),y=g.length,y<k&&g.unshift(0),t(b,g,k,l),h==-1&&(k=b.length,h=n(O,b,A,k),h<1&&(f++,t(b,A<k?st:O,k,l))),k=b.length):h===0&&(f++,b=[0]),S[u++]=f,h&&b[0]?b[k++]=M[Z]||0:(b=[M[Z]],k=1);while((Z++<z||b[0]!==void 0)&&_--);v=b[0]!==void 0}S[0]||S.shift()}if(m==1)C.e=c,Lt=v;else{for(u=1,f=S[0];f>=10;f/=10)u++;C.e=u+c*m-1,w(C,a?s+C.e+1:s,r,v)}return C}}();function w(o,n,t,e){var i,s,r,a,l,h,c,u,f,m=o.constructor;t:if(n!=null){if(u=o.d,!u)return o;for(i=1,a=u[0];a>=10;a/=10)i++;if(s=n-i,s<0)s+=x,r=n,c=u[f=0],l=c/R(10,i-r-1)%10|0;else if(f=Math.ceil((s+1)/x),a=u.length,f>=a)if(e){for(;a++<=f;)u.push(0);c=l=0,i=1,s%=x,r=s-x+1}else break t;else{for(c=a=u[f],i=1;a>=10;a/=10)i++;s%=x,r=s-x+i,l=r<0?0:c/R(10,i-r-1)%10|0}if(e=e||n<0||u[f+1]!==void 0||(r<0?c:c%R(10,i-r-1)),h=t<4?(l||e)&&(t==0||t==(o.s<0?3:2)):l>5||l==5&&(t==4||e||t==6&&(s>0?r>0?c/R(10,i-r):0:u[f-1])%10&1||t==(o.s<0?8:7)),n<1||!u[0])return u.length=0,h?(n-=o.e+1,u[0]=R(10,(x-n%x)%x),o.e=-n||0):u[0]=o.e=0,o;if(s==0?(u.length=f,a=1,f--):(u.length=f+1,a=R(10,x-s),u[f]=r>0?(c/R(10,i-r)%R(10,r)|0)*a:0),h)for(;;)if(f==0){for(s=1,r=u[0];r>=10;r/=10)s++;for(r=u[0]+=a,a=1;r>=10;r/=10)a++;s!=a&&(o.e++,u[0]==L&&(u[0]=1));break}else{if(u[f]+=a,u[f]!=L)break;u[f--]=0,a=1}for(s=u.length;u[--s]===0;)u.pop()}return P&&(o.e>m.maxE?(o.d=null,o.e=NaN):o.e<m.minE&&(o.e=0,o.d=[0])),o}function X(o,n,t){if(!o.isFinite())return Ft(o);var e,i=o.e,s=E(o.d),r=s.length;return n?(t&&(e=t-r)>0?s=s.charAt(0)+"."+s.slice(1)+q(e):r>1&&(s=s.charAt(0)+"."+s.slice(1)),s=s+(o.e<0?"e":"e+")+o.e):i<0?(s="0."+q(-i-1)+s,t&&(e=t-r)>0&&(s+=q(e))):i>=r?(s+=q(i+1-r),t&&(e=t-i-1)>0&&(s=s+"."+q(e))):((e=i+1)<r&&(s=s.slice(0,e)+"."+s.slice(e)),t&&(e=t-r)>0&&(i+1===r&&(s+="."),s+=q(e))),s}function yt(o,n){var t=o[0];for(n*=x;t>=10;t/=10)n++;return n}function pt(o,n,t){if(n>re)throw P=!0,t&&(o.precision=t),Error(_t);return w(new o(mt),n,1,!0)}function T(o,n,t){if(n>kt)throw Error(_t);return w(new o(gt),n,t,!0)}function Bt(o){var n=o.length-1,t=n*x+1;if(n=o[n],n){for(;n%10==0;n/=10)t--;for(n=o[0];n>=10;n/=10)t++}return t}function q(o){for(var n="";o--;)n+="0";return n}function Gt(o,n,t,e){var i,s=new o(1),r=Math.ceil(e/x+4);for(P=!1;;){if(t%2&&(s=s.times(n),Et(s.d,r)&&(i=!0)),t=H(t/2),t===0){t=s.d.length-1,i&&s.d[t]===0&&++s.d[t];break}n=n.times(n),Et(n.d,r)}return P=!0,s}function Vt(o){return o.d[o.d.length-1]&1}function zt(o,n,t){for(var e,i,s=new o(n[0]),r=0;++r<n.length;){if(i=new o(n[r]),!i.s){s=i;break}e=s.cmp(i),(e===t||e===0&&s.s===t)&&(s=i)}return s}function Ot(o,n){var t,e,i,s,r,a,l,h=0,c=0,u=0,f=o.constructor,m=f.rounding,v=f.precision;if(!o.d||!o.d[0]||o.e>17)return new f(o.d?o.d[0]?o.s<0?0:1/0:1:o.s?o.s<0?0:o:NaN);for(n==null?(P=!1,l=v):l=n,a=new f(.03125);o.e>-2;)o=o.times(a),u+=5;for(e=Math.log(R(2,u))/Math.LN10*2+5|0,l+=e,t=s=r=new f(1),f.precision=l;;){if(s=w(s.times(o),l,1),t=t.times(++c),a=r.plus(D(s,t,l,1)),E(a.d).slice(0,l)===E(r.d).slice(0,l)){for(i=u;i--;)r=w(r.times(r),l,1);if(n==null)if(h<3&&it(r.d,l-e,m,h))f.precision=l+=10,t=s=a=new f(1),c=0,h++;else return w(r,f.precision=v,m,P=!0);else return f.precision=v,r}r=a}}function W(o,n){var t,e,i,s,r,a,l,h,c,u,f,m=1,v=10,g=o,y=g.d,C=g.constructor,S=C.rounding,b=C.precision;if(g.s<0||!y||!y[0]||!g.e&&y[0]==1&&y.length==1)return new C(y&&!y[0]?-1/0:g.s!=1?NaN:y?0:g);if(n==null?(P=!1,c=b):c=n,C.precision=c+=v,t=E(y),e=t.charAt(0),Math.abs(s=g.e)<15e14){for(;e<7&&e!=1||e==1&&t.charAt(1)>3;)g=g.times(o),t=E(g.d),e=t.charAt(0),m++;s=g.e,e>1?(g=new C("0."+t),s++):g=new C(e+"."+t.slice(1))}else return h=pt(C,c+2,b).times(s+""),g=W(new C(e+"."+t.slice(1)),c-v).plus(h),C.precision=b,n==null?w(g,b,S,P=!0):g;for(u=g,l=r=g=D(g.minus(1),g.plus(1),c,1),f=w(g.times(g),c,1),i=3;;){if(r=w(r.times(f),c,1),h=l.plus(D(r,new C(i),c,1)),E(h.d).slice(0,c)===E(l.d).slice(0,c))if(l=l.times(2),s!==0&&(l=l.plus(pt(C,c+2,b).times(s+""))),l=D(l,new C(m),c,1),n==null)if(it(l.d,c-v,S,a))C.precision=c+=v,h=r=g=D(u.minus(1),u.plus(1),c,1),f=w(g.times(g),c,1),i=a=1;else return w(l,C.precision=b,S,P=!0);else return C.precision=b,l;l=h,i+=2}}function Ft(o){return String(o.s*o.s/0)}function rt(o,n){var t,e,i;for((t=n.indexOf("."))>-1&&(n=n.replace(".","")),(e=n.search(/e/i))>0?(t<0&&(t=e),t+=+n.slice(e+1),n=n.substring(0,e)):t<0&&(t=n.length),e=0;n.charCodeAt(e)===48;e++);for(i=n.length;n.charCodeAt(i-1)===48;--i);if(n=n.slice(e,i),n){if(i-=e,o.e=t=t-e-1,o.d=[],e=(t+1)%x,t<0&&(e+=x),e<i){for(e&&o.d.push(+n.slice(0,e)),i-=x;e<i;)o.d.push(+n.slice(e,e+=x));n=n.slice(e),e=x-n.length}else e-=i;for(;e--;)n+="0";o.d.push(+n),P&&(o.e>o.constructor.maxE?(o.d=null,o.e=NaN):o.e<o.constructor.minE&&(o.e=0,o.d=[0]))}else o.e=0,o.d=[0];return o}function le(o,n){var t,e,i,s,r,a,l,h,c;if(n.indexOf("_")>-1){if(n=n.replace(/(\d)_(?=\d)/g,"$1"),Yt.test(n))return rt(o,n)}else if(n==="Infinity"||n==="NaN")return+n||(o.s=NaN),o.e=NaN,o.d=null,o;if(se.test(n))t=16,n=n.toLowerCase();else if(ie.test(n))t=2;else if(ne.test(n))t=8;else throw Error(U+n);for(s=n.search(/p/i),s>0?(l=+n.slice(s+1),n=n.substring(2,s)):n=n.slice(2),s=n.indexOf("."),r=s>=0,e=o.constructor,r&&(n=n.replace(".",""),a=n.length,s=a-s,i=Gt(e,new e(t),s,s*2)),h=ot(n,t,L),c=h.length-1,s=c;h[s]===0;--s)h.pop();return s<0?new e(o.s*0):(o.e=yt(h,c),o.d=h,P=!1,r&&(o=D(o,i,a*4)),l&&(o=o.times(Math.abs(l)<54?R(2,l):N.pow(2,l))),P=!0,o)}function he(o,n){var t,e=n.d.length;if(e<3)return n.isZero()?n:tt(o,2,n,n);t=1.4*Math.sqrt(e),t=t>16?16:t|0,n=n.times(1/wt(5,t)),n=tt(o,2,n,n);for(var i,s=new o(5),r=new o(16),a=new o(20);t--;)i=n.times(n),n=n.times(s.plus(i.times(r.times(i).minus(a))));return n}function tt(o,n,t,e,i){var s,r,a,l,h=o.precision,c=Math.ceil(h/x);for(P=!1,l=t.times(t),a=new o(e);;){if(r=D(a.times(l),new o(n++*n++),h,1),a=i?e.plus(r):e.minus(r),e=D(r.times(l),new o(n++*n++),h,1),r=a.plus(e),r.d[c]!==void 0){for(s=c;r.d[s]===a.d[s]&&s--;);if(s==-1)break}s=a,a=e,e=r,r=s}return P=!0,r.d.length=c+1,r}function wt(o,n){for(var t=o;--n;)t*=o;return t}function qt(o,n){var t,e=n.s<0,i=T(o,o.precision,1),s=i.times(.5);if(n=n.abs(),n.lte(s))return G=e?4:1,n;if(t=n.divToInt(i),t.isZero())G=e?3:2;else{if(n=n.minus(t.times(i)),n.lte(s))return G=Vt(t)?e?2:3:e?4:1,n;G=Vt(t)?e?1:4:e?3:2}return n.minus(i).abs()}function Nt(o,n,t,e){var i,s,r,a,l,h,c,u,f,m=o.constructor,v=t!==void 0;if(v?(I(t,1,j),e===void 0?e=m.rounding:I(e,0,8)):(t=m.precision,e=m.rounding),!o.isFinite())c=Ft(o);else{for(c=X(o),r=c.indexOf("."),v?(i=2,n==16?t=t*4-3:n==8&&(t=t*3-2)):i=n,r>=0&&(c=c.replace(".",""),f=new m(1),f.e=c.length-r,f.d=ot(X(f),10,i),f.e=f.d.length),u=ot(c,10,i),s=l=u.length;u[--l]==0;)u.pop();if(!u[0])c=v?"0p+0":"0";else{if(r<0?s--:(o=new m(o),o.d=u,o.e=s,o=D(o,f,t,e,0,i),u=o.d,s=o.e,h=Lt),r=u[t],a=i/2,h=h||u[t+1]!==void 0,h=e<4?(r!==void 0||h)&&(e===0||e===(o.s<0?3:2)):r>a||r===a&&(e===4||h||e===6&&u[t-1]&1||e===(o.s<0?8:7)),u.length=t,h)for(;++u[--t]>i-1;)u[t]=0,t||(++s,u.unshift(1));for(l=u.length;!u[l-1];--l);for(r=0,c="";r<l;r++)c+=St.charAt(u[r]);if(v){if(l>1)if(n==16||n==8){for(r=n==16?4:3,--l;l%r;l++)c+="0";for(u=ot(c,i,n),l=u.length;!u[l-1];--l);for(r=1,c="1.";r<l;r++)c+=St.charAt(u[r])}else c=c.charAt(0)+"."+c.slice(1);c=c+(s<0?"p":"p+")+s}else if(s<0){for(;++s;)c="0"+c;c="0."+c}else if(++s>l)for(s-=l;s--;)c+="0";else s<l&&(c=c.slice(0,s)+"."+c.slice(s))}c=(n==16?"0x":n==2?"0b":n==8?"0o":"")+c}return o.s<0?"-"+c:c}function Et(o,n){if(o.length>n)return o.length=n,!0}function ce(o){return new this(o).abs()}function ue(o){return new this(o).acos()}function fe(o){return new this(o).acosh()}function de(o,n){return new this(o).plus(n)}function me(o){return new this(o).asin()}function ge(o){return new this(o).asinh()}function pe(o){return new this(o).atan()}function ve(o){return new this(o).atanh()}function ye(o,n){o=new this(o),n=new this(n);var t,e=this.precision,i=this.rounding,s=e+4;return!o.s||!n.s?t=new this(NaN):!o.d&&!n.d?(t=T(this,s,1).times(n.s>0?.25:.75),t.s=o.s):!n.d||o.isZero()?(t=n.s<0?T(this,e,i):new this(0),t.s=o.s):!o.d||n.isZero()?(t=T(this,s,1).times(.5),t.s=o.s):n.s<0?(this.precision=s,this.rounding=1,t=this.atan(D(o,n,s,1)),n=T(this,s,1),this.precision=e,this.rounding=i,t=o.s<0?t.minus(n):t.plus(n)):t=this.atan(D(o,n,s,1)),t}function we(o){return new this(o).cbrt()}function xe(o){return w(o=new this(o),o.e+1,2)}function Ce(o,n,t){return new this(o).clamp(n,t)}function Pe(o){if(!o||typeof o!="object")throw Error(vt+"Object expected");var n,t,e,i=o.defaults===!0,s=["precision",1,j,"rounding",0,8,"toExpNeg",-K,0,"toExpPos",0,K,"maxE",0,K,"minE",-K,0,"modulo",0,9];for(n=0;n<s.length;n+=3)if(t=s[n],i&&(this[t]=Dt[t]),(e=o[t])!==void 0)if(H(e)===e&&e>=s[n+1]&&e<=s[n+2])this[t]=e;else throw Error(U+t+": "+e);if(t="crypto",i&&(this[t]=Dt[t]),(e=o[t])!==void 0)if(e===!0||e===!1||e===0||e===1)if(e)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(Tt);else this[t]=!1;else throw Error(U+t+": "+e);return this}function be(o){return new this(o).cos()}function Se(o){return new this(o).cosh()}function Wt(o){var n,t,e;function i(s){var r,a,l,h=this;if(!(h instanceof i))return new i(s);if(h.constructor=i,Mt(s)){h.s=s.s,P?!s.d||s.e>i.maxE?(h.e=NaN,h.d=null):s.e<i.minE?(h.e=0,h.d=[0]):(h.e=s.e,h.d=s.d.slice()):(h.e=s.e,h.d=s.d?s.d.slice():s.d);return}if(l=typeof s,l==="number"){if(s===0){h.s=1/s<0?-1:1,h.e=0,h.d=[0];return}if(s<0?(s=-s,h.s=-1):h.s=1,s===~~s&&s<1e7){for(r=0,a=s;a>=10;a/=10)r++;P?r>i.maxE?(h.e=NaN,h.d=null):r<i.minE?(h.e=0,h.d=[0]):(h.e=r,h.d=[s]):(h.e=r,h.d=[s]);return}if(s*0!==0){s||(h.s=NaN),h.e=NaN,h.d=null;return}return rt(h,s.toString())}if(l==="string")return(a=s.charCodeAt(0))===45?(s=s.slice(1),h.s=-1):(a===43&&(s=s.slice(1)),h.s=1),Yt.test(s)?rt(h,s):le(h,s);if(l==="bigint")return s<0?(s=-s,h.s=-1):h.s=1,rt(h,s.toString());throw Error(U+s)}if(i.prototype=p,i.ROUND_UP=0,i.ROUND_DOWN=1,i.ROUND_CEIL=2,i.ROUND_FLOOR=3,i.ROUND_HALF_UP=4,i.ROUND_HALF_DOWN=5,i.ROUND_HALF_EVEN=6,i.ROUND_HALF_CEIL=7,i.ROUND_HALF_FLOOR=8,i.EUCLID=9,i.config=i.set=Pe,i.clone=Wt,i.isDecimal=Mt,i.abs=ce,i.acos=ue,i.acosh=fe,i.add=de,i.asin=me,i.asinh=ge,i.atan=pe,i.atanh=ve,i.atan2=ye,i.cbrt=we,i.ceil=xe,i.clamp=Ce,i.cos=be,i.cosh=Se,i.div=De,i.exp=ke,i.floor=Oe,i.hypot=Ne,i.ln=Re,i.log=Ve,i.log10=Me,i.log2=Ee,i.max=He,i.min=Ie,i.mod=Ae,i.mul=Le,i.pow=_e,i.random=Te,i.round=Xe,i.sign=Ye,i.sin=Be,i.sinh=Ge,i.sqrt=ze,i.sub=Fe,i.sum=qe,i.tan=We,i.tanh=Ue,i.trunc=je,o===void 0&&(o={}),o&&o.defaults!==!0)for(e=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],n=0;n<e.length;)o.hasOwnProperty(t=e[n++])||(o[t]=this[t]);return i.config(o),i}function De(o,n){return new this(o).div(n)}function ke(o){return new this(o).exp()}function Oe(o){return w(o=new this(o),o.e+1,3)}function Ne(){var o,n,t=new this(0);for(P=!1,o=0;o<arguments.length;)if(n=new this(arguments[o++]),n.d)t.d&&(t=t.plus(n.times(n)));else{if(n.s)return P=!0,new this(1/0);t=n}return P=!0,t.sqrt()}function Mt(o){return o instanceof N||o&&o.toStringTag===Xt||!1}function Re(o){return new this(o).ln()}function Ve(o,n){return new this(o).log(n)}function Ee(o){return new this(o).log(2)}function Me(o){return new this(o).log(10)}function He(){return zt(this,arguments,-1)}function Ie(){return zt(this,arguments,1)}function Ae(o,n){return new this(o).mod(n)}function Le(o,n){return new this(o).mul(n)}function _e(o,n){return new this(o).pow(n)}function Te(o){var n,t,e,i,s=0,r=new this(1),a=[];if(o===void 0?o=this.precision:I(o,1,j),e=Math.ceil(o/x),this.crypto)if(crypto.getRandomValues)for(n=crypto.getRandomValues(new Uint32Array(e));s<e;)i=n[s],i>=429e7?n[s]=crypto.getRandomValues(new Uint32Array(1))[0]:a[s++]=i%1e7;else if(crypto.randomBytes){for(n=crypto.randomBytes(e*=4);s<e;)i=n[s]+(n[s+1]<<8)+(n[s+2]<<16)+((n[s+3]&127)<<24),i>=214e7?crypto.randomBytes(4).copy(n,s):(a.push(i%1e7),s+=4);s=e/4}else throw Error(Tt);else for(;s<e;)a[s++]=Math.random()*1e7|0;for(e=a[--s],o%=x,e&&o&&(i=R(10,x-o),a[s]=(e/i|0)*i);a[s]===0;s--)a.pop();if(s<0)t=0,a=[0];else{for(t=-1;a[0]===0;t-=x)a.shift();for(e=1,i=a[0];i>=10;i/=10)e++;e<x&&(t-=x-e)}return r.e=t,r.d=a,r}function Xe(o){return w(o=new this(o),o.e+1,this.rounding)}function Ye(o){return o=new this(o),o.d?o.d[0]?o.s:0*o.s:o.s||NaN}function Be(o){return new this(o).sin()}function Ge(o){return new this(o).sinh()}function ze(o){return new this(o).sqrt()}function Fe(o,n){return new this(o).sub(n)}function qe(){var o=0,n=arguments,t=new this(n[o]);for(P=!1;t.s&&++o<n.length;)t=t.plus(n[o]);return P=!0,w(t,this.precision,this.rounding)}function We(o){return new this(o).tan()}function Ue(o){return new this(o).tanh()}function je(o){return w(o=new this(o),o.e+1,1)}p[Symbol.for("nodejs.util.inspect.custom")]=p.toString;p[Symbol.toStringTag]="Decimal";var N=p.constructor=Wt(Dt);mt=new N(mt);gt=new N(gt);function Ht(o){const t=o.toString().split("."),e=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,",");return t.length>1?e+"."+t[1]:e}class Ze{constructor(n){d(this,"canvas");d(this,"axis_canvas",document.createElement("canvas"));d(this,"ctx",this.axis_canvas.getContext("2d"));d(this,"isReload",!1);d(this,"show",{all:!0,grid:{main:!0,secondary:!0},axis:!0,axisText:!0});this.canvas=n,this.initAxisCanvas()}initAxisCanvas(){var e,i;const{canvas:n,axis_canvas:t}=this;n&&(t.width=((e=n.rect)==null?void 0:e.value.width)||0,t.height=((i=n.rect)==null?void 0:i.value.height)||0)}toggleAxis(n){const t=(()=>{if(typeof n=="object"){const{all:e=!0,grid:i={main:!0,secondary:!0},axis:s=!0,axisText:r=!0}=n;return Object.assign({main:!0,secondary:!0},i),{all:e,grid:i,axis:s,axisText:r}}return typeof n=="boolean"?{all:!0,grid:{main:n,secondary:n},axis:n,axisText:n}:!this.show.all})();typeof t=="boolean"?this.show.all=t:this.show=t,this.isReload=!0}drawAxisAndGrid(){if(!(!this.canvas||!this.show.all))return(this.canvas.isRecalculate||this.isReload||this.canvas.isThemeUpdated)&&(this.isReload=!1,this.initAxisCanvas(),(this.show.grid.main||this.show.grid.secondary)&&this.drawGrid(),this.show.axis&&this.drawAxis(),this.show.axisText&&this.drawAxisText()),this.axis_canvas}color(){const{theme:n,style:t}=this.canvas;return(t[n]||t.light).grid}drawGrid(){const{canvas:n,ctx:t}=this,{rect:e,center:i,axisConfig:s}=n,{width:r,height:a}=e.value,l=this.color(),h=s.size,c=h/5;t.lineWidth=1;const u=(m,v)=>{const g=i.x%m>0?i.x%m:m+i.x%m;t.strokeStyle=v,t.beginPath();for(let y=0;y*m+g<=r;y++)t.moveTo(y*m+g,0),t.lineTo(y*m+g,a);t.stroke()},f=(m,v)=>{const g=i.y%m>0?i.y%m:m+i.y%m;t.strokeStyle=v,t.beginPath();for(let y=0;y*m+g<=a;y++)t.moveTo(0,y*m+g),t.lineTo(r,y*m+g);t.stroke()};this.show.grid.secondary&&(u(c,l.innerGrid),f(c,l.innerGrid)),this.show.grid.main&&(u(h,l.grid),f(h,l.grid))}drawAxis(){const{canvas:n,ctx:t}=this,{rect:e,center:i}=n,{width:s,height:r}=e.value,a=this.color();t.lineWidth=2,t.strokeStyle=a.axis;const l=()=>{i.y>=0&&i.y<=r&&(t.beginPath(),t.moveTo(0,i.y),t.lineTo(s,i.y),t.stroke())},h=()=>{i.x>=0&&i.x<=s&&(t.beginPath(),t.moveTo(i.x,0),t.lineTo(i.x,r),t.stroke())};l(),h()}drawText(n,t,e,i){const{canvas:s,ctx:r}=this,{theme:a}=s,l=this.canvas.style[a].text;r.font=`${l.bold?"bold":""} ${l.size}px ${l.family}`,r.strokeStyle=l.stroke,![n,t,e].includes(void 0)&&r.strokeText(n,t,e),r.fillStyle=l[i?"secondary":"color"],![n,t,e].includes(void 0)&&r.fillText(n,t,e)}drawAxisText(){const{canvas:n,ctx:t}=this,{rect:e,center:i,axisConfig:s,style:r,theme:a}=n,{width:l,height:h}=e.value;this.drawText();const c=g=>Math.ceil(t.measureText(g).width),u=4,f=r[a].text.size;{const g=c("0"),y=i.x<u||i.x>l+g+u,C=i.y<-(u+f)||i.y>h+f+u;!y&&!C&&this.drawText("0",i.x-g-u,i.y+f+u)}const m=n.getNowGridCount,v=s.size;{let g=i.y+f+u;g=Math.max(Math.min(g,h-u),u+f);const y=i.y>h||i.y<0;let C=i.x>0?i.x%v:i.x<0?v+i.x%v:0,S=n.getAxisValueByPoint((C-i.x)*s.x,0).xV;for(;C<=l;){const b=Ht(S),k=c(b);S!==0&&this.drawText(b,C-k/2,g,y),C+=v,S=new N(m).mul(s.x).add(S).toNumber()}}{const g=i.x>l||i.x<0;let y=i.y>0?i.y%v:i.y<0?v+i.y%v:0,C=n.getAxisValueByPoint(0,(y-i.y)*s.y).yV;for(;y<=h;){const S=Ht(C),b=c(S);let k=i.x-b-u;k=Math.max(Math.min(k,l-b-u),u),C!=0&&this.drawText(S,k,y+f/2,g),y+=v,C=new N(m).mul(s.y).add(C).toNumber()}}}}class $e{constructor(n){d(this,"parent");d(this,"_isInteractive",!0);d(this,"_isHoverable",!0);d(this,"_isDownable",!0);d(this,"_isContextmenuable",!0);d(this,"_isClickable",!0);d(this,"_isDoubleClickable",!0);d(this,"_isDraggable",!0);d(this,"_isScaleable",!0);Object.assign(this,{...n})}get isInteractive(){return this.getPropValue("isInteractive",this._isInteractive,!1)}set isInteractive(n){this._isInteractive=n}get isHoverable(){return this.getPropValue("isHoverable",this._isHoverable)}set isHoverable(n){this._isHoverable=n}get isDownable(){return this.getPropValue("isDownable",this._isDownable)}set isDownable(n){this._isDownable=n}get isContextmenuable(){return this.getPropValue("isContextmenuable",this._isContextmenuable)}set isContextmenuable(n){this._isContextmenuable=n}get isClickable(){return this.getPropValue("isClickable",this._isClickable)}set isClickable(n){this._isClickable=n}get isDoubleClickable(){return this.getPropValue("isDoubleClickable",this._isDoubleClickable)}set isDoubleClickable(n){this._isDoubleClickable=n}get isDraggable(){return this.getPropValue("isDraggable",this._isDraggable)}set isDraggable(n){this._isDraggable=n}get isScaleable(){return this.getPropValue("isScaleable",this._isScaleable)}set isScaleable(n){this._isScaleable=n}getPropValue(n,t,e=!0){return(this.parent?this.parent[n]:!0)&&t&&(e?this.isInteractive:!0)}}class Je{constructor(n){d(this,"propagationStopped",!1);this.data=n}stopPropagation(){this.propagationStopped=!0}get canPropagate(){return!this.propagationStopped}}class Ut extends $e{constructor(){super(...arguments);d(this,"listeners",{hover:new Set,down:new Set,contextmenu:new Set,click:new Set,doubleClick:new Set,dragg:new Set});d(this,"sharedControllers",{});d(this,"_eventDate",{});d(this,"_clearEventDate",!1);d(this,"_isHover",!1);d(this,"notifyHover",(t,e)=>this.checkEventDate("hover",t)&&this.trigger("hover",{state:t,oldState:this.isHover},e,"isHoverable"));d(this,"_isDown",!1);d(this,"notifyDown",(t,e)=>this.checkEventDate("down",t)&&this.trigger("down",{state:t,oldState:this.isDown},e,"isDownable"));d(this,"_isContextmenu",!1);d(this,"notifyContextmenu",(t,e)=>this.checkEventDate("contextmenu",t)&&this.trigger("contextmenu",{state:t,oldState:this.isContextmenu},e,"isContextmenuable"));d(this,"_isClick",!1);d(this,"clickTimestamp",0);d(this,"doubleClickInterval",300);d(this,"notifyClick",(t,e)=>{if(!this.checkEventDate("click",t))return;let i=!1;t?(i=Date.now()-this.clickTimestamp<this.doubleClickInterval,this.clickTimestamp=i?0:Date.now()):(this._isDblClick=!1,this.clickTimestamp=0),i?this.notifyDoubleClick(i,e):this.trigger("click",{state:t,oldState:this.isClick},e,"isClickable")});d(this,"_isDblClick",!1);d(this,"notifyDoubleClick",(t,e)=>this.checkEventDate("doubleClick",t)&&this.trigger("doubleClick",{state:t,oldState:this.isDblClick},e,"isDoubleClickable"));d(this,"notifyDragg",(t,e)=>this.checkEventDate("dragg",t)&&this.trigger("dragg",t,e,"isDraggable"))}addEventListener(t,e){this.listeners[t].add(e)}removeEventListener(t,e){this.listeners[t].delete(e)}registerControllers(t,e){this.sharedControllers[t]=e}hasController(t,e){var i;return(i=this.sharedControllers[t])==null?void 0:i.includes(e)}trigger(t,e,i,s){var h,c;if(!this[s])return;this.updateStates(t,e);const r=new Je(e);this.listeners[t].forEach(u=>u(r,i));const a="notify"+(t.charAt(0).toUpperCase()+t.slice(1)),l=a=="notifyDragg"?e:e.state;r.canPropagate&&((h=this.parent)==null||h[a](l,i)),(c=this.sharedControllers[t])==null||c.forEach(u=>u!==this&&u[a](l,i))}updateStates(t,e){const i=e;switch(t){case"hover":this._isHover=i.state;break;case"down":this._isDown=i.state;break;case"contextmenu":this._isContextmenu=i.state;break;case"click":this._isClick=i.state;break;case"doubleClick":this._isDblClick=i.state;break}}checkEventDate(t,e){const i=this._eventDate[t],s=JSON.stringify(e);return i==s?!1:(this._eventDate[t]=s,this._clearEventDate||(this._clearEventDate=!0,Promise.resolve().then(()=>{this._clearEventDate=!1,this._eventDate={}})),!0)}get isHover(){return this.isHoverable&&this._isHover}get isDown(){return this.isDraggable&&this._isDown}get isContextmenu(){return this.isClickable&&this._isContextmenu}get isClick(){return this.isClickable&&this._isClick}get isDblClick(){return this.isDoubleClickable&&this._isDblClick}}class Ke{constructor(){d(this,"_isVisible",!0);d(this,"_scaleRange");d(this,"notifyReload")}get isVisible(){return this._isVisible}set isVisible(n){var t;n!=this.isVisible&&(this.isVisible=n,(t=this.notifyReload)==null||t.call(this,!0))}get scaleRange(){return this._scaleRange}set scaleRange(n){var t;n!=this.scaleRange&&(this._scaleRange=n,this.isVisible&&((t=this.notifyReload)==null||t.call(this)))}shouldRender(n,t){if(!this.isVisible||n===void 0||t===0)return!1;if(this.scaleRange){const e=Math.min(...this.scaleRange),i=Math.max(...this.scaleRange);return n>=e&&n<=i}return!0}}class xt extends Ut{constructor(t){super(t);d(this,"name","");d(this,"extData");d(this,"show",new Ke);d(this,"mainCanvas");d(this,"notifyReload");t.name=t.name||Jt("default-name-");const{name:e,extData:i,mainCanvas:s}=t;Object.assign(this,{name:e,extData:i,mainCanvas:s})}equalsMainCanvas(t){return this.mainCanvas===t}setMainCanvas(t){this.mainCanvas=t}}class V extends xt{constructor(t){t.isDraggable=t.isDraggable??!1;super(t);d(this,"style");d(this,"position");d(this,"value");d(this,"zIndex",0);d(this,"dynamicPosition");d(this,"path");d(this,"staticValueScope");d(this,"valueScope");d(this,"extraOffset",{x:0,y:0,xV:0,yV:0});d(this,"lastPointRadius",{value:0,radius:0});d(this,"redrawOnIsHoverChange",!1);d(this,"defaultHover",(t,e)=>{var i;this.redrawOnIsHoverChange&&((i=this.notifyReload)==null||i.call(this))});const{extraOffset:e,notifyReload:i,style:s,zIndex:r=0,position:a,dynamicPosition:l,value:h,redrawOnIsHoverChange:c}=t;this.setExtraOffset(e,!1),this.setNotifyReload(i),Object.assign(this,{style:s,zIndex:r,position:a,dynamicPosition:l,value:h,redrawOnIsHoverChange:c}),this.addEventListener("hover",this.defaultHover)}setMainCanvas(t){super.setMainCanvas(t),t&&this.updateBaseData()}setNotifyReload(t){this.notifyReload=t?e=>{var i;(e||this.show.shouldRender((i=this.mainCanvas)==null?void 0:i.scale))&&t()}:void 0,this.show.notifyReload=this.notifyReload}initValueScope(){const t=this.value;if(Array.isArray(t[0])){let e=1/0,i=-1/0,s=1/0,r=-1/0;t.forEach(([a,l])=>{e=Math.min(e,a),i=Math.max(i,a),s=Math.min(s,l),r=Math.max(r,l)}),this.valueScope={minX:e,maxX:i,minY:s,maxY:r}}else{const[e,i]=t;this.valueScope={minX:e,maxX:e,minY:i,maxY:i}}this.staticValueScope={...this.valueScope}}setExtraOffset(t,e=!0){var l;if(t=t||{x:0,y:0},!this.valueScope)return Object.assign(this.extraOffset,t);const{xV:i,yV:s}=this.mainCanvas.getAxisValueByPoint(t.x,t.y),r=i-this.extraOffset.xV,a=s-this.extraOffset.yV;this.valueScope.minX-=r,this.valueScope.maxX+=r,this.valueScope.minY-=a,this.valueScope.maxY+=a,Object.assign(this.extraOffset,t,{xV:i,yV:s}),e&&((l=this.notifyReload)==null||l.call(this))}calculatePointRadiusValue(t){if(!this.valueScope)return;const e=t?t.radius+t.width/2:this.lastPointRadius.radius,i=this.mainCanvas.getAxisValueByPoint(e,0).xV,s=i-this.lastPointRadius.value;this.valueScope.minX-=s,this.valueScope.maxX+=s,this.valueScope.minY-=s,this.valueScope.maxY+=s,this.lastPointRadius={radius:e,value:i}}calculateOffset(t,e){const{percentage:i,axisConfig:s}=this.mainCanvas,r=s.count/s.min/i,a={value:t*r*s.x,position:t/i*s.x,dynamicPosition:t*s.x},l={value:e*r*s.y,position:e/i*s.y,dynamicPosition:e*s.y};return{x:a,y:l}}isPointInAnywhere(t,e){return this.isPointInPath(t,e)||this.isPointInStroke(t,e)}setStyle(t){var e;this.style=t,this.dynamicPosition&&((e=this.notifyReload)==null||e.call(this))}setZIndex(t){var e;this.zIndex=t,this.dynamicPosition&&((e=this.notifyReload)==null||e.call(this))}setPosition(t){var i;this.position=t,this.value=void 0;const e=!!this.dynamicPosition;this.updateBaseData(),(this.dynamicPosition||e)&&((i=this.notifyReload)==null||i.call(this))}setValue(t){var i;this.value=t,this.position=void 0;const e=!!this.dynamicPosition;this.updateBaseData(),(this.dynamicPosition||e)&&((i=this.notifyReload)==null||i.call(this))}}d(V,"ctx",document.createElement("canvas").getContext("2d"));class at extends V{constructor(t){t.redrawOnIsHoverChange=t.redrawOnIsHoverChange??!0;super(t);d(this,"textOffset",{x:0,y:0});d(this,"text");d(this,"defaultDragg",(t,e)=>{var l;const{offsetX:i,offsetY:s}=t.data,{x:r,y:a}=this.calculateOffset(i,s);this.value=[this.value[0]+r.value,this.value[1]+a.value],this.position=[this.position[0]+r.position,this.position[1]+a.position],this.dynamicPosition=[this.dynamicPosition[0]+r.dynamicPosition,this.dynamicPosition[1]+a.dynamicPosition],this.updateValueScope(),(l=this.notifyReload)==null||l.call(this)});const{text:e}=t;Object.assign(this,{text:e}),this.addEventListener("dragg",this.defaultDragg)}updateValueScope(){const{textOffset:t,value:e}=this,{xV:i,yV:s}=this.mainCanvas.getAxisValueByPoint(t.x*2,t.y*2);this.valueScope={minX:e[0]-i/2,maxX:e[0]+i/2,minY:e[1]-s/2,maxY:e[1]+s/2},this.staticValueScope={minX:e[0],maxX:e[0],minY:e[1],maxY:e[1]},this.setExtraOffset(this.extraOffset,!1)}isPointInPath(t,e){return this.path?V.ctx.isPointInPath(this.path,t,e):!1}isPointInStroke(t,e){return!1}updateBaseData(){if(!this.mainCanvas)return;if(!this.text||this.text.length==0)return this.dynamicPosition=void 0;let{value:t,position:e}=this;const[i,s]=[ut(t),ut(e)];if(!i&&!s)return this.dynamicPosition=void 0;if(i){const h=this.mainCanvas.getAxisPointByValue(t[0],t[1],!0);e=[h.x,h.y]}else{const h=this.mainCanvas.getAxisValueByPoint(e[0],e[1],!0);t=[h.xV,h.yV]}const r=this.mainCanvas.transformPosition([e])[0];this.dynamicPosition=r,this.value=t,this.position=e;const a=this.mainCanvas.ctx;this.setCanvasStyles(a);const l=a.measureText(this.text);this.textOffset={x:l.width/2,y:l.actualBoundingBoxAscent/2},this.updateValueScope()}setText(t){var e;t!=this.text&&(this.text=t,this.updateBaseData(),this.dynamicPosition&&((e=this.notifyReload)==null||e.call(this)))}setCanvasStyles(t){var r;const e=this.mainCanvas,i=e.style[e.theme].text;let s={};typeof this.style=="string"?s=((r=e.style[this.style])==null?void 0:r.text)||i:typeof this.style=="object"?s=Object.assign({},i,this.style):s=i,t.font=`${s.bold?"bold":""} ${s.size}px ${s.family}`,t.lineWidth=2,t.strokeStyle=s.stroke,t.fillStyle=s[this.isHover?"secondary":"color"]}draw(t){if(!this.mainCanvas)return;const e=this.dynamicPosition,i=this.textOffset,s=this.text,r=this.extraOffset;this.setCanvasStyles(t);const a=e[0]+r.x-i.x,l=e[1]+r.y+i.y;t.strokeText(s,a,l),t.fillText(s,a,l),this.path=new Path2D,this.path.rect(a,e[1]+r.y-i.y,i.x*2,i.y*2)}getDraw(){const{show:t,dynamicPosition:e,position:i,valueScope:s,mainCanvas:r}=this;if(!r)return;const{scale:a,maxMinValue:l,isRecalculate:h,isScaleUpdated:c}=r;if(t.shouldRender(a)&&e)return c&&this.setExtraOffset(this.extraOffset,!1),l.maxXV<s.minX||l.minXV>s.maxX||l.maxYV<s.minY||l.minYV>s.maxY?void 0:(h&&(this.dynamicPosition=r.transformPosition([i])[0]),[this.draw,this])}}class Q extends V{constructor(t){t.redrawOnIsHoverChange=t.redrawOnIsHoverChange??!0;super(t);d(this,"angle",2*Math.PI);d(this,"defaultDragg",(t,e)=>{var l;const{offsetX:i,offsetY:s}=t.data,{x:r,y:a}=this.calculateOffset(i,s);this.value=[this.value[0]+r.value,this.value[1]+a.value],this.position=[this.position[0]+r.position,this.position[1]+a.position],this.dynamicPosition=[this.dynamicPosition[0]+r.dynamicPosition,this.dynamicPosition[1]+a.dynamicPosition],this.updateValueScope(),(l=this.notifyReload)==null||l.call(this)});d(this,"fillProgress");d(this,"defaultHover",(t,e)=>{const i=t.data.state,s=300,r=this.setCanvasStyles().width;this.fillProgress?this.cancelAndRestartAnimation(i,r,s-100):i&&this.startNewHoverAnimation(r,s)});this.addEventListener("hover",this.defaultHover),this.addEventListener("dragg",this.defaultDragg)}updateValueScope(){this.initValueScope(),this.calculatePointRadiusValue(this.setCanvasStyles()),this.setExtraOffset(this.extraOffset,!1)}cancelAndRestartAnimation(t,e,i){this.fillProgress.scheduleCallback();let s=0;this.fillProgress.scheduleCallback=ft(r=>{!this.fillProgress||!r||(this.fillProgress.progress+=(r-s)*(t?1:-1),s=r,this.fillProgress.progress=Math.min(1,Math.max(0,this.fillProgress.progress)),this.updateLineWidthOffset(e),(this.fillProgress.progress===1||this.fillProgress.progress===0)&&(this.fillProgress.scheduleCallback(),this.fillProgress.progress===0&&(this.fillProgress=void 0)))},i)}startNewHoverAnimation(t,e){this.fillProgress={lineWidthOffset:0,progress:0,scheduleCallback:ft(i=>{this.fillProgress&&(this.fillProgress.progress=i,this.updateLineWidthOffset(t))},e)}}updateLineWidthOffset(t){var i;if(!this.fillProgress)return;const e=Math.ceil(t*this.fillProgress.progress);e!==this.fillProgress.lineWidthOffset&&(this.fillProgress.lineWidthOffset=e,(i=this.notifyReload)==null||i.call(this))}isPointInPath(t,e){return this.path?V.ctx.isPointInPath(this.path,t,e):!1}isPointInStroke(t,e){var i;if(this.path&&this.mainCanvas){const{width:s}=this.setCanvasStyles(V.ctx);return((i=this.fillProgress)==null?void 0:i.lineWidthOffset)==s?!1:V.ctx.isPointInStroke(this.path,t,e)}return!1}setStyle(t){super.setStyle(t),this.calculatePointRadiusValue(this.setCanvasStyles())}updateBaseData(){if(!this.mainCanvas)return;let{value:t,position:e}=this;const[i,s]=[ut(t),ut(e)];if(!i&&!s)return this.dynamicPosition=void 0;if(i){const a=this.mainCanvas.getAxisPointByValue(t[0],t[1],!0);e=[a.x,a.y]}else{const a=this.mainCanvas.getAxisValueByPoint(e[0],e[1],!0);t=[a.xV,a.yV]}const r=this.mainCanvas.transformPosition([e])[0];this.dynamicPosition=r,this.value=t,this.position=e,this.updateValueScope()}setCanvasStyles(t){var h,c;const e=this.mainCanvas,i=e.style[e.theme].point;let s={};typeof this.style=="string"?s=((h=e.style[this.style])==null?void 0:h.point)||i:typeof this.style=="object"?s=Object.assign({},i,this.style):s=i;const{width:r,stroke:a,fill:l}=s;if(t){const u=((c=this.fillProgress)==null?void 0:c.lineWidthOffset)||0;t.lineWidth=r-u,t.strokeStyle=a,t.fillStyle=l}return{...s}}draw(t){var u;const{dynamicPosition:e,mainCanvas:i,extraOffset:s}=this;if(!i)return;const{radius:r,width:a}=this.setCanvasStyles(t),l=((u=this.fillProgress)==null?void 0:u.lineWidthOffset)||0,h=e[0]+s.x,c=e[1]+s.y;t.beginPath(),this.path=new Path2D,this.path.arc(h,c,r+l/2,0,this.angle),t.fill(this.path),a!=l&&t.stroke(this.path)}getDraw(){const{show:t,dynamicPosition:e,position:i,valueScope:s,mainCanvas:r}=this;if(!r)return;const{scale:a,maxMinValue:l,isRecalculate:h,isScaleUpdated:c}=r;if(t.shouldRender(a)&&!!e)return c&&(this.setExtraOffset(this.extraOffset,!1),this.calculatePointRadiusValue()),l.maxXV<s.minX||l.minXV>s.maxX||l.maxYV<s.minY||l.minYV>s.maxY?void 0:(h&&(this.dynamicPosition=r.transformPosition([i])[0]),[this.draw,this])}}function Qe(o,n,t=10){if(n.length===0)return 0;if(n.length===1)return 1;let e=1/0,i=-1;for(let s=0;s<n.length-1;s++){const r=Kt(o,n[s],n[s+1]);if(r<t)return s+1;r<e&&(e=r,i=s+1)}return i}function bt(o,n){const{x:t,y:e}=It(...o,...n);return[t,e]}class jt extends V{constructor(t){t.redrawOnIsHoverChange=t.redrawOnIsHoverChange??!0;super(t);d(this,"handlePoints",[]);d(this,"isShowHandlePoint",!0);d(this,"canCreateOrDeleteHandlePoint",!0);d(this,"lockedCanCreateOrDeleteHandlePoint",!1);d(this,"defaultClick",(t,e)=>{var r;if(!this.isShowHandlePoint)return;const{state:i,oldState:s}=t.data;i!=s&&!this.infinite&&((r=this.notifyReload)==null||r.call(this))});d(this,"defaultDoubleClick",(t,e)=>{if(e){if(!this.isShowHandlePoint)return;const{offsetX:i,offsetY:s}=e,{state:r}=t.data;if(this.lockedCanCreateOrDeleteHandlePoint)this.resetHandlePointLock();else if(r&&this.isShowHandlePoint&&this.canCreateOrDeleteHandlePoint&&this.isDraggable){const l=this.handlePoints.findIndex(h=>h.isHover);l===-1?this.tryCreateNewHandlePoint(i,s):this.tryDeleteHandlePoint(l)}}});d(this,"defaultDragg",(t,e)=>{if(!this.mainCanvas)return;const i=()=>{var h;const{offsetX:s,offsetY:r}=t.data,{x:a,y:l}=this.calculateOffset(s,r);this.value.forEach((c,u)=>{this.value[u][0]+=a.value,this.value[u][1]+=l.value,this.position[u][0]+=a.position,this.position[u][1]+=l.position,this.dynamicPosition[u][0]+=a.dynamicPosition,this.dynamicPosition[u][1]+=l.dynamicPosition}),this.handlePoints.forEach((c,u)=>{c.value=this.value[u],c.position=this.position[u],c.dynamicPosition=this.dynamicPosition[u]}),(h=this.notifyReload)==null||h.call(this),this.lockedCanCreateOrDeleteHandlePoint=!0};if(this.isShowHandlePoint){const s=this.handlePoints.findIndex(r=>r.isHover);if(s!=-1){const r=this.handlePoints[s];r.notifyDragg(t.data,e),this.value[s]=r.value,this.position[s]=r.position,this.dynamicPosition[s]=r.dynamicPosition}else i()}else i();this.updateValueScope()});const{isShowHandlePoint:e=!0,canCreateOrDeleteHandlePoint:i=!0}=t;Object.assign(this,{isShowHandlePoint:e,canCreateOrDeleteHandlePoint:i}),this.addEventListener("click",this.defaultClick),this.addEventListener("doubleClick",this.defaultDoubleClick),this.addEventListener("dragg",this.defaultDragg)}tryCreateNewHandlePoint(t,e){var h;if(!this.isPointInStroke(t,e))return;const i=this.getExtendedDynamicPositions(),s=Qe([t,e],i);if(s===-1)return;const[r,a]=this.getAdjacentIndices(s),l=this.createNewHandlePoint(r,a);this.insertHandlePoint(s,l),this.lockHandlePointCreationTemporarily(),(h=this.notifyReload)==null||h.call(this)}tryDeleteHandlePoint(t){var e;!this.isDblClick||!this.canDeleteHandlePoint||(this.deleteHandlePoint(t),(e=this.notifyReload)==null||e.call(this))}getExtendedDynamicPositions(){return this.isClosed?[...this.dynamicPosition,this.dynamicPosition[0]]:this.dynamicPosition}getAdjacentIndices(t){const e=t-1,i=this.isClosed&&t===this.dynamicPosition.length?0:t;return[e,i]}createNewHandlePoint(t,e){const i=bt(this.value[t],this.value[e]),s=bt(this.position[t],this.position[e]),r=bt(this.dynamicPosition[t],this.dynamicPosition[e]);return new Q({value:i,position:s,dynamicPosition:r,isDraggable:!0,mainCanvas:this.mainCanvas,notifyReload:()=>{var a;return(a=this.notifyReload)==null?void 0:a.call(this)}})}insertHandlePoint(t,e){this.handlePoints.splice(t,0,e),this.value.splice(t,0,e.value),this.position.splice(t,0,e.position),this.dynamicPosition.splice(t,0,e.dynamicPosition)}deleteHandlePoint(t){this.handlePoints.splice(t,1),this.value.splice(t,1),this.position.splice(t,1),this.dynamicPosition.splice(t,1)}lockHandlePointCreationTemporarily(){this.lockedCanCreateOrDeleteHandlePoint=!0,setTimeout(()=>{this.lockedCanCreateOrDeleteHandlePoint=!1},300)}resetHandlePointLock(){this.lockedCanCreateOrDeleteHandlePoint=!1}get canDeleteHandlePoint(){return this.handlePoints.length>this.minNeededHandlePoints}updateHandlePoints(){let{value:t,position:e,dynamicPosition:i}=this;i&&(t==null||t.forEach((s,r)=>{const a=this.handlePoints[r]||new Q({isDraggable:!0,value:t[r],position:e[r],dynamicPosition:i[r],mainCanvas:this.mainCanvas,notifyReload:()=>{var l;return(l=this.notifyReload)==null?void 0:l.call(this)}});this.handlePoints[r]||this.handlePoints.push(a)}),this.handlePoints.length=t.length)}}class lt extends jt{constructor(t){super(t);d(this,"infinite");d(this,"isClosed",!1);d(this,"minNeededHandlePoints",2);const{infinite:e}=t;Object.assign(this,{infinite:e}),e&&(this.canCreateOrDeleteHandlePoint=!1),this.redrawOnIsHoverChange=!1}updateValueScope(){this.initValueScope(),this.calculatePointRadiusValue(this.setCanvasStyles().point),this.setExtraOffset(this.extraOffset,!1)}isPointInPath(t,e){return!1}isPointInStroke(t,e){return this.path&&this.mainCanvas?(this.setCanvasStyles(V.ctx),this.isDraggable&&(V.ctx.lineWidth=Math.max(V.ctx.lineWidth,20)),V.ctx.isPointInStroke(this.path,t,e)):!1}isPointInAnywhere(t,e){const i=super.isPointInAnywhere(t,e),s=(this.isClick||!!this.infinite)&&this.isShowHandlePoint&&this.handlePoints.some(r=>{const a=r.isPointInAnywhere(t,e);return a!=r.isHover&&r.notifyHover(a),a});return i||s}updateBaseData(){if(!this.mainCanvas)return;let{value:t,position:e}=this;const[i,s]=[dt(t)&&t.length>1,dt(e)&&e.length>1];if(!i&&!s)return this.handlePoints=[],this.dynamicPosition=void 0;if(i){e=[];for(let a=0;a<t.length;a++){const l=t[a],h=this.mainCanvas.getAxisPointByValue(l[0],l[1],!0);e.push([h.x,h.y])}}else{t=[];for(let a=0;a<e.length;a++){const l=e[a],h=this.mainCanvas.getAxisValueByPoint(l[0],l[1],!0);t.push([h.xV,h.yV])}}const r=this.mainCanvas.transformPosition(e);this.dynamicPosition=r,this.value=t,this.position=e,this.updateHandlePoints(),this.updateValueScope()}setInfinite(t){var e;t!=this.infinite&&(this.infinite=t,this.canCreateOrDeleteHandlePoint=!t,this.dynamicPosition&&((e=this.notifyReload)==null||e.call(this)))}setCanvasStyles(t){var m;const e=this.mainCanvas,i=e.style[e.theme].line;let s={};typeof this.style=="string"?s=((m=e.style[this.style])==null?void 0:m.line)||i:typeof this.style=="object"?s=Object.assign({},i,this.style):s=i;const{width:r,color:a,dash:l,dashGap:h,dashOffset:c,cap:u,join:f}=s;return t&&(t.setLineDash(l?h:[]),t.lineDashOffset=c,t.lineCap=u,t.lineJoin=f,t.lineWidth=r,t.strokeStyle=a),s}drawLine(t,e){const{mainCanvas:i,infinite:s,isClick:r}=this;if(e=e||this.dynamicPosition,!i)return;const a=this.setCanvasStyles(t);t.beginPath(),this.path=new Path2D,e.forEach((l,h)=>{this.path[h==0?"moveTo":"lineTo"](l[0],l[1])}),t.stroke(this.path),(s||r)&&this.isShowHandlePoint&&this.handlePoints.forEach(l=>{l.style=a.point,l.draw(t)})}drawInfiniteStraightLine(t){const{mainCanvas:e,dynamicPosition:i}=this;if(!e)return;const{rect:s}=e,[r,a]=At(i),l=[a[0]-r[0],a[1]-r[1]];if(l[0]===0&&l[1]===0)return console.error("");const h=(f,m)=>{const[v,g]=f,[y,C]=m;let S=1/0;if(y!==0){const b=y>0?(s.value.width-v)/y:-v/y;b>0&&(S=Math.min(S,b))}if(y!==0){const b=y>0?(s.value.width-v)/y:-v/y;b>0&&(S=Math.min(S,b))}return S===1/0?f:[v+y*S,g+C*S]},c=h(r,[-l[0],-l[1]]),u=h(a,l);this.drawLine(t,[c,u])}getDraw(){const{show:t,dynamicPosition:e,position:i,infinite:s,mainCanvas:r,valueScope:a}=this;if(!r)return;const{scale:l,isRecalculate:h,isScaleUpdated:c,maxMinValue:u}=r;if(t.shouldRender(l)&&!!e)return c&&(this.setExtraOffset(this.extraOffset,!1),this.calculatePointRadiusValue()),!s&&(u.maxXV<a.minX||u.minXV>a.maxX||u.maxYV<a.minY||u.minYV>a.maxY)?void 0:(h&&(this.dynamicPosition=r.transformPosition(i),this.handlePoints.forEach((g,y)=>g.dynamicPosition=this.dynamicPosition[y])),s?[this.drawInfiniteStraightLine,this]:[this.drawLine,this])}}class ht extends jt{constructor(t){super(t);d(this,"isRect",!1);d(this,"isClosed",!0);d(this,"minNeededHandlePoints",3);const{isRect:e}=t;Object.assign(this,{isRect:e}),t.isRect&&(this.canCreateOrDeleteHandlePoint=!1)}updateValueScope(){this.initValueScope(),this.calculatePointRadiusValue(this.setCanvasStyles().point),this.setExtraOffset(this.extraOffset,!1)}isPointInPath(t,e){return this.path?V.ctx.isPointInPath(this.path,t,e):!1}isPointInStroke(t,e){return this.path&&this.mainCanvas?(this.setCanvasStyles(V.ctx),this.isDraggable&&(V.ctx.lineWidth=Math.max(V.ctx.lineWidth,20)),V.ctx.isPointInStroke(this.path,t,e)):!1}isPointInAnywhere(t,e){const i=super.isPointInAnywhere(t,e),s=this.isClick&&this.isShowHandlePoint&&this.handlePoints.some(r=>{const a=r.isPointInAnywhere(t,e);return a!=r.isHover&&r.notifyHover(a),a});return i||s}updateBaseData(){if(!this.mainCanvas)return;let{value:t,position:e,isRect:i}=this,[s,r]=[dt(t)&&t.length>(i?1:2),dt(e)&&e.length>(i?1:2)];if(!s&&!r)return this.dynamicPosition=void 0;if(i){if(s){t.length=2;const[l,h]=t;s=!(l[0]==h[0]||l[1]==h[1])}if(r){e.length=2;const[l,h]=e;r=!(l[0]==h[0]||l[1]==h[1])}}if(s){e=[];for(let l=0;l<t.length;l++){const h=t[l],c=this.mainCanvas.getAxisPointByValue(h[0],h[1],!0);e.push([c.x,c.y])}}else{t=[];for(let l=0;l<e.length;l++){const h=e[l],c=this.mainCanvas.getAxisValueByPoint(h[0],h[1],!0);t.push([c.xV,c.yV])}}const a=this.mainCanvas.transformPosition(e);this.dynamicPosition=a,this.value=t,this.position=e,this.updateHandlePoints(),this.updateValueScope()}setRect(t){var e;if(this.isRect!=t){this.isRect=t,this.canCreateOrDeleteHandlePoint=!t;const i=!!this.dynamicPosition;this.updateBaseData(),(this.dynamicPosition||i)&&((e=this.notifyReload)==null||e.call(this))}}setCanvasStyles(t){var g;const e=this.isHover,i=this.mainCanvas,s=i.style[i.theme].polygon;let r={};typeof this.style=="string"?r=((g=i.style[this.style])==null?void 0:g.polygon)||s:typeof this.style=="object"?r=Object.assign({},s,this.style):r=s;const{width:a,stroke:l,dash:h,dashGap:c,dashOffset:u,fill:f,fill_hover:m,stroke_hover:v}=r;return t&&(t.setLineDash(h?c:[]),t.lineDashOffset=u,t.lineWidth=a,t.strokeStyle=e?v:l,t.fillStyle=e?m:f),r}drawRect(t){const[[e,i],[s,r]]=this.dynamicPosition,a=Math.abs(s-e),l=Math.abs(r-i),h=Math.min(e,s),c=Math.min(i,r),u=this.setCanvasStyles(t);t.beginPath(),this.path=new Path2D,this.path.rect(h,c,a,l),t.stroke(this.path),t.fill(this.path),this.isClick&&this.isShowHandlePoint&&this.handlePoints.forEach(f=>{f.style=u.point,f.draw(t)})}drawPolygon(t){const e=this.dynamicPosition,i=this.setCanvasStyles(t);t.beginPath(),this.path=new Path2D,e.forEach((s,r)=>{this.path[r==0?"moveTo":"lineTo"](s[0],s[1])}),this.path.lineTo(e[0][0],e[0][1]),t.closePath(),t.stroke(this.path),t.fill(this.path),this.isClick&&this.isShowHandlePoint&&this.handlePoints.forEach(s=>{s.style=i.point,s.draw(t)})}getDraw(){const{show:t,dynamicPosition:e,position:i,mainCanvas:s,valueScope:r}=this;if(!s)return;const{scale:a,isRecalculate:l,isScaleUpdated:h,maxMinValue:c}=s;if(t.shouldRender(a)&&!!e)return h&&(this.setExtraOffset(this.extraOffset,!1),this.calculatePointRadiusValue()),c.maxXV<r.minX||c.minXV>r.maxX||c.maxYV<r.minY||c.minYV>r.maxY?void 0:(l&&(this.dynamicPosition=s.transformPosition(i),this.handlePoints.forEach((v,g)=>v.dynamicPosition=this.dynamicPosition[g])),this.isRect?[this.drawRect,this]:[this.drawPolygon,this])}}class ct extends V{constructor(t){super(t);d(this,"draw");this.redrawOnIsHoverChange=!1;const{draw:e}=t;Object.assign(this,{draw:e})}updateValueScope(){this.initValueScope(),this.setExtraOffset(this.extraOffset,!1)}isPointInPath(t,e){return!1}isPointInStroke(t,e){return!1}updateBaseData(){if(!this.mainCanvas)return;this.dynamicPosition=void 0;let t=this.value,e=this.position;t?e=this.convertValuesToPositions(t):t=this.convertPositionsToValues(e),this.updateDataProperties(t,e),this.updateValueScope()}convertValuesToPositions(t){const e=[];let i=1;return t.forEach((s,r)=>{if(r===0){const a=this.mainCanvas.getAxisPointByValue(s[0],s[1],!0);e.push([a.x,a.y]),i=new N(a.x).div(s[0]).toNumber()}else e.push([new N(i).mul(s[0]).toNumber(),new N(i).mul(s[1]).toNumber()])}),e}convertPositionsToValues(t){const e=[];let i=1;return t.forEach((s,r)=>{if(r===0){const a=this.mainCanvas.getAxisValueByPoint(s[0],s[1],!0);e.push([a.xV,a.yV]),i=new N(a.xV).div(s[0]).toNumber()}else e.push([new N(i).mul(s[0]).toNumber(),new N(i).mul(s[1]).toNumber()])}),e}updateDataProperties(t,e){this.dynamicPosition=this.mainCanvas.transformPosition(e),this.value=t,this.position=e}getDraw(){const{show:t,dynamicPosition:e,mainCanvas:i,position:s,valueScope:r}=this;if(!i||!this.draw)return;const{scale:a,isRecalculate:l,isScaleUpdated:h,maxMinValue:c}=i;if(t.shouldRender(a)&&!!e)return h&&this.setExtraOffset(this.extraOffset,!1),c.maxXV<r.minX||c.minXV>r.maxX||c.maxYV<r.minY||c.minYV>r.maxY?void 0:(l&&(this.dynamicPosition=i.transformPosition(s)),[this.draw,this])}}class Y extends xt{constructor(t){super(t);d(this,"overlays",new Set);this.setNotifyReload(t.notifyReload)}setMainCanvas(t){var e;super.setMainCanvas(t),this.overlays.forEach(i=>{i.setMainCanvas(t),i.parent=this}),t&&this.overlays.size&&((e=this.notifyReload)==null||e.call(this))}setNotifyReload(t){this.notifyReload=t?e=>{var i;(e||this.show.shouldRender((i=this.mainCanvas)==null?void 0:i.scale)&&this.overlays.size)&&t()}:void 0,this.overlays.forEach(e=>e.setNotifyReload(this.notifyReload)),this.show.notifyReload=this.notifyReload}addOverlays(t){var e;[t].flat().forEach(i=>{i.setNotifyReload(this.notifyReload),i.setMainCanvas(this.mainCanvas),i.parent=this,this.overlays.add(i)}),(e=this.notifyReload)==null||e.call(this)}hasOverlay(t){return this.overlays.has(t)}removeOverlays(t){var e;[t].flat().forEach(i=>{this.overlays.delete(i),i.setNotifyReload(),i.setMainCanvas(),i.parent=void 0}),(e=this.notifyReload)==null||e.call(this)}clearOverlays(){var t;(t=this.notifyReload)==null||t.call(this),this.overlays.forEach(e=>{e.setNotifyReload(),e.setMainCanvas(),e.parent=void 0}),this.overlays.clear()}getOverlaysDrawingMethod(){var e;const t=[];if(this.show.shouldRender((e=this.mainCanvas)==null?void 0:e.scale)&&this.overlays.size){let i=1;Array.from(this.overlays.values()).sort((s,r)=>s.zIndex-r.zIndex).forEach(s=>{if(s.equalsMainCanvas(this.mainCanvas)){const r=s.getDraw();r&&t.push([(Number(s.zIndex)||0)+i++,r])}else this.overlays.delete(s)})}return t}}class B extends xt{constructor(t){super(t);d(this,"opacity",1);d(this,"zIndex",4);d(this,"canvas",document.createElement("canvas"));d(this,"ctx",this.canvas.getContext("2d"));d(this,"isReload",!1);d(this,"groups",new Map);d(this,"currentDrawOverlays",[]);this.setNotifyReload(t.notifyReload)}setMainCanvas(t){var e,i;super.setMainCanvas(t),this.canvas.width=((e=t==null?void 0:t.rect)==null?void 0:e.value.width)||0,this.canvas.height=((i=t==null?void 0:t.rect)==null?void 0:i.value.height)||0,this.groups.forEach(s=>{s.setMainCanvas(t),s.parent=this})}setNotifyReload(t){this.notifyReload=t?e=>{var i;(e||this.show.shouldRender((i=this.mainCanvas)==null?void 0:i.scale)&&this.groups.size)&&t()}:void 0,this.groups.forEach(e=>this.setGroupNotifyReload(e)),this.show.notifyReload=this.notifyReload}setGroupNotifyReload(t){t.setNotifyReload(this.notifyReload?()=>{var e;(e=this.notifyReload)==null||e.call(this),this.isReload=!0}:void 0)}getGroup(t){return this.groups.get(t)}addGroup(t){[t].flat().forEach(e=>{e instanceof Y&&(this.setGroupNotifyReload(e),e.setMainCanvas(this.mainCanvas),e.parent=this,this.groups.set(e.name,e))})}removeGroup(t){var i;let e=!1;[t].flat().forEach(s=>{s instanceof Y&&(this.groups.delete(s.name),s.setNotifyReload(),s.setMainCanvas(),s.parent=void 0,e=!0)}),e&&((i=this.notifyReload)==null||i.call(this))}clearGroup(){var t;this.groups.size&&(this.groups.forEach(e=>{e.setNotifyReload(),e.setMainCanvas(),e.parent=void 0}),this.groups.clear(),(t=this.notifyReload)==null||t.call(this))}setzIndex(t){var e;t!=this.zIndex&&(this.zIndex=t,(e=this.notifyReload)==null||e.call(this,!1))}setOpacity(t){var e;this.opacity!=t&&(t>=0&&t<=1?(this.opacity=t,(e=this.notifyReload)==null||e.call(this,!1)):console.warn("Opacity value should be between 0 and 1."))}getCanvas(){if(!this.mainCanvas)return;const{scale:t,rect:e,isRecalculate:i,isThemeUpdated:s}=this.mainCanvas,r=this.show.shouldRender(t),a=this.groups.size;if(r&&a){if(this.isReload||i||s){this.currentDrawOverlays=[],this.isReload=!1,this.canvas.width=(e==null?void 0:e.value.width)||0,this.canvas.height=(e==null?void 0:e.value.height)||0;const l=[];this.groups.forEach(h=>{h.equalsMainCanvas(this.mainCanvas)?l.push(...h.getOverlaysDrawingMethod()):this.groups.delete(h.name)}),l.sort((h,c)=>h[0]-c[0]),l.forEach(([h,[c,u]])=>{c.call(u,this.ctx),this.currentDrawOverlays.push([[Number(this.zIndex)||0,h],u])})}return[Number(this.zIndex)||0,this.canvas,this.currentDrawOverlays]}}}class et extends xt{constructor(t){super(t);d(this,"layers",new Map);d(this,"defaultContextmenu",(t,e)=>t.stopPropagation());d(this,"defaultClick",(t,e)=>t.stopPropagation());d(this,"defaultDoubleClick",(t,e)=>t.stopPropagation());d(this,"defaultHover",(t,e)=>t.stopPropagation());d(this,"defaultDragg",(t,e)=>t.stopPropagation());d(this,"defaultDown",(t,e)=>t.stopPropagation());this.setNotifyReload(t.notifyReload),this.addEventListener("contextmenu",this.defaultContextmenu),this.addEventListener("click",this.defaultClick),this.addEventListener("doubleClick",this.defaultDoubleClick),this.addEventListener("hover",this.defaultHover),this.addEventListener("dragg",this.defaultDragg),this.addEventListener("down",this.defaultDown)}setMainCanvas(t){super.setMainCanvas(t),this.layers.forEach(e=>{e.setMainCanvas(t),e.parent=this})}setNotifyReload(t){this.notifyReload=t?e=>{var i;(e||this.show.shouldRender((i=this.mainCanvas)==null?void 0:i.scale)&&this.layers.size)&&t()}:void 0,this.layers.forEach(e=>e.setNotifyReload(this.notifyReload)),this.show.notifyReload=this.notifyReload}getLayer(t){return this.layers.get(t)}addLayer(t){[t].flat().forEach(e=>{e instanceof B&&(e.setNotifyReload(this.notifyReload),e.setMainCanvas(this.mainCanvas),e.parent=this,this.layers.set(e.name,e))})}removeLayer(t){var i;let e=!1;[t].flat().forEach(s=>{s instanceof B&&(this.layers.delete(s.name),s.setNotifyReload(),s.setMainCanvas(),s.parent=void 0,e=!0)}),e&&((i=this.notifyReload)==null||i.call(this))}clearLayers(){var t;this.layers.size&&(this.layers.forEach(e=>{e.setNotifyReload(),e.setMainCanvas(),e.parent=void 0}),this.layers.clear(),(t=this.notifyReload)==null||t.call(this))}fetchCanvas(){var t;if(this.show.shouldRender((t=this.mainCanvas)==null?void 0:t.scale)&&this.layers.size){const e=[];return this.layers.forEach(i=>{if(i.equalsMainCanvas(this.mainCanvas)){const s=i.getCanvas();s&&e.push(s)}else this.layers.delete(i.name)}),e}return[]}}class ti extends Ut{constructor(t){super(t);d(this,"canvas");d(this,"ctx");d(this,"rect");d(this,"offset",{x:0,y:0});d(this,"center",{x:0,y:0});d(this,"defaultCenter",{top:void 0,bottom:void 0,left:void 0,right:void 0});d(this,"accuracy",5);d(this,"scale",1);d(this,"percentage",1);d(this,"axisConfig",{count:2,min:100,size:100,x:1,y:1});d(this,"cycle",10);d(this,"delta",.02);d(this,"redrawInNextRenderFrame",!1);d(this,"isAuto",!1);d(this,"isRendering",!1);d(this,"drawAxis");d(this,"layerGroups",new Map);d(this,"isScaleUpdated",!1);d(this,"nowGridCount");const{id:e,axisConfig:i,defaultCenter:s,offset:r}=t,a=document.getElementById(e);if(a instanceof HTMLCanvasElement)if(a.getContext){this.canvas=a,this.ctx=a.getContext("2d"),this.rect=(c=>{let u=!0;Promise.resolve().then(()=>u=!1);const f={value:c.getBoundingClientRect()};return new Proxy(f,{get(m,v){return v=="value"?(u||(m.value=c.getBoundingClientRect(),u=!0,Promise.resolve().then(()=>u=!1)),m.value):m[v]},set(){return!1}})})(a);const{clientWidth:l,clientHeight:h}=a;[a.width,a.height]=[l,h]}else throw new Error("canvas-unsupported code here");else throw new Error("canvas is not HTMLCanvasElement");i&&this.setAxis(i),s&&this.setDefaultCenter(s),r&&(this.offset.x=r.x||0,this.offset.y=r.y||0)}getDefaultCenterLocation(){const{canvas:t,rect:e,defaultCenter:i}=this;if(!t)return console.error("canvas is not HTMLCanvasElement");const{width:s,height:r}=e.value,{top:a,bottom:l,left:h,right:c}=i,u={vertical:(g,y)=>{if([0,"0","0%"].includes(g))return 0;if(!(g==1/0||g==-1/0))return typeof g=="number"?g:["top","left"].includes(g)?0:["bottom","right"].includes(g)?y:["middle","center"].includes(g)?y/2:/^(\d+)%$/.test(g)?(g=g.match(/^(\d+)%$/)[1],y*Number(g)/100):Number(g)||void 0},reverse:(g,y)=>{if([0,"0","0%"].includes(g))return y;if(g==1/0||g==-1/0)return;if(typeof g=="number")return y-g;const C=u.vertical(g,y);return C?y-C:void 0}},f=(g,y,C)=>{if(g!==void 0){const S=u.vertical(g,C);if(S!==void 0)return S}if(y!==void 0){const S=u.reverse(y,C);if(S!==void 0)return S}return C/2},m=f(a,l,r);return{x:f(h,c,s),y:m}}updateCenter(){const t=this.getDefaultCenterLocation();if(!t)return;const{x:e,y:i}=t;this.center={x:Math.floor(e+this.offset.x),y:Math.floor(i+this.offset.y)}}updateSize(){const{scale:t,axisConfig:e}=this;e.size=this.getGridSize(t),this.percentage=this.getAxisPointByValue(e.count,0).x/e.min}setScale(t,e){const{canvas:i,isScaleable:s,axisConfig:r}=this,a=this.rect.value;if(!s||!i||!a)return console.error("canvas is not HTMLCanvasElement");let l,h;t==="center"?(l=a.left+a.width/2,h=a.top+a.height/2):[l,h]=[t.clientX,t.clientY];const c=this.getMousePositionOnAxis({clientX:l,clientY:h}),u=this.getAxisValueByPoint(c.x,c.y);this.scale=new N(this.scale).add(e).toNumber(),this.isScaleUpdated=!0,this.updateSize();const f=this.getAxisPointByValue(u.xV,u.yV);this.offset.x-=(f.x-c.x)*r.x,this.offset.y-=(f.y-c.y)*r.y,this.offset.x=Number(this.offset.x.toFixed(0)),this.offset.y=Number(this.offset.y.toFixed(0))}setAxis(t){const e={...this.axisConfig,...t},i=Object.fromEntries(Object.entries(e).map(([g,y])=>[g,Number(y)])),{x:s,y:r,count:a,min:l,size:h}=i,c=[1,-1].includes(s),u=[1,-1].includes(r),f=a>0,m=l>0,v=h>=l&&h<=l*2;if(!c||!u||!f||!m||!v){console.warn("Invalid axis configuration:",{x:s,y:r,count:a,min:l,size:h});return}this.axisConfig=i}setDefaultCenter(t){Object.assign(this.defaultCenter,t),this.updateCenter()}getGridSize(t){const{cycle:e,delta:i,axisConfig:s}=this;let r=new N(t).sub(1).abs().mod(e*i).div(i).toNumber();return r=t<1&&r!=0?e-r:r,Number(((r/e+1)*s.min).toFixed(0))}getGridCount(t){const{axisConfig:e,cycle:i,delta:s}=this,r=e.count,a=i*s;if(t===1)return r;if(t>1){const l=new N(t).sub(1).div(a).floor();return new N(r).div(new N(2).pow(l)).toNumber()}else{const l=new N(1).sub(t).div(a).ceil();return new N(r).mul(new N(2).pow(l)).toNumber()}}get getNowGridCount(){const{scale:t,nowGridCount:e,isRendering:i}=this;return e&&i?e:(this.nowGridCount=this.getGridCount(t),i&&Promise.resolve().then(()=>this.nowGridCount=void 0),this.nowGridCount)}getMousePositionOnAxis(t){const{canvas:e,center:i,rect:s,axisConfig:r}=this;if(!e)return console.error("canvas is not HTMLCanvasElement");const{clientX:a,clientY:l}=t,{left:h,top:c}=s.value,u=(a-h-i.x)*r.x,f=(l-c-i.y)*r.y;return{x:u,y:f}}getAxisValueByPoint(t,e,i){const{axisConfig:s}=this;if(i)return{xV:t/s.min*s.count,yV:e/s.min*s.count};const r=this.getNowGridCount,a=new N(t).div(s.size).mul(r).toFixed(8),l=new N(e).div(s.size).mul(r).toFixed(8);return{xV:Number(a),yV:Number(l)}}getAxisPointByValue(t,e,i){const{axisConfig:s}=this;if(i)return{x:t/s.count*s.min,y:e/s.count*s.min};const r=this.getNowGridCount,a=new N(t).div(r).mul(s.size).toFixed(3),l=new N(e).div(r).mul(s.size).toFixed(3);return{x:Number(a),y:Number(l)}}getMaxMinValue(t){t=t||this.rect.value;const{left:e,top:i,right:s,bottom:r}=t,{axisConfig:a}=this,{x:l,y:h}=this.getMousePositionOnAxis({clientX:a.x==1?e:s,clientY:a.y==1?i:r}),{xV:c,yV:u}=this.getAxisValueByPoint(l,h),{x:f,y:m}=this.getMousePositionOnAxis({clientX:a.x==1?s:e,clientY:a.y==1?r:i}),{xV:v,yV:g}=this.getAxisValueByPoint(f,m);return{minXV:c,maxXV:v,minYV:u,maxYV:g}}transformPosition(t){const{center:e,percentage:i,axisConfig:s}=this,r=[];for(let a=0;a<t.length;a++){let[l,h]=t[a];l=e.x+l*i*s.x,h=e.y+h*i*s.y,r.push([l,h])}return r}}class ei extends ti{constructor(t){super(t);d(this,"theme","light");d(this,"isThemeUpdated",!1);d(this,"style",{light:{background:"#fff",text:{color:"#222",secondary:"#909399",stroke:"#fff",size:12,family:"monospace",bold:!0},grid:{axis:"#222",grid:"#666",innerGrid:"#e5e5e5"},point:{radius:5,fill:"#d03050",width:14,stroke:"#d0305080"},line:{color:"#f0a020",width:4,dash:!1,dashGap:[5,10],dashOffset:0,cap:"round",join:"round",point:{radius:5,stroke:"#f0a02080",width:14,fill:"#f0a020"}},polygon:{fill:"#18a05830",stroke:"#18a058",fill_hover:"#03693360",stroke_hover:"#036933",width:1,dash:!1,dashGap:[5,10],dashOffset:0,point:{radius:5,stroke:"#03693380",width:14,fill:"#036933"}}},dark:{background:"#000",text:{color:"#aeaeae",secondary:"#8c8c8c",stroke:"#000",size:12,family:"monospace",bold:!0},grid:{axis:"#aeaeae",grid:"#666",innerGrid:"#454545"},point:{radius:5,fill:"#e88080",width:14,stroke:"#e8808070"},line:{color:"#f2c97d",width:4,dash:!1,dashGap:[5,10],dashOffset:0,cap:"round",join:"round",point:{radius:5,stroke:"#f2c97d80",width:14,fill:"#f2c97d"}},polygon:{fill:"#63e2b730",stroke:"#63e2b7",fill_hover:"#7efbd160",stroke_hover:"#7efbd1",width:1,dash:!1,dashGap:[5,10],dashOffset:0,point:{radius:5,stroke:"#7efbd180",width:14,fill:"#7efbd1"}}}});const{theme:e}=t;e&&this.setTheme(e),this.initStyle(),this.clearScreen()}initStyle(){const{canvas:t,ctx:e,theme:i}=this;t.classList.add("_nhanh_canvas");const s=this.style[i];e.font=`${s.text.bold?"bold":""} ${s.text.size}px ${s.text.family}`}clearScreen(){const{ctx:t,theme:e,rect:i}=this,{width:s,height:r}=i.value;t.clearRect(0,0,s,r),this.style[e].background&&(t.fillStyle=this.style[e].background,t.fillRect(0,0,s,r))}setStyle(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e)){const i=At(this.style[e]||this.style[this.theme]);Qt(i,t[e]),this.style[e]=i}this.initStyle()}setTheme(t){t in this.style&&(this.theme=t,this.isThemeUpdated=!0)}}class ii extends ei{constructor(t){super(t);d(this,"resizeObserver");d(this,"currentDrawOverlays",[]);d(this,"rely","");d(this,"isRecalculate",!1);d(this,"notifyReload");d(this,"maxMinValue",{minXV:0,maxXV:0,minYV:0,maxYV:0});d(this,"measureRedrawPerformance",ee(()=>this.redraw(),[[1,"#F56C6C"],[.5,"#E6A23C"],[0,"#67C23A"]]));this.canvas&&(this.resizeObserver=new ResizeObserver(te(()=>{const e=this.rect.value;[this.canvas.width,this.canvas.height]=[e.width,e.height],this.redrawOnce()},200)),this.resizeObserver.observe(this.canvas)),this.updateRely(),this.isRecalculate=!1}updateRely(){const{center:t,scale:e,rect:i,axisConfig:s}=this,r=[t.x,t.y,e,JSON.stringify(s),i.value.width,i.value.height].join();this.isRecalculate=this.rely!==r,this.rely=r}redraw(){var s,r;if(!this.canvas)return console.error("canvas is not HTMLCanvasElement");if(this.canvas.clientWidth==0||this.canvas.clientHeight==0)return console.error("The image argument is a canvas element with a width or height of 0.");this.updateCenter(),this.updateRely(),this.maxMinValue=this.getMaxMinValue(),this.clearScreen();const t=[];let e=[];const i=(s=this.drawAxis)==null?void 0:s.drawAxisAndGrid();i&&e.push([0,i,[]]),this.layerGroups.forEach(a=>e=e.concat(a.fetchCanvas())),e.sort((a,l)=>a[0]-l[0]),e.forEach(([,a,l],h)=>{this.ctx.drawImage(a,0,0),l.forEach(([[c,u],f])=>{t.push([[c+h,u],f])})}),t.sort(([[a,l],h],[[c,u],f])=>{if(a!==c)return c-a;if(l!==u)return u-l;const m=v=>v instanceof ct?0:v instanceof at?1:v instanceof Q?2:v instanceof lt?3:v instanceof ht?4:5;return m(f)-m(h)}),this.currentDrawOverlays=t.map(([,a])=>a),this.isRecalculate=!1,this.isThemeUpdated=!1,this.isScaleUpdated=!1,(r=this.notifyReload)==null||r.call(this)}redrawOnce(){this.redrawInNextRenderFrame||(this.redrawInNextRenderFrame=!0,Promise.resolve().then(()=>{this.isRendering=!0,this.redrawInNextRenderFrame=!1,this.redraw(),this.isRendering=!1}))}findOverlayByPoint(t,e){return this.currentDrawOverlays.find(i=>i.isPointInAnywhere(t,e))}destroy(){var t;(t=this.resizeObserver)==null||t.disconnect()}}class si extends ii{constructor(t){super(t);d(this,"mouseInCanvas",!1);d(this,"mouseIsDown",!1);d(this,"mouseLastPosition",{x:0,y:0});d(this,"unBind");d(this,"lastClickedOverlay");d(this,"lockNotifyClick",!1);d(this,"lastContextmenuOverlay");d(this,"defaultContextmenu",(t,e)=>{const i=this.lastClickedOverlay;i!=null&&i.isDraggable&&i.notifyClick(!1,e)});d(this,"lastPressedKey",{key:"",keyupTime:0,doubleClick:!1});d(this,"lastDownOverlay");d(this,"defaultDown",(t,e)=>{(e==null?void 0:e.button)==0&&(this.mouseIsDown=!0)});d(this,"lastHoverOverlay");d(this,"oldClientX",[]);d(this,"oldClientY",[]);this.initEvent(),this.addEventListener("contextmenu",this.defaultContextmenu),this.addEventListener("down",this.defaultDown)}initEvent(){const{canvas:t}=this;if(!t)return console.error("canvas is not HTMLCanvasElement");const e=[{type:"click",handler:this.click.bind(this)},{type:"contextmenu",handler:this.contextmenu.bind(this)},{type:"mouseenter",handler:this.mouseenter.bind(this)},{type:"mouseleave",handler:this.mouseleave.bind(this)},{type:"keydown",handler:this.keydown.bind(this),target:window},{type:"keyup",handler:this.keyup.bind(this),target:window},{type:"wheel",handler:this.wheel.bind(this)},{type:"mousedown",handler:this.mousedown.bind(this)},{type:"mouseup",handler:this.mouseup.bind(this),target:window},{type:"mousemove",handler:this.mousemove.bind(this),target:window},{type:"touchend",handler:this.touchend.bind(this)},{type:"touchmove",handler:this.touchmove.bind(this)}];e.forEach(({type:i,handler:s,target:r=t})=>{r.addEventListener(i,s)}),this.unBind=()=>{e.forEach(({type:i,handler:s,target:r=t})=>{r.removeEventListener(i,s)})}}click(t){var i;if(this.lockNotifyClick)return this.lockNotifyClick=!1;const e=this.findOverlayByPoint(t.offsetX,t.offsetY);this.lastClickedOverlay!=e&&((i=this.lastClickedOverlay)==null||i.notifyClick(!1,t)),e==null||e.notifyClick(!0,t),this.lastClickedOverlay=e,this.notifyClick(!0,t)}contextmenu(t){var i;t.preventDefault();const e=this.findOverlayByPoint(t.offsetX,t.offsetY);this.lastContextmenuOverlay!=e&&((i=this.lastContextmenuOverlay)==null||i.notifyContextmenu(!1,t)),e==null||e.notifyContextmenu(!0,t),this.lastContextmenuOverlay=e,this.notifyContextmenu(!0,t)}mouseenter(t){this.mouseInCanvas=!0}mouseleave(t){this.mouseInCanvas=!1}getStep(t){const{lastPressedKey:e}=this;return e.doubleClick?4:e.key===t&&Date.now()-e.keyupTime<300?(e.doubleClick=!0,4):1}keydown(t){const{mouseInCanvas:e,offset:i,delta:s}=this,r=t.key;if(e&&this.isDraggable&&!this.isAuto){const a=this.getStep(r);switch(r){case"ArrowUp":i.y-=a;break;case"ArrowDown":i.y+=a;break;case"ArrowLeft":i.x-=a;break;case"ArrowRight":i.x+=a;break;case"+":this.setScale("center",s);break;case"-":this.setScale("center",-s);break}["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","+","-"].includes(r)&&this.redrawOnce()}}keyup(t){const{mouseInCanvas:e,lastPressedKey:i}=this;if(e){const s=t.key;i.key=s,i.keyupTime=Date.now(),i.doubleClick=!1}}wheel(t){t.preventDefault();const{delta:e,isScaleable:i,isAuto:s}=this;!i||s||(this.setScale(t,t.deltaY<0?e:-e),this.redrawOnce())}mousedown(t){var r;const{clientX:e,clientY:i}=t;this.mouseLastPosition={x:e,y:i};const s=this.findOverlayByPoint(t.offsetX,t.offsetY);this.lastDownOverlay!=s&&((r=this.lastDownOverlay)==null||r.notifyDown(!1,t),s==null||s.notifyDown(!0,t)),this.lastDownOverlay=s,this.notifyDown(!0,t)}mouseup(t){this.mouseIsDown=!1,this.lastDownOverlay=void 0}mousemove(t){this.isAuto||(this.canvas.classList.toggle("_nhanh_canvas_draggable",this.isDraggable),this.mouseIsDown?this.handleDragMove(t):this.handleHover(t))}handleDragMove(t){const{lastDownOverlay:e}=this;if(!this.isDraggable)return;e!=null&&e.isDraggable?this.notifyDraggOverlays(t):this.handleCanvasPan(t);const{clientX:i,clientY:s}=t;this.mouseLastPosition={x:i,y:s},this.lockNotifyClick=!0}notifyDraggOverlays(t){const e=this.lastDownOverlay,{mouseLastPosition:i}=this,{clientX:s,clientY:r}=t;e.notifyDragg({offsetX:s-i.x,offsetY:r-i.y},t)}handleCanvasPan(t){const{clientX:e,clientY:i}=t,{offset:s,mouseLastPosition:r}=this,a=e-r.x,l=i-r.y;s.x+=a,s.y+=l,this.redrawOnce(),this.notifyDragg({offsetX:a,offsetY:l},t)}handleHover(t){if(t.target!=this.canvas)return;const e=this.findOverlayByPoint(t.offsetX,t.offsetY);this.updateHoverState(e,t),this.notifyHover(!0,t)}updateHoverState(t,e){if(this.lastHoverOverlay===t)return;this.lastHoverOverlay&&t&&t.hasController("hover",this.lastHoverOverlay)||(this.clearHoverState(e),this.applyHoverState(t,e)),this.lastHoverOverlay=t}clearHoverState(t){this.lastHoverOverlay&&(this.canvas.classList.remove(this.getHoverClass(this.lastHoverOverlay)),this.lastHoverOverlay.notifyHover(!1,t))}applyHoverState(t,e){t&&(this.canvas.classList.add(this.getHoverClass(t)),t.notifyHover(!0,e))}getHoverClass(t){return t!=null&&t.isDraggable?"_nhanh_canvas_hover_overlay_draggable":"_nhanh_canvas_hover_overlay"}touchend(t){this.oldClientX=this.oldClientY=[]}touchmove(t){const e=t.touches;t.preventDefault();const{oldClientX:i,oldClientY:s,offset:r,delta:a,isAuto:l,isDraggable:h}=this;if(h&&!l){if(e.length===1){const{clientX:c,clientY:u}=e[0];i.length&&(r.x+=c-i[0],r.y+=u-s[0],this.redrawOnce()),this.oldClientX=[c],this.oldClientY=[u]}else if(e.length===2){const{clientX:c,clientY:u}=e[0],{clientX:f,clientY:m}=e[1];if(i.length==2){const v=Rt(i[0],s[0],i[1],s[1]),g=Rt(c,u,f,m),{x:y,y:C}=It(c,u,f,m);this.setScale({clientX:y,clientY:C},g>v?a:-a),this.redrawOnce()}this.oldClientX=[c,f],this.oldClientY=[u,m]}}}destroy(){var t;super.destroy(),(t=this.unBind)==null||t.call(this)}}class ni extends si{getDefaultOverlayGroup(){var a,l,h,c,u;const n=this.layerGroups.get("");if(!n)return;const t=(a=n.getLayer(""))==null?void 0:a.getGroup(""),e=(l=n.getLayer(""))==null?void 0:l.getGroup(""),i=(h=n.getLayer(""))==null?void 0:h.getGroup(""),s=(c=n.getLayer(""))==null?void 0:c.getGroup(""),r=(u=n.getLayer(""))==null?void 0:u.getGroup("");return{overlays_text:s,overlays_point:t,overlays_line:e,overlays_polygon:i,overlays_custom:r}}getAllOverlays(n){const t=[],e=n!==void 0?Array.isArray(n)?[...n]:[n]:Array.from(this.layerGroups.values());for(;e.length>0;){const i=e.pop();if(i instanceof et){if(!i.show.isVisible)continue;e.push(...i.layers.values())}else if(i instanceof B){if(!i.show.isVisible)continue;e.push(...i.groups.values())}else if(i instanceof Y){if(!i.show.isVisible)continue;e.push(...i.overlays.values())}else i.show.isVisible&&t.push(i)}return t}setFitView(n=void 0,t=!1,e=[60,60,60,60],i){const s=this.getAllOverlays(n);if(s.length===0)return;const{minX:r,maxX:a,minY:l,maxY:h}=this.calculateBoundingBox(s),c=a-r,u=h-l,f=this.calculateOptimalScale(c,u,e,i),m=this.calculateOffsetDifference(r,a,l,h,e);f==this.scale&&m.x==0&&m.y==0||(t?this.applyTransformImmediately(f,m):this.animateTransform(f,m))}calculateBoundingBox(n){let t=1/0,e=-1/0,i=1/0,s=-1/0;for(const r of n){const a=r.staticValueScope;t=Math.min(t,a.minX),e=Math.max(e,a.maxX),i=Math.min(i,a.minY),s=Math.max(s,a.maxY)}return{minX:t,maxX:e,minY:i,maxY:s}}calculateOptimalScale(n,t,e,i){const{width:s,height:r}=this.rect.value,{cycle:a,delta:l,axisConfig:h}=this,c=Math.max(0,s-e[1]-e[3])||s,u=Math.max(0,r-e[0]-e[2])||r;if(c<=0||u<=0)return console.warn(""),this.scale;const f=n/c,m=t/u,v=Math.max(f,m),g=h.count,y=g/h.min,C=a*l;let S;if(v>y){const b=Math.ceil(v/y);S=1-((g*b/v-h.min)/h.min+(b-2))*C}else{const b=(J,Z,z)=>J<Z?z:b(J/2,Z,z+1),k=b(y,v,0),$=Math.pow(2,k);S=1+((g/$/v-h.min)/h.min+k)*C}return i!==void 0&&(S=Math.min(i,S)),S=new N(S).div(l).round().mul(l).toNumber(),S}calculateOffsetDifference(n,t,e,i,s){const{width:r,height:a}=this.rect.value,{axisConfig:l,center:h}=this,c=(t+n)/2,u=(i+e)/2,f=this.getAxisPointByValue(c,u),m=this.getAxisValueByPoint((r/2-h.x)*l.x,(a/2-h.y)*l.y),v=this.getAxisPointByValue(m.xV,m.yV);return{x:Math.round(-(f.x+(s[3]-s[1])-v.x)*l.x),y:Math.round(-(f.y+(s[0]-s[2])-v.y)*l.y)}}applyTransformImmediately(n,t){this.offset={x:this.offset.x+t.x,y:this.offset.y+t.y},this.scale=n,this.updateSize(),this.redrawOnce()}animateTransform(n,t){const e=this.scale,i={...this.offset},s=300;this.isAuto=!0;const r=()=>this.isAuto=!1;(h=>this.animateOffset(i,t,s,h||r))(h=>this.animateScale(e,n,s,h||r))}animateScale(n,t,e,i){const s=t-n;let r=0;ft(a=>{!this.isAuto||!this.canvas||!this.isInteractive||(this.setScale("center",(a-r)*s),r=a,this.redrawOnce(),a===1&&i())},e)}animateOffset(n,t,e,i){ft(s=>{!this.isAuto||!this.canvas||!this.isInteractive||(this.offset={x:Number((n.x+t.x*s).toFixed(0)),y:Number((n.y+t.y*s).toFixed(0))},this.redrawOnce(),s===1&&i())},e)}returnToOrigin(){if(!this.isInteractive||this.scale==1&&this.offset.x==0&&this.offset.y==0)return;const{rect:n,axisConfig:t}=this,e=this.getDefaultCenterLocation(),i=(n.value.width/2-e.x)*t.x,s=(n.value.height/2-e.y)*t.y,r=this.getAxisValueByPoint(i,s,!0),a=this.getMousePositionOnAxis({clientX:n.value.x+n.value.width/2,clientY:n.value.y+n.value.height/2}),l=this.getAxisValueByPoint(a.x,a.y),h=t.size/this.getNowGridCount,c=(l.xV-r.xV)*t.x*h,u=(l.yV-r.yV)*t.y*h;this.animateTransform(1,{x:c,y:u})}zoom(n){const{canvas:t,rect:e}=this;if(!t||!e)return console.error("canvas is not HTMLCanvasElement");this.setScale("center",n),this.redrawOnce()}zoomIn(){this.zoom(this.delta)}zoomOut(){this.zoom(-this.delta)}setStyle(n){super.setStyle(n),this.redrawOnce()}setTheme(n){super.setTheme(n),this.redrawOnce()}setAxis(n){super.setAxis(n),this.redrawOnce()}setDefaultCenter(n){super.setDefaultCenter(n),this.redrawOnce()}toggleAxis(n){this.drawAxis.toggleAxis(n),this.redrawOnce()}togglePoint(n){const{overlays_point:t}=this.getDefaultOverlayGroup()||{};return t?(t.show.isVisible=n??!t.show,this.redrawOnce(),t.show):!1}toggleLine(n){const{overlays_line:t}=this.getDefaultOverlayGroup()||{};return t?(t.show.isVisible=n??!t.show,this.redrawOnce(),t.show):!1}togglePolygon(n){const{overlays_polygon:t}=this.getDefaultOverlayGroup()||{};return t?(t.show.isVisible=n??!t.show,this.redrawOnce(),t.show):!1}toggleLock(n){return this.isInteractive=n??!this.isInteractive,this.isInteractive}}class F extends ni{constructor(n){super(n),this.drawAxis=new Ze(this),"axisShow"in n&&this.toggleAxis(n.axisShow),this.initLayerGroups(),this.updateCenter()}initLayerGroups(){const n=new B({name:""});n.addGroup(new Y({name:""})),n.setzIndex(1);const t=new B({name:""});t.addGroup(new Y({name:""})),t.setzIndex(2);const e=new B({name:""});e.addGroup(new Y({name:""})),e.setzIndex(3);const i=new B({name:""});i.addGroup(new Y({name:""})),i.setzIndex(4);const s=new B({name:""});s.addGroup(new Y({name:""})),s.setzIndex(5);const r=new et({name:""});r.addLayer([i,e,t,n,s]),this.setLayerGroups(r)}gteLayerGroups(n){return this.layerGroups.get(n)}setLayerGroups(n){n instanceof et&&(this.layerGroups.set(n.name,n),n.setNotifyReload(()=>this.redrawOnce()),n.setMainCanvas(this),n.parent=this)}removeLayerGroups(n){n instanceof et&&(this.layerGroups.delete(n.name),n.setNotifyReload(),n.setMainCanvas(),n.parent=void 0,this.redrawOnce())}addLayer(n){const t=this.layerGroups.get("");t&&t.addLayer([n].flat())}removeLayer(n){const t=this.layerGroups.get("");t&&t.removeLayer([n].flat())}addOverlay(n){const{overlays_text:t,overlays_point:e,overlays_line:i,overlays_polygon:s,overlays_custom:r}=this.getDefaultOverlayGroup()||{};[n].flat().forEach(a=>{a instanceof at?t==null||t.addOverlays(a):a instanceof Q?e==null||e.addOverlays(a):a instanceof lt?i==null||i.addOverlays(a):a instanceof ht?s==null||s.addOverlays(a):a instanceof ct&&(r==null||r.addOverlays(a))})}removeOverlay(n){const{overlays_text:t,overlays_point:e,overlays_line:i,overlays_polygon:s,overlays_custom:r}=this.getDefaultOverlayGroup()||{};[n].flat().forEach(a=>{a instanceof at?t==null||t.removeOverlays(a):a instanceof Q?e==null||e.removeOverlays(a):a instanceof lt?i==null||i.removeOverlays(a):a instanceof ht?s==null||s.removeOverlays(a):a instanceof ct&&(r==null||r.addOverlays(a))})}destroy(){super.destroy()}}d(F,"LayerGroup",et),d(F,"Layer",B),d(F,"OverlayGroup",Y),d(F,"Text",at),d(F,"Point",Q),d(F,"Line",lt),d(F,"Polygon",ht),d(F,"Custom",ct);export{F as _};
