var Zt=Object.defineProperty;var $t=(n,r,t)=>r in n?Zt(n,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[r]=t;var d=(n,r,t)=>$t(n,typeof r!="symbol"?r+"":r,t);import{aQ as Jt,da as Vt,db as K,c7 as pt,dc as Kt,dd as Mt,de as st,df as Qt,aR as te,dg as ee,dh as _t}from"./index-zsy9fzWA.js";/*!
 *  decimal.js v10.5.0
 *  An arbitrary-precision Decimal type for JavaScript.
 *  https://github.com/MikeMcl/decimal.js
 *  Copyright (c) 2025 Michael Mclaughlin <M8ch88l@gmail.com>
 *  MIT Licence
 */var tt=9e15,Z=1e9,St="0123456789abcdef",mt="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",yt="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",Rt={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-tt,maxE:tt,crypto:!1},Lt,F,b=!0,wt="[DecimalError] ",j=wt+"Invalid argument: ",Tt=wt+"Precision limit exceeded",Bt=wt+"crypto unavailable",Gt="[object Decimal]",H=Math.floor,_=Math.pow,ie=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,se=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,ne=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,Xt=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,T=1e7,C=7,re=9007199254740991,ae=mt.length-1,kt=yt.length-1,m={toStringTag:Gt};m.absoluteValue=m.abs=function(){var n=new this.constructor(this);return n.s<0&&(n.s=1),P(n)};m.ceil=function(){return P(new this.constructor(this),this.e+1,2)};m.clampedTo=m.clamp=function(n,r){var t,e=this,i=e.constructor;if(n=new i(n),r=new i(r),!n.s||!r.s)return new i(NaN);if(n.gt(r))throw Error(j+r);return t=e.cmp(n),t<0?n:e.cmp(r)>0?r:new i(e)};m.comparedTo=m.cmp=function(n){var r,t,e,i,s=this,a=s.d,o=(n=new s.constructor(n)).d,l=s.s,h=n.s;if(!a||!o)return!l||!h?NaN:l!==h?l:a===o?0:!a^l<0?1:-1;if(!a[0]||!o[0])return a[0]?l:o[0]?-h:0;if(l!==h)return l;if(s.e!==n.e)return s.e>n.e^l<0?1:-1;for(e=a.length,i=o.length,r=0,t=e<i?e:i;r<t;++r)if(a[r]!==o[r])return a[r]>o[r]^l<0?1:-1;return e===i?0:e>i^l<0?1:-1};m.cosine=m.cos=function(){var n,r,t=this,e=t.constructor;return t.d?t.d[0]?(n=e.precision,r=e.rounding,e.precision=n+Math.max(t.e,t.sd())+C,e.rounding=1,t=oe(e,zt(e,t)),e.precision=n,e.rounding=r,P(F==2||F==3?t.neg():t,n,r,!0)):new e(1):new e(NaN)};m.cubeRoot=m.cbrt=function(){var n,r,t,e,i,s,a,o,l,h,c=this,u=c.constructor;if(!c.isFinite()||c.isZero())return new u(c);for(b=!1,s=c.s*_(c.s*c,1/3),!s||Math.abs(s)==1/0?(t=N(c.d),n=c.e,(s=(n-t.length+1)%3)&&(t+=s==1||s==-2?"0":"00"),s=_(t,1/3),n=H((n+1)/3)-(n%3==(n<0?-1:2)),s==1/0?t="5e"+n:(t=s.toExponential(),t=t.slice(0,t.indexOf("e")+1)+n),e=new u(t),e.s=c.s):e=new u(s.toString()),a=(n=u.precision)+3;;)if(o=e,l=o.times(o).times(o),h=l.plus(c),e=k(h.plus(c).times(o),h.plus(l),a+2,1),N(o.d).slice(0,a)===(t=N(e.d)).slice(0,a))if(t=t.slice(a-3,a+1),t=="9999"||!i&&t=="4999"){if(!i&&(P(o,n+1,0),o.times(o).times(o).eq(c))){e=o;break}a+=4,i=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(P(e,n+1,1),r=!e.times(e).times(e).eq(c));break}return b=!0,P(e,n,u.rounding,r)};m.decimalPlaces=m.dp=function(){var n,r=this.d,t=NaN;if(r){if(n=r.length-1,t=(n-H(this.e/C))*C,n=r[n],n)for(;n%10==0;n/=10)t--;t<0&&(t=0)}return t};m.dividedBy=m.div=function(n){return k(this,new this.constructor(n))};m.dividedToIntegerBy=m.divToInt=function(n){var r=this,t=r.constructor;return P(k(r,new t(n),0,1,1),t.precision,t.rounding)};m.equals=m.eq=function(n){return this.cmp(n)===0};m.floor=function(){return P(new this.constructor(this),this.e+1,3)};m.greaterThan=m.gt=function(n){return this.cmp(n)>0};m.greaterThanOrEqualTo=m.gte=function(n){var r=this.cmp(n);return r==1||r===0};m.hyperbolicCosine=m.cosh=function(){var n,r,t,e,i,s=this,a=s.constructor,o=new a(1);if(!s.isFinite())return new a(s.s?1/0:NaN);if(s.isZero())return o;t=a.precision,e=a.rounding,a.precision=t+Math.max(s.e,s.sd())+4,a.rounding=1,i=s.d.length,i<32?(n=Math.ceil(i/3),r=(1/Ct(4,n)).toString()):(n=16,r="2.3283064365386962890625e-10"),s=et(a,1,s.times(r),new a(1),!0);for(var l,h=n,c=new a(8);h--;)l=s.times(s),s=o.minus(l.times(c.minus(l.times(c))));return P(s,a.precision=t,a.rounding=e,!0)};m.hyperbolicSine=m.sinh=function(){var n,r,t,e,i=this,s=i.constructor;if(!i.isFinite()||i.isZero())return new s(i);if(r=s.precision,t=s.rounding,s.precision=r+Math.max(i.e,i.sd())+4,s.rounding=1,e=i.d.length,e<3)i=et(s,2,i,i,!0);else{n=1.4*Math.sqrt(e),n=n>16?16:n|0,i=i.times(1/Ct(5,n)),i=et(s,2,i,i,!0);for(var a,o=new s(5),l=new s(16),h=new s(20);n--;)a=i.times(i),i=i.times(o.plus(a.times(l.times(a).plus(h))))}return s.precision=r,s.rounding=t,P(i,r,t,!0)};m.hyperbolicTangent=m.tanh=function(){var n,r,t=this,e=t.constructor;return t.isFinite()?t.isZero()?new e(t):(n=e.precision,r=e.rounding,e.precision=n+7,e.rounding=1,k(t.sinh(),t.cosh(),e.precision=n,e.rounding=r)):new e(t.s)};m.inverseCosine=m.acos=function(){var n=this,r=n.constructor,t=n.abs().cmp(1),e=r.precision,i=r.rounding;return t!==-1?t===0?n.isNeg()?B(r,e,i):new r(0):new r(NaN):n.isZero()?B(r,e+4,i).times(.5):(r.precision=e+6,r.rounding=1,n=new r(1).minus(n).div(n.plus(1)).sqrt().atan(),r.precision=e,r.rounding=i,n.times(2))};m.inverseHyperbolicCosine=m.acosh=function(){var n,r,t=this,e=t.constructor;return t.lte(1)?new e(t.eq(1)?0:NaN):t.isFinite()?(n=e.precision,r=e.rounding,e.precision=n+Math.max(Math.abs(t.e),t.sd())+4,e.rounding=1,b=!1,t=t.times(t).minus(1).sqrt().plus(t),b=!0,e.precision=n,e.rounding=r,t.ln()):new e(t)};m.inverseHyperbolicSine=m.asinh=function(){var n,r,t=this,e=t.constructor;return!t.isFinite()||t.isZero()?new e(t):(n=e.precision,r=e.rounding,e.precision=n+2*Math.max(Math.abs(t.e),t.sd())+6,e.rounding=1,b=!1,t=t.times(t).plus(1).sqrt().plus(t),b=!0,e.precision=n,e.rounding=r,t.ln())};m.inverseHyperbolicTangent=m.atanh=function(){var n,r,t,e,i=this,s=i.constructor;return i.isFinite()?i.e>=0?new s(i.abs().eq(1)?i.s/0:i.isZero()?i:NaN):(n=s.precision,r=s.rounding,e=i.sd(),Math.max(e,n)<2*-i.e-1?P(new s(i),n,r,!0):(s.precision=t=e-i.e,i=k(i.plus(1),new s(1).minus(i),t+n,1),s.precision=n+4,s.rounding=1,i=i.ln(),s.precision=n,s.rounding=r,i.times(.5))):new s(NaN)};m.inverseSine=m.asin=function(){var n,r,t,e,i=this,s=i.constructor;return i.isZero()?new s(i):(r=i.abs().cmp(1),t=s.precision,e=s.rounding,r!==-1?r===0?(n=B(s,t+4,e).times(.5),n.s=i.s,n):new s(NaN):(s.precision=t+6,s.rounding=1,i=i.div(new s(1).minus(i.times(i)).sqrt().plus(1)).atan(),s.precision=t,s.rounding=e,i.times(2)))};m.inverseTangent=m.atan=function(){var n,r,t,e,i,s,a,o,l,h=this,c=h.constructor,u=c.precision,f=c.rounding;if(h.isFinite()){if(h.isZero())return new c(h);if(h.abs().eq(1)&&u+4<=kt)return a=B(c,u+4,f).times(.25),a.s=h.s,a}else{if(!h.s)return new c(NaN);if(u+4<=kt)return a=B(c,u+4,f).times(.5),a.s=h.s,a}for(c.precision=o=u+10,c.rounding=1,t=Math.min(28,o/C+2|0),n=t;n;--n)h=h.div(h.times(h).plus(1).sqrt().plus(1));for(b=!1,r=Math.ceil(o/C),e=1,l=h.times(h),a=new c(h),i=h;n!==-1;)if(i=i.times(l),s=a.minus(i.div(e+=2)),i=i.times(l),a=s.plus(i.div(e+=2)),a.d[r]!==void 0)for(n=r;a.d[n]===s.d[n]&&n--;);return t&&(a=a.times(2<<t-1)),b=!0,P(a,c.precision=u,c.rounding=f,!0)};m.isFinite=function(){return!!this.d};m.isInteger=m.isInt=function(){return!!this.d&&H(this.e/C)>this.d.length-2};m.isNaN=function(){return!this.s};m.isNegative=m.isNeg=function(){return this.s<0};m.isPositive=m.isPos=function(){return this.s>0};m.isZero=function(){return!!this.d&&this.d[0]===0};m.lessThan=m.lt=function(n){return this.cmp(n)<0};m.lessThanOrEqualTo=m.lte=function(n){return this.cmp(n)<1};m.logarithm=m.log=function(n){var r,t,e,i,s,a,o,l,h=this,c=h.constructor,u=c.precision,f=c.rounding,g=5;if(n==null)n=new c(10),r=!0;else{if(n=new c(n),t=n.d,n.s<0||!t||!t[0]||n.eq(1))return new c(NaN);r=n.eq(10)}if(t=h.d,h.s<0||!t||!t[0]||h.eq(1))return new c(t&&!t[0]?-1/0:h.s!=1?NaN:t?0:1/0);if(r)if(t.length>1)s=!0;else{for(i=t[0];i%10===0;)i/=10;s=i!==1}if(b=!1,o=u+g,a=q(h,o),e=r?vt(c,o+10):q(n,o),l=k(a,e,o,1),nt(l.d,i=u,f))do if(o+=10,a=q(h,o),e=r?vt(c,o+10):q(n,o),l=k(a,e,o,1),!s){+N(l.d).slice(i+1,i+15)+1==1e14&&(l=P(l,u+1,0));break}while(nt(l.d,i+=10,f));return b=!0,P(l,u,f)};m.minus=m.sub=function(n){var r,t,e,i,s,a,o,l,h,c,u,f,g=this,y=g.constructor;if(n=new y(n),!g.d||!n.d)return!g.s||!n.s?n=new y(NaN):g.d?n.s=-n.s:n=new y(n.d||g.s!==n.s?g:NaN),n;if(g.s!=n.s)return n.s=-n.s,g.plus(n);if(h=g.d,f=n.d,o=y.precision,l=y.rounding,!h[0]||!f[0]){if(f[0])n.s=-n.s;else if(h[0])n=new y(g);else return new y(l===3?-0:0);return b?P(n,o,l):n}if(t=H(n.e/C),c=H(g.e/C),h=h.slice(),s=c-t,s){for(u=s<0,u?(r=h,s=-s,a=f.length):(r=f,t=c,a=h.length),e=Math.max(Math.ceil(o/C),a)+2,s>e&&(s=e,r.length=1),r.reverse(),e=s;e--;)r.push(0);r.reverse()}else{for(e=h.length,a=f.length,u=e<a,u&&(a=e),e=0;e<a;e++)if(h[e]!=f[e]){u=h[e]<f[e];break}s=0}for(u&&(r=h,h=f,f=r,n.s=-n.s),a=h.length,e=f.length-a;e>0;--e)h[a++]=0;for(e=f.length;e>s;){if(h[--e]<f[e]){for(i=e;i&&h[--i]===0;)h[i]=T-1;--h[i],h[e]+=T}h[e]-=f[e]}for(;h[--a]===0;)h.pop();for(;h[0]===0;h.shift())--t;return h[0]?(n.d=h,n.e=Pt(h,t),b?P(n,o,l):n):new y(l===3?-0:0)};m.modulo=m.mod=function(n){var r,t=this,e=t.constructor;return n=new e(n),!t.d||!n.s||n.d&&!n.d[0]?new e(NaN):!n.d||t.d&&!t.d[0]?P(new e(t),e.precision,e.rounding):(b=!1,e.modulo==9?(r=k(t,n.abs(),0,3,1),r.s*=n.s):r=k(t,n,0,e.modulo,1),r=r.times(n),b=!0,t.minus(r))};m.naturalExponential=m.exp=function(){return Dt(this)};m.naturalLogarithm=m.ln=function(){return q(this)};m.negated=m.neg=function(){var n=new this.constructor(this);return n.s=-n.s,P(n)};m.plus=m.add=function(n){var r,t,e,i,s,a,o,l,h,c,u=this,f=u.constructor;if(n=new f(n),!u.d||!n.d)return!u.s||!n.s?n=new f(NaN):u.d||(n=new f(n.d||u.s===n.s?u:NaN)),n;if(u.s!=n.s)return n.s=-n.s,u.minus(n);if(h=u.d,c=n.d,o=f.precision,l=f.rounding,!h[0]||!c[0])return c[0]||(n=new f(u)),b?P(n,o,l):n;if(s=H(u.e/C),e=H(n.e/C),h=h.slice(),i=s-e,i){for(i<0?(t=h,i=-i,a=c.length):(t=c,e=s,a=h.length),s=Math.ceil(o/C),a=s>a?s+1:a+1,i>a&&(i=a,t.length=1),t.reverse();i--;)t.push(0);t.reverse()}for(a=h.length,i=c.length,a-i<0&&(i=a,t=c,c=h,h=t),r=0;i;)r=(h[--i]=h[i]+c[i]+r)/T|0,h[i]%=T;for(r&&(h.unshift(r),++e),a=h.length;h[--a]==0;)h.pop();return n.d=h,n.e=Pt(h,e),b?P(n,o,l):n};m.precision=m.sd=function(n){var r,t=this;if(n!==void 0&&n!==!!n&&n!==1&&n!==0)throw Error(j+n);return t.d?(r=Yt(t.d),n&&t.e+1>r&&(r=t.e+1)):r=NaN,r};m.round=function(){var n=this,r=n.constructor;return P(new r(n),n.e+1,r.rounding)};m.sine=m.sin=function(){var n,r,t=this,e=t.constructor;return t.isFinite()?t.isZero()?new e(t):(n=e.precision,r=e.rounding,e.precision=n+Math.max(t.e,t.sd())+C,e.rounding=1,t=he(e,zt(e,t)),e.precision=n,e.rounding=r,P(F>2?t.neg():t,n,r,!0)):new e(NaN)};m.squareRoot=m.sqrt=function(){var n,r,t,e,i,s,a=this,o=a.d,l=a.e,h=a.s,c=a.constructor;if(h!==1||!o||!o[0])return new c(!h||h<0&&(!o||o[0])?NaN:o?a:1/0);for(b=!1,h=Math.sqrt(+a),h==0||h==1/0?(r=N(o),(r.length+l)%2==0&&(r+="0"),h=Math.sqrt(r),l=H((l+1)/2)-(l<0||l%2),h==1/0?r="5e"+l:(r=h.toExponential(),r=r.slice(0,r.indexOf("e")+1)+l),e=new c(r)):e=new c(h.toString()),t=(l=c.precision)+3;;)if(s=e,e=s.plus(k(a,s,t+2,1)).times(.5),N(s.d).slice(0,t)===(r=N(e.d)).slice(0,t))if(r=r.slice(t-3,t+1),r=="9999"||!i&&r=="4999"){if(!i&&(P(s,l+1,0),s.times(s).eq(a))){e=s;break}t+=4,i=1}else{(!+r||!+r.slice(1)&&r.charAt(0)=="5")&&(P(e,l+1,1),n=!e.times(e).eq(a));break}return b=!0,P(e,l,c.rounding,n)};m.tangent=m.tan=function(){var n,r,t=this,e=t.constructor;return t.isFinite()?t.isZero()?new e(t):(n=e.precision,r=e.rounding,e.precision=n+10,e.rounding=1,t=t.sin(),t.s=1,t=k(t,new e(1).minus(t.times(t)).sqrt(),n+10,0),e.precision=n,e.rounding=r,P(F==2||F==4?t.neg():t,n,r,!0)):new e(NaN)};m.times=m.mul=function(n){var r,t,e,i,s,a,o,l,h,c=this,u=c.constructor,f=c.d,g=(n=new u(n)).d;if(n.s*=c.s,!f||!f[0]||!g||!g[0])return new u(!n.s||f&&!f[0]&&!g||g&&!g[0]&&!f?NaN:!f||!g?n.s/0:n.s*0);for(t=H(c.e/C)+H(n.e/C),l=f.length,h=g.length,l<h&&(s=f,f=g,g=s,a=l,l=h,h=a),s=[],a=l+h,e=a;e--;)s.push(0);for(e=h;--e>=0;){for(r=0,i=l+e;i>e;)o=s[i]+g[e]*f[i-e-1]+r,s[i--]=o%T|0,r=o/T|0;s[i]=(s[i]+r)%T|0}for(;!s[--a];)s.pop();return r?++t:s.shift(),n.d=s,n.e=Pt(s,t),b?P(n,u.precision,u.rounding):n};m.toBinary=function(n,r){return Ot(this,2,n,r)};m.toDecimalPlaces=m.toDP=function(n,r){var t=this,e=t.constructor;return t=new e(t),n===void 0?t:(I(n,0,Z),r===void 0?r=e.rounding:I(r,0,8),P(t,n+t.e+1,r))};m.toExponential=function(n,r){var t,e=this,i=e.constructor;return n===void 0?t=G(e,!0):(I(n,0,Z),r===void 0?r=i.rounding:I(r,0,8),e=P(new i(e),n+1,r),t=G(e,!0,n+1)),e.isNeg()&&!e.isZero()?"-"+t:t};m.toFixed=function(n,r){var t,e,i=this,s=i.constructor;return n===void 0?t=G(i):(I(n,0,Z),r===void 0?r=s.rounding:I(r,0,8),e=P(new s(i),n+i.e+1,r),t=G(e,!1,n+e.e+1)),i.isNeg()&&!i.isZero()?"-"+t:t};m.toFraction=function(n){var r,t,e,i,s,a,o,l,h,c,u,f,g=this,y=g.d,p=g.constructor;if(!y)return new p(g);if(h=t=new p(1),e=l=new p(0),r=new p(e),s=r.e=Yt(y)-g.e-1,a=s%C,r.d[0]=_(10,a<0?C+a:a),n==null)n=s>0?r:h;else{if(o=new p(n),!o.isInt()||o.lt(h))throw Error(j+o);n=o.gt(r)?s>0?r:h:o}for(b=!1,o=new p(N(y)),c=p.precision,p.precision=s=y.length*C*2;u=k(o,r,0,1,1),i=t.plus(u.times(e)),i.cmp(n)!=1;)t=e,e=i,i=h,h=l.plus(u.times(i)),l=i,i=r,r=o.minus(u.times(i)),o=i;return i=k(n.minus(t),e,0,1,1),l=l.plus(i.times(h)),t=t.plus(i.times(e)),l.s=h.s=g.s,f=k(h,e,s,1).minus(g).abs().cmp(k(l,t,s,1).minus(g).abs())<1?[h,e]:[l,t],p.precision=c,b=!0,f};m.toHexadecimal=m.toHex=function(n,r){return Ot(this,16,n,r)};m.toNearest=function(n,r){var t=this,e=t.constructor;if(t=new e(t),n==null){if(!t.d)return t;n=new e(1),r=e.rounding}else{if(n=new e(n),r===void 0?r=e.rounding:I(r,0,8),!t.d)return n.s?t:n;if(!n.d)return n.s&&(n.s=t.s),n}return n.d[0]?(b=!1,t=k(t,n,0,r,1).times(n),b=!0,P(t)):(n.s=t.s,t=n),t};m.toNumber=function(){return+this};m.toOctal=function(n,r){return Ot(this,8,n,r)};m.toPower=m.pow=function(n){var r,t,e,i,s,a,o=this,l=o.constructor,h=+(n=new l(n));if(!o.d||!n.d||!o.d[0]||!n.d[0])return new l(_(+o,h));if(o=new l(o),o.eq(1))return o;if(e=l.precision,s=l.rounding,n.eq(1))return P(o,e,s);if(r=H(n.e/C),r>=n.d.length-1&&(t=h<0?-h:h)<=re)return i=Ut(l,o,t,e),n.s<0?new l(1).div(i):P(i,e,s);if(a=o.s,a<0){if(r<n.d.length-1)return new l(NaN);if(n.d[r]&1||(a=1),o.e==0&&o.d[0]==1&&o.d.length==1)return o.s=a,o}return t=_(+o,h),r=t==0||!isFinite(t)?H(h*(Math.log("0."+N(o.d))/Math.LN10+o.e+1)):new l(t+"").e,r>l.maxE+1||r<l.minE-1?new l(r>0?a/0:0):(b=!1,l.rounding=o.s=1,t=Math.min(12,(r+"").length),i=Dt(n.times(q(o,e+t)),e),i.d&&(i=P(i,e+5,1),nt(i.d,e,s)&&(r=e+10,i=P(Dt(n.times(q(o,r+t)),r),r+5,1),+N(i.d).slice(e+1,e+15)+1==1e14&&(i=P(i,e+1,0)))),i.s=a,b=!0,l.rounding=s,P(i,e,s))};m.toPrecision=function(n,r){var t,e=this,i=e.constructor;return n===void 0?t=G(e,e.e<=i.toExpNeg||e.e>=i.toExpPos):(I(n,1,Z),r===void 0?r=i.rounding:I(r,0,8),e=P(new i(e),n,r),t=G(e,n<=e.e||e.e<=i.toExpNeg,n)),e.isNeg()&&!e.isZero()?"-"+t:t};m.toSignificantDigits=m.toSD=function(n,r){var t=this,e=t.constructor;return n===void 0?(n=e.precision,r=e.rounding):(I(n,1,Z),r===void 0?r=e.rounding:I(r,0,8)),P(new e(t),n,r)};m.toString=function(){var n=this,r=n.constructor,t=G(n,n.e<=r.toExpNeg||n.e>=r.toExpPos);return n.isNeg()&&!n.isZero()?"-"+t:t};m.truncated=m.trunc=function(){return P(new this.constructor(this),this.e+1,1)};m.valueOf=m.toJSON=function(){var n=this,r=n.constructor,t=G(n,n.e<=r.toExpNeg||n.e>=r.toExpPos);return n.isNeg()?"-"+t:t};function N(n){var r,t,e,i=n.length-1,s="",a=n[0];if(i>0){for(s+=a,r=1;r<i;r++)e=n[r]+"",t=C-e.length,t&&(s+=z(t)),s+=e;a=n[r],e=a+"",t=C-e.length,t&&(s+=z(t))}else if(a===0)return"0";for(;a%10===0;)a/=10;return s+a}function I(n,r,t){if(n!==~~n||n<r||n>t)throw Error(j+n)}function nt(n,r,t,e){var i,s,a,o;for(s=n[0];s>=10;s/=10)--r;return--r<0?(r+=C,i=0):(i=Math.ceil((r+1)/C),r%=C),s=_(10,C-r),o=n[i]%s|0,e==null?r<3?(r==0?o=o/100|0:r==1&&(o=o/10|0),a=t<4&&o==99999||t>3&&o==49999||o==5e4||o==0):a=(t<4&&o+1==s||t>3&&o+1==s/2)&&(n[i+1]/s/100|0)==_(10,r-2)-1||(o==s/2||o==0)&&(n[i+1]/s/100|0)==0:r<4?(r==0?o=o/1e3|0:r==1?o=o/100|0:r==2&&(o=o/10|0),a=(e||t<4)&&o==9999||!e&&t>3&&o==4999):a=((e||t<4)&&o+1==s||!e&&t>3&&o+1==s/2)&&(n[i+1]/s/1e3|0)==_(10,r-3)-1,a}function ht(n,r,t){for(var e,i=[0],s,a=0,o=n.length;a<o;){for(s=i.length;s--;)i[s]*=r;for(i[0]+=St.indexOf(n.charAt(a++)),e=0;e<i.length;e++)i[e]>t-1&&(i[e+1]===void 0&&(i[e+1]=0),i[e+1]+=i[e]/t|0,i[e]%=t)}return i.reverse()}function oe(n,r){var t,e,i;if(r.isZero())return r;e=r.d.length,e<32?(t=Math.ceil(e/3),i=(1/Ct(4,t)).toString()):(t=16,i="2.3283064365386962890625e-10"),n.precision+=t,r=et(n,1,r.times(i),new n(1));for(var s=t;s--;){var a=r.times(r);r=a.times(a).minus(a).times(8).plus(1)}return n.precision-=t,r}var k=function(){function n(e,i,s){var a,o=0,l=e.length;for(e=e.slice();l--;)a=e[l]*i+o,e[l]=a%s|0,o=a/s|0;return o&&e.unshift(o),e}function r(e,i,s,a){var o,l;if(s!=a)l=s>a?1:-1;else for(o=l=0;o<s;o++)if(e[o]!=i[o]){l=e[o]>i[o]?1:-1;break}return l}function t(e,i,s,a){for(var o=0;s--;)e[s]-=o,o=e[s]<i[s]?1:0,e[s]=o*a+e[s]-i[s];for(;!e[0]&&e.length>1;)e.shift()}return function(e,i,s,a,o,l){var h,c,u,f,g,y,p,v,w,S,x,R,A,M,at,$,W,Q,L,ot,lt=e.constructor,xt=e.s==i.s?1:-1,E=e.d,D=i.d;if(!E||!E[0]||!D||!D[0])return new lt(!e.s||!i.s||(E?D&&E[0]==D[0]:!D)?NaN:E&&E[0]==0||!D?xt*0:xt/0);for(l?(g=1,c=e.e-i.e):(l=T,g=C,c=H(e.e/g)-H(i.e/g)),L=D.length,W=E.length,w=new lt(xt),S=w.d=[],u=0;D[u]==(E[u]||0);u++);if(D[u]>(E[u]||0)&&c--,s==null?(M=s=lt.precision,a=lt.rounding):o?M=s+(e.e-i.e)+1:M=s,M<0)S.push(1),y=!0;else{if(M=M/g+2|0,u=0,L==1){for(f=0,D=D[0],M++;(u<W||f)&&M--;u++)at=f*l+(E[u]||0),S[u]=at/D|0,f=at%D|0;y=f||u<W}else{for(f=l/(D[0]+1)|0,f>1&&(D=n(D,f,l),E=n(E,f,l),L=D.length,W=E.length),$=L,x=E.slice(0,L),R=x.length;R<L;)x[R++]=0;ot=D.slice(),ot.unshift(0),Q=D[0],D[1]>=l/2&&++Q;do f=0,h=r(D,x,L,R),h<0?(A=x[0],L!=R&&(A=A*l+(x[1]||0)),f=A/Q|0,f>1?(f>=l&&(f=l-1),p=n(D,f,l),v=p.length,R=x.length,h=r(p,x,v,R),h==1&&(f--,t(p,L<v?ot:D,v,l))):(f==0&&(h=f=1),p=D.slice()),v=p.length,v<R&&p.unshift(0),t(x,p,R,l),h==-1&&(R=x.length,h=r(D,x,L,R),h<1&&(f++,t(x,L<R?ot:D,R,l))),R=x.length):h===0&&(f++,x=[0]),S[u++]=f,h&&x[0]?x[R++]=E[$]||0:(x=[E[$]],R=1);while(($++<W||x[0]!==void 0)&&M--);y=x[0]!==void 0}S[0]||S.shift()}if(g==1)w.e=c,Lt=y;else{for(u=1,f=S[0];f>=10;f/=10)u++;w.e=u+c*g-1,P(w,o?s+w.e+1:s,a,y)}return w}}();function P(n,r,t,e){var i,s,a,o,l,h,c,u,f,g=n.constructor;t:if(r!=null){if(u=n.d,!u)return n;for(i=1,o=u[0];o>=10;o/=10)i++;if(s=r-i,s<0)s+=C,a=r,c=u[f=0],l=c/_(10,i-a-1)%10|0;else if(f=Math.ceil((s+1)/C),o=u.length,f>=o)if(e){for(;o++<=f;)u.push(0);c=l=0,i=1,s%=C,a=s-C+1}else break t;else{for(c=o=u[f],i=1;o>=10;o/=10)i++;s%=C,a=s-C+i,l=a<0?0:c/_(10,i-a-1)%10|0}if(e=e||r<0||u[f+1]!==void 0||(a<0?c:c%_(10,i-a-1)),h=t<4?(l||e)&&(t==0||t==(n.s<0?3:2)):l>5||l==5&&(t==4||e||t==6&&(s>0?a>0?c/_(10,i-a):0:u[f-1])%10&1||t==(n.s<0?8:7)),r<1||!u[0])return u.length=0,h?(r-=n.e+1,u[0]=_(10,(C-r%C)%C),n.e=-r||0):u[0]=n.e=0,n;if(s==0?(u.length=f,o=1,f--):(u.length=f+1,o=_(10,C-s),u[f]=a>0?(c/_(10,i-a)%_(10,a)|0)*o:0),h)for(;;)if(f==0){for(s=1,a=u[0];a>=10;a/=10)s++;for(a=u[0]+=o,o=1;a>=10;a/=10)o++;s!=o&&(n.e++,u[0]==T&&(u[0]=1));break}else{if(u[f]+=o,u[f]!=T)break;u[f--]=0,o=1}for(s=u.length;u[--s]===0;)u.pop()}return b&&(n.e>g.maxE?(n.d=null,n.e=NaN):n.e<g.minE&&(n.e=0,n.d=[0])),n}function G(n,r,t){if(!n.isFinite())return Wt(n);var e,i=n.e,s=N(n.d),a=s.length;return r?(t&&(e=t-a)>0?s=s.charAt(0)+"."+s.slice(1)+z(e):a>1&&(s=s.charAt(0)+"."+s.slice(1)),s=s+(n.e<0?"e":"e+")+n.e):i<0?(s="0."+z(-i-1)+s,t&&(e=t-a)>0&&(s+=z(e))):i>=a?(s+=z(i+1-a),t&&(e=t-i-1)>0&&(s=s+"."+z(e))):((e=i+1)<a&&(s=s.slice(0,e)+"."+s.slice(e)),t&&(e=t-a)>0&&(i+1===a&&(s+="."),s+=z(e))),s}function Pt(n,r){var t=n[0];for(r*=C;t>=10;t/=10)r++;return r}function vt(n,r,t){if(r>ae)throw b=!0,t&&(n.precision=t),Error(Tt);return P(new n(mt),r,1,!0)}function B(n,r,t){if(r>kt)throw Error(Tt);return P(new n(yt),r,t,!0)}function Yt(n){var r=n.length-1,t=r*C+1;if(r=n[r],r){for(;r%10==0;r/=10)t--;for(r=n[0];r>=10;r/=10)t++}return t}function z(n){for(var r="";n--;)r+="0";return r}function Ut(n,r,t,e){var i,s=new n(1),a=Math.ceil(e/C+4);for(b=!1;;){if(t%2&&(s=s.times(r),Et(s.d,a)&&(i=!0)),t=H(t/2),t===0){t=s.d.length-1,i&&s.d[t]===0&&++s.d[t];break}r=r.times(r),Et(r.d,a)}return b=!0,s}function Nt(n){return n.d[n.d.length-1]&1}function Ft(n,r,t){for(var e,i,s=new n(r[0]),a=0;++a<r.length;){if(i=new n(r[a]),!i.s){s=i;break}e=s.cmp(i),(e===t||e===0&&s.s===t)&&(s=i)}return s}function Dt(n,r){var t,e,i,s,a,o,l,h=0,c=0,u=0,f=n.constructor,g=f.rounding,y=f.precision;if(!n.d||!n.d[0]||n.e>17)return new f(n.d?n.d[0]?n.s<0?0:1/0:1:n.s?n.s<0?0:n:NaN);for(r==null?(b=!1,l=y):l=r,o=new f(.03125);n.e>-2;)n=n.times(o),u+=5;for(e=Math.log(_(2,u))/Math.LN10*2+5|0,l+=e,t=s=a=new f(1),f.precision=l;;){if(s=P(s.times(n),l,1),t=t.times(++c),o=a.plus(k(s,t,l,1)),N(o.d).slice(0,l)===N(a.d).slice(0,l)){for(i=u;i--;)a=P(a.times(a),l,1);if(r==null)if(h<3&&nt(a.d,l-e,g,h))f.precision=l+=10,t=s=o=new f(1),c=0,h++;else return P(a,f.precision=y,g,b=!0);else return f.precision=y,a}a=o}}function q(n,r){var t,e,i,s,a,o,l,h,c,u,f,g=1,y=10,p=n,v=p.d,w=p.constructor,S=w.rounding,x=w.precision;if(p.s<0||!v||!v[0]||!p.e&&v[0]==1&&v.length==1)return new w(v&&!v[0]?-1/0:p.s!=1?NaN:v?0:p);if(r==null?(b=!1,c=x):c=r,w.precision=c+=y,t=N(v),e=t.charAt(0),Math.abs(s=p.e)<15e14){for(;e<7&&e!=1||e==1&&t.charAt(1)>3;)p=p.times(n),t=N(p.d),e=t.charAt(0),g++;s=p.e,e>1?(p=new w("0."+t),s++):p=new w(e+"."+t.slice(1))}else return h=vt(w,c+2,x).times(s+""),p=q(new w(e+"."+t.slice(1)),c-y).plus(h),w.precision=x,r==null?P(p,x,S,b=!0):p;for(u=p,l=a=p=k(p.minus(1),p.plus(1),c,1),f=P(p.times(p),c,1),i=3;;){if(a=P(a.times(f),c,1),h=l.plus(k(a,new w(i),c,1)),N(h.d).slice(0,c)===N(l.d).slice(0,c))if(l=l.times(2),s!==0&&(l=l.plus(vt(w,c+2,x).times(s+""))),l=k(l,new w(g),c,1),r==null)if(nt(l.d,c-y,S,o))w.precision=c+=y,h=a=p=k(u.minus(1),u.plus(1),c,1),f=P(p.times(p),c,1),i=o=1;else return P(l,w.precision=x,S,b=!0);else return w.precision=x,l;l=h,i+=2}}function Wt(n){return String(n.s*n.s/0)}function ct(n,r){var t,e,i;for((t=r.indexOf("."))>-1&&(r=r.replace(".","")),(e=r.search(/e/i))>0?(t<0&&(t=e),t+=+r.slice(e+1),r=r.substring(0,e)):t<0&&(t=r.length),e=0;r.charCodeAt(e)===48;e++);for(i=r.length;r.charCodeAt(i-1)===48;--i);if(r=r.slice(e,i),r){if(i-=e,n.e=t=t-e-1,n.d=[],e=(t+1)%C,t<0&&(e+=C),e<i){for(e&&n.d.push(+r.slice(0,e)),i-=C;e<i;)n.d.push(+r.slice(e,e+=C));r=r.slice(e),e=C-r.length}else e-=i;for(;e--;)r+="0";n.d.push(+r),b&&(n.e>n.constructor.maxE?(n.d=null,n.e=NaN):n.e<n.constructor.minE&&(n.e=0,n.d=[0]))}else n.e=0,n.d=[0];return n}function le(n,r){var t,e,i,s,a,o,l,h,c;if(r.indexOf("_")>-1){if(r=r.replace(/(\d)_(?=\d)/g,"$1"),Xt.test(r))return ct(n,r)}else if(r==="Infinity"||r==="NaN")return+r||(n.s=NaN),n.e=NaN,n.d=null,n;if(se.test(r))t=16,r=r.toLowerCase();else if(ie.test(r))t=2;else if(ne.test(r))t=8;else throw Error(j+r);for(s=r.search(/p/i),s>0?(l=+r.slice(s+1),r=r.substring(2,s)):r=r.slice(2),s=r.indexOf("."),a=s>=0,e=n.constructor,a&&(r=r.replace(".",""),o=r.length,s=o-s,i=Ut(e,new e(t),s,s*2)),h=ht(r,t,T),c=h.length-1,s=c;h[s]===0;--s)h.pop();return s<0?new e(n.s*0):(n.e=Pt(h,c),n.d=h,b=!1,a&&(n=k(n,i,o*4)),l&&(n=n.times(Math.abs(l)<54?_(2,l):V.pow(2,l))),b=!0,n)}function he(n,r){var t,e=r.d.length;if(e<3)return r.isZero()?r:et(n,2,r,r);t=1.4*Math.sqrt(e),t=t>16?16:t|0,r=r.times(1/Ct(5,t)),r=et(n,2,r,r);for(var i,s=new n(5),a=new n(16),o=new n(20);t--;)i=r.times(r),r=r.times(s.plus(i.times(a.times(i).minus(o))));return r}function et(n,r,t,e,i){var s,a,o,l,h=n.precision,c=Math.ceil(h/C);for(b=!1,l=t.times(t),o=new n(e);;){if(a=k(o.times(l),new n(r++*r++),h,1),o=i?e.plus(a):e.minus(a),e=k(a.times(l),new n(r++*r++),h,1),a=o.plus(e),a.d[c]!==void 0){for(s=c;a.d[s]===o.d[s]&&s--;);if(s==-1)break}s=o,o=e,e=a,a=s}return b=!0,a.d.length=c+1,a}function Ct(n,r){for(var t=n;--r;)t*=n;return t}function zt(n,r){var t,e=r.s<0,i=B(n,n.precision,1),s=i.times(.5);if(r=r.abs(),r.lte(s))return F=e?4:1,r;if(t=r.divToInt(i),t.isZero())F=e?3:2;else{if(r=r.minus(t.times(i)),r.lte(s))return F=Nt(t)?e?2:3:e?4:1,r;F=Nt(t)?e?1:4:e?3:2}return r.minus(i).abs()}function Ot(n,r,t,e){var i,s,a,o,l,h,c,u,f,g=n.constructor,y=t!==void 0;if(y?(I(t,1,Z),e===void 0?e=g.rounding:I(e,0,8)):(t=g.precision,e=g.rounding),!n.isFinite())c=Wt(n);else{for(c=G(n),a=c.indexOf("."),y?(i=2,r==16?t=t*4-3:r==8&&(t=t*3-2)):i=r,a>=0&&(c=c.replace(".",""),f=new g(1),f.e=c.length-a,f.d=ht(G(f),10,i),f.e=f.d.length),u=ht(c,10,i),s=l=u.length;u[--l]==0;)u.pop();if(!u[0])c=y?"0p+0":"0";else{if(a<0?s--:(n=new g(n),n.d=u,n.e=s,n=k(n,f,t,e,0,i),u=n.d,s=n.e,h=Lt),a=u[t],o=i/2,h=h||u[t+1]!==void 0,h=e<4?(a!==void 0||h)&&(e===0||e===(n.s<0?3:2)):a>o||a===o&&(e===4||h||e===6&&u[t-1]&1||e===(n.s<0?8:7)),u.length=t,h)for(;++u[--t]>i-1;)u[t]=0,t||(++s,u.unshift(1));for(l=u.length;!u[l-1];--l);for(a=0,c="";a<l;a++)c+=St.charAt(u[a]);if(y){if(l>1)if(r==16||r==8){for(a=r==16?4:3,--l;l%a;l++)c+="0";for(u=ht(c,i,r),l=u.length;!u[l-1];--l);for(a=1,c="1.";a<l;a++)c+=St.charAt(u[a])}else c=c.charAt(0)+"."+c.slice(1);c=c+(s<0?"p":"p+")+s}else if(s<0){for(;++s;)c="0"+c;c="0."+c}else if(++s>l)for(s-=l;s--;)c+="0";else s<l&&(c=c.slice(0,s)+"."+c.slice(s))}c=(r==16?"0x":r==2?"0b":r==8?"0o":"")+c}return n.s<0?"-"+c:c}function Et(n,r){if(n.length>r)return n.length=r,!0}function ce(n){return new this(n).abs()}function ue(n){return new this(n).acos()}function fe(n){return new this(n).acosh()}function de(n,r){return new this(n).plus(r)}function ge(n){return new this(n).asin()}function pe(n){return new this(n).asinh()}function me(n){return new this(n).atan()}function ye(n){return new this(n).atanh()}function ve(n,r){n=new this(n),r=new this(r);var t,e=this.precision,i=this.rounding,s=e+4;return!n.s||!r.s?t=new this(NaN):!n.d&&!r.d?(t=B(this,s,1).times(r.s>0?.25:.75),t.s=n.s):!r.d||n.isZero()?(t=r.s<0?B(this,e,i):new this(0),t.s=n.s):!n.d||r.isZero()?(t=B(this,s,1).times(.5),t.s=n.s):r.s<0?(this.precision=s,this.rounding=1,t=this.atan(k(n,r,s,1)),r=B(this,s,1),this.precision=e,this.rounding=i,t=n.s<0?t.minus(r):t.plus(r)):t=this.atan(k(n,r,s,1)),t}function we(n){return new this(n).cbrt()}function Pe(n){return P(n=new this(n),n.e+1,2)}function Ce(n,r,t){return new this(n).clamp(r,t)}function xe(n){if(!n||typeof n!="object")throw Error(wt+"Object expected");var r,t,e,i=n.defaults===!0,s=["precision",1,Z,"rounding",0,8,"toExpNeg",-tt,0,"toExpPos",0,tt,"maxE",0,tt,"minE",-tt,0,"modulo",0,9];for(r=0;r<s.length;r+=3)if(t=s[r],i&&(this[t]=Rt[t]),(e=n[t])!==void 0)if(H(e)===e&&e>=s[r+1]&&e<=s[r+2])this[t]=e;else throw Error(j+t+": "+e);if(t="crypto",i&&(this[t]=Rt[t]),(e=n[t])!==void 0)if(e===!0||e===!1||e===0||e===1)if(e)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(Bt);else this[t]=!1;else throw Error(j+t+": "+e);return this}function be(n){return new this(n).cos()}function Se(n){return new this(n).cosh()}function qt(n){var r,t,e;function i(s){var a,o,l,h=this;if(!(h instanceof i))return new i(s);if(h.constructor=i,Ht(s)){h.s=s.s,b?!s.d||s.e>i.maxE?(h.e=NaN,h.d=null):s.e<i.minE?(h.e=0,h.d=[0]):(h.e=s.e,h.d=s.d.slice()):(h.e=s.e,h.d=s.d?s.d.slice():s.d);return}if(l=typeof s,l==="number"){if(s===0){h.s=1/s<0?-1:1,h.e=0,h.d=[0];return}if(s<0?(s=-s,h.s=-1):h.s=1,s===~~s&&s<1e7){for(a=0,o=s;o>=10;o/=10)a++;b?a>i.maxE?(h.e=NaN,h.d=null):a<i.minE?(h.e=0,h.d=[0]):(h.e=a,h.d=[s]):(h.e=a,h.d=[s]);return}if(s*0!==0){s||(h.s=NaN),h.e=NaN,h.d=null;return}return ct(h,s.toString())}if(l==="string")return(o=s.charCodeAt(0))===45?(s=s.slice(1),h.s=-1):(o===43&&(s=s.slice(1)),h.s=1),Xt.test(s)?ct(h,s):le(h,s);if(l==="bigint")return s<0?(s=-s,h.s=-1):h.s=1,ct(h,s.toString());throw Error(j+s)}if(i.prototype=m,i.ROUND_UP=0,i.ROUND_DOWN=1,i.ROUND_CEIL=2,i.ROUND_FLOOR=3,i.ROUND_HALF_UP=4,i.ROUND_HALF_DOWN=5,i.ROUND_HALF_EVEN=6,i.ROUND_HALF_CEIL=7,i.ROUND_HALF_FLOOR=8,i.EUCLID=9,i.config=i.set=xe,i.clone=qt,i.isDecimal=Ht,i.abs=ce,i.acos=ue,i.acosh=fe,i.add=de,i.asin=ge,i.asinh=pe,i.atan=me,i.atanh=ye,i.atan2=ve,i.cbrt=we,i.ceil=Pe,i.clamp=Ce,i.cos=be,i.cosh=Se,i.div=Re,i.exp=ke,i.floor=De,i.hypot=Ve,i.ln=Oe,i.log=_e,i.log10=Ee,i.log2=Ne,i.max=He,i.min=Ae,i.mod=Ie,i.mul=Me,i.pow=Le,i.random=Te,i.round=Be,i.sign=Ge,i.sin=Xe,i.sinh=Ye,i.sqrt=Ue,i.sub=Fe,i.sum=We,i.tan=ze,i.tanh=qe,i.trunc=je,n===void 0&&(n={}),n&&n.defaults!==!0)for(e=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],r=0;r<e.length;)n.hasOwnProperty(t=e[r++])||(n[t]=this[t]);return i.config(n),i}function Re(n,r){return new this(n).div(r)}function ke(n){return new this(n).exp()}function De(n){return P(n=new this(n),n.e+1,3)}function Ve(){var n,r,t=new this(0);for(b=!1,n=0;n<arguments.length;)if(r=new this(arguments[n++]),r.d)t.d&&(t=t.plus(r.times(r)));else{if(r.s)return b=!0,new this(1/0);t=r}return b=!0,t.sqrt()}function Ht(n){return n instanceof V||n&&n.toStringTag===Gt||!1}function Oe(n){return new this(n).ln()}function _e(n,r){return new this(n).log(r)}function Ne(n){return new this(n).log(2)}function Ee(n){return new this(n).log(10)}function He(){return Ft(this,arguments,-1)}function Ae(){return Ft(this,arguments,1)}function Ie(n,r){return new this(n).mod(r)}function Me(n,r){return new this(n).mul(r)}function Le(n,r){return new this(n).pow(r)}function Te(n){var r,t,e,i,s=0,a=new this(1),o=[];if(n===void 0?n=this.precision:I(n,1,Z),e=Math.ceil(n/C),this.crypto)if(crypto.getRandomValues)for(r=crypto.getRandomValues(new Uint32Array(e));s<e;)i=r[s],i>=429e7?r[s]=crypto.getRandomValues(new Uint32Array(1))[0]:o[s++]=i%1e7;else if(crypto.randomBytes){for(r=crypto.randomBytes(e*=4);s<e;)i=r[s]+(r[s+1]<<8)+(r[s+2]<<16)+((r[s+3]&127)<<24),i>=214e7?crypto.randomBytes(4).copy(r,s):(o.push(i%1e7),s+=4);s=e/4}else throw Error(Bt);else for(;s<e;)o[s++]=Math.random()*1e7|0;for(e=o[--s],n%=C,e&&n&&(i=_(10,C-n),o[s]=(e/i|0)*i);o[s]===0;s--)o.pop();if(s<0)t=0,o=[0];else{for(t=-1;o[0]===0;t-=C)o.shift();for(e=1,i=o[0];i>=10;i/=10)e++;e<C&&(t-=C-e)}return a.e=t,a.d=o,a}function Be(n){return P(n=new this(n),n.e+1,this.rounding)}function Ge(n){return n=new this(n),n.d?n.d[0]?n.s:0*n.s:n.s||NaN}function Xe(n){return new this(n).sin()}function Ye(n){return new this(n).sinh()}function Ue(n){return new this(n).sqrt()}function Fe(n,r){return new this(n).sub(r)}function We(){var n=0,r=arguments,t=new this(r[n]);for(b=!1;t.s&&++n<r.length;)t=t.plus(r[n]);return b=!0,P(t,this.precision,this.rounding)}function ze(n){return new this(n).tan()}function qe(n){return new this(n).tanh()}function je(n){return P(n=new this(n),n.e+1,1)}m[Symbol.for("nodejs.util.inspect.custom")]=m.toString;m[Symbol.toStringTag]="Decimal";var V=m.constructor=qt(Rt);mt=new V(mt);yt=new V(yt);function At(n){const t=n.toString().split("."),e=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,",");return t.length>1?e+"."+t[1]:e}class Ze{constructor(r){d(this,"canvas");d(this,"axis_canvas",document.createElement("canvas"));d(this,"ctx",this.axis_canvas.getContext("2d"));d(this,"isReload",!1);d(this,"show",{all:!0,grid:{main:!0,secondary:!0},axis:!0,axisText:!0});this.canvas=r,this.initAxisCanvas()}initAxisCanvas(){const{canvas:r,axis_canvas:t}=this;r&&(t.width=r.rect.width||0,t.height=r.rect.height||0)}toggleAxis(r){const t=(()=>{if(typeof r=="object"){const{all:e=!0,grid:i={main:!0,secondary:!0},axis:s=!0,axisText:a=!0}=r;return Object.assign({main:!0,secondary:!0},i),{all:e,grid:i,axis:s,axisText:a}}return typeof r=="boolean"?{all:!0,grid:{main:r,secondary:r},axis:r,axisText:r}:!this.show.all})();typeof t=="boolean"?this.show.all=t:this.show=t,this.isReload=!0}drawAxisAndGrid(){if(!(!this.canvas||!this.show.all))return(this.canvas.isRecalculate||this.isReload||this.canvas.isThemeUpdated)&&(this.isReload=!1,this.initAxisCanvas(),(this.show.grid.main||this.show.grid.secondary)&&this.drawGrid(),this.show.axis&&this.drawAxis(),this.show.axisText&&this.drawAxisText()),this.axis_canvas}color(){const{theme:r,style:t}=this.canvas;return(t[r]||t.light).grid}drawGrid(){const{canvas:r,ctx:t}=this,{rect:e,center:i,axisConfig:s}=r,{width:a,height:o}=e,l=this.color(),h=s.size,c=h/5;t.lineWidth=1;const u=(g,y)=>{const p=i.x%g>0?i.x%g:g+i.x%g;t.strokeStyle=y,t.beginPath();for(let v=0;v*g+p<=a;v++)t.moveTo(v*g+p,0),t.lineTo(v*g+p,o);t.stroke()},f=(g,y)=>{const p=i.y%g>0?i.y%g:g+i.y%g;t.strokeStyle=y,t.beginPath();for(let v=0;v*g+p<=o;v++)t.moveTo(0,v*g+p),t.lineTo(a,v*g+p);t.stroke()};this.show.grid.secondary&&(u(c,l.innerGrid),f(c,l.innerGrid)),this.show.grid.main&&(u(h,l.grid),f(h,l.grid))}drawAxis(){const{canvas:r,ctx:t}=this,{rect:e,center:i}=r,{width:s,height:a}=e,o=this.color();t.lineWidth=2,t.strokeStyle=o.axis;const l=()=>{i.y>=0&&i.y<=a&&(t.beginPath(),t.moveTo(0,i.y),t.lineTo(s,i.y),t.stroke())},h=()=>{i.x>=0&&i.x<=s&&(t.beginPath(),t.moveTo(i.x,0),t.lineTo(i.x,a),t.stroke())};l(),h()}drawText(r,t,e,i){const{canvas:s,ctx:a}=this,{theme:o}=s,l=this.canvas.style[o].text;a.font=`${l.bold?"bold":""} ${l.size}px ${l.family}`,a.strokeStyle=l.stroke,![r,t,e].includes(void 0)&&a.strokeText(r,t,e),a.fillStyle=l[i?"secondary":"color"],![r,t,e].includes(void 0)&&a.fillText(r,t,e)}drawAxisText(){const{canvas:r,ctx:t}=this,{rect:e,center:i,axisConfig:s,style:a,theme:o}=r,{width:l,height:h}=e;this.drawText();const c=p=>Math.ceil(t.measureText(p).width),u=4,f=a[o].text.size;{const p=c("0"),v=i.x<u||i.x>l+p+u,w=i.y<-(u+f)||i.y>h+f+u;!v&&!w&&this.drawText("0",i.x-p-u,i.y+f+u)}const g=r.getNowGridCount,y=s.size;{let p=i.y+f+u;p=Math.max(Math.min(p,h-u),u+f);const v=i.y>h||i.y<0;let w=i.x>0?i.x%y:i.x<0?y+i.x%y:0,S=r.getAxisValueByPoint((w-i.x)*s.x,0).xV;for(;w<=l;){const x=At(S),R=c(x);S!==0&&this.drawText(x,w-R/2,p,v),w+=y,S=new V(g).mul(s.x).add(S).toNumber()}}{const p=i.x>l||i.x<0;let v=i.y>0?i.y%y:i.y<0?y+i.y%y:0,w=r.getAxisValueByPoint(0,(v-i.y)*s.y).yV;for(;v<=h;){const S=At(w),x=c(S);let R=i.x-x-u;R=Math.max(Math.min(R,l-x-u),u),w!=0&&this.drawText(S,R,v+f/2,p),v+=y,w=new V(g).mul(s.y).add(w).toNumber()}}}}class $e{constructor(){d(this,"parent");d(this,"name","");d(this,"extData");d(this,"mainCanvas");d(this,"_isRecalculate",!1);d(this,"notifyReload")}get isRecalculate(){return(this.parent?this.parent.isRecalculate:!1)||this._isRecalculate}set isRecalculate(r){this._isRecalculate=r}equalsMainCanvas(r){return this.mainCanvas===r}setMainCanvas(r){this.mainCanvas=r}}class Je extends $e{constructor(){super(...arguments);d(this,"_isVisible",!0);d(this,"inheritOpacity",!0);d(this,"_opacity");d(this,"_scaleRange")}get isVisible(){return this._isVisible}set isVisible(t){var e;t!=this.isVisible&&(this._isVisible=t,(e=this.notifyReload)==null||e.call(this,!0))}get opacity(){var t;return this.inheritOpacity?this._opacity??((t=this.parent)==null?void 0:t.opacity):this._opacity}set opacity(t){var e;this._opacity!=t&&(t===void 0||t>=0&&t<=1?(this._opacity=t,(e=this.notifyReload)==null||e.call(this,!1)):console.warn("Opacity value should be between 0 and 1."))}get scaleRange(){return this._scaleRange}set scaleRange(t){var e;t!=this.scaleRange&&(this._scaleRange=t,this.isVisible&&((e=this.notifyReload)==null||e.call(this)))}shouldRender(){var e;if(!this.isVisible||this.opacity===0)return!1;const t=(e=this.mainCanvas)==null?void 0:e.scale;if(this.scaleRange&&t){const i=Math.min(...this.scaleRange),s=Math.max(...this.scaleRange);return t>=i&&t<=s}return!0}}let Ke=class extends Je{constructor(r){super(),r.name=r.name||Jt("default-name-"),Object.assign(this,{...r})}};class Qe extends Ke{constructor(t){super(t);d(this,"_isInteractive",!0);d(this,"_isHoverable",!0);d(this,"_isDownable",!0);d(this,"_isContextmenuable",!0);d(this,"_isClickable",!0);d(this,"_isDoubleClickable",!0);d(this,"_isDraggable",!0);d(this,"_isWheelable",!0);Object.assign(this,{...t})}get isInteractive(){return this.getPropValue("isInteractive",this._isInteractive,!1)}set isInteractive(t){this._isInteractive=t}get isHoverable(){return this.getPropValue("isHoverable",this._isHoverable)}set isHoverable(t){this._isHoverable=t}get isDownable(){return this.getPropValue("isDownable",this._isDownable)}set isDownable(t){this._isDownable=t}get isContextmenuable(){return this.getPropValue("isContextmenuable",this._isContextmenuable)}set isContextmenuable(t){this._isContextmenuable=t}get isClickable(){return this.getPropValue("isClickable",this._isClickable)}set isClickable(t){this._isClickable=t}get isDoubleClickable(){return this.getPropValue("isDoubleClickable",this._isDoubleClickable)}set isDoubleClickable(t){this._isDoubleClickable=t}get isDraggable(){return this.getPropValue("isDraggable",this._isDraggable)}set isDraggable(t){this._isDraggable=t}get isWheelable(){return this.getPropValue("isWheelable",this._isWheelable)}set isWheelable(t){this._isWheelable=t}getPropValue(t,e,i=!0){return(this.parent?this.parent[t]:!0)&&e&&(i?this.isInteractive:!0)}}class ti{constructor(r){d(this,"propagationStopped",!1);this.data=r}stopPropagation(){this.propagationStopped=!0}get canPropagate(){return!this.propagationStopped}}class rt extends Qe{constructor(){super(...arguments);d(this,"listeners",{wheel:new Set,hover:new Set,down:new Set,contextmenu:new Set,click:new Set,doubleClick:new Set,dragg:new Set});d(this,"sharedControllers",{});d(this,"_eventDate",{});d(this,"_clearEventDate",!1);d(this,"_isHover",!1);d(this,"notifyHover",(t,e)=>this.checkEventDate("hover",t)&&this.trigger("hover",{state:t,oldState:this.isHover},e,"isHoverable"));d(this,"_isDown",!1);d(this,"notifyDown",(t,e)=>this.checkEventDate("down",t)&&this.trigger("down",{state:t,oldState:this.isDown},e,"isDownable"));d(this,"_isContextmenu",!1);d(this,"notifyContextmenu",(t,e)=>this.checkEventDate("contextmenu",t)&&this.trigger("contextmenu",{state:t,oldState:this.isContextmenu},e,"isContextmenuable"));d(this,"_isClick",!1);d(this,"clickTimestamp",0);d(this,"doubleClickInterval",300);d(this,"notifyClick",(t,e)=>{if(!this.checkEventDate("click",t))return;let i=!1;t?(i=Date.now()-this.clickTimestamp<this.doubleClickInterval,this.clickTimestamp=i?0:Date.now()):(this._isDblClick=!1,this.clickTimestamp=0),i?this.notifyDoubleClick(i,e):this.trigger("click",{state:t,oldState:this.isClick},e,"isClickable")});d(this,"_isDblClick",!1);d(this,"notifyDoubleClick",(t,e)=>this.checkEventDate("doubleClick",t)&&this.trigger("doubleClick",{state:t,oldState:this.isDblClick},e,"isDoubleClickable"));d(this,"notifyDragg",(t,e)=>this.checkEventDate("dragg",t)&&this.trigger("dragg",t,e,"isDraggable"));d(this,"notifyWheel",(t,e)=>this.checkEventDate("wheel",t)&&this.trigger("wheel",t,e,"isWheelable"))}addEventListener(t,e){this.listeners[t].add(e)}removeEventListener(t,e){this.listeners[t].delete(e)}registerControllers(t,e){this.sharedControllers[t]=e}hasController(t,e){var i;return(i=this.sharedControllers[t])==null?void 0:i.includes(e)}trigger(t,e,i,s){var h,c;if(!this[s])return;this.updateStates(t,e);const a=new ti(e);this.listeners[t].forEach(u=>u(a,i));const o="notify"+(t.charAt(0).toUpperCase()+t.slice(1)),l=["notifyDragg","notifyWheel"].includes(o)?e:e.state;a.canPropagate&&((h=this.parent)==null||h[o](l,i)),(c=this.sharedControllers[t])==null||c.forEach(u=>u!==this&&u[o](l,i))}updateStates(t,e){const i=e;switch(t){case"hover":this._isHover=i.state;break;case"down":this._isDown=i.state;break;case"contextmenu":this._isContextmenu=i.state;break;case"click":this._isClick=i.state;break;case"doubleClick":this._isDblClick=i.state;break}}checkEventDate(t,e){const i=this._eventDate[t],s=JSON.stringify(e);return i==s?!1:(this._eventDate[t]=s,this._clearEventDate||(this._clearEventDate=!0,Promise.resolve().then(()=>{this._clearEventDate=!1,this._eventDate={}})),!0)}get isHover(){return this.isHoverable&&this._isHover}get isDown(){return this.isDraggable&&this._isDown}get isContextmenu(){return this.isClickable&&this._isContextmenu}get isClick(){return this.isClickable&&this._isClick}get isDblClick(){return this.isDoubleClickable&&this._isDblClick}}class O extends rt{constructor(t){t={...t},t.isDraggable=t.isDraggable??!1;const{mainCanvas:e,notifyReload:i}=t;delete t.mainCanvas,delete t.notifyReload;super(t);d(this,"_style");d(this,"_position");d(this,"_value");d(this,"_zIndex",0);d(this,"_dynamicPosition");d(this,"path");d(this,"redrawOnIsHoverChange",!1);d(this,"defaultHover",(t,e)=>{var i;this.redrawOnIsHoverChange&&((i=this.notifyReload)==null||i.call(this))});d(this,"staticValueScope");d(this,"valueScope");d(this,"extraScope",{topV:0,bottomV:0,leftV:0,rightV:0});d(this,"extraOffset",{x:0,y:0,xV:0,yV:0});d(this,"lastPointRadius",{value:0,radius:0});const{extraOffset:s,style:a,zIndex:o=0,position:l,dynamicPosition:h,value:c,redrawOnIsHoverChange:u}=t;this.setExtraOffset(s,!1),this.setNotifyReload(i),Object.assign(this,{mainCanvas:e,redrawOnIsHoverChange:u}),this.internalUpdate({style:a,zIndex:o,position:l,dynamicPosition:h,value:c}),this.addEventListener("hover",this.defaultHover)}get style(){return this._style}set style(t){var e;this._style=t,this.calculatePointRadiusValue(),(e=this.notifyReload)==null||e.call(this)}get position(){return this._position}set position(t){var e;this._position=t,this._value=void 0,this.updateBaseData(),(e=this.notifyReload)==null||e.call(this)}get value(){return this._value}set value(t){var e;this._value=t,this._position=void 0,this.updateBaseData(),(e=this.notifyReload)==null||e.call(this)}get zIndex(){return this._zIndex}set zIndex(t){var e;this._zIndex!=t&&(this._zIndex=t,(e=this.notifyReload)==null||e.call(this))}get dynamicPosition(){return this._dynamicPosition}set dynamicPosition(t){this._dynamicPosition=t}internalUpdate(t,e){t=Vt(t);for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(this["_"+i]=t[i],e===void 0&&(e=["value","position"].includes(i)));e&&this.updateValueScope()}setMainCanvas(t){super.setMainCanvas(t),t&&this.updateBaseData()}setNotifyReload(t){this.notifyReload=t?e=>{var i,s;e&&(this.isRecalculate=!0),!((i=this.mainCanvas)!=null&&i.redrawInNextRenderFrame)&&(e||this.isNeedRender||(s=this.mainCanvas)!=null&&s.currentDrawOverlays.includes(this))&&t()}:void 0}initValueScope(){const t=this.value;if(Array.isArray(t[0])){let e=1/0,i=-1/0,s=1/0,a=-1/0;t.forEach(([o,l])=>{e=Math.min(e,o),i=Math.max(i,o),s=Math.min(s,l),a=Math.max(a,l)}),this.valueScope={minX:e,maxX:i,minY:s,maxY:a}}else{const[e,i]=t;this.valueScope={minX:e,maxX:e,minY:i,maxY:i}}this.staticValueScope={...this.valueScope},["extraScope","extraOffset","lastPointRadius"].forEach(e=>{Object.keys(this[e]).forEach(i=>this[e][i]=0)}),this.calculatePointRadiusValue(),this.setExtraOffset(this.extraOffset,!1)}setExtraScope(t){if(t=t||{top:0,bottom:0,left:0,right:0},this.valueScope){const{xV:e,yV:i}=this.mainCanvas.getAxisValueByPoint(t.top,t.bottom),{xV:s,yV:a}=this.mainCanvas.getAxisValueByPoint(t.left,t.right);this.setExtraScopeByValue({topV:e,bottomV:i,leftV:s,rightV:a})}}setExtraScopeByValue(t){if(t=t||{topV:0,bottomV:0,leftV:0,rightV:0},this.valueScope){const{leftV:e,rightV:i,topV:s,bottomV:a}=t;this.valueScope.minX-=e-this.extraScope.leftV,this.valueScope.maxX+=i-this.extraScope.rightV,this.valueScope.minY-=s-this.extraScope.topV,this.valueScope.maxY+=a-this.extraScope.bottomV,Object.assign(this.extraScope,t)}}setExtraOffset(t,e=!0){var l;if(t=t||{x:0,y:0},!this.valueScope)return Object.assign(this.extraOffset,t);const{xV:i,yV:s}=this.mainCanvas.getAxisValueByPoint(t.x,t.y),a=i-this.extraOffset.xV,o=s-this.extraOffset.yV;this.valueScope.minX-=a,this.valueScope.maxX+=a,this.valueScope.minY-=o,this.valueScope.maxY+=o,Object.assign(this.extraOffset,t,{xV:i,yV:s}),e&&((l=this.notifyReload)==null||l.call(this))}calculatePointRadiusValue(t=!1){if(!this.mainCanvas||!this.valueScope||t&&this.lastPointRadius.value==0)return;const e=(()=>{if(t)return this.lastPointRadius.radius;const a=this.handlePointStyle;if(a)return a.radius+Math.max(0,a.width/2)})();if(e===void 0)return;const i=this.mainCanvas.getAxisValueByPoint(e,0).xV,s=i-this.lastPointRadius.value;this.valueScope.minX-=s,this.valueScope.maxX+=s,this.valueScope.minY-=s,this.valueScope.maxY+=s,this.lastPointRadius={radius:e,value:i}}get isWithinRange(){const{mainCanvas:t,valueScope:e,extraOffset:i}=this;if(!t)return!1;const{isScaleUpdated:s,maxMinValue:a,axisConfig:o}=t;return s&&(this.setExtraOffset(i,!1),this.calculatePointRadiusValue(!0)),e?!(a.maxXV<e.minX||a.minXV>e.maxX||a.maxYV<e.minY||a.minYV>e.maxY):!0}get isNeedRender(){return!!(this.mainCanvas&&this.shouldRender()&&this.dynamicPosition&&this.isWithinRange)}calculateOffset(t,e){const{percentage:i,axisConfig:s}=this.mainCanvas,a=s.count/s.min/i,o={value:t*a*s.x,position:t/i*s.x,dynamicPosition:t},l={value:e*a*s.y,position:e/i*s.y,dynamicPosition:e};return{x:o,y:l}}isPointInAnywhere(t,e){return this.isPointInPath(t,e)||this.isPointInStroke(t,e)}setGlobalAlpha(t){var i;const e=this.opacity??((i=this.parent)==null?void 0:i.opacity);e!==void 0&&(t.globalAlpha=e)}setBaseLineStyle(t,e){const{width:i,dash:s,dashGap:a,dashOffset:o,color:l,color_hover:h,cap:c,join:u}=e;return t.setLineDash(s?a:[]),t.lineDashOffset=o,t.lineCap=c,t.lineJoin=u,t.lineWidth=i,t.strokeStyle=this.isHover?h:l,e}get cursorStyle(){return this.isDraggable?"_nhanh_canvas_hover_overlay_draggable":"_nhanh_canvas_hover_overlay"}}d(O,"ctx",document.createElement("canvas").getContext("2d"));class ut extends O{constructor(t){t.redrawOnIsHoverChange=t.redrawOnIsHoverChange??!0;super(t);d(this,"textOffset",{x:0,y:0});d(this,"_text");d(this,"defaultDragg",(t,e)=>{var l;const{offsetX:i,offsetY:s}=t.data,{x:a,y:o}=this.calculateOffset(i,s);this.internalUpdate({value:[this.value[0]+a.value,this.value[1]+o.value],position:[this.position[0]+a.position,this.position[1]+o.position],dynamicPosition:[this.dynamicPosition[0]+a.dynamicPosition,this.dynamicPosition[1]+o.dynamicPosition]}),(l=this.notifyReload)==null||l.call(this)});const{text:e}=t;Object.assign(this,{text:e}),this.addEventListener("dragg",this.defaultDragg)}get text(){return this._text}set text(t){var e;this._text!=t&&(this._text=t,this.updateBaseData(),(e=this.notifyReload)==null||e.call(this))}updateValueScope(){const{textOffset:t,value:e}=this,{xV:i,yV:s}=this.mainCanvas.getAxisValueByPoint(t.x*2,t.y*2);this.valueScope={minX:e[0]-i/2,maxX:e[0]+i/2,minY:e[1]-s/2,maxY:e[1]+s/2},this.staticValueScope={minX:e[0],maxX:e[0],minY:e[1],maxY:e[1]},this.setExtraOffset(this.extraOffset,!1)}isPointInPath(t,e){return this.path?O.ctx.isPointInPath(this.path,t,e):!1}isPointInStroke(t,e){return!1}updateBaseData(){if(!this.mainCanvas)return;if(!this.text||this.text.length==0)return this.internalUpdate({dynamicPosition:void 0});let{value:t,position:e}=this;const[i,s]=[K(t),K(e)];if(!i&&!s)return this.internalUpdate({dynamicPosition:void 0});if(i){const h=this.mainCanvas.getAxisPointByValue(t[0],t[1],!0);e=[h.x,h.y]}else{const h=this.mainCanvas.getAxisValueByPoint(e[0],e[1],!0);t=[h.xV,h.yV]}const a=this.mainCanvas.transformPosition([e])[0],o=this.mainCanvas.ctx;this.setOverlayStyles(o);const l=o.measureText(this.text);this.textOffset={x:l.width/2,y:l.actualBoundingBoxAscent/2},this.internalUpdate({value:t,position:e,dynamicPosition:a})}setOverlayStyles(t){var a;const e=this.mainCanvas,i=e.style[e.theme].text;let s={};return typeof this.style=="string"?s=((a=e.style[this.style])==null?void 0:a.text)||i:typeof this.style=="object"?s=Object.assign({},i,this.style):s=i,t.font=`${s.bold?"bold":""} ${s.size}px ${s.family}`,t.lineWidth=2,t.strokeStyle=s.stroke,t.fillStyle=s[this.isHover?"secondary":"color"],s}get handlePointStyle(){}draw(t){if(!this.mainCanvas)return;this.setGlobalAlpha(t);const e=this.dynamicPosition,i=this.textOffset,s=this.text,a=this.extraOffset;this.setOverlayStyles(t);const o=e[0]+a.x-i.x,l=e[1]+a.y+i.y;t.strokeText(s,o,l),t.fillText(s,o,l),this.path=new Path2D,this.path.rect(o,e[1]+a.y-i.y,i.x*2,i.y*2)}getDraw(){if(this.isNeedRender){if(this.isRecalculate){const{position:t,mainCanvas:e}=this;this.internalUpdate({dynamicPosition:e.transformPosition([t])[0]})}return[this.draw,this]}}}class J extends O{constructor(t){t.redrawOnIsHoverChange=t.redrawOnIsHoverChange??!0;super(t);d(this,"angle",2*Math.PI);d(this,"defaultDragg",(t,e)=>{var l;const{offsetX:i,offsetY:s}=t.data,{x:a,y:o}=this.calculateOffset(i,s);this.internalUpdate({value:[this.value[0]+a.value,this.value[1]+o.value],position:[this.position[0]+a.position,this.position[1]+o.position],dynamicPosition:[this.dynamicPosition[0]+a.dynamicPosition,this.dynamicPosition[1]+o.dynamicPosition]}),(l=this.notifyReload)==null||l.call(this)});d(this,"fillProgress");d(this,"defaultHover",(t,e)=>{const i=t.data.state,s=300,a=this.setOverlayStyles().width;this.fillProgress?this.cancelAndRestartAnimation(i,a,s-100):i&&this.startNewHoverAnimation(a,s)});this.addEventListener("hover",this.defaultHover),this.addEventListener("dragg",this.defaultDragg)}updateValueScope(){this.initValueScope()}cancelAndRestartAnimation(t,e,i){this.fillProgress.scheduleCallback();let s=0;this.fillProgress.scheduleCallback=pt(a=>{!this.fillProgress||!a||(this.fillProgress.progress+=(a-s)*(t?1:-1),s=a,this.fillProgress.progress=Math.min(1,Math.max(0,this.fillProgress.progress)),this.updateLineWidthOffset(e),(this.fillProgress.progress===1||this.fillProgress.progress===0)&&(this.fillProgress.scheduleCallback(),this.fillProgress.progress===0&&(this.fillProgress=void 0)))},i)}startNewHoverAnimation(t,e){this.fillProgress={lineWidthOffset:0,progress:0,scheduleCallback:pt(i=>{this.fillProgress&&(this.fillProgress.progress=i,this.updateLineWidthOffset(t))},e)}}updateLineWidthOffset(t){var i;if(!this.fillProgress)return;const e=Math.ceil(t*this.fillProgress.progress);e!==this.fillProgress.lineWidthOffset&&(this.fillProgress.lineWidthOffset=e,(i=this.notifyReload)==null||i.call(this))}isPointInPath(t,e){return this.path?O.ctx.isPointInPath(this.path,t,e):!1}isPointInStroke(t,e){var i;if(this.path&&this.mainCanvas){const{width:s}=this.setOverlayStyles(O.ctx);return((i=this.fillProgress)==null?void 0:i.lineWidthOffset)==s?!1:O.ctx.isPointInStroke(this.path,t,e)}return!1}updateBaseData(){if(!this.mainCanvas)return;let{value:t,position:e}=this;const[i,s]=[K(t),K(e)];if(!i&&!s)return this.internalUpdate({dynamicPosition:void 0});if(i){const o=this.mainCanvas.getAxisPointByValue(t[0],t[1],!0);e=[o.x,o.y]}else{const o=this.mainCanvas.getAxisValueByPoint(e[0],e[1],!0);t=[o.xV,o.yV]}const a=this.mainCanvas.transformPosition([e])[0];this.internalUpdate({value:t,position:e,dynamicPosition:a})}setOverlayStyles(t){var h,c;const e=this.mainCanvas,i=e.style[e.theme].point;let s={};typeof this.style=="string"?s=((h=e.style[this.style])==null?void 0:h.point)||i:typeof this.style=="object"?s=Object.assign({},i,this.style):s=i;const{width:a,stroke:o,fill:l}=s;if(t){t.setLineDash([]);const u=((c=this.fillProgress)==null?void 0:c.lineWidthOffset)||0;t.lineWidth=a-u,t.strokeStyle=o,t.fillStyle=l}return{...s}}get handlePointStyle(){return this.setOverlayStyles()}draw(t){var u;const{dynamicPosition:e,mainCanvas:i,extraOffset:s}=this;if(!i)return;this.setGlobalAlpha(t);const{radius:a,width:o}=this.setOverlayStyles(t),l=((u=this.fillProgress)==null?void 0:u.lineWidthOffset)||0,h=e[0]+s.x,c=e[1]+s.y;t.beginPath(),this.path=new Path2D,this.path.arc(h,c,a+l/2,0,this.angle),o!=l&&t.stroke(this.path),t.fill(this.path)}getDraw(){if(this.isNeedRender){const{mainCanvas:t,position:e}=this;return this.isRecalculate&&this.internalUpdate({dynamicPosition:t.transformPosition([e])[0]}),[this.draw,this]}}}class jt extends O{constructor(t){t.redrawOnIsHoverChange=t.redrawOnIsHoverChange??!0;super(t);d(this,"handlePoints",[]);d(this,"_isHandlePointsVisible",!0);d(this,"isShowHandlePoint",!1);d(this,"canCreateOrDeleteHandlePoint",!0);d(this,"lockedCanCreateOrDeleteHandlePoint",!1);d(this,"defaultClick",(t,e)=>{var a;if(!this.isHandlePointsVisible)return;const{state:i,oldState:s}=t.data;i!=s&&!this.isInfinite&&((a=this.notifyReload)==null||a.call(this))});d(this,"defaultDoubleClick",(t,e)=>{if(e){if(!this.isHandlePointsVisible)return;const{offsetX:i,offsetY:s}=e,{state:a}=t.data;if(this.lockedCanCreateOrDeleteHandlePoint)this.resetHandlePointLock();else if(a&&this.isHandlePointsVisible&&this.canCreateOrDeleteHandlePoint&&this.isDraggable){const l=this.handlePoints.findIndex(h=>h.isHover);l===-1?this.tryCreateNewHandlePoint(i,s):this.tryDeleteHandlePoint(l)}}});d(this,"defaultDragg",(t,e)=>{var s;if(!this.mainCanvas)return;const i=()=>{const{offsetX:a,offsetY:o}=t.data,{x:l,y:h}=this.calculateOffset(a,o);this.value.forEach((c,u)=>{this.value[u][0]+=l.value,this.value[u][1]+=h.value,this.position[u][0]+=l.position,this.position[u][1]+=h.position,this.dynamicPosition[u][0]+=l.dynamicPosition,this.dynamicPosition[u][1]+=h.dynamicPosition}),this.handlePoints.forEach((c,u)=>{c.internalUpdate({value:this.value[u],position:this.position[u],dynamicPosition:this.dynamicPosition[u]})}),this.lockedCanCreateOrDeleteHandlePoint=!0};if(this.isHandlePointsVisible){const a=this.handlePoints.findIndex(o=>o.isHover);if(a!=-1){const o=this.handlePoints[a];o.notifyDragg(t.data,e),this.value[a]=o.value,this.position[a]=o.position,this.dynamicPosition[a]=o.dynamicPosition}else i()}else i();(s=this.notifyReload)==null||s.call(this),this.updateValueScope()});["isHandlePointsVisible","canCreateOrDeleteHandlePoint"].forEach(e=>{e in t&&(this[e]=t[e])}),this.addEventListener("click",this.defaultClick),this.addEventListener("doubleClick",this.defaultDoubleClick),this.addEventListener("dragg",this.defaultDragg)}get isHandlePointsVisible(){return this._isHandlePointsVisible}set isHandlePointsVisible(t){var e;this._isHandlePointsVisible!==t&&(this._isHandlePointsVisible=t,this.isShowHandlePoint!=t&&((e=this.notifyReload)==null||e.call(this)))}tryCreateNewHandlePoint(t,e){var h;if(!this.isPointInStroke(t,e))return;const i=this.getExtendedDynamicPositions(),s=ei([t,e],i);if(s===-1)return;const[a,o]=this.getAdjacentIndices(s),l=this.createNewHandlePoint(a,o);this.insertHandlePoint(s,l),this.lockHandlePointCreationTemporarily(),(h=this.notifyReload)==null||h.call(this)}tryDeleteHandlePoint(t){var e;!this.isDblClick||!this.canDeleteHandlePoint||(this.deleteHandlePoint(t),(e=this.notifyReload)==null||e.call(this))}getExtendedDynamicPositions(){return this.isClosed?[...this.dynamicPosition,this.dynamicPosition[0]]:this.dynamicPosition}getAdjacentIndices(t){const e=t-1,i=this.isClosed&&t===this.dynamicPosition.length?0:t;return[e,i]}createNewHandlePoint(t,e){const i=bt(this.value[t],this.value[e]),s=bt(this.position[t],this.position[e]),a=bt(this.dynamicPosition[t],this.dynamicPosition[e]);return new J({value:i,position:s,dynamicPosition:a,isDraggable:!0,mainCanvas:this.mainCanvas,notifyReload:()=>{var o;return(o=this.notifyReload)==null?void 0:o.call(this)}})}insertHandlePoint(t,e){this.handlePoints.splice(t,0,e),this.value.splice(t,0,e.value),this.position.splice(t,0,e.position),this.dynamicPosition.splice(t,0,e.dynamicPosition)}deleteHandlePoint(t){this.handlePoints.splice(t,1),this.value.splice(t,1),this.position.splice(t,1),this.dynamicPosition.splice(t,1)}lockHandlePointCreationTemporarily(){this.lockedCanCreateOrDeleteHandlePoint=!0,setTimeout(()=>{this.lockedCanCreateOrDeleteHandlePoint=!1},300)}resetHandlePointLock(){this.lockedCanCreateOrDeleteHandlePoint=!1}get canDeleteHandlePoint(){return this.handlePoints.length>this.minNeededHandlePoints}updateHandlePoints(){let{value:t,position:e,dynamicPosition:i}=this;i&&(t==null||t.forEach((s,a)=>{if(!this.handlePoints[a]){const o=new J({mainCanvas:this.mainCanvas,isDraggable:!0,notifyReload:()=>{var l;return(l=this.notifyReload)==null?void 0:l.call(this)}});this.handlePoints.push(o)}this.handlePoints[a].internalUpdate({value:t[a],position:e[a],dynamicPosition:i[a]},!0)}),this.handlePoints.length=t.length)}}function ei(n,r,t=10){if(r.length===0)return 0;if(r.length===1)return 1;let e=1/0,i=-1;for(let s=0;s<r.length-1;s++){const a=Kt(n,r[s],r[s+1]);if(a<t)return s+1;a<e&&(e=a,i=s+1)}return i}function bt(n,r){const{x:t,y:e}=Mt(...n,...r);return[t,e]}class ft extends jt{constructor(t){super(t);d(this,"_isInfinite");d(this,"isClosed",!1);d(this,"minNeededHandlePoints",2);const{isInfinite:e}=t;Object.assign(this,{isInfinite:e}),e&&(this.canCreateOrDeleteHandlePoint=!1)}get isInfinite(){return this._isInfinite}set isInfinite(t){var e;this._isInfinite!=t&&(this._isInfinite=t,this.canCreateOrDeleteHandlePoint=!t,(e=this.notifyReload)==null||e.call(this))}updateValueScope(){this.initValueScope()}isPointInPath(t,e){return!1}isPointInStroke(t,e){return this.path&&this.mainCanvas?(this.setOverlayStyles(O.ctx),this.isDraggable&&(O.ctx.lineWidth=Math.max(O.ctx.lineWidth,20)),O.ctx.isPointInStroke(this.path,t,e)):!1}isPointInAnywhere(t,e){const i=super.isPointInAnywhere(t,e),s=(a=>{if(!a)return!1;let o=!1;return[...this.handlePoints].sort((h,c)=>(h.isHover?0:1)-(c.isHover?0:1)).forEach(h=>{o?h.isHover&&h.notifyHover(!1):(o=h.isPointInAnywhere(t,e),o!=h.isHover&&h.notifyHover(o))}),o})((this.isClick||!!this.isInfinite)&&this.isHandlePointsVisible);return i||s}updateBaseData(){if(!this.mainCanvas)return;let{value:t,position:e}=this;const[i,s]=[st(t)&&t.length>1,st(e)&&e.length>1];if(!i&&!s)return this.handlePoints=[],this.internalUpdate({dynamicPosition:void 0});if(i){e=[];for(let o=0;o<t.length;o++){const l=t[o],h=this.mainCanvas.getAxisPointByValue(l[0],l[1],!0);e.push([h.x,h.y])}}else{t=[];for(let o=0;o<e.length;o++){const l=e[o],h=this.mainCanvas.getAxisValueByPoint(l[0],l[1],!0);t.push([h.xV,h.yV])}}const a=this.mainCanvas.transformPosition(e);this.internalUpdate({value:t,position:e,dynamicPosition:a}),this.updateHandlePoints()}setOverlayStyles(t){var a;const e=this.mainCanvas,i=e.style[e.theme].line;let s={};return typeof this.style=="string"?s=((a=e.style[this.style])==null?void 0:a.line)||i:typeof this.style=="object"?s=Object.assign({},i,this.style):s=i,t&&this.setBaseLineStyle(t,s),s}get handlePointStyle(){return this.setOverlayStyles().point}drawLine(t,e){const{mainCanvas:i,isInfinite:s,isClick:a}=this;if(e=e||this.dynamicPosition,!i)return;this.setGlobalAlpha(t);const o=this.setOverlayStyles(t);t.beginPath(),this.path=new Path2D,e.forEach((l,h)=>{this.path[h==0?"moveTo":"lineTo"](l[0],l[1])}),t.stroke(this.path),this.isShowHandlePoint=(s||a)&&this.isHandlePointsVisible,this.isShowHandlePoint&&this.handlePoints.forEach(l=>{var h;l.style=o.point,(h=l.getDraw())==null||h[0].call(l,t)})}drawisInfiniteStraightLine(t){const{mainCanvas:e,dynamicPosition:i}=this;if(!e)return;this.setGlobalAlpha(t);const{rect:s}=e,[a,o]=Vt(i),l=[o[0]-a[0],o[1]-a[1]];if(l[0]===0&&l[1]===0)return console.error("重合点无法确定方向");const h=(f,g)=>{const[y,p]=f,[v,w]=g;let S=1/0;if(v!==0){const x=v>0?(s.width-y)/v:-y/v;x>0&&(S=Math.min(S,x))}if(v!==0){const x=v>0?(s.width-y)/v:-y/v;x>0&&(S=Math.min(S,x))}return S===1/0?f:[y+v*S,p+w*S]},c=h(a,[-l[0],-l[1]]),u=h(o,l);this.drawLine(t,[c,u])}getDraw(){if(this.isNeedRender){const{mainCanvas:t,position:e,isInfinite:i}=this;if(this.isRecalculate){const s=t.transformPosition(e);this.internalUpdate({dynamicPosition:s}),this.handlePoints.forEach((a,o)=>{a.internalUpdate({dynamicPosition:s[o]})})}return i?[this.drawisInfiniteStraightLine,this]:[this.drawLine,this]}}}class dt extends jt{constructor(t){super(t);d(this,"_isRect",!1);d(this,"dynamicBorderRadius");d(this,"_borderRadius");d(this,"_borderRadiusType","position");d(this,"isClosed",!0);d(this,"minNeededHandlePoints",3);["isRect","borderRadius","borderRadiusType"].forEach(e=>{e in t&&(this[e]=t[e])}),t.isRect&&(this.canCreateOrDeleteHandlePoint=!1)}get isRect(){return this._isRect}set isRect(t){var e;this._isRect!=t&&(this._isRect=t,this.canCreateOrDeleteHandlePoint=!t,this.updateBaseData(),(e=this.notifyReload)==null||e.call(this))}get borderRadius(){return this._borderRadius}set borderRadius(t){var e;this._borderRadius!=t&&(this._borderRadius=t,this.updateDynamicRadius(),(e=this.notifyReload)==null||e.call(this))}get borderRadiusType(){return this._borderRadiusType}set borderRadiusType(t){var e;this._borderRadiusType!=t&&(this._borderRadiusType=t,this.updateDynamicRadius(),(e=this.notifyReload)==null||e.call(this))}updateValueScope(){this.initValueScope()}isPointInPath(t,e){return this.path?O.ctx.isPointInPath(this.path,t,e):!1}isPointInStroke(t,e){return this.path&&this.mainCanvas?(this.setOverlayStyles(O.ctx),this.isDraggable&&(O.ctx.lineWidth=Math.max(O.ctx.lineWidth,20)),O.ctx.isPointInStroke(this.path,t,e)):!1}isPointInAnywhere(t,e){const i=super.isPointInAnywhere(t,e),s=(a=>{if(!a)return!1;let o=!1;return[...this.handlePoints].sort((h,c)=>(h.isHover?0:1)-(c.isHover?0:1)).forEach(h=>{o?h.isHover&&h.notifyHover(!1):(o=h.isPointInAnywhere(t,e),o!=h.isHover&&h.notifyHover(o))}),o})(this.isClick&&this.isHandlePointsVisible);return i||s}updateDynamicRadius(){const{mainCanvas:t,borderRadius:e}=this;if(!t||!e){this.dynamicBorderRadius=void 0;return}if(typeof e=="number"){this.dynamicBorderRadius=this.handleSingleRadius(e);return}this.dynamicBorderRadius=e.map(i=>this.handleSingleRadius(i,!0))}handleSingleRadius(t,e){const{mainCanvas:i,borderRadiusType:s}=this;if(t<=0)return e?0:void 0;switch(s){case"position":return t*i.percentage;default:return i.getAxisPointByValue(t,0).x}}updateBaseData(){if(!this.mainCanvas)return;let{value:t,position:e,isRect:i}=this,[s,a]=[st(t)&&t.length>(i?1:2),st(e)&&e.length>(i?1:2)];if(!s&&!a)return this.internalUpdate({dynamicPosition:void 0});if(i){if(s){t.length=2;const[l,h]=t;s=!(l[0]==h[0]||l[1]==h[1])}if(a){e.length=2;const[l,h]=e;a=!(l[0]==h[0]||l[1]==h[1])}}if(s){e=[];for(let l=0;l<t.length;l++){const h=t[l],c=this.mainCanvas.getAxisPointByValue(h[0],h[1],!0);e.push([c.x,c.y])}}else{t=[];for(let l=0;l<e.length;l++){const h=e[l],c=this.mainCanvas.getAxisValueByPoint(h[0],h[1],!0);t.push([c.xV,c.yV])}}const o=this.mainCanvas.transformPosition(e);this.internalUpdate({value:t,position:e,dynamicPosition:o}),this.updateHandlePoints(),this.updateDynamicRadius()}setOverlayStyles(t){var h;const e=this.isHover,i=this.mainCanvas,s=i.style[i.theme].polygon;let a={};if(typeof this.style=="string")a=((h=i.style[this.style])==null?void 0:h.polygon)||s;else if(typeof this.style=="object"){const c=this.style.stroke?Object.assign({},s.stroke,this.style.stroke):s.stroke;a=Object.assign({},s,this.style,{stroke:c})}else a=s;const{fill:o,fill_hover:l}=a;return t&&(this.setBaseLineStyle(t,a.stroke),t.fillStyle=e?l:o),a}get handlePointStyle(){return this.setOverlayStyles().point}drawRect(t){this.setGlobalAlpha(t);const[[e,i],[s,a]]=this.dynamicPosition,o=Math.abs(s-e),l=Math.abs(a-i),h=Math.min(e,s),c=Math.min(i,a),u=this.setOverlayStyles(t);t.beginPath(),this.path=new Path2D,this.dynamicBorderRadius?this.path.roundRect(h,c,o,l,this.dynamicBorderRadius):this.path.rect(h,c,o,l),t.stroke(this.path),t.fill(this.path),this.isShowHandlePoint=this.isClick&&this.isHandlePointsVisible,this.isShowHandlePoint&&this.handlePoints.forEach(f=>{var g;f.internalUpdate({style:u.point}),(g=f.getDraw())==null||g[0].call(f,t)})}drawPolygon(t){this.setGlobalAlpha(t);const e=this.dynamicPosition,i=this.setOverlayStyles(t);t.beginPath(),this.path=new Path2D,e.forEach((s,a)=>{this.path[a==0?"moveTo":"lineTo"](s[0],s[1])}),this.path.lineTo(e[0][0],e[0][1]),t.closePath(),t.stroke(this.path),t.fill(this.path),this.isShowHandlePoint=this.isClick&&this.isHandlePointsVisible,this.isShowHandlePoint&&this.handlePoints.forEach(s=>{var a;s.internalUpdate({style:i.point}),(a=s.getDraw())==null||a[0].call(s,t)})}getDraw(){if(this.isNeedRender){const{mainCanvas:t,position:e}=this;if(this.isRecalculate){this.updateDynamicRadius();const i=t.transformPosition(e);this.internalUpdate({dynamicPosition:i}),this.handlePoints.forEach((s,a)=>{s.internalUpdate({dynamicPosition:i[a]})})}return this.isRect?[this.drawRect,this]:[this.drawPolygon,this]}}}class gt extends O{constructor(t){super(t);d(this,"_draw");this.redrawOnIsHoverChange=!1;const{draw:e}=t;Object.assign(this,{draw:e})}updateValueScope(){this.initValueScope()}isPointInPath(t,e){return!1}isPointInStroke(t,e){return!1}updateBaseData(){if(!this.mainCanvas)return;this.internalUpdate({dynamicPosition:void 0});let t=this.value,e=this.position;t?e=this.convertValuesToPositions(t):t=this.convertPositionsToValues(e),this.updateDataProperties(t,e)}convertValuesToPositions(t){const e=[];let i=1;return t.forEach((s,a)=>{if(a===0){const o=this.mainCanvas.getAxisPointByValue(s[0],s[1],!0);e.push([o.x,o.y]),i=new V(o.x).div(s[0]).toNumber()}else e.push([new V(i).mul(s[0]).toNumber(),new V(i).mul(s[1]).toNumber()])}),e}convertPositionsToValues(t){const e=[];let i=1;return t.forEach((s,a)=>{if(a===0){const o=this.mainCanvas.getAxisValueByPoint(s[0],s[1],!0);e.push([o.xV,o.yV]),i=new V(o.xV).div(s[0]).toNumber()}else e.push([new V(i).mul(s[0]).toNumber(),new V(i).mul(s[1]).toNumber()])}),e}updateDataProperties(t,e){this.internalUpdate({value:t,position:e,dynamicPosition:this.mainCanvas.transformPosition(e)})}setOverlayStyles(t){}get handlePointStyle(){}get draw(){return t=>{var e;this.setGlobalAlpha(t),(e=this._draw)==null||e.call(this,t)}}set draw(t){this._draw=t}getDraw(){if(this.isNeedRender){const{mainCanvas:t,position:e}=this;return this.isRecalculate&&this.internalUpdate({dynamicPosition:t.transformPosition(e)}),[this.draw,this]}}}class Y extends rt{constructor(t){super(t);d(this,"overlays",new Set);this.setNotifyReload(t.notifyReload)}setMainCanvas(t){var e;super.setMainCanvas(t),this.overlays.forEach(i=>{i.setMainCanvas(t),i.parent=this}),t&&this.overlays.size&&((e=this.notifyReload)==null||e.call(this))}setNotifyReload(t){this.notifyReload=t?e=>{var i;e&&(this.isRecalculate=!0),!((i=this.mainCanvas)!=null&&i.redrawInNextRenderFrame)&&(e||this.shouldRender()&&this.overlays.size)&&t()}:void 0,this.overlays.forEach(e=>e.setNotifyReload(this.notifyReload))}addOverlays(t){var e;[t].flat().forEach(i=>{i.setNotifyReload(this.notifyReload),i.setMainCanvas(this.mainCanvas),i.parent=this,this.overlays.add(i)}),(e=this.notifyReload)==null||e.call(this)}hasOverlay(t){return this.overlays.has(t)}removeOverlays(t){var e;[t].flat().forEach(i=>{this.overlays.delete(i),i.setNotifyReload(),i.setMainCanvas(),i.parent=void 0}),(e=this.notifyReload)==null||e.call(this)}clearOverlays(){var t;(t=this.notifyReload)==null||t.call(this),this.overlays.forEach(e=>{e.setNotifyReload(),e.setMainCanvas(),e.parent=void 0}),this.overlays.clear()}getOverlaysDrawingMethod(){const t=[];if(this.shouldRender()&&this.overlays.size){let e=1;Array.from(this.overlays.values()).sort((i,s)=>i.zIndex-s.zIndex).forEach(i=>{if(i.equalsMainCanvas(this.mainCanvas)){const s=i.getDraw();s&&t.push([(Number(i.zIndex)||0)+e++,s])}else this.overlays.delete(i)})}return t}}class U extends rt{constructor(t){super(t);d(this,"zIndex",4);d(this,"canvas",document.createElement("canvas"));d(this,"ctx",this.canvas.getContext("2d"));d(this,"isReload",!1);d(this,"groups",new Map);d(this,"currentDrawOverlays",[]);this.setNotifyReload(t.notifyReload)}setMainCanvas(t){super.setMainCanvas(t),this.canvas.width=(t==null?void 0:t.rect.width)||0,this.canvas.height=(t==null?void 0:t.rect.height)||0,this.groups.forEach(e=>{e.setMainCanvas(t),e.parent=this})}setNotifyReload(t){this.notifyReload=t?e=>{var i;e&&(this.isRecalculate=!0),!((i=this.mainCanvas)!=null&&i.redrawInNextRenderFrame)&&(e||this.shouldRender()&&this.groups.size)&&t()}:void 0,this.groups.forEach(e=>this.setGroupNotifyReload(e))}setGroupNotifyReload(t){t.setNotifyReload(this.notifyReload?()=>{var e;(e=this.notifyReload)==null||e.call(this),this.isReload=!0}:void 0)}getGroup(t){return this.groups.get(t)}addGroup(t){[t].flat().forEach(e=>{e instanceof Y&&(this.setGroupNotifyReload(e),e.setMainCanvas(this.mainCanvas),e.parent=this,this.groups.set(e.name,e))})}removeGroup(t){var i;let e=!1;[t].flat().forEach(s=>{s instanceof Y&&(this.groups.delete(s.name),s.setNotifyReload(),s.setMainCanvas(),s.parent=void 0,e=!0)}),e&&((i=this.notifyReload)==null||i.call(this))}clearGroup(){var t;this.groups.size&&(this.groups.forEach(e=>{e.setNotifyReload(),e.setMainCanvas(),e.parent=void 0}),this.groups.clear(),(t=this.notifyReload)==null||t.call(this))}setzIndex(t){var e;t!=this.zIndex&&(this.zIndex=t,(e=this.notifyReload)==null||e.call(this,!1))}getCanvas(){if(!this.mainCanvas)return;const{rect:t,isThemeUpdated:e}=this.mainCanvas,i=this.shouldRender(),s=this.groups.size;if(i&&s){if(this.isReload||this.isRecalculate||e){this.currentDrawOverlays=[],this.isReload=!1,this.canvas.width=t.width||0,this.canvas.height=t.height||0;const a=[];this.groups.forEach(o=>{o.equalsMainCanvas(this.mainCanvas)?a.push(...o.getOverlaysDrawingMethod()):this.groups.delete(o.name)}),a.sort((o,l)=>o[0]-l[0]),a.forEach(([o,[l,h]])=>{l.call(h,this.ctx),this.currentDrawOverlays.push([[Number(this.zIndex)||0,o],h])})}return[Number(this.zIndex)||0,this.canvas,this.currentDrawOverlays]}}}class it extends rt{constructor(t){super(t);d(this,"layers",new Map);d(this,"defaultContextmenu",(t,e)=>t.stopPropagation());d(this,"defaultClick",(t,e)=>t.stopPropagation());d(this,"defaultDoubleClick",(t,e)=>t.stopPropagation());d(this,"defaultHover",(t,e)=>t.stopPropagation());d(this,"defaultDragg",(t,e)=>t.stopPropagation());d(this,"defaultDown",(t,e)=>t.stopPropagation());this.inheritOpacity=!1,this.setNotifyReload(t.notifyReload),this.addEventListener("contextmenu",this.defaultContextmenu),this.addEventListener("click",this.defaultClick),this.addEventListener("doubleClick",this.defaultDoubleClick),this.addEventListener("hover",this.defaultHover),this.addEventListener("dragg",this.defaultDragg),this.addEventListener("down",this.defaultDown)}setMainCanvas(t){super.setMainCanvas(t),this.layers.forEach(e=>{e.setMainCanvas(t),e.parent=this})}setNotifyReload(t){this.notifyReload=t?e=>{var i;e&&(this.isRecalculate=!0),!((i=this.mainCanvas)!=null&&i.redrawInNextRenderFrame)&&(e||this.shouldRender()&&this.layers.size)&&t()}:void 0,this.layers.forEach(e=>e.setNotifyReload(this.notifyReload))}getLayer(t){return this.layers.get(t)}addLayer(t){[t].flat().forEach(e=>{e instanceof U&&(e.setNotifyReload(this.notifyReload),e.setMainCanvas(this.mainCanvas),e.parent=this,this.layers.set(e.name,e))})}removeLayer(t){var i;let e=!1;[t].flat().forEach(s=>{s instanceof U&&(this.layers.delete(s.name),s.setNotifyReload(),s.setMainCanvas(),s.parent=void 0,e=!0)}),e&&((i=this.notifyReload)==null||i.call(this))}clearLayers(){var t;this.layers.size&&(this.layers.forEach(e=>{e.setNotifyReload(),e.setMainCanvas(),e.parent=void 0}),this.layers.clear(),(t=this.notifyReload)==null||t.call(this))}fetchCanvas(){if(this.shouldRender()&&this.layers.size){const t=[];return this.layers.forEach(e=>{if(e.equalsMainCanvas(this.mainCanvas)){const i=e.getCanvas();i&&t.push(i)}else this.layers.delete(e.name)}),t}return[]}}class ii extends rt{constructor(t){super(t);d(this,"canvas");d(this,"ctx");d(this,"_rectValueIsUpdated",!1);d(this,"_rect");d(this,"offset",{x:0,y:0});d(this,"center",{x:0,y:0});d(this,"defaultCenter",{top:void 0,bottom:void 0,left:void 0,right:void 0});d(this,"accuracy",5);d(this,"scale",1);d(this,"percentage",1);d(this,"axisConfig",{count:2,min:100,size:100,x:1,y:1});d(this,"cycle",10);d(this,"delta",.02);d(this,"_redrawInNextRenderFrame",!1);d(this,"isAuto",!1);d(this,"isRendering",!1);d(this,"drawAxis");d(this,"layerGroups",new Map);d(this,"isScaleUpdated",!1);d(this,"nowGridCount");const{id:e,axisConfig:i,defaultCenter:s,offset:a}=t,o=document.getElementById(e);if(o instanceof HTMLCanvasElement)if(o.getContext){this.canvas=o,this.ctx=o.getContext("2d");const{clientWidth:l,clientHeight:h}=o;[o.width,o.height]=[l,h]}else throw new Error("canvas-unsupported code here");else throw new Error("canvas is not HTMLCanvasElement");i&&this.setAxis(i),s&&this.setDefaultCenter(s),a&&(this.offset.x=a.x||0,this.offset.y=a.y||0)}get rect(){return this._rectValueIsUpdated&&this._rect?this._rect:(this._rectValueIsUpdated=!0,Promise.resolve().then(()=>this._rectValueIsUpdated=!1),this._rect=this.canvas.getBoundingClientRect(),this._rect)}get redrawInNextRenderFrame(){return this._redrawInNextRenderFrame}set redrawInNextRenderFrame(t){this._redrawInNextRenderFrame=t}setNotifyReload(t){this.notifyReload=t}getDefaultCenterLocation(){const{canvas:t,rect:e,defaultCenter:i}=this;if(!t)return console.error("canvas is not HTMLCanvasElement");const{width:s,height:a}=e,{top:o,bottom:l,left:h,right:c}=i,u={vertical:(p,v)=>{if([0,"0","0%"].includes(p))return 0;if(!(p==1/0||p==-1/0))return typeof p=="number"?p:["top","left"].includes(p)?0:["bottom","right"].includes(p)?v:["middle","center"].includes(p)?v/2:/^(\d+)%$/.test(p)?(p=p.match(/^(\d+)%$/)[1],v*Number(p)/100):Number(p)||void 0},reverse:(p,v)=>{if([0,"0","0%"].includes(p))return v;if(p==1/0||p==-1/0)return;if(typeof p=="number")return v-p;const w=u.vertical(p,v);return w?v-w:void 0}},f=(p,v,w)=>{if(p!==void 0){const S=u.vertical(p,w);if(S!==void 0)return S}if(v!==void 0){const S=u.reverse(v,w);if(S!==void 0)return S}return w/2},g=f(o,l,a);return{x:f(h,c,s),y:g}}updateCenter(){const t=this.getDefaultCenterLocation();if(!t)return;const{x:e,y:i}=t;this.center={x:Math.floor(e+this.offset.x),y:Math.floor(i+this.offset.y)}}updateSize(){const{scale:t,axisConfig:e}=this;e.size=this.getGridSize(t),this.percentage=this.getAxisPointByValue(e.count,0).x/e.min}setScale(t,e){const{canvas:i,isWheelable:s,axisConfig:a,rect:o}=this;if(!s||!i)return console.error("canvas is not HTMLCanvasElement");let l,h;t==="center"?(l=o.left+o.width/2,h=o.top+o.height/2):[l,h]=[t.clientX,t.clientY];const c=this.getMousePositionOnAxis({clientX:l,clientY:h}),u=this.getAxisValueByPoint(c.x,c.y);this.scale=new V(this.scale).add(e).toNumber(),this.isScaleUpdated=!0,this.updateSize();const f=this.getAxisPointByValue(u.xV,u.yV);this.offset.x-=(f.x-c.x)*a.x,this.offset.y-=(f.y-c.y)*a.y,this.offset.x=Number(this.offset.x.toFixed(0)),this.offset.y=Number(this.offset.y.toFixed(0))}setAxis(t){const e={...this.axisConfig,...t},i=Object.fromEntries(Object.entries(e).map(([p,v])=>[p,Number(v)])),{x:s,y:a,count:o,min:l,size:h}=i,c=[1,-1].includes(s),u=[1,-1].includes(a),f=o>0,g=l>0,y=h>=l&&h<=l*2;if(!c||!u||!f||!g||!y){console.warn("Invalid axis configuration:",{x:s,y:a,count:o,min:l,size:h});return}this.axisConfig=i}setDefaultCenter(t){Object.assign(this.defaultCenter,t),this.updateCenter()}getGridSize(t){const{cycle:e,delta:i,axisConfig:s}=this;let a=new V(t).sub(1).abs().mod(e*i).div(i).toNumber();return a=t<1&&a!=0?e-a:a,Number(((a/e+1)*s.min).toFixed(0))}getGridCount(t){const{axisConfig:e,cycle:i,delta:s}=this,a=e.count,o=i*s;if(t===1)return a;if(t>1){const l=new V(t).sub(1).div(o).floor();return new V(a).div(new V(2).pow(l)).toNumber()}else{const l=new V(1).sub(t).div(o).ceil();return new V(a).mul(new V(2).pow(l)).toNumber()}}get getNowGridCount(){const{scale:t,nowGridCount:e,isRendering:i}=this;return e&&i?e:(this.nowGridCount=this.getGridCount(t),i&&Promise.resolve().then(()=>this.nowGridCount=void 0),this.nowGridCount)}getMousePositionOnAxis(t){const{canvas:e,center:i,rect:s,axisConfig:a}=this;if(!e)return console.error("canvas is not HTMLCanvasElement");const{clientX:o,clientY:l}=t,{left:h,top:c}=s,u=(o-h-i.x)*a.x,f=(l-c-i.y)*a.y;return{x:u,y:f}}getAxisValueByPoint(t,e,i){const{axisConfig:s}=this;if(i)return{xV:t/s.min*s.count,yV:e/s.min*s.count};const a=this.getNowGridCount,o=new V(t).div(s.size).mul(a).toFixed(8),l=new V(e).div(s.size).mul(a).toFixed(8);return{xV:Number(o),yV:Number(l)}}getAxisPointByValue(t,e,i){const{axisConfig:s}=this;if(i)return{x:t/s.count*s.min,y:e/s.count*s.min};const a=this.getNowGridCount,o=new V(t).div(a).mul(s.size).toFixed(3),l=new V(e).div(a).mul(s.size).toFixed(3);return{x:Number(o),y:Number(l)}}getMaxMinValue(t){t=t||this.rect;const{left:e,top:i,right:s,bottom:a}=t,{axisConfig:o}=this,{x:l,y:h}=this.getMousePositionOnAxis({clientX:o.x==1?e:s,clientY:o.y==1?i:a}),{xV:c,yV:u}=this.getAxisValueByPoint(l,h),{x:f,y:g}=this.getMousePositionOnAxis({clientX:o.x==1?s:e,clientY:o.y==1?a:i}),{xV:y,yV:p}=this.getAxisValueByPoint(f,g);return{minXV:c,maxXV:y,minYV:u,maxYV:p}}transformPosition(t){const{center:e,percentage:i,axisConfig:s}=this,a=[];for(let o=0;o<t.length;o++){let[l,h]=t[o];l=e.x+l*i*s.x,h=e.y+h*i*s.y,a.push([l,h])}return a}}class si extends ii{constructor(t){super(t);d(this,"theme","light");d(this,"isThemeUpdated",!1);d(this,"style",{light:{background:"#fff",text:{color:"#222",secondary:"#909399",stroke:"#fff",size:12,family:"monospace",bold:!0},grid:{axis:"#222",grid:"#666",innerGrid:"#e5e5e5"},point:{radius:5,fill:"#d03050",width:14,stroke:"#d0305080"},line:{color:"#f0a020",color_hover:"#f2c97d",width:4,dash:!1,dashGap:[5,10],dashOffset:0,cap:"round",join:"round",point:{radius:5,stroke:"#f0a02080",width:14,fill:"#f0a020"}},arc:{fill:"#f0a02030",fill_hover:"#f2c97d60",stroke:{color:"#f0a020",color_hover:"#f2c97d",width:4,dash:!1,dashGap:[5,10],dashOffset:0,cap:"round",join:"round"},point:{radius:5,stroke:"#f0a02080",width:14,fill:"#f0a020"}},polygon:{fill:"#18a05830",fill_hover:"#03693360",stroke:{color:"#18a058",color_hover:"#036933",width:1,dash:!1,dashGap:[5,10],dashOffset:0,cap:"round",join:"round"},point:{radius:5,stroke:"#03693380",width:14,fill:"#036933"}}},dark:{background:"#000",text:{color:"#aeaeae",secondary:"#8c8c8c",stroke:"#000",size:12,family:"monospace",bold:!0},grid:{axis:"#aeaeae",grid:"#666",innerGrid:"#454545"},point:{radius:5,fill:"#e88080",width:14,stroke:"#e8808070"},line:{color:"#f2c97d",color_hover:"#f0a020",width:4,dash:!1,dashGap:[5,10],dashOffset:0,cap:"round",join:"round",point:{radius:5,stroke:"#f2c97d80",width:14,fill:"#f2c97d"}},arc:{fill:"#f2c97d30",fill_hover:"#f0a02060",stroke:{color:"#f2c97d",color_hover:"#f0a020",width:4,dash:!1,dashGap:[5,10],dashOffset:0,cap:"round",join:"round"},point:{radius:5,stroke:"#f2c97d80",width:14,fill:"#f2c97d"}},polygon:{fill:"#63e2b730",fill_hover:"#7efbd160",stroke:{color:"#63e2b7",color_hover:"#63e2b7",width:1,dash:!1,dashGap:[5,10],dashOffset:0,cap:"round",join:"round"},point:{radius:5,stroke:"#7efbd180",width:14,fill:"#7efbd1"}}}});const{theme:e}=t;e&&this.setTheme(e),this.initStyle(),this.clearScreen()}initStyle(){const{canvas:t,ctx:e,theme:i}=this;t.classList.add("_nhanh_canvas");const s=this.style[i];e.font=`${s.text.bold?"bold":""} ${s.text.size}px ${s.text.family}`}clearScreen(t=!0){const{ctx:e,theme:i,rect:s}=this,{width:a,height:o}=s;e.clearRect(0,0,a,o),t&&this.style[i].background&&(e.fillStyle=this.style[i].background,e.fillRect(0,0,a,o))}setStyle(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e)){const i=Vt(this.style[e]||this.style[this.theme]);Qt(i,t[e]),this.style[e]=i}this.initStyle()}setTheme(t){t in this.style&&(this.theme=t,this.isThemeUpdated=!0)}}class ni extends si{constructor(t){super(t);d(this,"resizeObserver");d(this,"currentDrawOverlays",[]);d(this,"rely","");d(this,"maxMinValue",{minXV:0,maxXV:0,minYV:0,maxYV:0});d(this,"measureRedrawPerformance",ee(()=>{this.isRendering=!0,this.redraw(),this.redrawInNextRenderFrame=!1,this.isRendering=!1},[[1,"#F56C6C"],[.5,"#E6A23C"],[0,"#67C23A"]]));this.canvas&&(this.resizeObserver=new ResizeObserver(te(()=>{[this.canvas.width,this.canvas.height]=[this.rect.width,this.rect.height],this.redrawOnce()},200)),this.resizeObserver.observe(this.canvas)),this.updateRely(),this.isRecalculate=!1}updateRely(){const{center:t,scale:e,rect:i,axisConfig:s}=this,a=[t.x,t.y,e,JSON.stringify(s),i.width,i.height].join();this.isRecalculate=this.rely!==a,this.rely=a}redraw(){var s,a;if(!this.canvas)return console.warn("canvas is not HTMLCanvasElement");if(this.canvas.clientWidth==0||this.canvas.clientHeight==0)return console.warn("The image argument is a canvas element with a width or height of 0.");if(!this.shouldRender())return this.clearScreen(!1);this.ctx.globalAlpha=this.opacity??1,this.updateCenter(),this.updateRely(),this.maxMinValue=this.getMaxMinValue(),this.clearScreen();const t=[];let e=[];const i=(s=this.drawAxis)==null?void 0:s.drawAxisAndGrid();i&&e.push([0,i,[]]),this.layerGroups.forEach(o=>e=e.concat(o.fetchCanvas())),e.sort((o,l)=>o[0]-l[0]),e.forEach(([,o,l],h)=>{this.ctx.drawImage(o,0,0),l.forEach(([[c,u],f])=>{t.push([[c+h,u],f])})}),t.sort(([[o,l],h],[[c,u],f])=>{if(o!==c)return c-o;if(l!==u)return u-l;const g=y=>y instanceof gt?0:y instanceof ut?1:y instanceof J?2:y instanceof ft?3:y instanceof dt?4:5;return g(f)-g(h)}),this.currentDrawOverlays=t.map(([,o])=>o),this.isRecalculate=!1,this.isThemeUpdated=!1,this.isScaleUpdated=!1,(a=this.notifyReload)==null||a.call(this)}redrawOnce(){this.redrawInNextRenderFrame||(this.redrawInNextRenderFrame=!0,Promise.resolve().then(()=>{this.isRendering=!0,this.redraw(),this.redrawInNextRenderFrame=!1,this.isRendering=!1}))}findOverlayByPoint(t,e){return[...this.currentDrawOverlays].sort((i,s)=>(i.isClick?0:1)-(s.isClick?0:1)).find(i=>i.isPointInAnywhere(t,e))}destroy(){var t;(t=this.resizeObserver)==null||t.disconnect()}}class ri extends ni{constructor(t){super(t);d(this,"mouseInCanvas",!1);d(this,"mouseIsDown",!1);d(this,"mouseLastPosition",{x:0,y:0});d(this,"unBind");d(this,"lastClickedOverlay");d(this,"lockNotifyClick",!1);d(this,"lastContextmenuOverlay");d(this,"defaultContextmenu",(t,e)=>{const i=this.lastClickedOverlay;i!=null&&i.isDraggable&&i.notifyClick(!1,e)});d(this,"lastPressedKey",{key:"",keyupTime:0,doubleClick:!1});d(this,"defaultWheel",(t,e)=>{this.setScale(e,t.data),this.redrawOnce()});d(this,"lastDownOverlay");d(this,"defaultDown",(t,e)=>{(e==null?void 0:e.button)==0&&(this.mouseIsDown=!0)});d(this,"lastHoverOverlay");d(this,"lastCursorStyle");d(this,"oldClientX",[]);d(this,"oldClientY",[]);this.initEvent(),this.addEventListener("contextmenu",this.defaultContextmenu),this.addEventListener("down",this.defaultDown),this.addEventListener("wheel",this.defaultWheel)}initEvent(){const{canvas:t}=this;if(!t)return console.error("canvas is not HTMLCanvasElement");const e=[{type:"click",handler:this.click.bind(this)},{type:"contextmenu",handler:this.contextmenu.bind(this)},{type:"mouseenter",handler:this.mouseenter.bind(this)},{type:"mouseleave",handler:this.mouseleave.bind(this)},{type:"keydown",handler:this.keydown.bind(this),target:window},{type:"keyup",handler:this.keyup.bind(this),target:window},{type:"wheel",handler:this.wheel.bind(this)},{type:"mousedown",handler:this.mousedown.bind(this)},{type:"mouseup",handler:this.mouseup.bind(this),target:window},{type:"mousemove",handler:this.mousemove.bind(this),target:window},{type:"touchend",handler:this.touchend.bind(this)},{type:"touchmove",handler:this.touchmove.bind(this)}];e.forEach(({type:i,handler:s,target:a=t})=>{a.addEventListener(i,s)}),this.unBind=()=>{e.forEach(({type:i,handler:s,target:a=t})=>{a.removeEventListener(i,s)})}}click(t){var i;if(!this.isClickable)return;if(this.lockNotifyClick)return this.lockNotifyClick=!1;const e=this.findOverlayByPoint(t.offsetX,t.offsetY);this.lastClickedOverlay!=e&&((i=this.lastClickedOverlay)==null||i.notifyClick(!1,t)),e==null||e.notifyClick(!0,t),this.lastClickedOverlay=e,this.notifyClick(!0,t)}contextmenu(t){var i;if(!this.isContextmenuable)return;t.preventDefault();const e=this.findOverlayByPoint(t.offsetX,t.offsetY);this.lastContextmenuOverlay!=e&&((i=this.lastContextmenuOverlay)==null||i.notifyContextmenu(!1,t)),e==null||e.notifyContextmenu(!0,t),this.lastContextmenuOverlay=e,this.notifyContextmenu(!0,t)}mouseenter(t){this.mouseInCanvas=!0}mouseleave(t){this.mouseInCanvas=!1}getStep(t){const{lastPressedKey:e}=this;return e.doubleClick?4:e.key===t&&Date.now()-e.keyupTime<300?(e.doubleClick=!0,4):1}keydown(t){const{mouseInCanvas:e,offset:i,delta:s,axisConfig:a}=this,o=t.key;if(!e||!this.isDraggable||this.isAuto)return;const l=this.getStep(o),h=this.lastClickedOverlay,u=(h==null?void 0:h.isDraggable)&&this.currentDrawOverlays.includes(h)&&(st(h.value)?"Matrix":K(h.value)?"Single":!1),f=(v,w)=>{if(!u)return i.x+=v*l,i.y+=w*l,!0;const S=this.getAxisValueByPoint(l,0).xV,[x,R]=[S*a.x,S*a.y];if(u==="Single"){const A=h.value;A[0]+=v*x,A[1]+=w*R}else h.value.forEach(A=>{A[0]+=v*x,A[1]+=w*R});return h.value=[...h.value],!0},g=v=>(this.setScale("center",v*s),!0),p={ArrowUp:()=>f(0,-1),ArrowDown:()=>f(0,1),ArrowLeft:()=>f(-1,0),ArrowRight:()=>f(1,0),"+":()=>g(1),"-":()=>g(-1)}[o];p!=null&&p()&&this.redrawOnce()}keyup(t){const{mouseInCanvas:e,lastPressedKey:i}=this;if(e){const s=t.key;i.key=s,i.keyupTime=Date.now(),i.doubleClick=!1}}wheel(t){if(!this.isWheelable)return;t.preventDefault();const{delta:e,isAuto:i}=this;if(i)return;const s=t.deltaY<0?e:-e,a=this.findOverlayByPoint(t.offsetX,t.offsetY);a==null||a.notifyWheel(s,t),this.notifyWheel(s,t)}mousedown(t){var a;if(!this.isDownable)return;const{clientX:e,clientY:i}=t;this.mouseLastPosition={x:e,y:i};const s=this.findOverlayByPoint(t.offsetX,t.offsetY);this.lastDownOverlay!=s&&((a=this.lastDownOverlay)==null||a.notifyDown(!1,t),s==null||s.notifyDown(!0,t)),this.lastDownOverlay=s,this.notifyDown(!0,t)}mouseup(t){this.mouseIsDown=!1,this.lastDownOverlay=void 0}mousemove(t){this.isAuto||(this.canvas.classList.toggle("_nhanh_canvas_draggable",this.isDraggable),this.mouseIsDown?this.handleDragMove(t):this.handleHover(t))}handleDragMove(t){if(!this.isDraggable)return;const{lastDownOverlay:e}=this;if(!this.isDraggable)return;e!=null&&e.isDraggable?this.notifyDraggOverlays(t):this.handleCanvasPan(t);const{clientX:i,clientY:s}=t;this.mouseLastPosition={x:i,y:s},this.lockNotifyClick=!0}notifyDraggOverlays(t){const e=this.lastDownOverlay,{mouseLastPosition:i}=this,{clientX:s,clientY:a}=t;e.notifyDragg({offsetX:s-i.x,offsetY:a-i.y},t)}handleCanvasPan(t){const{clientX:e,clientY:i}=t,{offset:s,mouseLastPosition:a}=this,o=e-a.x,l=i-a.y;s.x+=o,s.y+=l,this.redrawOnce(),this.notifyDragg({offsetX:o,offsetY:l},t)}handleHover(t){if(!this.isHoverable||t.target!=this.canvas)return;const e=this.findOverlayByPoint(t.offsetX,t.offsetY);this.updateHoverState(e,t),this.notifyHover(!0,t)}updateHoverState(t,e){if(this.lastHoverOverlay===t){const s=t==null?void 0:t.cursorStyle;s!==this.lastCursorStyle&&(this.lastCursorStyle&&this.canvas.classList.remove(this.lastCursorStyle),s&&this.canvas.classList.add(s),this.lastCursorStyle=s);return}this.lastHoverOverlay&&t&&t.hasController("hover",this.lastHoverOverlay)||(this.clearHoverState(e),this.applyHoverState(t,e)),this.lastHoverOverlay=t}clearHoverState(t){this.lastHoverOverlay&&(this.lastHoverOverlay.notifyHover(!1,t),this.canvas.classList.remove(this.lastHoverOverlay.cursorStyle))}applyHoverState(t,e){t&&(t.notifyHover(!0,e),this.lastCursorStyle=t.cursorStyle,this.canvas.classList.add(this.lastCursorStyle))}touchend(t){this.oldClientX=this.oldClientY=[]}touchmove(t){if(!this.isDraggable)return;const e=t.touches;t.preventDefault();const{oldClientX:i,oldClientY:s,offset:a,delta:o,isAuto:l,isDraggable:h}=this;if(h&&!l){if(e.length===1){const{clientX:c,clientY:u}=e[0];i.length&&(a.x+=c-i[0],a.y+=u-s[0],this.redrawOnce()),this.oldClientX=[c],this.oldClientY=[u]}else if(e.length===2){const{clientX:c,clientY:u}=e[0],{clientX:f,clientY:g}=e[1];if(i.length==2){const y=_t(i[0],s[0],i[1],s[1]),p=_t(c,u,f,g),{x:v,y:w}=Mt(c,u,f,g);this.setScale({clientX:v,clientY:w},p>y?o:-o),this.redrawOnce()}this.oldClientX=[c,f],this.oldClientY=[u,g]}}}destroy(){var t;super.destroy(),(t=this.unBind)==null||t.call(this)}}class ai extends ri{getDefaultOverlayGroup(){var o,l,h,c,u;const r=this.layerGroups.get("默认图层群组");if(!r)return;const t=(o=r.getLayer("点位图层"))==null?void 0:o.getGroup("点位覆盖物群组"),e=(l=r.getLayer("线段图层"))==null?void 0:l.getGroup("线段覆盖物群组"),i=(h=r.getLayer("多边形图层"))==null?void 0:h.getGroup("多边形覆盖物群组"),s=(c=r.getLayer("文字图层"))==null?void 0:c.getGroup("文字覆盖物群组"),a=(u=r.getLayer("自定义绘制图层"))==null?void 0:u.getGroup("自定义绘制覆盖物群组");return{overlays_text:s,overlays_point:t,overlays_line:e,overlays_polygon:i,overlays_custom:a}}getAllOverlays(r){const t=[],e=r!==void 0?Array.isArray(r)?[...r]:[r]:Array.from(this.layerGroups.values());for(;e.length>0;){const i=e.pop();if(i instanceof it){if(!i.isVisible)continue;e.push(...i.layers.values())}else if(i instanceof U){if(!i.isVisible)continue;e.push(...i.groups.values())}else if(i instanceof Y){if(!i.isVisible)continue;e.push(...i.overlays.values())}else i.isVisible&&t.push(i)}return t}setFitView(r=void 0,t=!1,e=[60,60,60,60],i){const s=this.getAllOverlays(r);if(s.length===0)return;const{minX:a,maxX:o,minY:l,maxY:h}=this.calculateBoundingBox(s),c=o-a,u=h-l,f=this.calculateOptimalScale(c,u,e,i),g=this.calculateOffsetDifference(a,o,l,h,e);f==this.scale&&g.x==0&&g.y==0||(t?this.applyTransformImmediately(f,g):this.animateTransform(f,g))}calculateBoundingBox(r){let t=1/0,e=-1/0,i=1/0,s=-1/0;for(const a of r){const o=a.staticValueScope;t=Math.min(t,o.minX),e=Math.max(e,o.maxX),i=Math.min(i,o.minY),s=Math.max(s,o.maxY)}return{minX:t,maxX:e,minY:i,maxY:s}}calculateOptimalScale(r,t,e,i){const{cycle:s,delta:a,axisConfig:o,rect:l}=this,{width:h,height:c}=l,u=Math.max(0,h-e[1]-e[3])||h,f=Math.max(0,c-e[0]-e[2])||c;if(u<=0||f<=0)return console.warn("无效的可视区域尺寸，边距设置可能不合理"),this.scale;const g=r/u,y=t/f,p=Math.max(g,y),v=o.count,w=v/o.min,S=s*a;let x;if(p>w){const R=Math.ceil(p/w);x=1-((v*R/p-o.min)/o.min+(R-2))*S}else{const R=($,W,Q)=>$<W?Q-1:R($/2,W,Q+1),A=R(w,p,0),M=Math.pow(2,A);x=1+((v/M/p-o.min)/o.min+A)*S}return i!==void 0&&(x=Math.min(i,x)),x=new V(x).div(a).round().mul(a).toNumber(),x}calculateOffsetDifference(r,t,e,i,s){const{width:a,height:o}=this.rect,{axisConfig:l,center:h}=this,c=(t+r)/2,u=(i+e)/2,f=this.getAxisPointByValue(c,u),g=this.getAxisValueByPoint((a/2-h.x)*l.x,(o/2-h.y)*l.y),y=this.getAxisPointByValue(g.xV,g.yV);return{x:Math.round(-(f.x+(s[3]-s[1])-y.x)*l.x),y:Math.round(-(f.y+(s[0]-s[2])-y.y)*l.y)}}applyTransformImmediately(r,t){this.offset={x:this.offset.x+t.x,y:this.offset.y+t.y},this.scale=r,this.updateSize(),this.redrawOnce()}animateTransform(r,t){const e=this.scale,i={...this.offset},s=300;this.isAuto=!0;const a=()=>this.isAuto=!1;(h=>this.animateOffset(i,t,s,h||a))(h=>this.animateScale(e,r,s,h||a))}animateScale(r,t,e,i){const s=t-r;let a=0;pt(o=>{!this.isAuto||!this.canvas||!this.isInteractive||(this.setScale("center",(o-a)*s),a=o,this.redrawOnce(),o===1&&i())},e)}animateOffset(r,t,e,i){pt(s=>{!this.isAuto||!this.canvas||!this.isInteractive||(this.offset={x:Number((r.x+t.x*s).toFixed(0)),y:Number((r.y+t.y*s).toFixed(0))},this.redrawOnce(),s===1&&i())},e)}returnToOrigin(){if(!this.isInteractive||this.scale==1&&this.offset.x==0&&this.offset.y==0)return;const{rect:r,axisConfig:t}=this,e=this.getDefaultCenterLocation(),i=(r.width/2-e.x)*t.x,s=(r.height/2-e.y)*t.y,a=this.getAxisValueByPoint(i,s,!0),o=this.getMousePositionOnAxis({clientX:r.x+r.width/2,clientY:r.y+r.height/2}),l=this.getAxisValueByPoint(o.x,o.y),h=t.size/this.getNowGridCount,c=(l.xV-a.xV)*t.x*h,u=(l.yV-a.yV)*t.y*h;this.animateTransform(1,{x:c,y:u})}zoom(r){const{canvas:t,rect:e}=this;if(!t||!e)return console.error("canvas is not HTMLCanvasElement");this.setScale("center",r),this.redrawOnce()}zoomIn(){this.zoom(this.delta)}zoomOut(){this.zoom(-this.delta)}setStyle(r){super.setStyle(r),this.redrawOnce()}setTheme(r){super.setTheme(r),this.redrawOnce()}setAxis(r){super.setAxis(r),this.redrawOnce()}setDefaultCenter(r){super.setDefaultCenter(r),this.redrawOnce()}toggleAxis(r){this.drawAxis.toggleAxis(r),this.redrawOnce()}togglePoint(r){const{overlays_point:t}=this.getDefaultOverlayGroup()||{};return t?(t.isVisible=r??!t.isVisible,this.redrawOnce(),t.isVisible):!1}toggleLine(r){const{overlays_line:t}=this.getDefaultOverlayGroup()||{};return t?(t.isVisible=r??!t.isVisible,this.redrawOnce(),t.isVisible):!1}togglePolygon(r){const{overlays_polygon:t}=this.getDefaultOverlayGroup()||{};return t?(t.isVisible=r??!t.isVisible,this.redrawOnce(),t.isVisible):!1}toggleLock(r){return this.isInteractive=r??!this.isInteractive,this.isInteractive}}class It extends O{constructor(t){t.redrawOnIsHoverChange=t.redrawOnIsHoverChange??!0;super(t);d(this,"_isFill",!1);d(this,"_isClosed",!1);d(this,"_isClosedThroughCenter",!1);d(this,"_radiusType","position");d(this,"dynamicRadius",0);d(this,"_radius",0);d(this,"_startAngle",0);d(this,"_endAngle",0);d(this,"_counterclockwise",!1);d(this,"_isHandlePointsVisible",!0);d(this,"isShowHandlePoint",!1);d(this,"defaultClick",(t,e)=>{var a;if(!this.isHandlePointsVisible)return;const{state:i,oldState:s}=t.data;i!=s&&((a=this.notifyReload)==null||a.call(this))});d(this,"defaultDragg",(t,e)=>{if(!this.mainCanvas)return;const i=()=>{var c;const{offsetX:s,offsetY:a}=t.data,{x:o,y:l}=this.calculateOffset(s,a);this.handlePointsArr.concat(this).forEach(u=>{u.internalUpdate({value:[u.value[0]+o.value,u.value[1]+l.value],position:[u.position[0]+o.position,u.position[1]+l.position],dynamicPosition:[u.dynamicPosition[0]+o.dynamicPosition,u.dynamicPosition[1]+l.dynamicPosition]})}),(c=this.notifyReload)==null||c.call(this)};if(this.isHandlePointsVisible){const{start:s,end:a,radius:o}=this.handlePoints,l=this.handlePointsArr.find(h=>h.isHover);if(l){const h=t.data.offsetX;if(l==s)this.startAngle=(this.startAngle+-h/180*Math.PI)%(Math.PI*2);else if(l==a)this.endAngle=(this.endAngle+-h/180*Math.PI)%(Math.PI*2);else if(l==o){let c=0;this.radiusType=="position"?c=h/2/this.mainCanvas.percentage:c=this.mainCanvas.getAxisValueByPoint(h,0).xV/2,this.radius+c>0&&(this.radius+=c)}}else i()}else i()});d(this,"handlePoints",{start:void 0,end:void 0,radius:void 0});["isFill","isClosed","isClosedThroughCenter","radius","radiusType","startAngle","endAngle","counterclockwise","isHandlePointsVisible"].forEach(e=>{e in t&&(this["_"+e]=t[e])}),this.addEventListener("click",this.defaultClick),this.addEventListener("dragg",this.defaultDragg)}get isFill(){return this._isFill}set isFill(t){var e;this._isFill!=t&&(this._isFill=t,(e=this.notifyReload)==null||e.call(this))}get isClosed(){return this._isClosed}set isClosed(t){var e;this._isClosed!=t&&(this._isClosed=t,(e=this.notifyReload)==null||e.call(this))}get isClosedThroughCenter(){return this._isClosedThroughCenter}set isClosedThroughCenter(t){var e;this._isClosedThroughCenter!=t&&(this._isClosedThroughCenter=t,(e=this.notifyReload)==null||e.call(this))}get radiusType(){return this._radiusType}set radiusType(t){this._radiusType!=t&&(this._radiusType=t,this.updateRadius())}get radius(){return this._radius}set radius(t){this._radius!=t&&(this._radius=t,this.updateRadius())}get startAngle(){return this._startAngle}set startAngle(t){var e;this._startAngle!=t&&(this._startAngle=t,this.updateDynamicRadius(),this.updateHandlePoints(),(e=this.notifyReload)==null||e.call(this))}get endAngle(){return this._endAngle}set endAngle(t){var e;this._endAngle!=t&&(this._endAngle=t,this.updateDynamicRadius(),this.updateHandlePoints(),(e=this.notifyReload)==null||e.call(this))}get counterclockwise(){return this._counterclockwise}set counterclockwise(t){var e;this._counterclockwise!=t&&(this._counterclockwise=t,this.updateDynamicRadius(),this.updateHandlePoints(),(e=this.notifyReload)==null||e.call(this))}get isHandlePointsVisible(){return this._isHandlePointsVisible}set isHandlePointsVisible(t){var e;this._isHandlePointsVisible!==t&&(this._isHandlePointsVisible=t,this.isShowHandlePoint!=t&&((e=this.notifyReload)==null||e.call(this)))}updateValueScope(){this.initValueScope(),this.updateExtraScope()}isPointInPath(t,e){return this.isFill&&this.path?O.ctx.isPointInPath(this.path,t,e):!1}isPointInStroke(t,e){return this.path&&this.mainCanvas?(this.setOverlayStyles(O.ctx),this.isDraggable&&(O.ctx.lineWidth=Math.max(O.ctx.lineWidth,20)),O.ctx.isPointInStroke(this.path,t,e)):!1}isPointInAnywhere(t,e){const i=super.isPointInAnywhere(t,e),s=(a=>{if(!a)return!1;let o=!1;return this.handlePointsArr.forEach(l=>{o?l.isHover&&l.notifyHover(!1):(o=l.isPointInAnywhere(t,e),o!=l.isHover&&l.notifyHover(o))}),o})(this.isClick&&this.isHandlePointsVisible);return i||s}get cursorStyle(){const t=this.handlePointsArr.some(e=>e==null?void 0:e.isHover);return this.isDraggable?"_nhanh_canvas_hover_overlay_draggable"+(t?"_ew":""):"_nhanh_canvas_hover_overlay"}setOverlayStyles(t){var h;const e=this.isHover,i=this.mainCanvas,s=i.style[i.theme].arc;let a={};if(typeof this.style=="string")a=((h=i.style[this.style])==null?void 0:h.arc)||s;else if(typeof this.style=="object"){const c=this.style.stroke?Object.assign({},s.stroke,this.style.stroke):s.stroke;a=Object.assign({},s,this.style,{stroke:c})}else a=s;const{fill:o,fill_hover:l}=a;return t&&(this.setBaseLineStyle(t,a.stroke),t.fillStyle=e?l:o),a}get handlePointStyle(){return this.setOverlayStyles().point}get handlePointsArr(){const t=this.handlePoints.radius;return Object.values(this.handlePoints).filter(Boolean).sort((e,i)=>(e.isHover||e==t?0:1)-(i.isHover||i==t?0:1))}updateHandlePoints(){let{mainCanvas:t,radius:e,radiusType:i,startAngle:s,endAngle:a,dynamicPosition:o}=this;if(!t||!o)return;const l=this[i],[h,c]=oi(...l,e,s,a,t.axisConfig.x,t.axisConfig.y),u=v=>new J({name:v,isDraggable:!0,mainCanvas:this.mainCanvas,notifyReload:()=>{var w;return(w=this.notifyReload)==null?void 0:w.call(this)}}),f=this.handlePoints.start||u("start"),g=this.handlePoints.end||u("end"),y=this.handlePoints.radius||u("radius");f[i]=h,g[i]=c;const p=l[0]+e*2*t.axisConfig.x;y[i]=[p,l[1]],this.handlePoints={start:f,end:g,radius:y}}updateRadius(){this.mainCanvas&&(this.updateDynamicRadius(),this.updateHandlePoints(),this.updateExtraScope())}updateExtraScope(){const{mainCanvas:t,radius:e,radiusType:i}=this;if(t)if(e==0)this.setExtraScopeByValue();else if(i=="position"){const s=t.getAxisValueByPoint(e,0).xV;this.setExtraScopeByValue({topV:s,bottomV:s,leftV:s,rightV:s*2})}else i=="value"&&this.setExtraScopeByValue({topV:e,bottomV:e,leftV:e,rightV:e*2})}updateDynamicRadius(){const{mainCanvas:t,radius:e,radiusType:i}=this;!t||e<=0?this.dynamicRadius=0:i=="position"?this.dynamicRadius=e*t.percentage:this.dynamicRadius=t.getAxisPointByValue(e,0).x}updateBaseData(){if(!this.mainCanvas)return;let{value:t,position:e}=this;const[i,s]=[K(t),K(e)];if(!i&&!s)return this.internalUpdate({dynamicPosition:void 0});if(i){const o=this.mainCanvas.getAxisPointByValue(t[0],t[1],!0);e=[o.x,o.y]}else{const o=this.mainCanvas.getAxisValueByPoint(e[0],e[1],!0);t=[o.xV,o.yV]}const a=this.mainCanvas.transformPosition([e])[0];this.internalUpdate({value:t,position:e,dynamicPosition:a}),this.updateDynamicRadius(),this.updateHandlePoints()}drawGuideLine(t,e,i,s){this.setBaseLineStyle(t,{...s.stroke,dash:!0});const{dynamicRadius:a,startAngle:o,endAngle:l,counterclockwise:h}=this;t.beginPath(),t.arc(e,i,a,l,o,h),t.stroke(),t.beginPath(),t.moveTo(e,i);const c=this.handlePoints.radius.dynamicPosition;t.lineTo(c[0],c[1]),t.stroke(),!(this.isClosed&&this.isClosedThroughCenter)&&(t.fillStyle=t.strokeStyle,t.beginPath(),t.arc(e,i,s.point.radius,0,Math.PI*2),t.fill())}draw(t){const{dynamicPosition:e,mainCanvas:i,extraOffset:s,dynamicRadius:a,startAngle:o,endAngle:l,counterclockwise:h,isFill:c,isClosed:u,isClosedThroughCenter:f}=this;if(!i||a<=0)return;this.setGlobalAlpha(t);const g=this.setOverlayStyles(t),y=e[0]+s.x,p=e[1]+s.y;t.beginPath(),this.path=new Path2D,this.path.arc(y,p,a,o,l,h),u&&(this.path.lineTo(y,p),f&&this.path.closePath()),t.stroke(this.path),c&&t.fill(this.path),this.isShowHandlePoint=this.isClick&&this.isHandlePointsVisible,this.isShowHandlePoint&&(this.drawGuideLine(t,y,p,g),this.handlePointsArr.forEach(v=>{var w;v.internalUpdate({style:g.point}),(w=v.getDraw())==null||w[0].call(v,t)}))}getDraw(){if(this.isNeedRender){if(this.isRecalculate){const{position:t,mainCanvas:e}=this;this.updateDynamicRadius();const i=[...this.dynamicPosition],s=e.transformPosition([t])[0];e!=null&&e.isScaleUpdated?this.updateHandlePoints():this.handlePointsArr.forEach(a=>{const o=s[0]-i[0],l=s[1]-i[1],h=a.dynamicPosition[0]+o,c=a.dynamicPosition[1]+l;a.internalUpdate({dynamicPosition:[h,c]})}),this.internalUpdate({dynamicPosition:s})}return[this.draw,this]}}}function oi(n,r,t,e,i,s=1,a=1){const o=n+t*Math.cos(e)*s,l=r+t*Math.sin(e)*a,h=n+t*Math.cos(i)*s,c=r+t*Math.sin(i)*a;return[[o,l],[h,c]]}class X extends ai{constructor(r){super(r),this.drawAxis=new Ze(this),"axisShow"in r&&this.toggleAxis(r.axisShow),this.initLayerGroups(),this.updateCenter()}initLayerGroups(){const r=new U({name:"多边形图层"});r.addGroup(new Y({name:"多边形覆盖物群组"})),r.setzIndex(1);const t=new U({name:"线段图层"});t.addGroup(new Y({name:"线段覆盖物群组"})),t.setzIndex(2);const e=new U({name:"点位图层"});e.addGroup(new Y({name:"点位覆盖物群组"})),e.setzIndex(3);const i=new U({name:"文字图层"});i.addGroup(new Y({name:"文字覆盖物群组"})),i.setzIndex(4);const s=new U({name:"自定义绘制图层"});s.addGroup(new Y({name:"自定义绘制覆盖物群组"})),s.setzIndex(5);const a=new it({name:"默认图层群组"});a.addLayer([i,e,t,r,s]),this.setLayerGroups(a)}gteLayerGroups(r="默认图层群组"){return this.layerGroups.get(r)}setLayerGroups(r){r instanceof it&&(this.layerGroups.set(r.name,r),r.setNotifyReload(()=>this.redrawOnce()),r.setMainCanvas(this),r.parent=this)}removeLayerGroups(r){r instanceof it&&(this.layerGroups.delete(r.name),r.setNotifyReload(),r.setMainCanvas(),r.parent=void 0,this.redrawOnce())}addLayer(r){const t=this.layerGroups.get("默认图层群组");t&&t.addLayer([r].flat())}removeLayer(r){const t=this.layerGroups.get("默认图层群组");t&&t.removeLayer([r].flat())}addOverlay(r){const{overlays_text:t,overlays_point:e,overlays_line:i,overlays_polygon:s,overlays_custom:a}=this.getDefaultOverlayGroup()||{};[r].flat().forEach(o=>{o instanceof ut?t==null||t.addOverlays(o):o instanceof J?e==null||e.addOverlays(o):o instanceof ft||o instanceof It?i==null||i.addOverlays(o):o instanceof dt?s==null||s.addOverlays(o):o instanceof gt&&(a==null||a.addOverlays(o))})}removeOverlay(r){const{overlays_text:t,overlays_point:e,overlays_line:i,overlays_polygon:s,overlays_custom:a}=this.getDefaultOverlayGroup()||{};[r].flat().forEach(o=>{o instanceof ut?t==null||t.removeOverlays(o):o instanceof J?e==null||e.removeOverlays(o):o instanceof ft?i==null||i.removeOverlays(o):o instanceof dt?s==null||s.removeOverlays(o):o instanceof gt&&(a==null||a.addOverlays(o))})}destroy(){super.destroy()}}d(X,"LayerGroup",it),d(X,"Layer",U),d(X,"OverlayGroup",Y),d(X,"Text",ut),d(X,"Point",J),d(X,"Line",ft),d(X,"Polygon",dt),d(X,"Custom",gt),d(X,"Arc",It);export{X as _};
