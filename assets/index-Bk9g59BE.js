var _e=Object.defineProperty;var we=i=>{throw TypeError(i)};var ke=(i,e,t)=>e in i?_e(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var d=(i,e,t)=>ke(i,typeof e!="symbol"?e+"":e,t),be=(i,e,t)=>e.has(i)||we("Cannot "+t);var g=(i,e,t)=>(be(i,e,"read from private field"),t?t.call(i):e.get(i)),V=(i,e,t)=>e.has(i)?we("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(i):e.set(i,t),ae=(i,e,t,n)=>(be(i,e,"write to private field"),n?n.call(i,t):e.set(i,t),t);import{d as Q,c as F,o as B,W as N,bg as Ve,b5 as De,az as ge,b as m,w as p,u as f,e as w,_ as fe,ao as Ce,p as z,aw as We,bh as ze,at as xe,bd as $e,bi as Ge,A as ve,ae as Me,Z as ye,af as Oe,t as A,a1 as he,R as me,ag as Xe,as as X,B as oe,a7 as Ye,a8 as je,a3 as le,a9 as He,bj as Ke,bk as qe}from"./index-CWGjrrMU.js";import{R as Je}from"./ResponsiveDirectionLayout-DUKiLA-1.js";import{N as W}from"./InputGroupLabel-_vGPaSeB.js";import{N as pe}from"./Select-Bngy2hJi.js";import{N as ne}from"./InputGroup-Cx0ZCvNf.js";import{N as Ze}from"./InputNumber-aw3XYLMZ.js";import{N as Qe}from"./Slider-BFnMjvPH.js";import{S as Ie}from"./Scrollbar-C5M1isNN.js";import{N as et}from"./Image-DYHSz4uR.js";import{N as ue}from"./text-1P8XkLwd.js";import{a as tt}from"./headers-D4790ABn.js";import{N as at}from"./ButtonGroup-DEQcQ937.js";import{N as nt,a as it,b as rt}from"./Upload-CgDrM21o.js";import{A as st}from"./Add-Bl2kvWL0.js";import{C as ot}from"./CloudDownloadOutline-DKIGgdUU.js";import"./Suffix-JMpYLuyb.js";import"./attribute-Cz32yFEB.js";import"./Empty-CBX426LN.js";import"./use-locale-BiPC89H3.js";import"./Input-B0PaHSyX.js";import"./_createCompounder-DNKiq6G4.js";import"./Progress-CyWzqJsB.js";const lt={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},ut=N("path",{d:"M112 111v290c0 17.44 17 28.52 31 20.16l247.9-148.37c12.12-7.25 12.12-26.33 0-33.58L143 90.84c-14-8.36-31 2.72-31 20.16z",fill:"none",stroke:"currentColor","stroke-miterlimit":"10","stroke-width":"32"},null,-1),ct=[ut],dt=Q({name:"PlayOutline",render:function(e,t){return B(),F("svg",lt,ct)}}),ft={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},ht=N("rect",{x:"96",y:"96",width:"320",height:"320",rx:"24",ry:"24",fill:"none",stroke:"currentColor","stroke-linejoin":"round","stroke-width":"32"},null,-1),mt=[ht],pt=Q({name:"StopOutline",render:function(e,t){return B(),F("svg",ft,mt)}});var O=(i=>(i.LE="le",i.BE="be",i.LittleEndian="le",i.BigEndian="be",i))(O||{});function Z(i){const e=n=>n.toString().padStart(2,"0");return`${e(Math.floor(i/60))}:${e(Math.floor(i%60))}`}function gt(i,e){const{audioBasicInfo:t,fileSize:n,fileName:a}=i,r=a.lastIndexOf("."),s=r>0?a.substring(r+1):"异常！",o=Z(t.startTime||0);return{...t,name:a,currentTime:o,totalDuration:Z(e),size:Ve(n),type:s.toLocaleUpperCase()}}const Ct={class:"options-panel"},vt=Q({__name:"options",props:{volume:{required:!0},volumeModifiers:{},options:{required:!0},optionsModifiers:{}},emits:["update:volume","update:options"],setup(i){const e=De(i,"volume"),t=De(i,"options");return(n,a)=>(B(),F("div",Ct,[ge(n.$slots,"prefix",{},void 0,!0),m(f(ne),null,{default:p(()=>[m(f(W),null,{default:p(()=>[...a[5]||(a[5]=[w("采样率",-1)])]),_:1}),m(f(pe),{value:t.value.sampleRate,"onUpdate:value":a[0]||(a[0]=r=>t.value.sampleRate=r),options:[8e3,16e3,22050,24e3,44100,48e3,96e3,192e3].map(r=>({label:String(r),value:r}))},null,8,["value","options"]),m(f(W),null,{default:p(()=>[...a[6]||(a[6]=[w("Hz",-1)])]),_:1})]),_:1}),m(f(ne),null,{default:p(()=>[m(f(W),null,{default:p(()=>[...a[7]||(a[7]=[w("位深",-1)])]),_:1}),m(f(pe),{value:t.value.bitDepth,"onUpdate:value":a[1]||(a[1]=r=>t.value.bitDepth=r),options:[8,16,24,32,64].map(r=>({label:String(r),value:r}))},null,8,["value","options"]),m(f(W),null,{default:p(()=>[...a[8]||(a[8]=[w("bit",-1)])]),_:1})]),_:1}),m(f(ne),null,{default:p(()=>[m(f(W),null,{default:p(()=>[...a[9]||(a[9]=[w("声道数",-1)])]),_:1}),m(f(Ze),{value:t.value.channelCount,"onUpdate:value":a[2]||(a[2]=r=>t.value.channelCount=r),min:1,precision:0},null,8,["value"]),m(f(W),null,{default:p(()=>[...a[10]||(a[10]=[w("ch",-1)])]),_:1})]),_:1}),m(f(ne),null,{default:p(()=>[m(f(W),null,{default:p(()=>[...a[11]||(a[11]=[w("字节序",-1)])]),_:1}),m(f(pe),{value:t.value.endianness,"onUpdate:value":a[3]||(a[3]=r=>t.value.endianness=r),options:[{label:"小端序",value:f(O).LE},{label:"大端序",value:f(O).BE}]},null,8,["value","options"])]),_:1}),m(f(ne),null,{default:p(()=>[m(f(W),null,{default:p(()=>[...a[12]||(a[12]=[w("音量",-1)])]),_:1}),m(f(Qe),{value:e.value,"onUpdate:value":a[4]||(a[4]=r=>e.value=r),min:0,max:1,step:.01},null,8,["value"])]),_:1}),ge(n.$slots,"suffix",{},void 0,!0)]))}}),yt=fe(vt,[["__scopeId","data-v-f4c5ec2a"]]),It=["id"],Et=Q({__name:"HandleFileDrag",emits:["drop-callback"],setup(i,{emit:e}){const t=e,n=Ce("handle-file-drag-"),a=z(!1);function r(u){if(u.preventDefault(),u.stopPropagation(),!u.dataTransfer){a.value=!1;return}const l=u.dataTransfer.types;a.value=l.includes("Files")}function s(u){r(u)}function o(u){u.target.id==n&&(a.value=!1)}function c(u){var h;u.preventDefault(),u.stopPropagation(),a.value=!1;const l=(h=u.dataTransfer)==null?void 0:h.files;t("drop-callback",Array.from(l||[]))}return(u,l)=>{var h,E;return B(),F("div",{id:f(n),class:xe(["handle-file-drag",a.value&&"file-drop-hint"]),style:We({"--color":((E=(h=f(ze).theme)==null?void 0:h.common)==null?void 0:E.successColor)||"#63e2b7"}),"drag-tip":"请将音频文件拖拽至此",onDragenter:r,onDragover:s,onDragleave:o,onDrop:c},[ge(u.$slots,"default",{},void 0,!0)],46,It)}}}),Rt=fe(Et,[["__scopeId","data-v-bf2639f9"]]);class wt{constructor(){d(this,"config");d(this,"barWidth",2);d(this,"barGap",2);d(this,"barCount",0);d(this,"barColor","#2080f0");d(this,"amplitudeValues",[]);d(this,"amplitudeBarMetrics",[]);d(this,"lastTimelineX")}init(e){this.config=e,this.lastTimelineX=void 0,this.calculateAmplitudeData(),this.calculateAmplitudeBarMetrics(),this.render(0)}render(e){if(!this.config)return;const{canvasContext:t}=this.config,{amplitudeBarMetrics:n,barColor:a,barWidth:r}=this,{width:s,height:o}=t.canvas,c=Math.floor((s-2)*e);this.lastTimelineX!=c&&(this.lastTimelineX=c,t.clearRect(0,0,s,o),t.fillStyle=a,n.forEach(({x:u,y:l,height:h})=>{c<=u&&(t.fillStyle="#B1B1B1FF"),t.fillRect(u,l,r,h)}),t.fillStyle=a,t.fillRect(c,0,2,o))}calculateAmplitudeData(){if(!this.config)return;const{canvasContext:e,audioBuffer:t,channelCount:n}=this.config,{barWidth:a,barGap:r}=this;this.barCount=Math.floor(e.canvas.width/(a+r));const s=t.length,o=Array.from({length:n},(u,l)=>t.getChannelData(l)),c=Math.floor(s/this.barCount);this.amplitudeValues=[];for(let u=0;u<this.barCount;u++){const l=u*c,h=o.reduce((E,b)=>{const _=b.slice(l,l+c).reduce((te,k)=>te+k**2,0),ee=Math.sqrt(_/c);return E+ee},0);this.amplitudeValues.push(h)}}calculateAmplitudeBarMetrics(){var u;const e=(u=this.config)==null?void 0:u.canvasContext.canvas;if(!e)return;const{barWidth:t,barGap:n,barCount:a,amplitudeValues:r}=this,s=e.height,o=e.height/2;let c=0;this.amplitudeBarMetrics=[];for(let l=0;l<a;l++){const h=s*r[l];this.amplitudeBarMetrics.push({x:c,y:o-h/2,height:h}),c+=t+n}}clear(){this.amplitudeValues=[],this.amplitudeBarMetrics=[]}}class bt{constructor(){d(this,"config");d(this,"channelColors",["#5470c6","#91cc75","#fac858","#ee6666","#73c0de","#3ba272","#fc8452","#9a60b4","#ea7ccc"]);d(this,"channelRenderHeight",0);d(this,"waveformDataSize",0);d(this,"waveformDataCount",0);d(this,"channelAmplitudeData",[]);d(this,"lastRenderedStartIndex")}init(e){this.config=e,this.lastRenderedStartIndex=void 0,this.channelRenderHeight=Math.floor(e.canvasContext.canvas.height/e.channelCount),this.preprocessAudioData(),this.renderChannelBaseLines()}renderChannelBaseLines(){const{config:e,channelColors:t,channelRenderHeight:n}=this;if(!e)return;const{channelCount:a,canvasContext:r}=e,{width:s}=r.canvas;r.clearRect(0,0,s,r.canvas.height);for(let o=0;o<a;o++){const c=t[o%t.length];r.fillStyle=c;const u=o*n+n/2;r.fillRect(0,u,s,1)}}render(e){const{channelRenderHeight:t,channelAmplitudeData:n,config:a,channelColors:r,waveformDataSize:s,waveformDataCount:o}=this;if(!a||!n.length)return;const{channelCount:c,canvasContext:u}=a,{width:l,height:h}=u.canvas,E=Math.floor(Math.min(o*e,o-1));if(this.lastRenderedStartIndex!==E){this.lastRenderedStartIndex=E,u.clearRect(0,0,l,h);for(let b=0;b<c;b++){const _=r[b%r.length];u.fillStyle=_;const ee=t*b+t/2,te=n[b][E];for(let k=0;k<s;k++){const ie=Math.floor(ee-t/2*te[k]);u.fillRect(k,ie,1,1)}}}}preprocessAudioData(){if(!this.config)return;const{canvasContext:e,audioBuffer:t,channelCount:n}=this.config,a=Math.floor(e.canvas.width),r=Math.floor(t.length/a);this.waveformDataSize=a,this.waveformDataCount=r,this.channelAmplitudeData=Array.from({length:n}).map(()=>new Array(r));for(let s=0;s<n;s++){const o=t.getChannelData(s);for(let c=0;c<r;c++){const u=c*a;this.channelAmplitudeData[s][c]=o.slice(u,u+a)}}}clear(){this.channelAmplitudeData=[]}}class Dt{constructor(){d(this,"audioContext");d(this,"isPlaying",!1);d(this,"source");d(this,"audioBuffer");d(this,"gainNode");d(this,"currentVolume",1);d(this,"startTime",0);d(this,"duration",0);d(this,"playStartTime",0);d(this,"offsetTime");d(this,"options",{sampleRate:16e3,channelCount:1,bitDepth:16,startTime:0,duration:0,endianness:O.LE,volume:1});d(this,"onPlayCompleted");d(this,"playProgressCallback")}get totalDuration(){return this.audioBuffer?this.audioBuffer.duration:0}get ready(){return!!this.audioContext}setVolume(e){if(!this.gainNode){console.warn("增益节点未初始化，请先调用 init()");return}const t=Math.max(0,Math.min(1,e));this.currentVolume=t,this.gainNode.gain.value=t}init(){if(!this.audioContext){const e=window.AudioContext||window.webkitAudioContext;this.audioContext=new e,this.gainNode=this.audioContext.createGain(),this.gainNode.connect(this.audioContext.destination),this.gainNode.gain.value=this.currentVolume}}async initPCM(e,t={}){if(this.init(),!this.audioContext){console.error("音频上下文初始化失败");return}Object.assign(this.options,t);const{sampleRate:n,channelCount:a,bitDepth:r,startTime:s,duration:o,endianness:c,volume:u}=this.options;this.startTime=s,this.duration=o,this.offsetTime=void 0,this.setVolume(u),await this.stop();try{const l=this.convertPCMToFloat32(e,r,c);this.audioBuffer=this.audioContext.createBuffer(a,l.length/a,n);for(let h=0;h<a;h++){const E=this.audioBuffer.getChannelData(h);for(let b=0;b<E.length;b++)E[b]=l[b*a+h]}}catch(l){console.error("播放 PCM 失败：",l)}}convertPCMToFloat32(e,t,n=O.LE){const a=new DataView(e),r=t/8,s=n===O.LE,o=Math.floor(e.byteLength/r),c=new Float32Array(o);for(let u=0;u<o;u++){const l=u*r;switch(t){case 8:c[u]=(a.getUint8(l)-128)/128;break;case 16:c[u]=a.getInt16(l,s)/32768;break;case 24:let h;s?h=a.getUint8(l)|a.getUint8(l+1)<<8|a.getUint8(l+2)<<16:h=a.getUint8(l)<<16|a.getUint8(l+1)<<8|a.getUint8(l+2),h&8388608&&(h|=4278190080),c[u]=h/8388608;break;case 32:c[u]=a.getInt32(l,s)/2147483648;break;case 64:c[u]=a.getFloat64(l,s);break}}return c}async playFromPosition(e=0,t=0){if(!this.audioBuffer||!this.audioContext){console.error("请先加载 PCM 数据");return}this.isPlaying&&await this.stop();const n=this.audioBuffer.duration,a=Math.max(0,Math.min(e,n)),r=t>0?Math.min(t,n-a):void 0;this.source=this.audioContext.createBufferSource(),this.source.buffer=this.audioBuffer,this.source.connect(this.gainNode),this.source.start(0,a,r),this.isPlaying=!0,this.playStartTime=this.audioContext.currentTime,this.source.onended=()=>{var s,o;this.updatePlayProgress(),this.isPlaying=!1,typeof this.offsetTime=="number"&&(this.offsetTime+=(((s=this.audioContext)==null?void 0:s.currentTime)||0)-this.playStartTime),(o=this.onPlayCompleted)==null||o.call(this)}}updatePlayProgress(){const{isPlaying:e,audioContext:t,audioBuffer:n,offsetTime:a,playStartTime:r,playProgressCallback:s}=this;if(!e||!t||!n||!s)return;const o=(a||0)+(t.currentTime-r),c=o/n.duration,u=o.toFixed(2),l=n.duration.toFixed(2),h=Math.min(1,c).toFixed(6);s(u,l,h),requestAnimationFrame(()=>this.updatePlayProgress())}async play(e){if(typeof e=="number")await this.stop(),this.offsetTime=e;else{if(this.isPlaying)return;const{startTime:t,offsetTime:n}=this;(!n||n+t>=this.totalDuration)&&(this.offsetTime=0)}this.playFromPosition(this.startTime+this.offsetTime,this.duration),this.updatePlayProgress()}async stop(){this.source&&(this.source.stop(),this.source.disconnect(),this.source=void 0,await $e(()=>!this.isPlaying,500))}clear(){this.stop(),this.isPlaying=!1,this.audioBuffer=void 0}}class Tt{constructor(){d(this,"audioSpectrum",new wt);d(this,"audioSpectrumCanvas",document.createElement("canvas"));d(this,"audioSpectrumCtx",this.audioSpectrumCanvas.getContext("2d"));d(this,"audioSpectrumHeight",100);d(this,"audioWaveform",new bt);d(this,"audioWaveformCanvas",document.createElement("canvas"));d(this,"audioWaveformCtx",this.audioWaveformCanvas.getContext("2d"));d(this,"audioWaveformHeight",100);d(this,"audioPlayer",new Dt);d(this,"canvas");d(this,"ctx");d(this,"onPlayCompleted");d(this,"playProgressCallback");this.audioPlayer.onPlayCompleted=()=>{var e;(e=this.onPlayCompleted)==null||e.call(this)},this.audioPlayer.playProgressCallback=(e,t,n)=>{var r;const a=Number(n);this.render(a),(r=this.playProgressCallback)==null||r.call(this,e,t,n)}}get totalDuration(){return this.audioPlayer.totalDuration}async init(e){await this.initPCM(e),this.audioPlayer.ready&&this.initCanvas(e)}async initPCM(e){const{audioPlayer:t}=this,{pcmData:n,pcmOptions:a}=e;await t.initPCM(n,a)}initCanvas(e){const{audioPlayer:t,audioSpectrumCanvas:n,audioSpectrumCtx:a,audioSpectrumHeight:r,audioWaveformCanvas:s,audioWaveformCtx:o,audioWaveformHeight:c}=this,{canvas:u}=e,l=t.options.channelCount,h=t.audioBuffer,E=t.totalDuration,b=Math.floor(u.getBoundingClientRect().width);if(u.width=b,u.height=c*l+r,this.canvas=u,this.ctx=u.getContext("2d"),!this.ctx||!a||!o){console.error("Canvas 上下文不可用。");return}n.width=b,n.height=r,s.width=b,s.height=c*l;const _={channelCount:l,audioBuffer:h,duration:E};this.audioWaveform.init({..._,canvasContext:o}),this.audioSpectrum.init({..._,canvasContext:a}),this.ctx.drawImage(s,0,0),this.ctx.drawImage(n,0,s.height)}render(e){const{canvas:t,ctx:n,audioSpectrum:a,audioSpectrumCanvas:r,audioWaveform:s,audioWaveformCanvas:o}=this;if(!t||!n){console.error("Canvas 不可用。");return}n.clearRect(0,0,t.width,t.height),a.render(e),s.render(e),n.drawImage(o,0,0),n.drawImage(r,0,o.height)}setVolume(e){this.audioPlayer.setVolume(e)}play(e,t){if(console.log(typeof e=="number",t),typeof e=="number"&&t){this.render(e/this.totalDuration),this.audioPlayer.offsetTime=e;return}return this.audioPlayer.play(e)}stop(){this.audioPlayer.stop()}clear(){this.audioPlayer.clear(),this.audioSpectrum.clear(),this.audioWaveform.clear();const{ctx:e,canvas:t}=this;e&&t&&e.clearRect(0,0,t.width,t.height)}}var v;(function(i){i.LOAD="LOAD",i.EXEC="EXEC",i.FFPROBE="FFPROBE",i.WRITE_FILE="WRITE_FILE",i.READ_FILE="READ_FILE",i.DELETE_FILE="DELETE_FILE",i.RENAME="RENAME",i.CREATE_DIR="CREATE_DIR",i.LIST_DIR="LIST_DIR",i.DELETE_DIR="DELETE_DIR",i.ERROR="ERROR",i.DOWNLOAD="DOWNLOAD",i.PROGRESS="PROGRESS",i.LOG="LOG",i.MOUNT="MOUNT",i.UNMOUNT="UNMOUNT"})(v||(v={}));const St=(()=>{let i=0;return()=>i++})(),Pt=new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first"),Lt=new Error("called FFmpeg.terminate()");var L,$,U,Y,j,ce,P;class At{constructor(){V(this,L,null);V(this,$,{});V(this,U,{});V(this,Y,[]);V(this,j,[]);d(this,"loaded",!1);V(this,ce,()=>{g(this,L)&&(g(this,L).onmessage=({data:{id:e,type:t,data:n}})=>{switch(t){case v.LOAD:this.loaded=!0,g(this,$)[e](n);break;case v.MOUNT:case v.UNMOUNT:case v.EXEC:case v.FFPROBE:case v.WRITE_FILE:case v.READ_FILE:case v.DELETE_FILE:case v.RENAME:case v.CREATE_DIR:case v.LIST_DIR:case v.DELETE_DIR:g(this,$)[e](n);break;case v.LOG:g(this,Y).forEach(a=>a(n));break;case v.PROGRESS:g(this,j).forEach(a=>a(n));break;case v.ERROR:g(this,U)[e](n);break}delete g(this,$)[e],delete g(this,U)[e]})});V(this,P,({type:e,data:t},n=[],a)=>g(this,L)?new Promise((r,s)=>{const o=St();g(this,L)&&g(this,L).postMessage({id:o,type:e,data:t},n),g(this,$)[o]=r,g(this,U)[o]=s,a==null||a.addEventListener("abort",()=>{s(new DOMException(`Message # ${o} was aborted`,"AbortError"))},{once:!0})}):Promise.reject(Pt));d(this,"load",({classWorkerURL:e,...t}={},{signal:n}={})=>(g(this,L)||(ae(this,L,e?new Worker(new URL(e,import.meta.url),{type:"module"}):new Worker(new URL("/assets/worker-BAOIWoxA.js",import.meta.url),{type:"module"})),g(this,ce).call(this)),g(this,P).call(this,{type:v.LOAD,data:t},void 0,n)));d(this,"exec",(e,t=-1,{signal:n}={})=>g(this,P).call(this,{type:v.EXEC,data:{args:e,timeout:t}},void 0,n));d(this,"ffprobe",(e,t=-1,{signal:n}={})=>g(this,P).call(this,{type:v.FFPROBE,data:{args:e,timeout:t}},void 0,n));d(this,"terminate",()=>{const e=Object.keys(g(this,U));for(const t of e)g(this,U)[t](Lt),delete g(this,U)[t],delete g(this,$)[t];g(this,L)&&(g(this,L).terminate(),ae(this,L,null),this.loaded=!1)});d(this,"writeFile",(e,t,{signal:n}={})=>{const a=[];return t instanceof Uint8Array&&a.push(t.buffer),g(this,P).call(this,{type:v.WRITE_FILE,data:{path:e,data:t}},a,n)});d(this,"mount",(e,t,n)=>{const a=[];return g(this,P).call(this,{type:v.MOUNT,data:{fsType:e,options:t,mountPoint:n}},a)});d(this,"unmount",e=>{const t=[];return g(this,P).call(this,{type:v.UNMOUNT,data:{mountPoint:e}},t)});d(this,"readFile",(e,t="binary",{signal:n}={})=>g(this,P).call(this,{type:v.READ_FILE,data:{path:e,encoding:t}},void 0,n));d(this,"deleteFile",(e,{signal:t}={})=>g(this,P).call(this,{type:v.DELETE_FILE,data:{path:e}},void 0,t));d(this,"rename",(e,t,{signal:n}={})=>g(this,P).call(this,{type:v.RENAME,data:{oldPath:e,newPath:t}},void 0,n));d(this,"createDir",(e,{signal:t}={})=>g(this,P).call(this,{type:v.CREATE_DIR,data:{path:e}},void 0,t));d(this,"listDir",(e,{signal:t}={})=>g(this,P).call(this,{type:v.LIST_DIR,data:{path:e}},void 0,t));d(this,"deleteDir",(e,{signal:t}={})=>g(this,P).call(this,{type:v.DELETE_DIR,data:{path:e}},void 0,t))}on(e,t){e==="log"?g(this,Y).push(t):e==="progress"&&g(this,j).push(t)}off(e,t){e==="log"?ae(this,Y,g(this,Y).filter(n=>n!==t)):e==="progress"&&ae(this,j,g(this,j).filter(n=>n!==t))}}L=new WeakMap,$=new WeakMap,U=new WeakMap,Y=new WeakMap,j=new WeakMap,ce=new WeakMap,P=new WeakMap;var Te;(function(i){i.MEMFS="MEMFS",i.NODEFS="NODEFS",i.NODERAWFS="NODERAWFS",i.IDBFS="IDBFS",i.WORKERFS="WORKERFS",i.PROXYFS="PROXYFS"})(Te||(Te={}));const Bt=i=>new Promise((e,t)=>{const n=new FileReader;n.onload=()=>{const{result:a}=n;a instanceof ArrayBuffer?e(new Uint8Array(a)):e(new Uint8Array)},n.onerror=a=>{var r,s;t(Error(`File could not be read! Code=${((s=(r=a==null?void 0:a.target)==null?void 0:r.error)==null?void 0:s.code)||-1}`))},n.readAsArrayBuffer(i)}),xt=async i=>{let e;if(typeof i=="string")/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(i)?e=atob(i.split(",")[1]).split("").map(t=>t.charCodeAt(0)):e=await(await fetch(i)).arrayBuffer();else if(i instanceof URL)e=await(await fetch(i)).arrayBuffer();else if(i instanceof File||i instanceof Blob)e=await Bt(i);else return new Uint8Array;return new Uint8Array(e)},q=new At;q.load();async function Se(i,e){const t=i.name,n="output_s16le.pcm",{sampleRate:a=44100,channelCount:r=2,bitDepth:s=16,endianness:o="le",isFloat:c=!1}=e,l=`${s==8?"u":c?"f":"s"}${s}${s==8?"":o}`,h=`pcm_${l}`;try{await q.writeFile(t,await xt(i)),await q.exec(["-i",t,"-f",l,"-acodec",h,"-ac",String(r),"-ar",String(a),n]);const E=await q.readFile(n);return typeof E=="string"?(console.warn("PCM 文件读取结果为字符串，转换失败"),null):E.buffer}catch(E){return console.error("音频文件 转 PCM 失败：",E),null}finally{try{await q.deleteFile(t),await q.deleteFile(n)}catch(E){console.warn("清理虚拟文件失败：",E)}}}async function Ue(i,e){let t=await Se(i,{...e,isFloat:!1}).catch(()=>null);return t||(t=await Se(i,{...e,isFloat:!0})),t}const Pe=["Blues","Classic Rock","Country","Dance","Disco","Funk","Grunge","Hip-Hop","Jazz","Metal","New Age","Oldies","Other","Pop","R&B","Rap","Reggae","Rock","Techno","Industrial","Alternative","Ska","Death Metal","Pranks","Soundtrack","Euro-Techno","Ambient","Trip-Hop","Vocal","Jazz+Funk","Fusion"];function K(i,e,t){const n=i.subarray(e,t),a=n.findIndex(o=>o===0),r=a===-1?n:n.subarray(0,a),s=new TextDecoder("ascii").decode(r).trim();return s===""?"-":s}function Mt(i){return i<Pe.length?Pe[i]:"Unknown"}function Ot(i){const e=new Uint8Array(i);if(e.length<128)return null;const t=e.subarray(e.length-128);if(t[0]!==84||t[1]!==65||t[2]!==71)return null;const n=t[125],a=t[126];let r=n===0;if(r&&(a<1||a>99)&&(r=!1),r){const c=t.subarray(97,125);Array.from(c).every(l=>l===0||l===32)&&a!==0&&a!==32&&(r=!1)}let s,o;return r?(s=K(t,97,125),o=a):(s=K(t,97,127),o=0),{title:K(t,3,33),artist:K(t,33,63),album:K(t,63,93),year:K(t,93,97),comment:s,track:o,genre:Mt(t[127]),isID3v1_1:r}}const Le={2.2:{TT2:"标题",TP1:"艺术家",TAL:"专辑",TYE:"年份",COM:"评论",TRK:"音轨号",TCO:"流派",PIC:"附加图片",TCM:"作曲家",TCR:"版权信息",TBP:"播放速度",TLE:"时长",TLA:"语言",TPB:"发行商"},2.3:{TIT2:"标题",TPE1:"艺术家",TALB:"专辑",TYER:"年份",COMM:"评论",TRCK:"音轨号",TCON:"流派",APIC:"附加图片",TCOM:"作曲家",TCOP:"版权信息",TBPM:"播放速度",TLEN:"时长",TLAN:"语言",TPUB:"发行商",TIT3:"副标题",TPE2:"乐队",TPE3:"指挥",TPE4:"改编者",TOPE:"原艺术家",TOAL:"原专辑",TSRC:"ISRC码",TENC:"编码者",TEXT:"歌词作者",TOWN:"文件所有者",TPOS:"音轨集位置",TRDA:"录制日期",TXXX:"用户自定义文本",USLT:"非同步歌词",SYLT:"同步歌词",UFID:"唯一文件标识",RBUF:"推荐缓冲区大小",RVAD:"相对音量调整",RVRB:"混响",ETCO:"事件定时码",MLLT:"MPEG位置查找表",SYTC:"同步节奏码",IPLS:"参与人员列表",MCDI:"音乐CD标识符",GEOB:"通用封装对象",PCNT:"播放计数器",POPM:"流行度计量",AENC:"音频加密",LINK:"链接信息",POSS:"位置同步帧",USER:"使用条款",OWNE:"所有权帧",ENCR:"加密方法注册",GRID:"组标识注册",PRIV:"私有帧",COMR:"商业帧",EQUA:"均衡器",WCOM:"商业信息URL",WCOP:"版权信息URL",WOAF:"官方音频文件URL",WOAR:"官方艺术家URL",WOAS:"官方音频源URL",WORS:"官方电台URL",WPAY:"支付信息URL",WPUB:"官方发行商URL",WXXX:"用户自定义URL"},2.4:{TIT2:"标题",TPE1:"艺术家",TALB:"专辑",TYER:"年份",COMM:"评论",TRCK:"音轨号",TCON:"流派",APIC:"附加图片",TCOM:"作曲家",TCOP:"版权信息",TBPM:"播放速度",TLEN:"时长",TLAN:"语言",TPUB:"发行商",TIT3:"副标题",TPE2:"乐队",TPE3:"指挥",TPE4:"改编者",TOPE:"原艺术家",TOAL:"原专辑",TSRC:"ISRC码",TENC:"编码者",TEXT:"歌词作者",TOWN:"文件所有者",TPOS:"音轨集位置",TRDA:"录制日期",TXXX:"用户自定义文本",USLT:"非同步歌词",SYLT:"同步歌词",UFID:"唯一文件标识",RBUF:"推荐缓冲区大小",RVAD:"相对音量调整",RVRB:"混响",ETCO:"事件定时码",MLLT:"MPEG位置查找表",SYTC:"同步节奏码",IPLS:"参与人员列表",MCDI:"音乐CD标识符",GEOB:"通用封装对象",PCNT:"播放计数器",POPM:"流行度计量",AENC:"音频加密",LINK:"链接信息",POSS:"位置同步帧",USER:"使用条款",OWNE:"所有权帧",ENCR:"加密方法注册",GRID:"组标识注册",PRIV:"私有帧",COMR:"商业帧",EQUA:"均衡器",WCOM:"商业信息URL",WCOP:"版权信息URL",WOAF:"官方音频文件URL",WOAR:"官方艺术家URL",WOAS:"官方音频源URL",WORS:"官方电台URL",WPAY:"支付信息URL",WPUB:"官方发行商URL",WXXX:"用户自定义URL"}};class Ut{constructor(e,t=0){d(this,"buffer");d(this,"offset",0);d(this,"offsetBase",0);d(this,"version","");d(this,"frameIdMap",{});this.buffer=e,this.offsetBase=t}initVersion(e){return this.version=`2.${e}`,this.frameIdMap=Le[this.version],!!this.frameIdMap}syncSafeInteger(e){return e[0]<<21|e[1]<<14|e[2]<<7|e[3]}cleanString(e){return e.replace(/\0/g,"").trim()}readID3String(e,t){if(t<=0)return"";const n=new Uint8Array(this.buffer,e,t);let a="";switch(n[0]){case 1:if(t>=2)try{a=new TextDecoder("utf-16",{ignoreBOM:!0}).decode(n.subarray(1))}catch{a=this.readIso88591String(e+1,t-1)}break;case 2:if(t>=2)try{a=new TextDecoder("utf-16be").decode(n.subarray(1))}catch{a=this.readIso88591String(e+1,t-1)}break;case 3:if(t>=2)try{a=new TextDecoder("utf-8").decode(n.subarray(1))}catch{a=this.readIso88591String(e+1,t-1)}break;case 0:a=this.readIso88591String(e+1,t-1);break;default:try{a=new TextDecoder("utf-8",{fatal:!0}).decode(n)}catch{a=this.readIso88591String(e,t)}break}return this.cleanString(a)}readIso88591String(e,t){const n=new Uint8Array(this.buffer,e,t);return Array.from(n).map(a=>String.fromCharCode(a)).join("")}readAsciiString(e,t){const n=new Uint8Array(this.buffer,e,t);return Array.from(n).map(a=>a===0?"":String.fromCharCode(a)).join("")}readUInt24BE(e){const t=new Uint8Array(this.buffer);return t[e]<<16|t[e+1]<<8|t[e+2]}readUInt32BE(e){return new DataView(this.buffer).getUint32(e,!1)}parseAPICFrame(e,t){if(t<=0)return null;const n=new Uint8Array(this.buffer,e,t);let a=0;if(this.version!=="2.2"&&(a+=1,a>=t))return null;const r=n.subarray(a).findIndex(c=>c===0);if(r===-1)return null;let s=this.readAsciiString(e+a,r);if(a+=r+1,a>=t||(s==="JPG"||s==="JPEG"?s="image/jpeg":s==="PNG"?s="image/png":s==="GIF"&&(s="image/gif"),a+=1,a>=t))return null;const o=n.subarray(a).findIndex(c=>c===0);return o===-1||(a+=o+1,a>=t)?null:{mime:s,data:this.buffer.slice(e+a,e+t)}}parseFrame(e,t,n,a){const r=this.readID3String(n,a),s=this.frameIdMap[t]||t;let o=r;t=="TRCK"?o=parseInt(r)||0:t=="APIC"&&(o=this.parseAPICFrame(n,a),e.audioCover=o),e[s]=o}validateTagId(){return this.readAsciiString(this.offset,3)==="ID3"}getVersion(){if(this.offset=this.offsetBase,this.buffer.byteLength<this.offset+10||!this.validateTagId())return null;const n=`2.${new Uint8Array(this.buffer)[this.offset+3]}`;return Le[n]?n:null}commonParse(e,t,n){this.offset=this.offsetBase;try{if(this.buffer.byteLength<this.offset+10||!this.validateTagId())return null;const a=new Uint8Array(this.buffer),r=a[this.offset+3];if(!this.initVersion(r))return null;const s=this.calculateTagSize(a),o={版本:this.version,标签大小:s+10};let c=this.offset+10;const u=this.offset+10+s;for(;c+t<=u&&c+t<=this.buffer.byteLength;){const l=this.readAsciiString(c,e);if(!l||l.replace(/\0/g,"")==="")break;const h=n(c+e);if(h<=0||c+t+h>this.buffer.byteLength){c+=t+h;continue}this.parseFrame(o,l,c+t,h),c+=t+h}return o}catch(a){return console.error(`ID3v${this.version} 解析失败:`,a),null}}calculateTagSize(e){if(this.version==="2.2")return this.readUInt24BE(this.offset+6);{const t=[e[this.offset+6],e[this.offset+7],e[this.offset+8],e[this.offset+9]];return this.syncSafeInteger(t)}}}class Ft extends Ut{ID3v22Parser(){return this.commonParse(3,6,e=>this.readUInt24BE(e))}ID3v23Parser(){return this.commonParse(4,10,e=>this.readUInt32BE(e))}ID3v24Parser(){return this.commonParse(4,10,e=>this.readUInt32BE(e))}parse(){const e=this.getVersion();if(!e)return null;switch(e){case"2.4":return this.ID3v24Parser();case"2.3":return this.ID3v23Parser();case"2.2":return this.ID3v22Parser();default:return null}}}function Fe(i,e){return new Ft(i,e).parse()}const J={offset:-1,isValid:!1,syncWord:0,mpegVersion:"Unknown",layer:"Unknown",protectionBit:!1,crcValid:null,bitrateIndex:-1,bitrate:0,sampleRateIndex:-1,sampleRate:0,sampleRateExtension:!1,bitrateExtension:!1,paddingBit:!1,privateBit:!1,frameSize:0,frameDuration:0,channelMode:"Unknown",modeExtension:-1,copyright:!1,original:!1,emphasis:-1},M=class M{constructor(e){d(this,"dataView");this.dataView=new DataView(e)}parseFrameHeaderWithError(e){var c,u;if(e+4>this.dataView.byteLength){const l={offset:e,errorType:"偏移量越界",errorMsg:`偏移量${e}超出buffer范围（总长度${this.dataView.byteLength}）`};return{frameHeader:{...J,offset:e},errorDetail:l}}const t=this.readHeaderBytes(e);if(t===null){const l={offset:e,errorType:"其他解析错误",errorMsg:"读取帧头4字节失败"};return{frameHeader:{...J,offset:e},errorDetail:l}}const n=(t&M.SYNC_WORD_MASK)>>>20;if((t&M.SYNC_WORD_VALUE)>>>0!==M.SYNC_WORD_VALUE){const l={offset:e,errorType:"同步字无效",errorMsg:`同步字${n.toString(16)}无效，预期0xFFE`};return{frameHeader:{...J,offset:e,syncWord:n},errorDetail:l}}const a={...J,offset:e,isValid:!0,syncWord:n};a.mpegVersion=this.parseMpegVersion(t>>19&3),a.layer=this.parseLayer(t>>17&3),a.protectionBit=(t>>16&1)===1,a.bitrateIndex=t>>12&15,a.sampleRateIndex=t>>10&3,a.paddingBit=(t>>9&1)===1,a.privateBit=(t>>8&1)===1,a.channelMode=this.parseChannelMode(t>>6&3),a.modeExtension=t>>4&3,a.copyright=(t>>3&1)===1,a.original=(t>>2&1)===1,a.emphasis=t&3;const r=this.parseBitrate(a.mpegVersion,a.layer,a.bitrateIndex);a.bitrate=r.bitrate,a.bitrateExtension=r.isExtended;const s=this.parseSampleRate(a.mpegVersion,a.sampleRateIndex);if(a.sampleRate=s.sampleRate,a.sampleRateExtension=s.isExtended,a.bitrate===0||a.sampleRate===0){const l={offset:e,errorType:"比特率/采样率为0",errorMsg:`比特率${a.bitrate}kbps/采样率${a.sampleRate}Hz无效`};return a.isValid=!1,{frameHeader:a,errorDetail:l}}if(a.protectionBit)a.crcValid=null;else{const l=this.validateCrc(e,t);if(a.crcValid=l.isValid,a.crcValue=l.crcValue,!l.isValid){const h={offset:e,errorType:"CRC校验失败",errorMsg:`CRC校验失败，实际值${((c=l.crcValue)==null?void 0:c.toString(16))||"未知"}，计算值${((u=l.calculatedCrc)==null?void 0:u.toString(16))||"未知"}`};return a.isValid=!1,{frameHeader:a,errorDetail:h}}}const o=new Ae;if(a.frameSize=o.calculateFrameSize(a),a.frameDuration=o.calculateFrameDuration(a),a.frameSize<=0||a.frameSize>this.dataView.byteLength-e){const l={offset:e,errorType:"帧大小计算异常",errorMsg:`帧大小${a.frameSize}字节无效（超出剩余buffer长度）`};return a.isValid=!1,{frameHeader:a,errorDetail:l}}return{frameHeader:a,errorDetail:null}}readHeaderBytes(e){try{return this.dataView.getUint32(e,!1)}catch{return null}}parseMpegVersion(e){switch(e){case 0:return"MPEG Version 2.5";case 1:return"Unknown";case 2:return"MPEG Version 2";case 3:return"MPEG Version 1";default:return"Unknown"}}parseLayer(e){switch(e){case 0:return"Unknown";case 1:return"Layer III";case 2:return"Layer II";case 3:return"Layer I";default:return"Unknown"}}parseChannelMode(e){switch(e){case 0:return"Stereo";case 1:return"Joint Stereo";case 2:return"Dual Channel";case 3:return"Mono";default:return"Unknown"}}parseBitrate(e,t,n){var s,o;if(e==="Unknown"||t==="Unknown"||n>15||n<0)return{bitrate:0,isExtended:!1};const a=((o=(s=M.BITRATE_TABLE[e])==null?void 0:s[t])==null?void 0:o[n])||0;return{bitrate:a||0,isExtended:a===0&&n!==0}}parseSampleRate(e,t){var r;if(e==="Unknown"||t>3||t<0)return{sampleRate:0,isExtended:!1};const n=((r=M.SAMPLE_RATE_TABLE[e])==null?void 0:r[t])||0;return{sampleRate:n||0,isExtended:n===0&&t!==3}}validateCrc(e,t){try{const n=this.dataView.getUint16(e+4,!1),a=t&4294967292,r=new Uint8Array(4);r[0]=a>>24&255,r[1]=a>>16&255,r[2]=a>>8&255,r[3]=a&255;const o=new Ae().calculateFrameSize({...J,mpegVersion:this.parseMpegVersion(t>>19&3),layer:this.parseLayer(t>>17&3),bitrate:this.parseBitrate(this.parseMpegVersion(t>>19&3),this.parseLayer(t>>17&3),t>>12&15).bitrate,sampleRate:this.parseSampleRate(this.parseMpegVersion(t>>19&3),t>>10&3).sampleRate,paddingBit:(t>>9&1)===1,isValid:!0})-6;if(o<=0||e+6+o>this.dataView.byteLength)return{isValid:!1,crcValue:n};const c=new Uint8Array(this.dataView.buffer,e+6,o),u=new Uint8Array(4+c.length);u.set(r,0),u.set(c,4);const l=this.calculateCrc16(u);return{isValid:(l^65535)===n,crcValue:n,calculatedCrc:l}}catch(n){return console.error("CRC校验计算失败:",n),{isValid:!1}}}calculateCrc16(e){let t=65535;const n=4129;for(let a=0;a<e.length;a++){t^=e[a]<<8&65280;for(let r=0;r<8;r++)t&32768?t=t<<1^n:t<<=1,t&=65535}return t}};d(M,"SYNC_WORD_MASK",4292870144),d(M,"SYNC_WORD_VALUE",4292870144),d(M,"BITRATE_TABLE",{"MPEG Version 1":{"Layer I":[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,0],"Layer II":[0,32,48,64,80,96,112,128,144,160,176,192,208,224,240,256],"Layer III":[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,0]},"MPEG Version 2":{"Layer I":[0,32,48,64,80,96,112,128,144,160,176,192,208,224,240,256],"Layer II":[0,8,16,24,32,40,48,56,64,80,88,96,112,128,144,160],"Layer III":[0,8,16,24,32,40,48,56,64,80,88,96,112,128,144,160]},"MPEG Version 2.5":{"Layer I":[0,32,48,64,80,96,112,128,144,160,176,192,208,224,240,256],"Layer II":[0,8,16,24,32,40,48,56,64,80,88,96,112,128,144,160],"Layer III":[0,8,16,24,32,40,48,56,64,80,88,96,112,128,144,160]}}),d(M,"SAMPLE_RATE_TABLE",{"MPEG Version 1":[44100,48e3,32e3,0],"MPEG Version 2":[22050,24e3,16e3,0],"MPEG Version 2.5":[11025,12e3,8e3,0],Unknown:[0,0,0,0]});let Ee=M;class Ae{calculateFrameSize(e){if(!e.isValid||e.bitrate===0||e.sampleRate===0)return 0;const t=e.bitrate,n=e.sampleRate,a=e.paddingBit?1:0;switch(e.layer){case"Layer I":return Math.floor(12*t*1e3/n+a*4);case"Layer II":case"Layer III":return Math.floor(144*t*1e3/n+a);default:return 0}}calculateFrameDuration(e){if(!e.isValid||e.sampleRate===0)return 0;let t=0;switch(e.layer){case"Layer I":t=384;break;case"Layer II":t=1152;break;case"Layer III":t=e.mpegVersion==="MPEG Version 1"?1152:576;break;default:return 0}return t/e.sampleRate*1e3}}class Nt{constructor(e,t,n){d(this,"dataView");d(this,"frameParser");d(this,"audioStartOffset");d(this,"audioEndOffset");this.dataView=new DataView(e),this.frameParser=new Ee(e),this.audioStartOffset=Math.max(0,t),this.audioEndOffset=this.dataView.byteLength-(n?128:0)}findAllFramesWithError(){const e=[],t=[];let n=this.audioStartOffset,a=0;for(;n<this.audioEndOffset-4;){a++;const{frameHeader:r,errorDetail:s}=this.frameParser.parseFrameHeaderWithError(n);s?(t.push(s),n+=1):(e.push(r),n+=r.frameSize||1)}return{validFrames:e,totalFrameCount:a,errorFrameDetails:t}}}const de=class de{constructor(e,t,n){d(this,"frameFinder");this.frameFinder=new Nt(e,t,n)}parseComplete(){const{validFrames:e,totalFrameCount:t,errorFrameDetails:n}=this.frameFinder.findAllFramesWithError(),a=e.find(s=>s.isValid)||J,r={sampleRate:a.sampleRate,bitrate:a.bitrate,channelCount:a.channelMode==="Mono"?1:2,totalDuration:e.reduce((s,o)=>s+o.frameDuration,0),bitDepth:de.DEFAULT_BIT_DEPTH};return{frameHeader:a,frameCount:t,errorFrameCount:n.length,errorFrameDetails:n,audioBasicInfo:r}}};d(de,"DEFAULT_BIT_DEPTH",16);let Re=de;async function _t(i){const e=await i.arrayBuffer(),t=e.byteLength,n=Fe(e),a=Ot(e),r=a?128:0,s=n&&t-n.标签大小-r,o=new Re(e,(n==null?void 0:n.标签大小)||0,!!a).parseComplete(),c={bitDepth:16,bitrate:340,channelCount:2,sampleRate:44100,totalDuration:0},u=o.frameHeader.isValid?o.audioBasicInfo:c,l=await Ue(i,u);return l?{id3v2:n,id3v1:a,audioSize:s,fileSize:t,mpegAudio:o,pcm:l,audioBasicInfo:u}:null}const kt={class:"flex-box"},Vt={class:"img-box"},Wt=Q({__name:"audioBasicInfo",props:{isRunning:{type:Boolean},info:{},getMetadata:{type:Function}},setup(i){const e=i,t=z(""),n=Ge([]);function a(o){if(!o||typeof o!="object")return[];const c=/[\u4e00-\u9fa5]/;return Object.keys(o).filter(u=>c.test(u)&&typeof o[u]=="string").map(u=>`${u}：${o[u]}`)}function r(){s();const o=e.getMetadata();if(o){const{mp3:c,wav:u}=o;if(c){const{id3v2:l}=c;if(!l)return;const h=l.audioCover;if(n.value=a(l),h&&typeof h=="object"){const E=new Blob([h.data],{type:h.mime});t.value=URL.createObjectURL(E)}}else if(u){const{id3:l,list_info:h}=u.otherChunk;n.value=[],l&&(n.value=a(l)),h&&n.value.push(...a(h))}}}function s(){t.value&&URL.revokeObjectURL(t.value),n.value=[],t.value=""}return ve(()=>e.info,r,{immediate:!0}),Me(s),(o,c)=>(B(),F("div",kt,[N("div",{class:xe([i.isRunning&&"running","record-player"])},[N("div",Vt,[t.value?(B(),ye(f(et),{key:0,src:t.value},null,8,["src"])):Oe("",!0)]),c[0]||(c[0]=N("div",{class:"tonarm-lift"},null,-1))],2),m(f(he),{vertical:""},{default:p(()=>[m(f(ue),null,{default:p(()=>[w(A(i.info.name),1)]),_:1}),m(f(Ie),{style:{"max-height":"90px"}},{default:p(()=>[m(f(he),null,{default:p(()=>[(B(!0),F(me,null,Xe(n.value,u=>(B(),ye(f(X),{key:u},{default:p(()=>[u.length>30?(B(),F(me,{key:0},[w(A(u.slice(0,28))+".. ",1),m(f(oe),{type:"info",text:"",onClick:l=>f(Ye).success("复制完成").error("复制失败").run(f(je)(u))},{default:p(()=>[m(f(le),{component:f(He)},null,8,["component"])]),_:1},8,["onClick"])],64)):(B(),F(me,{key:1},[w(A(u),1)],64))]),_:2},1024))),128))]),_:1})]),_:1}),m(f(he),null,{default:p(()=>[m(f(X),{type:"info"},{default:p(()=>[w(A(i.info.type),1)]),_:1}),m(f(X),{color:{color:"#8a2be21a",textColor:"#9339E7FF",borderColor:"#9339E7FF"}},{default:p(()=>[w(A(i.info.size),1)]),_:1}),m(f(X),{type:"success"},{default:p(()=>[w(A(i.info.totalDuration),1)]),_:1}),m(f(X),{type:"warning"},{default:p(()=>[w(A(i.info.sampleRate)+"Hz ",1)]),_:1}),m(f(X),null,{default:p(()=>[w(A(i.info.channelCount)+"ch ",1)]),_:1}),m(f(X),null,{default:p(()=>[w(A(i.info.bitDepth)+"bit ",1)]),_:1})]),_:1})]),_:1})]))}}),zt=fe(Wt,[["__scopeId","data-v-41419f30"]]);function $t(i){const e=H(i,12,4);if(e!="fmt ")return!1;const t=i.getUint32(16,!0),n=i.getUint16(20,!0),a=i.getUint16(22,!0),r=i.getUint32(24,!0),s=i.getUint32(28,!0),o=i.getUint16(32,!0),c=i.getUint16(34,!0);return{fmt:e,dwChunkSize:t,wFormatTag:n,wChannels:a,dwSamplesPerSec:r,dwAvgBytesPerSec:s,wBlockAlign:o,dwBitsPerSample:c}}const Gt={IARL:"档案位置",IART:"艺术家/表演者",ICMS:"委托制作方",ICMT:"注释/备注",ICOP:"版权声明",ICRD:"创作/录制日期",IENG:"录音工程师",IGNR:"音乐流派",IKEY:"关键词",IMED:"介质类型",INAM:"作品名称",ISFT:"制作/编码软件",ISRC:"标准录音代码",IPRD:"发行商",IPUB:"出版方/唱片公司",IREC:"录制时间",ITIT:"副标题",IYER:"发行年份",IARR:"编曲者",IWRI:"作词者",ILNG:"语言"};function Xt(i,e,t){const n=e+t,a={};for(;e<n;){const r=H(i,e,4),s=i.getUint32(e+4,!0),o=H(i,e+8,s);a[Gt[r]||r]=o.replace(/\u0000/g,""),e+=8+s+s%2}return a}function Yt(i,e,t){if(H(i,e,4)=="INFO")return Xt(i,e+4,t-4)}function jt(i){let e=0;const t={};for(;e<i.byteLength;){const n=H(i,e,4),a=i.getUint32(e+4,!0);n=="LIST"?t.list_info=Yt(i,e+8,a):n=="id3 "?t.id3=Fe(i.buffer,e+8):t[n.trim()]=a,n=="RIFF"?e+=12:e+=8+a+a%2}return t}function Ht(i){const e=H(i,0,4),t=i.getUint32(4,!0),n=H(i,8,4);return e=="RIFF"&&t==i.byteLength-8&&n=="WAVE"}function H(i,e,t){let n="";for(let a=0;a<t;a++)n+=String.fromCharCode(i.getUint8(e+a));return n}async function Kt(i){const e=await i.arrayBuffer(),t=e.byteLength,n=new DataView(e);if(!Ht(n))return null;const r=$t(n);if(!r)return null;const s=jt(n),o=await Ue(i,{sampleRate:r.dwSamplesPerSec,channelCount:r.wChannels,bitDepth:r.dwBitsPerSample,endianness:"le"});return o?{fileSize:t,pcm:o,fmt:r,otherChunk:s}:null}const qt={key:0,class:"audio-player-container"},Jt={class:"canvas-container"},Zt=["id"],Qt={class:"time-container"},Be=".mp3,.pcm,.wav,.wave",ea=Q({__name:"index",setup(i){const e=Ce("audio-player-"),t=Ce("file-list-"),n=z(!1),a=z(void 0),r=z([]),s=new Map,o=z(.2),c=z({sampleRate:16e3,bitDepth:16,channelCount:1,startTime:0,duration:0,endianness:O.LE}),u=z(),l=new Tt;l.onPlayCompleted=()=>{n.value=!1},l.playProgressCallback=R=>{u.value.currentTime=Z(Number(R))},ve([c,a],async([R,C])=>{if(typeof C=="number"){const I=r.value[C],y=s.get(I.id);u.value=gt(y,0),requestAnimationFrame(async()=>{const T=document.getElementById(e),S=y.pcm;await l.init({canvas:T,pcmData:S,pcmOptions:{volume:o.value,...R}}),u.value.currentTime=Z(0),u.value.totalDuration=Z(Number(l.totalDuration))})}},{deep:!0}),ve(o,R=>{l.setVolume(R)});function h(){l.play(),n.value=!0}function E(){l.stop(),n.value=!1}async function b(R){var S;const{offsetX:C,target:I}=R,y=I.clientWidth,T=C/y*l.totalDuration;(S=l.play(Math.max(0,T),!n.value))==null||S.then(()=>n.value=!0)}function _(R){const{offsetX:C,target:I}=R,y=I,T=y.clientWidth,S=Math.max(0,C),D=S/T*l.totalDuration;y.dataset.time=Z(D),y.style.setProperty("--after-x",S-46/2+"px")}function ee(){if(a.value===void 0)return;const R=r.value[a.value];return s.get(R.id)}function te(R){const C=y=>Be.split(",").some(T=>y.endsWith(T)),I=R.filter(y=>C(y.name));I.length>0?I.forEach(y=>{const T=String(y.lastModified);r.value.push({id:T,name:y.name,status:"finished",file:y})}):window.$message.warning("请拖拽音频文件")}function k(){qe.get("/multimedia/Jay Chou.pcm",{responseType:"blob"}).then(async R=>{const C=new File([R.data],"Jay Chou.pcm"),I=await C.arrayBuffer(),y=String(C.lastModified);s.set(y,{fileName:C.name,fileSize:C.size,audioBasicInfo:{sampleRate:24e3,bitDepth:16,channelCount:2,endianness:O.LE},pcm:I}),r.value.push({id:y,name:C.name,status:"finished"}),ie(r.value.length-1)})}async function ie(R){const C=r.value[R];let I=s.get(C.id);const y=window.$message.loading("解析中... 希望不会太久~",{duration:0}),T=()=>{setTimeout(()=>{y.type="success",y.content="解析完成。久等了~",setTimeout(()=>y.destroy(),3e3)},1e3)},S=D=>{y.type="error",y.content=`解析失败，${D}。额~`,setTimeout(()=>y.destroy(),3e3)};if(!I){const D=C.file;if(!D)return S("数据异常");const re=D.name.lastIndexOf("."),se=D.name.slice(re+1);if(se.toLocaleLowerCase()=="mp3"){const x=await _t(D);if(x){const G=x.audioBasicInfo;s.set(C.id,{fileName:D.name,fileSize:D.size,audioBasicInfo:{sampleRate:G.sampleRate,channelCount:G.channelCount,bitDepth:G.bitDepth,endianness:O.LE},pcm:x.pcm,mp3:x})}else return S("MP3文件解析失败")}else if(se.toLocaleLowerCase()=="pcm"){const x=await D.arrayBuffer();s.set(C.id,{fileName:D.name,fileSize:D.size,audioBasicInfo:{sampleRate:8e3,channelCount:2,bitDepth:16,endianness:O.LE},pcm:x})}else{const x=await Kt(D);if(x){const G=x.fmt;s.set(C.id,{fileName:D.name,fileSize:D.size,audioBasicInfo:{sampleRate:G.dwSamplesPerSec,channelCount:G.wChannels,bitDepth:G.dwBitsPerSample,endianness:O.LE},pcm:x.pcm,wav:x})}else return S("WAV文件解析失败")}I=s.get(C.id)}a.value=R,T(),Object.assign(c.value,I.audioBasicInfo),setTimeout(()=>{document.querySelectorAll(`#${t} .n-upload-file`).forEach((re,se)=>{re.classList.remove("active"),se==R&&re.classList.add("active")})},100)}function Ne(R){const C=R.target.closest(".n-button"),I=R.target.closest(".n-upload-file");if(!I)return;const y=document.querySelectorAll(`#${t} .n-upload-file`),T=Array.from(y).findIndex(S=>S===I);if(C){const S=r.value[T];s.delete(S.id),T==a.value&&(a.value=void 0,n.value=!1,l.clear()),u.value=void 0;return}T!=-1&&ie(T)}return Ke(()=>{l.stop()}),Me(()=>{l.clear()}),(R,C)=>(B(),ye(Rt,{onDropCallback:te},{default:p(()=>[m(Je,{"default-size":.35,min:0},{left:p(()=>[m(f(Ie),null,{default:p(()=>[m(f(tt),{prefix:"bar"},{default:p(()=>[m(f(ue),{type:"success"},{default:p(()=>[...C[4]||(C[4]=[w(" PCM / MP3 / WAV 音频可视化播放器 ",-1)])]),_:1})]),_:1}),m(yt,{options:c.value,"onUpdate:options":C[2]||(C[2]=I=>c.value=I),volume:o.value,"onUpdate:volume":C[3]||(C[3]=I=>o.value=I)},{prefix:p(()=>[m(f(nt),{"file-list":r.value,"onUpdate:fileList":C[0]||(C[0]=I=>r.value=I),abstract:"",accept:Be,multiple:""},{default:p(()=>[m(f(at),null,{default:p(()=>[m(f(it),{abstract:""},{default:p(({handleClick:I})=>[m(f(oe),{type:"info",onClick:I},{icon:p(()=>[m(f(le),{component:f(st)},null,8,["component"])]),default:p(()=>[C[5]||(C[5]=w(" 选择或拖入文件 ",-1))]),_:1},8,["onClick"])]),_:1}),m(f(oe),{type:"info",ghost:"",onClick:k},{icon:p(()=>[m(f(le),{component:f(ot)},null,8,["component"])]),default:p(()=>[C[6]||(C[6]=w(" 加载样例 ",-1))]),_:1})]),_:1}),m(f(rt),{id:f(t),onClickCapture:Ne},null,8,["id"])]),_:1},8,["file-list"])]),suffix:p(()=>[m(f(oe),{disabled:typeof a.value!="number",type:n.value?"error":"success",ghost:"",onClick:C[1]||(C[1]=I=>n.value?E():h())},{icon:p(()=>[m(f(le),{component:n.value?f(pt):f(dt)},null,8,["component"])]),default:p(()=>[w(" "+A(n.value?"暂停":"播放"),1)]),_:1},8,["disabled","type"])]),_:1},8,["options","volume"])]),_:1})]),right:p(()=>[m(f(Ie),null,{default:p(()=>[u.value?(B(),F("div",qt,[m(zt,{"is-running":n.value,info:u.value,getMetadata:ee},null,8,["is-running","info"]),N("div",Jt,[N("canvas",{id:f(e)},null,8,Zt),N("div",{class:"progress",onMousemove:_,onClick:b},null,32)]),N("div",Qt,[m(f(ue),null,{default:p(()=>[w(A(u.value.currentTime),1)]),_:1}),m(f(ue),null,{default:p(()=>[w(A(u.value.totalDuration),1)]),_:1})])])):Oe("",!0)]),_:1})]),_:1})]),_:1}))}}),ba=fe(ea,[["__scopeId","data-v-580f884e"]]);export{ba as default};
