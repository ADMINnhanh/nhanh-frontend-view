import{ar as lt,aF as _t,d as pt,ao as Tt,c as Et,o as bt,e as Ze,W as yt,u as Ut,_ as Mt}from"./index-1AQuBEyl.js";var Ue={exports:{}};/**
 * @license glsl-canvas-js v0.2.9
 * (c) 2022 Luca Zampetti <lzampetti@gmail.com>
 * License: MIT
 */(function(ie,X){(function(u,z){z(X)})(lt,function(u){function z(i,s){for(var a=0;a<s.length;a++){var t=s[a];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(i,t.key,t)}}function ne(i,s,a){return s&&z(i.prototype,s),i}function B(i,s){i.prototype=Object.create(s.prototype),i.prototype.constructor=i,ae(i,s)}function ae(i,s){return ae=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},ae(i,s)}function Me(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}var ge=`
#ifdef GL_ES
precision mediump float;
#endif

attribute vec4 a_position;
attribute vec4 a_normal;
attribute vec2 a_texcoord;
attribute vec4 a_color;

varying vec4 v_position;
varying vec4 v_normal;
varying vec2 v_texcoord;
varying vec4 v_color;
`,se=`
#ifdef GL_ES
precision mediump float;
#endif

varying vec4 v_position;
varying vec4 v_normal;
varying vec2 v_texcoord;
varying vec4 v_color;
`,xe=`#version 300 es

precision mediump float;

in vec4 a_position;
in vec4 a_normal;
in vec2 a_texcoord;
in vec4 a_color;

out vec4 v_position;
out vec4 v_normal;
out vec2 v_texcoord;
out vec4 v_color;
`,oe=`#version 300 es

precision mediump float;

in vec4 v_position;
in vec4 v_normal;
in vec2 v_texcoord;
in vec4 v_color;

out vec4 outColor;
`,W=`
uniform mat4 u_projectionMatrix;
uniform mat4 u_modelViewMatrix;
uniform mat4 u_normalMatrix;

uniform vec2 u_resolution;
uniform float u_time;
`,Ae=`
void main() {
	v_position = a_position;
	v_normal = a_normal;
	v_texcoord = a_texcoord;
	v_color = a_color;
	gl_Position = a_position;
}
`,Le=`
void main(void) {
	v_position = u_projectionMatrix * u_modelViewMatrix * a_position;
	v_normal = u_normalMatrix * a_normal;
	v_texcoord = a_texcoord;
	v_color = a_color;
	gl_Position = v_position;
}
`,et=`
void main() {
	vec2 st = gl_FragCoord.xy / u_resolution.xy;
	st.x *= u_resolution.x / u_resolution.y;
	vec3 color = vec3(
		abs(cos(u_time * 0.1)) * st.y,
		abs(cos(u_time * 0.2)) * st.y,
		abs(sin(u_time)) * st.y
	);
	gl_FragColor = vec4(color, 1.0);
}
`,tt=`
void main() {
	vec2 st = gl_FragCoord.xy / u_resolution.xy;
	st.x *= u_resolution.x / u_resolution.y;
	vec3 color = vec3(
		abs(cos(u_time * 0.1)) * st.y,
		abs(cos(u_time * 0.2)) * st.y,
		abs(sin(u_time)) * st.y
	);
	outColor = vec4(color, 1.0);
}
`,rt=`
void main() {
	vec2 uv = v_texcoord;
	vec3 color = vec3(
		abs(cos(u_time * 0.1)) * uv.y,
		abs(cos(u_time * 0.2)) * uv.y,
		abs(sin(u_time)) * uv.y
	);
	float incidence = max(dot(v_normal.xyz, vec3(0.0, 1.0, 0.0)), 0.0);
	vec3 light = vec3(0.2) + (vec3(1.0) * incidence);
	gl_FragColor = vec4(v_color.rgb * color * light, 1.0);
}
`,it=`
void main() {
	vec2 uv = v_texcoord;
	vec3 color = vec3(
		abs(cos(u_time * 0.1)) * uv.y,
		abs(cos(u_time * 0.2)) * uv.y,
		abs(sin(u_time)) * uv.y
	);
	float incidence = max(dot(v_normal.xyz, vec3(0.0, 1.0, 0.0)), 0.0);
	vec3 light = vec3(0.2) + (vec3(1.0) * incidence);
	outColor = vec4(v_color.rgb * color * light, 1.0);
}
`,nt=`
void main(){
	gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
}`,at=`
void main() {
	outColor = vec4(0.0, 0.0, 0.0, 1.0);
}
`,ue=ge+W+Le,fe=xe+W+Le,Fe=se+W+et,we=oe+W+tt,Re=se+W+rt,Se=oe+W+it,De=ge+W+Ae,Pe=xe+W+Ae,Ce=se+W+nt,Oe=oe+W+at,N=function(){function i(){}return i.fetch=function(a){return new Promise(function(t,e){var r=new XMLHttpRequest;r.onload=function(){t(r.response||r.responseText)},r.onerror=function(n){console.log("Common.error",n),e(new Error("Network request failed for url "+a))},r.ontimeout=function(n){e(new Error("Network request failed for url "+a))},r.onabort=function(){e(new Error("Aborted"))},r.open("GET",a,!0),r.send(null)})},i.getResource=function(a,t){t===void 0&&(t="");var e=a.indexOf(":/")===-1?i.join(t,a):a;return e},i.join=function(){for(var a=[],t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return e.forEach(function(n){n.indexOf("/")===0&&(a=[]);var o=i.comps(n);o.forEach(function(f){switch(f){case".":break;case"..":a.pop();break;default:a.push(f)}})}),a.join("/")},i.dirname=function(a){var t=i.comps(a);return t.pop(),t.join("/")},i.comps=function(a){return a.replace(/\/$/,"").split(/\/+/)},i}(),k;(function(i){i[i.None=0]="None",i[i.Error=1]="Error",i[i.Warn=2]="Warn",i[i.Log=3]="Log"})(k||(k={}));var O=function(){function i(){}return i.log=function(){if(i.enabled&&i.level>=k.Log){var a;(a=console).log.apply(a,arguments)}},i.warn=function(){if(i.enabled&&i.level>=k.Warn){var a;(a=console).warn.apply(a,arguments)}},i.error=function(){if(i.enabled&&i.level>=k.Error){var a;(a=console).error.apply(a,arguments)}},i}();O.level=k.Warn,O.enabled=!0,function(i){i.WebGl="webgl",i.WebGl2="webgl2"}(u.ContextVersion||(u.ContextVersion={}));var he;(function(i){i.LowP="lowp",i.MediumP="mediump",i.HighP="highp"})(he||(he={}));var R;(function(i){i.Flat="flat",i.Box="box",i.Sphere="sphere",i.Torus="torus",i.Mesh="mesh"})(R||(R={}));var Be={webgl:{flat:{vertex:ue,fragment:Fe},mesh:{vertex:ue,fragment:Re}},webgl2:{flat:{vertex:fe,fragment:we},mesh:{vertex:fe,fragment:Se}}};(function(i){i[i.BrowserSupport=1]="BrowserSupport",i[i.Other=2]="Other"})(u.ContextError||(u.ContextError={}));var Ge=function(){},U=function(){function i(){}return i.getContext_=function(a,t){for(var e=["webgl","experimental-webgl"],r=null,n=0;n<e.length;++n)try{r=a.getContext(e[n],t)}catch{if(r)break}return r},i.getContext2_=function(a,t){var e=null;try{e=a.getContext("webgl2",t)}catch{}return e},i.getFragmentVertex=function(a,t){var e;if(t){var r=i.inferVersion(t);r===u.ContextVersion.WebGl2&&(t=t.replace(/^\#version\s*300\s*es.*?\n/,""));var n=/(?:^\s*)((?:#if|#elif)(?:\s*)(defined\s*\(\s*VERTEX)(?:\s*\))|(?:#ifdef)(?:\s*VERTEX)(?:\s*))/gm,o=n.exec(t);o!==null&&(e=r===u.ContextVersion.WebGl2?`#version 300 es
#define VERTEX
`+t:`#define VERTEX
`+t)}return e},i.getIncludes=function(a,t){if(t===void 0&&(t=""),a===void 0)return Promise.resolve(a);for(var e=/#include\s*['|"](.*.glsl)['|"]/gm,r=[],n=0,o,f=function(){r.push(Promise.resolve(a.slice(n,o.index))),n=o.index+o[0].length;var c=o[1],v=N.getResource(c,t),m=c.indexOf(":/")===-1?N.dirname(v):"";r.push(N.fetch(v).then(function(d){return i.getIncludes(d,m)}))};(o=e.exec(a))!==null;)f();return r.push(Promise.resolve(a.slice(n))),Promise.all(r).then(function(h){return h.join("")})},i.isWebGl=function(a){return a instanceof WebGLRenderingContext},i.isWebGl2=function(a){return window.WebGL2RenderingContext&&a instanceof WebGL2RenderingContext},i.inferVersion=function(a,t){var e=a||t;return e&&e.indexOf("#version 300 es")===0?u.ContextVersion.WebGl2:u.ContextVersion.WebGl},i.inferPrecision=function(a){var t=a.match(/precision\s+(.+)\s+float/);return t&&t.length>1&&(i.precision=t[1]),i.precision},i.versionDiffers=function(a,t,e){if(a){var r=this.isWebGl2(a)?u.ContextVersion.WebGl2:u.ContextVersion.WebGl,n=i.inferVersion(t,e);return n!==r}else return!1},i.getBufferVertex=function(a){return this.isWebGl2(a)?Pe:De},i.getVertex=function(a,t,e){if(e===void 0&&(e=R.Flat),a)return a;var r=this.inferVersion(a,t);return Be[r][e===R.Flat?"flat":"mesh"].vertex},i.getFragment=function(a,t,e){if(e===void 0&&(e=R.Flat),t)return t;var r=this.inferVersion(a,t);return Be[r][e===R.Flat?"flat":"mesh"].fragment},i.tryInferContext=function(a,t,e,r,n,o){n===void 0&&(n=[]);function f(v,m){if(typeof o=="function")o(v);else{var d=e.parentNode;d&&(d.innerHTML='<div class="glsl-canvas--error">'+m+"</div>")}}if(!WebGLRenderingContext)return f(u.ContextError.BrowserSupport,`This page requires a browser that supports WebGL.<br/>
			<a href="http://get.webgl.org">Click here to upgrade your browser.</a>`),null;var h=i.inferContext(a,t,e,r);if(!h)f(u.ContextError.Other,`It does not appear your computer can support WebGL.<br/>
			<a href="http://get.webgl.org/troubleshooting/">Click here for more information.</a>`);else{!this.isWebGl2(h)&&n.indexOf("OES_standard_derivatives")===-1&&n.push("OES_standard_derivatives");var c=h.getSupportedExtensions();n.forEach(function(v){c.indexOf(v)!==-1?h.getExtension(v):O.warn("GlslCanvas "+v+" not supported")})}return h},i.tryGetContext=function(a,t,e){function r(o,f){if(typeof e=="function")e(o);else{var h=a.parentNode;h&&(h.innerHTML='<div class="glsl-canvas--error">'+f+"</div>")}}if(!WebGLRenderingContext)return r(u.ContextError.BrowserSupport,`This page requires a browser that supports WebGL.<br/>
			<a href="http://get.webgl.org">Click here to upgrade your browser.</a>`),null;var n=i.getContext_(a,t);return n?n.getExtension("OES_standard_derivatives"):r(u.ContextError.Other,`It does not appear your computer can support WebGL.<br/>
			<a href="http://get.webgl.org/troubleshooting/">Click here for more information.</a>`),n},i.inferContext=function(a,t,e,r){var n=this.inferVersion(a,t);return n===u.ContextVersion.WebGl2?this.getContext2_(e,r):this.getContext_(e,r)},i.createShader=function(a,t,e,r){r===void 0&&(r=0);var n=a.createShader(e);t=t.replace(/precision\s+(.+)\s+float/,"precision "+i.precision+" float"),a.shaderSource(n,t),a.compileShader(n);var o=a.getShaderParameter(n,a.COMPILE_STATUS);if(!o)throw i.lastError=a.getShaderInfoLog(n),O.error("*** Error compiling shader: "+i.lastError),a.deleteShader(n),{shader:n,source:t,type:e,error:i.lastError,offset:r};return n},i.createProgram=function(a,t,e,r){for(var n=a.createProgram(),o=0;o<t.length;++o)a.attachShader(n,t[o]);if(e&&r)for(var f=0;f<e.length;++f)a.bindAttribLocation(n,r?r[f]:f,e[f]);a.linkProgram(n),a.validateProgram(n);var h=a.getProgramParameter(n,a.LINK_STATUS);return h?(a.useProgram(n),n):(i.lastError=a.getProgramInfoLog(n),O.error("Error in program linking: "+i.lastError),a.deleteProgram(n),null)},i.createVertexBuffers=function(a,t){var e=new Ge,r=a.getAttribLocation(t,"a_texcoord");e.texcoord=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,e.texcoord),a.bufferData(a.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),a.STATIC_DRAW),a.enableVertexAttribArray(r),a.vertexAttribPointer(r,2,a.FLOAT,!1,0,0);var n=a.getAttribLocation(t,"a_position");return e.position=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,e.position),a.bufferData(a.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),a.STATIC_DRAW),a.enableVertexAttribArray(n),a.vertexAttribPointer(n,2,a.FLOAT,!1,0,0),e},i}();U.precision=he.MediumP,U.lastError="";var st=function(){},Q=function(){function i(){this.values=new st}var s=i.prototype;return s.has=function(t){return t in this.values},s.set=function(t,e){this.values[t]=e},s.get=function(t){return this.values[t]},s.forEach=function(t){var e=this,r=0;Object.keys(this.values).forEach(function(n){t(e.values[n],r,e.values),r++})},s.reduce=function(t,e){var r=this,n=e,o=0;return Object.keys(this.values).forEach(function(f){n=t(n,r.values[f],o,r.values),o++}),n},i}(),G=function(){function i(a){a&&(Object.assign(this,a),this.positions&&(this.size=this.positions.length/3))}var s=i.prototype;return s.create=function(t,e){this.createData_(),this.createAttributes_(t,e)},s.createBufferData_=function(t,e,r){var n=t.createBuffer();return t.bindBuffer(e,n),t.bufferData(e,r,t.STATIC_DRAW),n},s.createAttribLocation_=function(t,e,r,n,o){var f=t.getAttribLocation(e,r);return t.enableVertexAttribArray(f),t.vertexAttribPointer(f,n,o,!1,0,0),f},s.createAttributes_=function(t,e){this.positions&&(this.positionBuffer=this.createBufferData_(t,t.ARRAY_BUFFER,new Float32Array(this.positions)),this.positionLocation=this.createAttribLocation_(t,e,"a_position",this.positions.length/this.size,t.FLOAT),t.bindAttribLocation(e,this.positionLocation,"a_position")),this.texcoords&&(this.texcoordBuffer=this.createBufferData_(t,t.ARRAY_BUFFER,new Float32Array(this.texcoords)),this.texcoordLocation=this.createAttribLocation_(t,e,"a_texcoord",this.texcoords.length/this.size,t.FLOAT),t.bindAttribLocation(e,this.texcoordLocation,"a_texcoord")),this.normals&&(this.normalBuffer=this.createBufferData_(t,t.ARRAY_BUFFER,new Float32Array(this.normals)),this.normalLocation=this.createAttribLocation_(t,e,"a_normal",this.normals.length/this.size,t.FLOAT),t.bindAttribLocation(e,this.normalLocation,"a_normal")),this.colors&&(this.colorBuffer=this.createBufferData_(t,t.ARRAY_BUFFER,new Float32Array(this.colors)),this.colorLocation=this.createAttribLocation_(t,e,"a_color",this.colors.length/this.size,t.FLOAT),t.bindAttribLocation(e,this.colorLocation,"a_color"))},s.attachAttributes_=function(t,e){var r;this.positions&&(r=t.getAttribLocation(e,"a_position"),t.enableVertexAttribArray(r),t.bindBuffer(t.ARRAY_BUFFER,this.positionBuffer),t.vertexAttribPointer(r,this.positions.length/this.size,t.FLOAT,!1,0,0)),this.texcoords&&(r=t.getAttribLocation(e,"a_texcoord"),t.enableVertexAttribArray(this.texcoordLocation),t.bindBuffer(t.ARRAY_BUFFER,this.texcoordBuffer),t.vertexAttribPointer(this.texcoordLocation,this.texcoords.length/this.size,t.FLOAT,!1,0,0)),this.normals&&(r=t.getAttribLocation(e,"a_normal"),t.enableVertexAttribArray(this.normalLocation),t.bindBuffer(t.ARRAY_BUFFER,this.normalBuffer),t.vertexAttribPointer(this.normalLocation,this.normals.length/this.size,t.FLOAT,!1,0,0)),this.colors&&(r=t.getAttribLocation(e,"a_color"),t.enableVertexAttribArray(this.colorLocation),t.bindBuffer(t.ARRAY_BUFFER,this.colorBuffer),t.vertexAttribPointer(this.colorLocation,this.colors.length/this.size,t.FLOAT,!1,0,0))},s.bindAttributes_=function(t,e){this.positions&&t.bindAttribLocation(e,this.positionLocation,"a_position"),this.texcoords&&t.bindAttribLocation(e,this.texcoordLocation,"a_texcoord"),this.normals&&t.bindAttribLocation(e,this.normalLocation,"a_normal"),this.colors&&t.bindAttribLocation(e,this.colorLocation,"a_color")},s.createData_=function(){this.positions=[],this.normals=[],this.texcoords=[],this.colors=[],this.size=0},i.fromIndices=function(t,e,r){var n=[];return t.forEach(function(o){n.push.apply(n,e.slice(o*r,o*r+r))}),n},i}(),Z=function(i){B(s,i);function s(){return i.apply(this,arguments)||this}var a=s.prototype;return a.createData_=function(){this.size=6,this.positions=[-1,-1,0,1,-1,0,1,1,0,-1,-1,0,1,1,0,-1,1,0],this.texcoords=[0,0,1,0,1,1,0,0,1,1,0,1],this.normals=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1],this.colors=[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]},s}(G);(function(i){i[i.FLOAT=0]="FLOAT",i[i.HALF_FLOAT=1]="HALF_FLOAT"})(u.BufferFloatType||(u.BufferFloatType={}));var ee=function(){function i(a,t,e,r){var n=a.createFramebuffer(),o=i.getTexture(a,t,e,r);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),this.texture=o,this.buffer=n,this.BW=t,this.BH=e,this.index=r}i.getFloatType=function(t){var e;return U.isWebGl2(t)&&(e=t.getExtension("EXT_color_buffer_float"),e)||(e=t.getExtension("OES_texture_float"),e)?t.FLOAT:null},i.getHalfFloatType=function(t){var e;return U.isWebGl2(t)&&(e=t.getExtension("EXT_color_buffer_half_float")||t.getExtension("EXT_color_buffer_float"),e)?t.HALF_FLOAT:(e=t.getExtension("OES_texture_half_float"),e&&e.HALF_FLOAT_OES||null)},i.getInternalFormat=function(t){return U.isWebGl2(t)?t.RGBA16F:t.RGBA},i.getType=function(t){var e;return i.type===u.BufferFloatType.HALF_FLOAT?(e=i.getHalfFloatType(t),e||(i.type=u.BufferFloatType.FLOAT,i.getType(t))):(e=i.getFloatType(t),e||(i.type=u.BufferFloatType.HALF_FLOAT,i.getType(t)))},i.getTexture=function(t,e,r,n){var o=i.getInternalFormat(t),f=t.RGBA,h=i.getType(t),c=t.createTexture();t.activeTexture(t.TEXTURE0+n),t.bindTexture(t.TEXTURE_2D,c),t.texImage2D(t.TEXTURE_2D,0,o,e,r,0,f,h,null);var v=t.checkFramebufferStatus(t.FRAMEBUFFER);return v!==t.FRAMEBUFFER_COMPLETE?(i.type===u.BufferFloatType.FLOAT?i.type=u.BufferFloatType.HALF_FLOAT:i.type=u.BufferFloatType.FLOAT,i.getTexture(t,e,r,n)):c};var s=i.prototype;return s.resize=function(t,e,r){if(e!==this.BW||r!==this.BH){var n=this.buffer,o=this.texture,f=this.index;t.bindFramebuffer(t.FRAMEBUFFER,n);var h=t.checkFramebufferStatus(t.FRAMEBUFFER),c=Math.min(e,this.BW),v=Math.min(r,this.BH),m,d=i.getType(t);h===t.FRAMEBUFFER_COMPLETE&&(m=new Float32Array(c*v*4),t.readPixels(0,0,c,v,t.RGBA,d,m)),t.bindFramebuffer(t.FRAMEBUFFER,null);var l=f+1,_=i.getTexture(t,e,r,l);d=i.getType(t),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),m&&t.texSubImage2D(t.TEXTURE_2D,0,0,0,c,v,t.RGBA,d,m);var p=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(o),t.activeTexture(t.TEXTURE0+f),t.bindTexture(t.TEXTURE_2D,_),this.index=f,this.texture=_,this.buffer=p,this.BW=e,this.BH=r}},i}();ee.type=u.BufferFloatType.HALF_FLOAT;var Ie=function(){function i(a,t,e,r){this.isValid=!1,this.index=a,this.key=t,this.vertexString=e,this.fragmentString=r,this.geometry=new Z}var s=i.prototype;return s.create=function(t,e,r){var n=U.createShader(t,this.vertexString,t.VERTEX_SHADER),o=U.createShader(t,this.fragmentString,t.FRAGMENT_SHADER,1);o?this.isValid=!0:(o=U.createShader(t,U.isWebGl2(t)?Oe:Ce,t.FRAGMENT_SHADER),this.isValid=!1);var f=U.createProgram(t,[n,o]);if(!f){this.isValid=!1,t.deleteShader(n),t.deleteShader(o);return}this.geometry.create(t,f),t.deleteShader(n),t.deleteShader(o);var h=new ee(t,e,r,this.index+0),c=new ee(t,e,r,this.index+2);this.program=f,this.input=h,this.output=c},s.render=function(t,e,r){t.useProgram(this.program),t.bindFramebuffer(t.FRAMEBUFFER,this.output.buffer),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.output.texture,0);var n=t.checkFramebufferStatus(t.FRAMEBUFFER);n===t.FRAMEBUFFER_COMPLETE&&(t.clearColor(0,0,0,1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)),t.viewport(0,0,e,r),t.drawArrays(t.TRIANGLES,0,this.geometry.size);var o=this.input;this.input=this.output,this.output=o},s.resize=function(t,e,r){t.useProgram(this.program),t.viewport(0,0,e,r),this.input.resize(t,e,r),this.output.resize(t,e,r)},s.destroy=function(t){t.deleteProgram(this.program),this.program=null,this.input=null,this.output=null},i}(),te=function(i){B(s,i);function s(){return i.apply(this,arguments)||this}return s.getBuffers=function(t,e,r){var n=new s,o=0;if(e){U.isWebGl2(t)&&(e=e.replace(/^\#version\s*300\s*es\s*\n/,""));for(var f=/(?:^\s*)((?:#if|#elif)(?:\s*)(defined\s*\(\s*BUFFER_)(\d+)(?:\s*\))|(?:#ifdef)(?:\s*BUFFER_)(\d+)(?:\s*))/gm,h;(h=f.exec(e))!==null;){var c=h[3]||h[4],v="u_buffer"+c,m=U.isWebGl2(t)?`#version 300 es
#define BUFFER_`+c+`
`+e:"#define BUFFER_"+c+`
`+e,d=new Ie(o,v,r,m);if(d.create(t,t.drawingBufferWidth,t.drawingBufferHeight),d.program)n.set(v,d);else throw"buffer error "+v;o+=4}}return n},ne(s,[{key:"count",get:function(){return Object.keys(this.values).length*4}}]),s}(Q),q=function(){function i(a,t){a===void 0&&(a=0),t===void 0&&(t=0),this.isVector2=!0,this.x=a,this.y=t}var s=i.prototype;return s.copy=function(t){return this.x=t.x,this.y=t.y,this},s.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},s.normalize=function(){return this.divideScalar(this.length()||1)},s.divideScalar=function(t){return this.multiplyScalar(1/t)},s.multiplyScalar=function(t){return this.x*=t,this.y*=t,this},s.subVectors=function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},s.addVectors=function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},i}(),C=function(){function i(a,t,e){a===void 0&&(a=0),t===void 0&&(t=0),e===void 0&&(e=0),this.isVector3=!0,this.x=a,this.y=t,this.z=e}var s=i.prototype;return s.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},s.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},s.normalize=function(){return this.divideScalar(this.length()||1)},s.divideScalar=function(t){return this.multiplyScalar(1/t)},s.multiplyScalar=function(t){return this.x*=t,this.y*=t,this.z*=t,this},s.subVectors=function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},s.addVectors=function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},s.crossVectors=function(t,e){var r=t.x,n=t.y,o=t.z,f=e.x,h=e.y,c=e.z;return this.x=n*c-o*h,this.y=o*f-r*c,this.z=r*h-n*f,this},i}(),ot=Math.PI,H=ot/180,ce=function(i){B(s,i);function s(t,e,r){var n;return n=i.call(this)||this,n.position=new C,n.value=new Float32Array([0,0,0]),n.mouse=null,n.dirty=!1,n.theta=(t||0)*H,n.phi=(e||0)*H,n.radius=r||6,n}var a=s.prototype;return a.down=function(e,r){this.mouse=new q(e,r)},a.move=function(e,r){var n=this.mouse;if(n&&(n.x!==e||n.y!==r)){var o=(e-n.x)*180*H,f=(r-n.y)*180*H;n.x=e,n.y=r,this.theta+=o,this.phi=Math.max(-60*H,Math.min(60*H,this.phi+f))}},a.up=function(){this.mouse=null},a.wheel=function(e){this.radius=Math.max(4,Math.min(10,this.radius+e*.02))},s.fromVector=function(e){var r=e.length(),n=Math.acos(e.y/r),o=Math.atan(e.x/e.z);return new s(n,o,r)},s.toArray=function(e){var r=Math.sin(e.phi)*e.radius,n=r*Math.sin(e.theta),o=Math.cos(e.phi)*e.radius,f=r*Math.cos(e.theta);return[n,o,f]},s}(C),ut=1e-6,Ve=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var i=0,s=arguments.length;s--;)i+=arguments[s]*arguments[s];return Math.sqrt(i)});function j(){var i=new Ve(16);return Ve!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i}function We(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function ft(i,s){if(i===s){var a=s[1],t=s[2],e=s[3],r=s[6],n=s[7],o=s[11];i[1]=s[4],i[2]=s[8],i[3]=s[12],i[4]=a,i[6]=s[9],i[7]=s[13],i[8]=t,i[9]=r,i[11]=s[14],i[12]=e,i[13]=n,i[14]=o}else i[0]=s[0],i[1]=s[4],i[2]=s[8],i[3]=s[12],i[4]=s[1],i[5]=s[5],i[6]=s[9],i[7]=s[13],i[8]=s[2],i[9]=s[6],i[10]=s[10],i[11]=s[14],i[12]=s[3],i[13]=s[7],i[14]=s[11],i[15]=s[15];return i}function ht(i,s){var a=s[0],t=s[1],e=s[2],r=s[3],n=s[4],o=s[5],f=s[6],h=s[7],c=s[8],v=s[9],m=s[10],d=s[11],l=s[12],_=s[13],p=s[14],M=s[15],D=a*o-t*n,T=a*f-e*n,b=a*h-r*n,E=t*f-e*o,g=t*h-r*o,P=e*h-r*f,x=c*_-v*l,S=c*p-m*l,A=c*M-d*l,w=v*p-m*_,L=v*M-d*_,F=m*M-d*p,y=D*F-T*L+b*w+E*A-g*S+P*x;return y?(y=1/y,i[0]=(o*F-f*L+h*w)*y,i[1]=(e*L-t*F-r*w)*y,i[2]=(_*P-p*g+M*E)*y,i[3]=(m*g-v*P-d*E)*y,i[4]=(f*A-n*F-h*S)*y,i[5]=(a*F-e*A+r*S)*y,i[6]=(p*b-l*P-M*T)*y,i[7]=(c*P-m*b+d*T)*y,i[8]=(n*L-o*A+h*x)*y,i[9]=(t*A-a*L-r*x)*y,i[10]=(l*g-_*b+M*D)*y,i[11]=(v*b-c*g-d*D)*y,i[12]=(o*S-n*w-f*x)*y,i[13]=(a*w-t*S+e*x)*y,i[14]=(_*T-l*E-p*D)*y,i[15]=(c*E-v*T+m*D)*y,i):null}function ct(i,s,a){var t=a[0],e=a[1],r=a[2],n,o,f,h,c,v,m,d,l,_,p,M;return s===i?(i[12]=s[0]*t+s[4]*e+s[8]*r+s[12],i[13]=s[1]*t+s[5]*e+s[9]*r+s[13],i[14]=s[2]*t+s[6]*e+s[10]*r+s[14],i[15]=s[3]*t+s[7]*e+s[11]*r+s[15]):(n=s[0],o=s[1],f=s[2],h=s[3],c=s[4],v=s[5],m=s[6],d=s[7],l=s[8],_=s[9],p=s[10],M=s[11],i[0]=n,i[1]=o,i[2]=f,i[3]=h,i[4]=c,i[5]=v,i[6]=m,i[7]=d,i[8]=l,i[9]=_,i[10]=p,i[11]=M,i[12]=n*t+c*e+l*r+s[12],i[13]=o*t+v*e+_*r+s[13],i[14]=f*t+m*e+p*r+s[14],i[15]=h*t+d*e+M*r+s[15]),i}function Ne(i,s,a,t){var e=t[0],r=t[1],n=t[2],o=Math.hypot(e,r,n),f,h,c,v,m,d,l,_,p,M,D,T,b,E,g,P,x,S,A,w,L,F,y,I;return o<ut?null:(o=1/o,e*=o,r*=o,n*=o,f=Math.sin(a),h=Math.cos(a),c=1-h,v=s[0],m=s[1],d=s[2],l=s[3],_=s[4],p=s[5],M=s[6],D=s[7],T=s[8],b=s[9],E=s[10],g=s[11],P=e*e*c+h,x=r*e*c+n*f,S=n*e*c-r*f,A=e*r*c-n*f,w=r*r*c+h,L=n*r*c+e*f,F=e*n*c+r*f,y=r*n*c-e*f,I=n*n*c+h,i[0]=v*P+_*x+T*S,i[1]=m*P+p*x+b*S,i[2]=d*P+M*x+E*S,i[3]=l*P+D*x+g*S,i[4]=v*A+_*w+T*L,i[5]=m*A+p*w+b*L,i[6]=d*A+M*w+E*L,i[7]=l*A+D*w+g*L,i[8]=v*F+_*y+T*I,i[9]=m*F+p*y+b*I,i[10]=d*F+M*y+E*I,i[11]=l*F+D*y+g*I,s!==i&&(i[12]=s[12],i[13]=s[13],i[14]=s[14],i[15]=s[15]),i)}function vt(i,s,a,t,e){var r=1/Math.tan(s/2),n;return i[0]=r/a,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=r,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,e!==1/0?(n=1/(t-e),i[10]=(e+t)*n,i[14]=2*e*t*n):(i[10]=-1,i[14]=-2*t),i}var ze=function(){function i(){this.delay=0,this.current=0,this.delta=0,this.paused=!1,this.start=this.previous=this.now()}var s=i.prototype;return s.now=function(){return performance.now()},s.play=function(){if(this.previous){var t=this.now();this.delay+=t-this.previous,this.previous=t}this.paused=!1},s.pause=function(){this.paused=!0},s.next=function(){var t=this.now();return this.delta=t-this.previous,this.current=t-this.start-this.delay,this.previous=t,this},i}(),ve=function(s,a){this.event=s,this.callback=a},de=function(){function i(){this.listeners=new Set}var s=i.prototype;return s.logListeners=function(){this.listeners.forEach(function(t){return O.log(t)})},s.subscribe=function(t){this.listeners.add(t)},s.unsubscribe=function(t){this.listeners.delete(t)},s.unsubscribeAll=function(){this.listeners.clear()},s.on=function(t,e){return this.listeners.add(new ve(t,e)),this},s.off=function(t,e){var r=this;return e?this.listeners.delete(new ve(t,e)):this.listeners.forEach(function(n){n.event===t&&r.listeners.delete(n)}),this},s.trigger=function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return this.listeners.forEach(function(o){o.event===t&&typeof o.callback=="function"&&o.callback.apply(o,r)}),this},i}(),Xe=function(i){B(s,i);function s(){return i.apply(this,arguments)||this}var a=s.prototype;return a.createData_=function(){this.size=36,this.positions=[-1,-1,1,1,-1,1,1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,-1,-1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,-1,-1,-1,1,1,-1,1,-1],this.texcoords=[0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1],this.normals=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0];for(var e=[[1,1,1,1],[1,0,0,1],[0,1,0,1],[0,0,1,1],[1,1,0,1],[1,0,1,1]],r=[],n=0;n<e.length;++n){var o=e[n];r=r.concat(o,o,o,o,o,o)}this.colors=r},s}(G),ke=function(i){B(s,i);function s(){return i.apply(this,arguments)||this}var a=s.prototype;return a.createData_=function(){var e=1.4,r=80,n=60,o=0,f=Math.PI*2,h=0,c=Math.PI,v=new C,m=new C,d=[],l=[],_=[],p=[],M=[],D=Math.min(h+c,Math.PI),T,b,E=0,g=[];for(b=0;b<=n;b++){var P=[],x=b/n,S=0;for(b==0&&h==0?S=.5/r:b==n&&D==Math.PI&&(S=-.5/r),T=0;T<=r;T++){var A=T/r;v.x=-e*Math.cos(o+A*f)*Math.sin(h+x*c),v.y=e*Math.cos(h+x*c),v.z=e*Math.sin(o+A*f)*Math.sin(h+x*c),l.push(v.x,v.y,v.z),m.copy(v).normalize(),_.push(m.x,m.y,m.z);var w=A+S,L=1-x;p.push(w,L),M.push(1,1,1,1),P.push(E++)}g.push(P)}for(b=0;b<n;b++)for(T=0;T<r;T++){var F=g[b][T+1],y=g[b][T],I=g[b+1][T],V=g[b+1][T+1];(b!==0||h>0)&&d.push(F,y,V),(b!==n-1||D<Math.PI)&&d.push(y,I,V)}this.size=d.length,this.positions=G.fromIndices(d,l,3),this.texcoords=G.fromIndices(d,p,2),this.normals=G.fromIndices(d,_,3),this.colors=G.fromIndices(d,M,4)},s}(G),He=function(i){B(s,i);function s(){return i.apply(this,arguments)||this}var a=s.prototype;return a.createData_=function(){for(var e=1,r=.25,n=200,o=40,f=2,h=3,c=[],v=[],m=[],d=[],l=[],_=new C,p=new C,M=new C,D=new C,T=new C,b=new C,E=new C,g=0;g<=n;++g){var P=g/n*f*Math.PI*2;this.calculatePositionOnCurve(P,f,h,e,M),this.calculatePositionOnCurve(P+.01,f,h,e,D),b.subVectors(D,M),E.addVectors(D,M),T.crossVectors(b,E),E.crossVectors(T,b),T.normalize(),E.normalize();for(var x=0;x<=o;++x){var S=x/o*Math.PI*2,A=-r*Math.cos(S),w=r*Math.sin(S);_.x=M.x+(A*E.x+w*T.x),_.y=M.y+(A*E.y+w*T.y),_.z=M.z+(A*E.z+w*T.z),v.push(_.x,_.y,_.z),p.subVectors(_,M).normalize(),m.push(p.x,p.y,p.z),d.push(g/n*2*Math.round(h)),d.push(x/o),l.push(1,1,1,1)}}for(var L=1;L<=n;L++)for(var F=1;F<=o;F++){var y=(o+1)*(L-1)+(F-1),I=(o+1)*L+(F-1),V=(o+1)*L+F,Y=(o+1)*(L-1)+F;c.push(y,I,Y),c.push(I,V,Y)}this.size=c.length,this.positions=G.fromIndices(c,v,3),this.texcoords=G.fromIndices(c,d,2),this.normals=G.fromIndices(c,m,3),this.colors=G.fromIndices(c,l,4)},a.calculatePositionOnCurve=function(e,r,n,o,f){var h=Math.cos(e),c=Math.sin(e),v=n/r*e,m=Math.cos(v);f.x=o*(2+m)*.5*h,f.y=o*(2+m)*c*.5,f.z=o*Math.sin(v)*.5},s}(G),je=[[1,1,1],[1,0,0],[0,1,0],[0,0,1],[1,1,0],[0,1,1]],me=0,Ye=function(){function i(){}var s=i.prototype;return s.load=function(t){var e=this;return new Promise(function(r,n){N.fetch(t).then(function(o){var f=e.parse(o);if(f.positions.length){var h=new G(f);r(h)}else n("ObjLoader error: empty positions "+t)},function(o){console.log("ObjLoader error:",o,t),n(o)})})},s.parseIndices=function(t,e,r,n,o,f){for(var h=0;h<=t.length-3;){var c=void 0,v=void 0,m=void 0;h===0?(c=h,v=h+1,m=h+2):(c=h-1,v=h+1,m=h+2),h++;for(var d=[c,v,m],l=0;l<d.length;l++){var _=t[d[l]][e],p=void 0;_&&_!==NaN&&(p=n[_-1],p&&(p=p.slice(0,r),o.push.apply(o,p)))}}},s.parseFaces=function(t,e,r,n,o,f,h,c){var v=this,m=o.length;t.forEach(function(_){v.parseIndices(_,0,3,e,o,"positions"),v.parseIndices(_,2,3,r,f,"normals"),v.parseIndices(_,1,2,n,h,"texcoords")});var d=o.length-m;if(d>0){var l=new Array(d/3).fill(0);l.forEach(function(){var _=je[me%je.length];c.push(_[0],_[1],_[2],1)}),me++}},s.parse=function(t){var e=this,r=[],n=[],o=[],f=[];me=0;var h=[],c=[],v=[],m=[];t.indexOf(`\r
`)!==-1&&(t=t.replace(/\r\n/g,`
`)),t=t.replace(/  /g," ");var d=t.split(`
`);d.forEach(function(E,g){if(E.indexOf("v ")===0){m.length&&(e.parseFaces(m,h,c,v,r,n,o,f),m=[]);var P=E.replace("v","").trim().split(" "),x=P.map(function(V){return parseFloat(V)});h.push(x)}else if(E.indexOf("vn ")===0){var S=E.replace("vn","").trim().split(" "),A=S.map(function(V){return parseFloat(V)}),w=new C(A[0],A[1],A[2]).normalize();c.push([w.x,w.y,w.z])}else if(E.indexOf("vt ")===0){var L=E.replace("vt","").trim().split(" "),F=L.map(function(V){return parseFloat(V)});v.push(F)}else if(E.indexOf("f ")===0){var y=E.replace("f","").trim().split(" "),I=y.map(function(V){var Y=V.split("/").map(function(mt){return parseInt(mt)});return Y.length===2&&Y.push(null),Y});m[m.length]=I}}),m.length&&this.parseFaces(m,h,c,v,r,n,o,f);for(var l={min:new C(Number.POSITIVE_INFINITY),max:new C(Number.NEGATIVE_INFINITY)},_=0;_<r.length;_+=3)l.min.x=Math.min(l.min.x,r[_]),l.min.y=Math.min(l.min.y,r[_+1]),l.min.z=Math.min(l.min.z,r[_+2]),l.max.x=Math.max(l.max.x,r[_]),l.max.y=Math.max(l.max.y,r[_+1]),l.max.z=Math.max(l.max.z,r[_+2]);for(var p=-(l.min.x+l.max.x)/2,M=-(l.min.y+l.max.y)/2,D=-(l.min.z+l.max.z)/2,T=0;T<r.length;T+=3)r[T]+=p,r[T+1]+=M,r[T+2]+=D;var b=r.reduce(function(E,g){return Math.max(E,g)},0);return r.forEach(function(E,g){return r[g]=E/b*2}),n.length||(n=r.slice()),o.length||(o=this.unrapUvw(r)),{positions:r,normals:n,texcoords:o,colors:f}},s.unrapUvw=function(t){for(var e=[],r=0;r<t.length;r+=3){var n=new C(t[r],t[r+1],t[r+2]);n.normalize();var o=Math.asin(-n.y),f=Math.atan2(n.x,n.z),h=.5+o/Math.PI,c=.5+f/(Math.PI*2);e.push(h,c)}return e},i}(),qe=["jpg","jpeg","png"],le=["ogv","webm","mp4"],dt=qe.concat(le);(function(i){i[i.Data=0]="Data",i[i.Element=1]="Element",i[i.Url=2]="Url"})(u.TextureSourceType||(u.TextureSourceType={})),function(i){i.MipMap="mipmap",i.Linear="linear",i.Nearest="nearest"}(u.TextureFilteringType||(u.TextureFilteringType={}));function Ke(i){return"data"in i&&"width"in i&&"height"in i}var K=function(i){B(s,i);function s(t,e,r,n,o){var f;return n===void 0&&(n={filtering:u.TextureFilteringType.Linear}),f=i.call(this)||this,f.valid=!1,f.dirty=!1,f.animated=!1,f.powerOf2=!1,f.key=e,f.index=r,f.options=n,f.workpath=o,f.create(t),f}s.isPowerOf2=function(e){return(e&e-1)===0},s.isSafari=function(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)},s.isTextureUrl=function(e){return e&&/\.(jpg|jpeg|png|ogv|webm|mp4)$/i.test(e.split("?")[0])},s.isTexture=function(e){var r=s.getTextureOptions(e);return r!==void 0},s.getMaxTextureSize=function(e){return e.getParameter(e.MAX_TEXTURE_SIZE)},s.getTextureOptions=function(e,r){if(r===void 0&&(r={}),typeof e=="string"&&e!==""){if(s.isTextureUrl(e))return r.url=e,e.indexOf("?")!==-1&&(r=e.split("?")[1].split("&").reduce(function(n,o){var f=o.split("="),h=decodeURIComponent(f[0]),c=decodeURIComponent(f[1]);switch(h){case"filtering":n[h]=c;break;case"repeat":case"UNPACK_FLIP_Y_WEBGL":n[h]=!!c;break;case"UNPACK_PREMULTIPLY_ALPHA_WEBGL":case"TEXTURE_WRAP_S":case"TEXTURE_WRAP_T":n[h]=Number(c);break}return n},r)),r;document&&(e=document.querySelector(e))}return e instanceof HTMLCanvasElement||e instanceof HTMLImageElement||e instanceof HTMLVideoElement?(r.element=e,r):Ke(e)?(r.data=e.data,r.width=e.width,r.height=e.height,r):null};var a=s.prototype;return a.create=function(e){this.texture=e.createTexture(),this.texture&&(this.valid=!0),this.setData(e,1,1,new Uint8Array([0,0,0,0]),this.options)},a.load=function(e,r){return r===void 0&&(r={}),this.options=r,typeof r.url=="string"?this.url===void 0||r.url!==this.url?this.setUrl(e,r.url,r):Promise.resolve(this):r.element?this.setElement(e,r.element,r):r.data&&r.width&&r.height?this.setData(e,r.width,r.height,r.data,r):Promise.reject(this)},a.setUrl=function(e,r,n){if(n===void 0&&(n={}),!this.valid)return Promise.reject(this);this.url=r,this.source=r,this.sourceType=u.TextureSourceType.Url,this.options=Object.assign(this.options,n);var o=r.split("?")[0].split(".").pop().toLowerCase(),f=le.indexOf(o)!==-1,h=N.getResource(r,this.workpath),c,v;return f?(O.log("GlslCanvas.setUrl video",h),c=document.createElement("video"),c.setAttribute("preload","auto"),c.setAttribute("loop","true"),c.setAttribute("muted","true"),c.setAttribute("playsinline","true"),c.loop=!0,c.muted=!0,v=this.setElement(e,c,n),c.src=h,c.addEventListener("canplay",function(){c.play()})):(O.log("GlslCanvas.setUrl image",h),c=document.createElement("img"),v=this.setElement(e,c,n),s.isSafari()&&r.slice(0,5)==="data:"||(c.crossOrigin="anonymous"),c.src=h),v},a.setElement=function(e,r,n){var o=this;return n===void 0&&(n={}),n=this.options=Object.assign(this.options,n),new Promise(function(f,h){var c=r;if(typeof r=="string"&&(r=document.querySelector(r)),r instanceof HTMLCanvasElement||r instanceof HTMLImageElement||r instanceof HTMLVideoElement)if(o.source=r,o.sourceType=u.TextureSourceType.Element,r instanceof HTMLVideoElement){var v=r;v.addEventListener("loadeddata",function(d){o.update(e,n),o.setFiltering(e,n),f(o)}),v.addEventListener("error",function(d){h(d)}),v.load()}else r instanceof HTMLImageElement?(r.addEventListener("load",function(){o.update(e,n),o.setFiltering(e,n),f(o)}),r.addEventListener("error",function(d){h(d)})):(o.update(e,n),o.setFiltering(e,n),f(o));else{var m="the 'element' parameter (`element: "+JSON.stringify(c)+"`) must be a CSS selector string, or a <canvas>, <image> or <video> object";O.log("Texture '"+o.key+"': "+m,n),h(m)}})},a.setData=function(e,r,n,o,f){return f===void 0&&(f={}),this.width=r,this.height=n,this.options=Object.assign(this.options,f),this.source=o,this.sourceType=u.TextureSourceType.Data,this.update(e,f),this.setFiltering(e,f),Promise.resolve(this)},a.update=function(e,r){if(this.valid){if(e.activeTexture(e.TEXTURE0+this.index),e.bindTexture(e.TEXTURE_2D,this.texture),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,r.UNPACK_FLIP_Y_WEBGL===!1?0:1),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.UNPACK_PREMULTIPLY_ALPHA_WEBGL||0),this.sourceType===u.TextureSourceType.Element)this.source instanceof HTMLImageElement&&this.source.naturalWidth&&this.source.naturalHeight?(this.width=this.source.naturalWidth,this.height=this.source.naturalHeight,e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this.source)):this.source instanceof HTMLVideoElement&&this.source.videoWidth&&this.source.videoHeight?(this.width=this.source.videoWidth,this.height=this.source.videoHeight,e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this.source)):this.source instanceof HTMLCanvasElement&&(this.width=this.source.width,this.height=this.source.height,e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this.source));else if(this.sourceType===u.TextureSourceType.Data){var n=this.source;e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.width,this.height,0,e.RGBA,e.UNSIGNED_BYTE,n)}this.trigger("loaded",this)}},a.tryUpdate=function(e){var r=!1;return this.animated&&(r=!0,this.update(e,this.options)),r},a.destroy=function(e){this.valid&&(e.deleteTexture(this.texture),this.texture=null,delete this.source,this.source=null,this.valid=!1)},a.setFiltering=function(e,r){if(this.valid){var n=s.isPowerOf2(this.width)&&s.isPowerOf2(this.height),o=r.filtering||u.TextureFilteringType.MipMap,f=r.TEXTURE_WRAP_S||(r.repeat?e.REPEAT:e.CLAMP_TO_EDGE),h=r.TEXTURE_WRAP_T||(r.repeat?e.REPEAT:e.CLAMP_TO_EDGE);n||(o=o===u.TextureFilteringType.MipMap?u.TextureFilteringType.Linear:o,f=h=e.CLAMP_TO_EDGE,(r.repeat||r.TEXTURE_WRAP_S||r.TEXTURE_WRAP_T)&&O.warn("GlslCanvas: cannot repeat texture "+r.url+" cause is not power of 2.")),this.powerOf2=n,this.filtering=o,e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,f),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,h),this.filtering===u.TextureFilteringType.MipMap?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.generateMipmap(e.TEXTURE_2D)):this.filtering===u.TextureFilteringType.Nearest?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST)):this.filtering===u.TextureFilteringType.Linear&&(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR))}},s}(de),_e=function(i){B(s,i);function s(){var t;return t=i.apply(this,arguments)||this,t.count=0,t.dirty=!1,t.animated=!1,t}var a=s.prototype;return a.clean=function(){var e=this;Object.keys(this.values).forEach(function(r){e.values[r].dirty=!1}),this.dirty=!1},a.createOrUpdate=function(e,r,n,o,f,h){var c=this;o===void 0&&(o=0),f===void 0&&(f={});var v,m=K.getTextureOptions(n,f);return v=this.get(r),v||(v=new K(e,r,o+this.count,m,h),this.count++,this.set(r,v)),m!==void 0?v.load(e,m).then(function(d){if(d.source instanceof HTMLVideoElement){var l=d.source;l.addEventListener("play",function(){d.animated=!0,c.animated=!0}),l.addEventListener("pause",function(){d.animated=!1,c.animated=c.reduce(function(_,p){return _||p.animated},!1)}),l.addEventListener("seeked",function(){d.update(e,d.options),c.dirty=!0})}return d}):Promise.resolve(v)},s}(Q);(function(i){i[i.Unknown=0]="Unknown",i.Uniform1i="uniform1i",i.Uniform2i="uniform2i",i.Uniform3i="uniform3i",i.Uniform4i="uniform4i",i.Uniform1f="uniform1f",i.Uniform2f="uniform2f",i.Uniform3f="uniform3f",i.Uniform4f="uniform4f",i.Uniform1iv="uniform1iv",i.Uniform2iv="uniform2iv",i.Uniform3iv="uniform3iv",i.Uniform4iv="uniform4iv",i.Uniform1fv="uniform1fv",i.Uniform2fv="uniform2fv",i.Uniform3fv="uniform3fv",i.Uniform4fv="uniform4fv",i.UniformMatrix2fv="uniformMatrix2fv",i.UniformMatrix3fv="uniformMatrix3fv",i.UniformMatrix4fv="uniformMatrix4fv"})(u.UniformMethod||(u.UniformMethod={})),function(i){i[i.Unknown=0]="Unknown",i[i.Float=1]="Float",i[i.Int=2]="Int",i[i.Bool=3]="Bool",i[i.Sampler2D=4]="Sampler2D",i[i.SamplerCube=5]="SamplerCube",i[i.Matrix2fv=6]="Matrix2fv",i[i.Matrix3fv=7]="Matrix3fv",i[i.Matrix4fv=8]="Matrix4fv"}(u.UniformType||(u.UniformType={}));var pe=[u.UniformMethod.Uniform1i,u.UniformMethod.Uniform2i,u.UniformMethod.Uniform3i,u.UniformMethod.Uniform4i],Te=[u.UniformMethod.Uniform1f,u.UniformMethod.Uniform2f,u.UniformMethod.Uniform3f,u.UniformMethod.Uniform4f],Ee=[u.UniformMethod.Uniform1iv,u.UniformMethod.Uniform2iv,u.UniformMethod.Uniform3iv,u.UniformMethod.Uniform4iv],be=[u.UniformMethod.Uniform1fv,u.UniformMethod.Uniform2fv,u.UniformMethod.Uniform3fv,u.UniformMethod.Uniform4fv],$=function(s){var a=this;switch(this.dirty=!0,s&&Object.assign(this,s),this.method){case u.UniformMethod.UniformMatrix2fv:case u.UniformMethod.UniformMatrix3fv:case u.UniformMethod.UniformMatrix4fv:this.apply=function(t,e){if(a.dirty){t.useProgram(e);var r=t.getUniformLocation(e,a.key);t[a.method].apply(t,[r,!1].concat(a.values))}};break;default:this.apply=function(t,e){if(a.dirty){t.useProgram(e);var r=t.getUniformLocation(e,a.key);t[a.method].apply(t,[r].concat(a.values))}}}},ye=function(i){B(s,i);function s(a){return i.call(this,a)||this}return s}($),J=function(i){B(s,i);function s(){var t;return t=i.apply(this,arguments)||this,t.dirty=!1,t}s.isArrayOfInteger=function(e){return e.reduce(function(r,n){return r&&Number.isInteger(n)},!0)},s.isArrayOfNumber=function(e){return e.reduce(function(r,n){return r&&typeof n=="number"},!0)},s.isArrayOfBoolean=function(e){return e.reduce(function(r,n){return r&&typeof n=="boolean"},!0)},s.isArrayOfTexture=function(e){return e.reduce(function(r,n){return r&&K.isTexture(n)},!0)},s.isArrayOfSampler2D=function(e){return e.reduce(function(r,n){return r&&n.type===u.UniformType.Sampler2D},!0)},s.getType_=function(e){var r=u.UniformType.Unknown,n=e.length===1&&Array.isArray(e[0]),o=n?e[0]:e;return s.isArrayOfNumber(o)?r=u.UniformType.Float:s.isArrayOfBoolean(o)?r=u.UniformType.Bool:s.isArrayOfTexture(o)&&(r=u.UniformType.Sampler2D),r},s.getMethod_=function(e,r){var n=u.UniformMethod.Unknown,o=r.length===1&&Array.isArray(r[0]),f=o?r[0]:r,h=f.length,c=h-1;switch(e){case u.UniformType.Float:o?n=c<be.length?be[c]:u.UniformMethod.Unknown:n=c<Te.length?Te[c]:u.UniformMethod.Uniform1fv;break;case u.UniformType.Int:case u.UniformType.Bool:o?n=c<Ee.length?Ee[c]:u.UniformMethod.Unknown:n=c<pe.length?pe[c]:u.UniformMethod.Uniform1iv;break;case u.UniformType.Sampler2D:o?n=u.UniformMethod.Uniform1iv:n=h===1?u.UniformMethod.Uniform1i:u.UniformMethod.Uniform1iv;break}return n},s.parseUniform=function(e,r,n){n===void 0&&(n=null);var o;n=n||s.getType_(r);var f=s.getMethod_(n,r);if(n!==u.UniformType.Unknown&&f!==u.UniformMethod.Unknown){if(n===u.UniformType.Sampler2D&&f===u.UniformMethod.Uniform1iv)return r[0].map(function(h,c){return new $({method:f,type:n,key:e+"["+c+"]",values:[h]})});o=new $({method:f,type:n,key:e,values:r})}else O.error("Uniforms.parseUniform.Unknown",e,r);return o};var a=s.prototype;return a.create=function(e,r,n,o){var f=new $({method:e,type:r,key:n,values:o});return this.set(n,f),this.dirty=!0,f},a.createTexture=function(e,r){var n;return e.indexOf("]")!==-1?n=new ye({method:u.UniformMethod.Uniform1iv,type:u.UniformType.Sampler2D,key:e,values:[[r]]}):n=new ye({method:u.UniformMethod.Uniform1i,type:u.UniformType.Sampler2D,key:e,values:[r]}),this.set(e,n),this.dirty=!0,n},a.update=function(e,r,n,o){var f=this.get(n);f&&(f.method=e,f.type=r,f.values=o,f.dirty=!0,this.dirty=!0)},a.createOrUpdate=function(e,r,n,o){this.has(n)?this.update(e,r,n,o):this.create(e,r,n,o)},a.apply=function(e,r){var n=this;e.useProgram(r),Object.keys(this.values).forEach(function(o){n.values[o].apply(e,r)})},a.clean=function(){var e=this;Object.keys(this.values).forEach(function(r){e.values[r].dirty=!1}),this.dirty=!1},s.isDifferent=function(e,r){return e.length!==r.length||e.reduce(function(n,o,f){return n||o!==r[f]},!1)},s}(Q),$e=function(i){B(s,i);function s(){var t;return t=i.call(this)||this,t.uniforms=new J,t.buffers=new te,t.textures=new _e,t.textureList=[],t.W=0,t.H=0,t.mouse=new q,t.radians=0,t.dirty=!0,t.animated=!1,t.camera=new ce,t.cache={},t.drawFunc_=t.drawArrays_,t}var a=s.prototype;return a.render=function(){var e=this,r=this.gl;if(r){var n=r.drawingBufferWidth,o=r.drawingBufferHeight;this.update_(),r.viewport(0,0,n,o);var f=this.uniforms;Object.keys(this.buffers.values).forEach(function(h){var c=e.buffers.values[h];c.geometry.attachAttributes_(r,c.program),f.apply(r,c.program),c.render(r,n,o)}),this.geometry.attachAttributes_(r,this.program),f.apply(r,this.program),this.drawFunc_(this.timer.delta),f.clean(),this.textures.clean(),this.dirty=!1,this.trigger("render",this)}},a.drawArrays_=function(e){var r=this.gl;r.bindFramebuffer(r.FRAMEBUFFER,null),r.viewport(0,0,this.W,this.H),r.clearColor(0,0,0,1),r.clearDepth(1),r.enable(r.DEPTH_TEST),r.depthFunc(r.LEQUAL),r.enable(r.CULL_FACE),this.doubleSided&&this.mode!==R.Flat&&(r.cullFace(r.FRONT),r.drawArrays(r.TRIANGLES,0,this.geometry.size),r.enable(r.BLEND),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA)),r.cullFace(r.BACK),r.drawArrays(r.TRIANGLES,0,this.geometry.size)},a.create_=function(){this.createGeometry_(),this.createUniforms_()},a.createGeometry_=function(){this.parseGeometry_(),this.setMode(this.mode)},a.parseGeometry_=function(){var e=/^attribute\s+vec4\s+a_position\s*;\s*\/\/\s*([\w|\:\/\/|\.|\-|\_|\?|\&|\=]+)/gm,r=e.exec(this.vertexString);r&&r.length>1?this.mesh=r[1]:this.mesh=this.defaultMesh},a.createUniforms_=function(){var e=this.gl,r=this.fragmentString,n=e.drawingBufferWidth,o=e.drawingBufferHeight,f=this.timer=new ze,h=(r.match(/u_delta/g)||[]).length>1,c=(r.match(/u_time/g)||[]).length>1,v=(r.match(/u_date/g)||[]).length>1,m=(r.match(/u_mouse/g)||[]).length>1,d=(r.match(/u_camera/g)||[]).length>1;this.animated=!0;var l=this.uniforms;if(l.create(u.UniformMethod.Uniform2f,u.UniformType.Float,"u_resolution",[n,o]),h?(l.create(u.UniformMethod.Uniform1f,u.UniformType.Float,"u_delta",[f.delta/1e3]),this.updateUniformDelta_=this.updateUniformDelta__):this.updateUniformDelta_=this.updateUniformNoop_,c?(l.create(u.UniformMethod.Uniform1f,u.UniformType.Float,"u_time",[f.current/1e3]),this.updateUniformTime_=this.updateUniformTime__):this.updateUniformTime_=this.updateUniformNoop_,v){var _=new Date;l.create(u.UniformMethod.Uniform4f,u.UniformType.Float,"u_date",[_.getFullYear(),_.getMonth(),_.getDate(),_.getHours()*3600+_.getMinutes()*60+_.getSeconds()+_.getMilliseconds()*.001]),this.updateUniformDate_=this.updateUniformDate__}else this.updateUniformDate_=this.updateUniformNoop_;m?(l.create(u.UniformMethod.Uniform2f,u.UniformType.Float,"u_mouse",[0,0]),this.updateUniformMouse_=this.updateUniformMouse__):this.updateUniformMouse_=this.updateUniformNoop_,d?(l.create(u.UniformMethod.Uniform3f,u.UniformType.Float,"u_camera",[0,0,0]),this.updateUniformCamera_=this.updateUniformCamera__):this.updateUniformCamera_=this.updateUniformNoop_,this.projectionMatrix=j(),l.create(u.UniformMethod.UniformMatrix4fv,u.UniformType.Float,"u_projectionMatrix",this.projectionMatrix),this.modelViewMatrix=j(),l.create(u.UniformMethod.UniformMatrix4fv,u.UniformType.Float,"u_modelViewMatrix",this.modelViewMatrix),this.normalMatrix=j(),l.create(u.UniformMethod.UniformMatrix4fv,u.UniformType.Float,"u_normalMatrix",this.normalMatrix)},a.update_=function(){var e=this.gl,r=e.drawingBufferWidth,n=e.drawingBufferHeight;if(this.timer){var o=this.timer.next(),f=this.uniforms;f.update(u.UniformMethod.Uniform2f,u.UniformType.Float,"u_resolution",[r,n]),this.updateUniformDelta_(o),this.updateUniformTime_(o),this.updateUniformDate_(),this.updateUniformMouse_(),this.updateUniformCamera_(),this.updateUniformMesh_()}},a.updateUniformNoop_=function(){},a.updateUniformDelta__=function(e){var r=this.uniforms;r.update(u.UniformMethod.Uniform1f,u.UniformType.Float,"u_delta",[e.delta/1e3])},a.updateUniformTime__=function(e){var r=this.uniforms;r.update(u.UniformMethod.Uniform1f,u.UniformType.Float,"u_time",[e.current/1e3])},a.updateUniformDate__=function(){var e=this.uniforms,r=new Date;e.update(u.UniformMethod.Uniform4f,u.UniformType.Float,"u_date",[r.getFullYear(),r.getMonth(),r.getDate(),r.getHours()*3600+r.getMinutes()*60+r.getSeconds()+r.getMilliseconds()*.001])},a.updateUniformMouse__=function(){var e=this.uniforms,r=this.mouse;e.update(u.UniformMethod.Uniform2f,u.UniformType.Float,"u_mouse",[r.x,r.y])},a.updateUniformCamera__=function(){var e=this.uniforms,r=ce.toArray(this.camera);e.update(u.UniformMethod.Uniform3f,u.UniformType.Float,"u_camera",r)},a.updateUniformMesh__=function(){var e=this.uniforms;e.update(u.UniformMethod.UniformMatrix4fv,u.UniformType.Float,"u_projectionMatrix",this.updateProjectionMatrix_()),e.update(u.UniformMethod.UniformMatrix4fv,u.UniformType.Float,"u_modelViewMatrix",this.updateModelViewMatrix_(this.timer.delta)),e.update(u.UniformMethod.UniformMatrix4fv,u.UniformType.Float,"u_normalMatrix",this.updateNormalMatrix_(this.modelViewMatrix))},a.updateUniformFlat__=function(){var e=this.uniforms;e.update(u.UniformMethod.UniformMatrix4fv,u.UniformType.Float,"u_projectionMatrix",j()),e.update(u.UniformMethod.UniformMatrix4fv,u.UniformType.Float,"u_modelViewMatrix",j()),e.update(u.UniformMethod.UniformMatrix4fv,u.UniformType.Float,"u_normalMatrix",j())},a.updateProjectionMatrix_=function(){var e=this.gl,r=45*Math.PI/180,n=e.drawingBufferWidth/e.drawingBufferHeight,o=.1,f=100;return vt(this.projectionMatrix,r,n,o,f),this.projectionMatrix},a.updateModelViewMatrix_=function(e){var r=this.camera,n=this.modelViewMatrix;return n=We(n),ct(n,n,[0,0,-r.radius]),Ne(n,n,r.theta+this.radians,[0,1,0]),Ne(n,n,r.phi,[1,0,0]),r.mouse||(r.theta+=(0-r.theta)/20,r.phi+=(0-r.phi)/20,this.radians+=e*5e-4),n},a.updateNormalMatrix_=function(e){var r=this.normalMatrix;return r=We(r),ht(r,e),ft(r,r),r},a.setMode=function(e){var r=this,n;if(e===R.Mesh&&(n=this.cache[this.mesh],n)){this.geometry=n,this.mode=R.Mesh,this.updateUniformMesh_=this.updateUniformMesh__,this.dirty=!0;return}var o;switch(e){case R.Flat:n=new Z,this.updateUniformMesh_=this.updateUniformNoop_,this.updateUniformFlat__();break;case R.Box:n=new Xe,this.updateUniformMesh_=this.updateUniformMesh__;break;case R.Sphere:n=new ke,this.updateUniformMesh_=this.updateUniformMesh__;break;case R.Torus:n=new He,this.updateUniformMesh_=this.updateUniformMesh__;break;case R.Mesh:n=new Z,this.mesh?(o=new Ye,o.load(N.getResource(this.mesh,this.workpath)).then(function(f){f.createAttributes_(r.gl,r.program);var h={};h[r.mesh]=f,r.cache=h,r.geometry=f,r.dirty=!0},function(f){O.warn("GlslCanvas",f),r.mode=R.Flat})):e=R.Flat,this.updateUniformMesh_=this.updateUniformMesh__;break}n.create(this.gl,this.program),this.geometry=n,this.mode=e,this.dirty=!0},a.setMesh=function(e){this.mesh=e},s}(de),re=function(i){B(s,i);function s(t,e){var r;return e===void 0&&(e={}),r=i.call(this)||this,r.valid=!1,r.visible=!1,r.controls=!1,r.vertexPath="",r.fragmentPath="",t?(r.options=e,r.canvas=t,r.width=0,r.height=0,r.rect=t.getBoundingClientRect(),r.devicePixelRatio=window.devicePixelRatio||1,r.mode=e.mode||R.Flat,r.mesh=e.mesh||void 0,r.doubleSided=e.doubleSided||!1,r.defaultMesh=r.mesh,r.workpath=e.workpath,t.style.backgroundColor=e.backgroundColor||"rgba(0,0,0,0)",r.getShaders_().then(function(n){r.load().then(function(o){r.program&&(r.addListeners_(),r.onLoop())})},function(n){O.error("GlslCanvas.getShaders_.error",n)}),s.items.push(Me(r)),r):Me(r)}var a=s.prototype;return a.getShaders_=function(){var e=this;return new Promise(function(r){e.vertexString=e.options.vertexString||e.vertexString,e.fragmentString=e.options.fragmentString||e.fragmentString;var n=e.canvas,o={};n.hasAttribute("data-vertex-url")&&(o.vertex=n.getAttribute("data-vertex-url")),n.hasAttribute("data-fragment-url")&&(o.fragment=n.getAttribute("data-fragment-url")),n.hasAttribute("data-vertex")&&(e.vertexString=n.getAttribute("data-vertex")),n.hasAttribute("data-fragment")&&(e.fragmentString=n.getAttribute("data-fragment")),Object.keys(o).length?Promise.all(Object.keys(o).map(function(f){var h=N.getResource(o[f],e.workpath);return N.fetch(h).then(function(c){var v=N.dirname(o[f]);return f==="vertex"?(e.vertexPath=v,e.vertexString=c):(e.fragmentPath=v,e.fragmentString=c)})})).then(function(f){r([e.vertexString,e.fragmentString])}):r([e.vertexString,e.fragmentString])})},a.addListeners_=function(){this.onScroll=this.onScroll.bind(this),this.onWheel=this.onWheel.bind(this),this.onClick=this.onClick.bind(this),this.onMove=this.onMove.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onMouseOver=this.onMouseOver.bind(this),this.onMouseOut=this.onMouseOut.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onTouchStart=this.onTouchStart.bind(this),this.onLoop=this.onLoop.bind(this),window.addEventListener("scroll",this.onScroll),document.addEventListener("mousemove",this.onMouseMove,!1),document.addEventListener("touchmove",this.onTouchMove),this.addCanvasListeners_()},a.addCanvasListeners_=function(){this.controls=this.canvas.hasAttribute("controls"),this.canvas.addEventListener("wheel",this.onWheel),this.canvas.addEventListener("click",this.onClick),this.canvas.addEventListener("mousedown",this.onMouseDown),this.canvas.addEventListener("touchstart",this.onTouchStart),this.controls&&(this.canvas.addEventListener("mouseover",this.onMouseOver),this.canvas.addEventListener("mouseout",this.onMouseOut),this.canvas.hasAttribute("data-autoplay")||this.pause())},a.removeCanvasListeners_=function(){this.canvas.removeEventListener("wheel",this.onWheel),this.canvas.removeEventListener("click",this.onClick),this.canvas.removeEventListener("mousedown",this.onMouseDown),this.canvas.removeEventListener("mouseup",this.onMouseUp),this.canvas.removeEventListener("touchstart",this.onTouchStart),this.canvas.removeEventListener("touchend",this.onTouchEnd),this.controls&&(this.canvas.removeEventListener("mouseover",this.onMouseOver),this.canvas.removeEventListener("mouseout",this.onMouseOut))},a.removeListeners_=function(){window.cancelAnimationFrame(this.rafId),window.removeEventListener("scroll",this.onScroll),document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("touchmove",this.onTouchMove),this.removeCanvasListeners_()},a.onScroll=function(e){this.rect=this.canvas.getBoundingClientRect()},a.onWheel=function(e){this.camera.wheel(e.deltaY),this.dirty=this.mode!==R.Flat,this.trigger("wheel",e)},a.onClick=function(e){this.controls&&this.toggle(),this.trigger("click",e)},a.onDown=function(e,r){var n=this.rect;e=e-n.left,r=n.height-(r-n.top);var o=e*this.devicePixelRatio,f=r*this.devicePixelRatio;this.mouse.x=o,this.mouse.y=f;var h=Math.min(n.width,n.height);this.camera.down(e/h,r/h),this.trigger("down",this.mouse)},a.onMove=function(e,r){var n=this.rect;e=e-n.left,r=n.height-(r-n.top);var o=e*this.devicePixelRatio,f=r*this.devicePixelRatio;if(o!==this.mouse.x||f!==this.mouse.y){this.mouse.x=o,this.mouse.y=f;var h=Math.min(n.width,n.height);this.camera.move(e/h,r/h),this.dirty=this.mode!==R.Flat&&this.camera.mouse!==null,this.trigger("move",this.mouse)}},a.onUp=function(e){this.camera.up(),this.controls&&this.pause(),this.trigger("out",e)},a.onMouseDown=function(e){this.onDown(e.clientX,e.clientY),document.addEventListener("mouseup",this.onMouseUp),document.removeEventListener("touchstart",this.onTouchStart),document.removeEventListener("touchmove",this.onTouchMove)},a.onMouseMove=function(e){this.onMove(e.clientX,e.clientY)},a.onMouseUp=function(e){this.onUp(e)},a.onMouseOver=function(e){this.play(),this.trigger("over",e)},a.onMouseOut=function(e){this.pause(),this.trigger("out",e)},a.onTouchStart=function(e){var r=[].slice.call(e.touches).reduce(function(n,o){return n=n||new q,n.x+=o.clientX,n.y+=o.clientY,n},null);r&&this.onDown(r.x/e.touches.length,r.y/e.touches.length),this.controls&&this.play(),this.trigger("over",e),document.addEventListener("touchend",this.onTouchEnd),document.removeEventListener("mousedown",this.onMouseDown),document.removeEventListener("mousemove",this.onMouseMove),this.controls&&(this.canvas.removeEventListener("mouseover",this.onMouseOver),this.canvas.removeEventListener("mouseout",this.onMouseOut))},a.onTouchMove=function(e){var r=[].slice.call(e.touches).reduce(function(n,o){return n=n||new q,n.x+=o.clientX,n.y+=o.clientY,n},null);r&&this.onMove(r.x/e.touches.length,r.y/e.touches.length)},a.onTouchEnd=function(e){this.onUp(e),document.removeEventListener("touchend",this.onTouchEnd)},a.onLoop=function(e){this.checkRender(),this.rafId=window.requestAnimationFrame(this.onLoop)},a.setUniform_=function(e,r,n,o){var f=this;n===void 0&&(n={}),o===void 0&&(o=null);var h=J.parseUniform(e,r,o);if(Array.isArray(h))J.isArrayOfSampler2D(h)?h.forEach(function(c){return f.loadTexture(c.key,c.values[0],n)}):h.forEach(function(c){return f.uniforms.set(c.key,c.values[0])});else if(h)switch(h.type){case u.UniformType.Sampler2D:this.loadTexture(e,r[0],n);break;default:this.uniforms.set(e,h)}},a.isVisible_=function(){var e=this.rect;return e.top+e.height>0&&e.top<(window.innerHeight||document.documentElement.clientHeight)},a.isAnimated_=function(){return(this.animated||this.textures.animated||this.mode!==R.Flat)&&!this.timer.paused},a.isDirty_=function(){return this.dirty||this.uniforms.dirty||this.textures.dirty},a.sizeDidChanged_=function(){var e=this,r=this.gl,n=Math.ceil(this.canvas.clientWidth),o=Math.ceil(this.canvas.clientHeight);if(this.width!==n||this.height!==o){this.width=n,this.height=o;var f=Math.ceil(n*this.devicePixelRatio),h=Math.ceil(o*this.devicePixelRatio);return this.W=f,this.H=h,this.canvas.width=f,this.canvas.height=h,Object.keys(this.buffers.values).forEach(function(c){var v=e.buffers.values[c];v.resize(r,f,h)}),this.rect=this.canvas.getBoundingClientRect(),this.trigger("resize"),!0}else return!1},a.parseTextures_=function(e){for(var r=this,n=/uniform\s*sampler2D\s*([\w]*);(\s*\/\/\s*([\w|\:\/\/|\.|\-|\_|\?|\&|\=]*)|\s*)/gm,o;(o=n.exec(e))!==null;){var f=o[1],h=o[3];K.isTextureUrl(h)?this.textureList.push({key:f,url:h}):this.buffers.has(f)||this.textureList.push({key:f,url:null})}if(this.canvas.hasAttribute("data-textures")){var c=this.canvas.getAttribute("data-textures").split(",");c.forEach(function(v,m){var d="u_texture"+m;r.textureList.push({key:d,url:v})})}return this.textureList.length>0},a.load=function(e,r){var n=this,o=U.getFragmentVertex(this.gl,e||this.fragmentString);return Promise.all([U.getIncludes(e||this.fragmentString,this.fragmentPath===""?this.workpath:this.fragmentPath),U.getIncludes(o||r||this.vertexString,this.vertexPath===""?this.workpath:this.vertexPath)]).then(function(f){return n.fragmentString=f[0],n.vertexString=f[1],n.createContext_()})},a.getContext_=function(){var e=this.vertexString,r=this.fragmentString;if(this.vertexString=U.getVertex(e,r,this.mode),this.fragmentString=U.getFragment(e,r,this.mode),U.versionDiffers(this.gl,e,r)&&(this.destroyContext_(),this.swapCanvas_(),this.uniforms=new J,this.buffers=new te,this.textures=new _e,this.textureList=[]),!this.gl){var n=U.tryInferContext(e,r,this.canvas,this.options,this.options.extensions,this.options.onError);if(!n)return null;this.gl=n}return this.gl},a.createContext_=function(){var e=this.getContext_();if(!e)return!1;var r,n;try{if(U.inferPrecision(this.fragmentString),r=U.createShader(e,this.vertexString,e.VERTEX_SHADER),n=U.createShader(e,this.fragmentString,e.FRAGMENT_SHADER),n)this.valid=!0;else{var o=U.getFragment(null,null,this.mode);n=U.createShader(e,o,e.FRAGMENT_SHADER),this.valid=!1}}catch(h){return this.trigger("error",h),!1}var f=U.createProgram(e,[r,n]);if(!f)return this.trigger("error",U.lastError),!1;if(e.deleteShader(r),e.deleteShader(n),this.program=f,this.valid){try{this.buffers=te.getBuffers(e,this.fragmentString,U.getBufferVertex(e))}catch(h){return this.valid=!1,this.trigger("error",h),!1}this.create_(),this.animated?this.canvas.classList.add("animated"):this.canvas.classList.remove("animated")}return this.trigger("load",this),this.valid},a.create_=function(){this.parseMode_(),this.parseMesh_(),i.prototype.create_.call(this),this.createBuffers_(),this.createTextures_()},a.parseMode_=function(){if(this.canvas.hasAttribute("data-mode")){var e=this.canvas.getAttribute("data-mode");["flat","box","sphere","torus","mesh"].indexOf(e)!==-1&&(this.mode=e)}},a.parseMesh_=function(){if(this.canvas.hasAttribute("data-mesh")){var e=this.canvas.getAttribute("data-mesh");e.indexOf(".obj")!==-1&&(this.mesh=this.defaultMesh=e)}},a.createBuffers_=function(){var e=this;Object.keys(this.buffers.values).forEach(function(r){var n=e.buffers.values[r];e.uniforms.create(u.UniformMethod.Uniform1i,u.UniformType.Sampler2D,n.key,[n.input.index])})},a.createTextures_=function(){var e=this,r=this.parseTextures_(this.fragmentString);r&&(this.textureList.filter(function(n){return n.url}).forEach(function(n){e.setTexture(n.key,n.url,n.options)}),this.textureList=[])},a.update_=function(){i.prototype.update_.call(this),this.updateBuffers_(),this.updateTextures_()},a.updateBuffers_=function(){var e=this;Object.keys(this.buffers.values).forEach(function(r){var n=e.buffers.values[r];e.uniforms.update(u.UniformMethod.Uniform1i,u.UniformType.Sampler2D,n.key,[n.input.index])})},a.updateTextures_=function(){var e=this,r=this.gl;Object.keys(this.textures.values).forEach(function(n){var o=e.textures.values[n];o.tryUpdate(r),e.uniforms.update(u.UniformMethod.Uniform1i,u.UniformType.Sampler2D,o.key,[o.index])})},a.destroyContext_=function(){var e=this,r=this.gl;r.useProgram(null),this.program&&r.deleteProgram(this.program),Object.keys(this.buffers.values).forEach(function(n){var o=e.buffers.values[n];o.destroy(r)}),Object.keys(this.textures.values).forEach(function(n){var o=e.textures.values[n];o.destroy(r)}),this.buffers=null,this.textures=null,this.uniforms=null,this.program=null,this.gl=null},a.swapCanvas_=function(){var e=this.canvas,r=e.cloneNode();e.parentNode.replaceChild(r,e),this.canvas=r,this.addCanvasListeners_()},a.destroy=function(){this.removeListeners_(),this.destroyContext_(),this.animated=!1,this.valid=!1;var e=s.items.indexOf(this);e!==-1&&s.items.splice(e,1)},a.loadTexture=function(e,r,n){var o=this;n===void 0&&(n={}),this.valid?this.textures.createOrUpdate(this.gl,e,r,this.buffers.count,n,this.options.workpath).then(function(f){var h=f.index,c=o.uniforms.createTexture(e,h);c.texture=f;var v=e.indexOf("[")!==-1?e.replace("[","Resolution["):e+"Resolution";return o.uniforms.create(u.UniformMethod.Uniform2f,u.UniformType.Float,v,[f.width,f.height]),f},function(f){var h=Array.isArray(f.path)?f.path.map(function(c){return c.error?c.error.message:""}).join(", "):f.message;O.error("GlslCanvas.loadTexture.error",e,r,h),o.trigger("textureError",{key:e,urlElementOrData:r,message:h})}):this.textureList.push({key:e,url:r,options:n})},a.setTexture=function(e,r,n){return n===void 0&&(n={}),this.setUniform_(e,[r],n)},a.setUniform=function(e){for(var r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];return this.setUniform_(e,n)},a.setUniformOfInt=function(e,r){return this.setUniform_(e,r,null,u.UniformType.Int)},a.setUniforms=function(e){var r=this;Object.keys(e).forEach(function(n){r.setUniform(n,e[n])})},a.pause=function(){this.valid&&(this.timer.pause(),this.canvas.classList.add("paused"),this.trigger("pause"))},a.play=function(){this.valid&&(this.timer.play(),this.canvas.classList.remove("paused"),this.trigger("play"))},a.toggle=function(){this.valid&&(this.timer.paused?this.play():this.pause())},a.checkRender=function(){this.isVisible_()&&(this.sizeDidChanged_()||this.isDirty_()||this.isAnimated_())?(this.render(),this.canvas.classList.add("playing")):this.canvas.classList.remove("playing")},s}($e);re.items=[];function Je(i,s){return re.items.find(function(a){return a.canvas===i})||new re(i,s)}function Qe(){var i=[].slice.call(document.getElementsByClassName("glsl-canvas")).filter(function(s){return s instanceof HTMLCanvasElement});return i.map(function(s){return Je(s)})}typeof window=="object"&&document.addEventListener("DOMContentLoaded",function(){Qe()}),u.BoxGeometry=Xe,u.Buffer=ee,u.Buffers=te,u.Canvas=re,u.CanvasTimer=ze,u.Common=N,u.Context=U,u.ContextVertexBuffers=Ge,u.DefaultWebGL2BufferFragment=Oe,u.DefaultWebGL2BufferVertex=Pe,u.DefaultWebGL2FlatFragment=we,u.DefaultWebGL2MeshFragment=Se,u.DefaultWebGL2MeshVertex=fe,u.DefaultWebGLBufferFragment=Ce,u.DefaultWebGLBufferVertex=De,u.DefaultWebGLFlatFragment=Fe,u.DefaultWebGLMeshFragment=Re,u.DefaultWebGLMeshVertex=ue,u.FlatGeometry=Z,u.Geometry=G,u.IOBuffer=Ie,u.IterableStringMap=Q,u.Listener=ve,u.Logger=O,u.METHODS_FLOAT=Te,u.METHODS_FLOATV=be,u.METHODS_INT=pe,u.METHODS_INTV=Ee,u.ObjLoader=Ye,u.OrbitCamera=ce,u.Renderer=$e,u.SphereGeometry=ke,u.Subscriber=de,u.Texture=K,u.TextureExtensions=dt,u.TextureImageExtensions=qe,u.TextureVideoExtensions=le,u.Textures=_e,u.TorusGeometry=He,u.Uniform=$,u.UniformTexture=ye,u.Uniforms=J,u.Vector2=q,u.Vector3=C,u.isTextureData=Ke,u.loadAll=Qe,u.of=Je,Object.defineProperty(u,"__esModule",{value:!0})})})(Ue,Ue.exports);var gt=Ue.exports;function xt(ie){const X=document.getElementById(ie),u={backgroundColor:"rgba(0.0, 0.0, 0.0, 0.0)",alpha:!0,antialias:!0,extensions:["EXT_shader_texture_lod"],mode:"mesh"},z=new gt.Canvas(X,u),ne=new URL("./sun.glsl",import.meta.url).href;_t(ne).then(B=>{z.load(B)})}const At=["id"],Lt=pt({__name:"index",setup(ie){const X=Tt("webgl-");return requestAnimationFrame(()=>{xt(X)}),(u,z)=>(bt(),Et("canvas",{id:Ut(X)},[...z[0]||(z[0]=[Ze("  HTML5 ",-1),yt("code",null,"<canvas>",-1),Ze("  ",-1)])],8,At))}}),wt=Mt(Lt,[["__scopeId","data-v-be83c038"]]);export{wt as default};
