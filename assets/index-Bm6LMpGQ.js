var Oe=Object.defineProperty;var Ie=r=>{throw TypeError(r)};var Ue=(r,e,t)=>e in r?Oe(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var d=(r,e,t)=>Ue(r,typeof e!="symbol"?e+"":e,t),we=(r,e,t)=>e.has(r)||Ie("Cannot "+t);var v=(r,e,t)=>(we(r,e,"read from private field"),t?t.call(r):e.get(r)),k=(r,e,t)=>e.has(r)?Ie("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),ee=(r,e,t,n)=>(we(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t);import{d as J,c as U,o as A,W as V,bg as Ve,b5 as be,az as pe,b as h,w as m,u as f,e as R,_ as ce,ao as ge,p as W,aw as Ne,bh as _e,at as Ae,bd as ke,bi as Fe,A as ve,ae as xe,Z as Ce,af as Be,t as L,a1 as fe,R as he,ag as We,as as $,B as se,a7 as ze,a8 as $e,a3 as oe,a9 as Ge,bj as Xe,bk as Ye}from"./index-DpK4wnXH.js";import{R as je}from"./ResponsiveDirectionLayout-ff-bq-w2.js";import{N as F}from"./InputGroupLabel-_p6g7Oix.js";import{N as me}from"./Select-COw_-uoh.js";import{N as te}from"./InputGroup-B9MRcsII.js";import{N as He}from"./InputNumber-Cf-oBWcT.js";import{N as Ke}from"./Slider-b5LP2GFf.js";import{S as ye}from"./Scrollbar-BYDHE4Wf.js";import{N as qe}from"./Image-nhNmH1CE.js";import{N as ae}from"./text-CgiMGVj7.js";import{a as Je}from"./headers-C7Ey2318.js";import{N as Ze}from"./ButtonGroup-eL4i-MGK.js";import{N as Qe,a as et,b as tt}from"./Upload-XOSf44yh.js";import{A as at}from"./Add-mLH6kked.js";import{C as nt}from"./CloudDownloadOutline-U5rXpPoi.js";import"./Suffix-CdLf3VPI.js";import"./attribute-Cz32yFEB.js";import"./Empty-CAY4mSm_.js";import"./use-locale-BR6zCv3W.js";import"./Input-Cu1fa9qi.js";import"./_createCompounder-CuZLthUo.js";import"./Progress-BPArtsA0.js";const it={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},rt=V("path",{d:"M112 111v290c0 17.44 17 28.52 31 20.16l247.9-148.37c12.12-7.25 12.12-26.33 0-33.58L143 90.84c-14-8.36-31 2.72-31 20.16z",fill:"none",stroke:"currentColor","stroke-miterlimit":"10","stroke-width":"32"},null,-1),st=[rt],ot=J({name:"PlayOutline",render:function(e,t){return A(),U("svg",it,st)}}),lt={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},ut=V("rect",{x:"96",y:"96",width:"320",height:"320",rx:"24",ry:"24",fill:"none",stroke:"currentColor","stroke-linejoin":"round","stroke-width":"32"},null,-1),ct=[ut],dt=J({name:"StopOutline",render:function(e,t){return A(),U("svg",lt,ct)}});var M=(r=>(r.LE="le",r.BE="be",r.LittleEndian="le",r.BigEndian="be",r))(M||{});function q(r){const e=n=>n.toString().padStart(2,"0");return`${e(Math.floor(r/60))}:${e(Math.floor(r%60))}`}function ft(r,e){const{audioBasicInfo:t,fileSize:n,fileName:a}=r,i=a.lastIndexOf("."),s=i>0?a.substring(i+1):"异常！",l=q(t.startTime||0);return{...t,name:a,currentTime:l,totalDuration:q(e),size:Ve(n),type:s.toLocaleUpperCase()}}const ht={class:"options-panel"},mt=J({__name:"options",props:{volume:{required:!0},volumeModifiers:{},options:{required:!0},optionsModifiers:{}},emits:["update:volume","update:options"],setup(r){const e=be(r,"volume"),t=be(r,"options");return(n,a)=>(A(),U("div",ht,[pe(n.$slots,"prefix",{},void 0,!0),h(f(te),null,{default:m(()=>[h(f(F),null,{default:m(()=>[...a[5]||(a[5]=[R("采样率",-1)])]),_:1}),h(f(me),{value:t.value.sampleRate,"onUpdate:value":a[0]||(a[0]=i=>t.value.sampleRate=i),options:[8e3,16e3,22050,24e3,44100,48e3,96e3,192e3].map(i=>({label:String(i),value:i}))},null,8,["value","options"]),h(f(F),null,{default:m(()=>[...a[6]||(a[6]=[R("Hz",-1)])]),_:1})]),_:1}),h(f(te),null,{default:m(()=>[h(f(F),null,{default:m(()=>[...a[7]||(a[7]=[R("位深",-1)])]),_:1}),h(f(me),{value:t.value.bitDepth,"onUpdate:value":a[1]||(a[1]=i=>t.value.bitDepth=i),options:[8,16,24,32].map(i=>({label:String(i),value:i}))},null,8,["value","options"]),h(f(F),null,{default:m(()=>[...a[8]||(a[8]=[R("bit",-1)])]),_:1})]),_:1}),h(f(te),null,{default:m(()=>[h(f(F),null,{default:m(()=>[...a[9]||(a[9]=[R("声道数",-1)])]),_:1}),h(f(He),{value:t.value.channelCount,"onUpdate:value":a[2]||(a[2]=i=>t.value.channelCount=i),min:1,precision:0},null,8,["value"]),h(f(F),null,{default:m(()=>[...a[10]||(a[10]=[R("ch",-1)])]),_:1})]),_:1}),h(f(te),null,{default:m(()=>[h(f(F),null,{default:m(()=>[...a[11]||(a[11]=[R("字节序",-1)])]),_:1}),h(f(me),{value:t.value.endianness,"onUpdate:value":a[3]||(a[3]=i=>t.value.endianness=i),options:[{label:"小端序",value:f(M).LE},{label:"大端序",value:f(M).BE}]},null,8,["value","options"])]),_:1}),h(f(te),null,{default:m(()=>[h(f(F),null,{default:m(()=>[...a[12]||(a[12]=[R("音量",-1)])]),_:1}),h(f(Ke),{value:e.value,"onUpdate:value":a[4]||(a[4]=i=>e.value=i),min:0,max:1,step:.01},null,8,["value"])]),_:1}),pe(n.$slots,"suffix",{},void 0,!0)]))}}),pt=ce(mt,[["__scopeId","data-v-4f7165fd"]]),gt=["id"],vt=J({__name:"HandleFileDrag",emits:["drop-callback"],setup(r,{emit:e}){const t=e,n=ge("handle-file-drag-"),a=W(!1);function i(u){if(u.preventDefault(),u.stopPropagation(),!u.dataTransfer){a.value=!1;return}const o=u.dataTransfer.types;a.value=o.includes("Files")}function s(u){i(u)}function l(u){u.target.id==n&&(a.value=!1)}function c(u){var g;u.preventDefault(),u.stopPropagation(),a.value=!1;const o=(g=u.dataTransfer)==null?void 0:g.files;t("drop-callback",Array.from(o||[]))}return(u,o)=>{var g,D;return A(),U("div",{id:f(n),class:Ae(["handle-file-drag",a.value&&"file-drop-hint"]),style:Ne({"--color":((D=(g=f(_e).theme)==null?void 0:g.common)==null?void 0:D.successColor)||"#63e2b7"}),"drag-tip":"请将音频文件拖拽至此",onDragenter:i,onDragover:s,onDragleave:l,onDrop:c},[pe(u.$slots,"default",{},void 0,!0)],46,gt)}}}),Ct=ce(vt,[["__scopeId","data-v-bf2639f9"]]);class yt{constructor(){d(this,"config");d(this,"barWidth",2);d(this,"barGap",2);d(this,"barCount",0);d(this,"barColor","#2080f0");d(this,"amplitudeValues",[]);d(this,"amplitudeBarMetrics",[]);d(this,"lastTimelineX")}init(e){this.config=e,this.lastTimelineX=void 0,this.calculateAmplitudeData(),this.calculateAmplitudeBarMetrics(),this.render(0)}render(e){if(!this.config)return;const{canvasContext:t}=this.config,{amplitudeBarMetrics:n,barColor:a,barWidth:i}=this,{width:s,height:l}=t.canvas,c=Math.floor((s-2)*e);this.lastTimelineX!=c&&(this.lastTimelineX=c,t.clearRect(0,0,s,l),t.fillStyle=a,n.forEach(({x:u,y:o,height:g})=>{c<=u&&(t.fillStyle="#B1B1B1FF"),t.fillRect(u,o,i,g)}),t.fillStyle=a,t.fillRect(c,0,2,l))}calculateAmplitudeData(){if(!this.config)return;const{canvasContext:e,audioBuffer:t,channelCount:n}=this.config,{barWidth:a,barGap:i}=this;this.barCount=Math.floor(e.canvas.width/(a+i));const s=t.length,l=Array.from({length:n},(u,o)=>t.getChannelData(o)),c=Math.floor(s/this.barCount);this.amplitudeValues=[];for(let u=0;u<this.barCount;u++){const o=u*c,g=l.reduce((D,w)=>{const N=w.slice(o,o+c).reduce((Q,_)=>Q+_**2,0),Z=Math.sqrt(N/c);return D+Z},0);this.amplitudeValues.push(g)}}calculateAmplitudeBarMetrics(){var u;const e=(u=this.config)==null?void 0:u.canvasContext.canvas;if(!e)return;const{barWidth:t,barGap:n,barCount:a,amplitudeValues:i}=this,s=e.height,l=e.height/2;let c=0;this.amplitudeBarMetrics=[];for(let o=0;o<a;o++){const g=s*i[o];this.amplitudeBarMetrics.push({x:c,y:l-g/2,height:g}),c+=t+n}}clear(){this.amplitudeValues=[],this.amplitudeBarMetrics=[]}}class Et{constructor(){d(this,"config");d(this,"channelColors",["#5470c6","#91cc75","#fac858","#ee6666","#73c0de","#3ba272","#fc8452","#9a60b4","#ea7ccc"]);d(this,"channelRenderHeight",0);d(this,"waveformDataSize",0);d(this,"waveformDataCount",0);d(this,"channelAmplitudeData",[]);d(this,"lastRenderedStartIndex")}init(e){this.config=e,this.lastRenderedStartIndex=void 0,this.channelRenderHeight=Math.floor(e.canvasContext.canvas.height/e.channelCount),this.preprocessAudioData(),this.renderChannelBaseLines()}renderChannelBaseLines(){const{config:e,channelColors:t,channelRenderHeight:n}=this;if(!e)return;const{channelCount:a,canvasContext:i}=e,{width:s}=i.canvas;i.clearRect(0,0,s,i.canvas.height);for(let l=0;l<a;l++){const c=t[l%t.length];i.fillStyle=c;const u=l*n+n/2;i.fillRect(0,u,s,1)}}render(e){const{channelRenderHeight:t,channelAmplitudeData:n,config:a,channelColors:i,waveformDataSize:s,waveformDataCount:l}=this;if(!a||!n.length)return;const{channelCount:c,canvasContext:u}=a,{width:o,height:g}=u.canvas,D=Math.floor(Math.min(l*e,l-1));if(this.lastRenderedStartIndex!==D){this.lastRenderedStartIndex=D,u.clearRect(0,0,o,g);for(let w=0;w<c;w++){const N=i[w%i.length];u.fillStyle=N;const Z=t*w+t/2,Q=n[w][D];for(let _=0;_<s;_++){const ne=Math.floor(Z-t/2*Q[_]);u.fillRect(_,ne,1,1)}}}}preprocessAudioData(){if(!this.config)return;const{canvasContext:e,audioBuffer:t,channelCount:n}=this.config,a=Math.floor(e.canvas.width),i=Math.floor(t.length/a);this.waveformDataSize=a,this.waveformDataCount=i,this.channelAmplitudeData=Array.from({length:n}).map(()=>new Array(i));for(let s=0;s<n;s++){const l=t.getChannelData(s);for(let c=0;c<i;c++){const u=c*a;this.channelAmplitudeData[s][c]=l.slice(u,u+a)}}}clear(){this.channelAmplitudeData=[]}}class Rt{constructor(){d(this,"audioContext");d(this,"isPlaying",!1);d(this,"source");d(this,"audioBuffer");d(this,"gainNode");d(this,"currentVolume",1);d(this,"startTime",0);d(this,"duration",0);d(this,"playStartTime",0);d(this,"offsetTime");d(this,"options",{sampleRate:16e3,channelCount:1,bitDepth:16,startTime:0,duration:0,endianness:M.LE,volume:1});d(this,"onPlayCompleted");d(this,"playProgressCallback")}get totalDuration(){return this.audioBuffer?this.audioBuffer.duration:0}get ready(){return!!this.audioContext}setVolume(e){if(!this.gainNode){console.warn("增益节点未初始化，请先调用 init()");return}const t=Math.max(0,Math.min(1,e));this.currentVolume=t,this.gainNode.gain.value=t}init(){if(!this.audioContext){const e=window.AudioContext||window.webkitAudioContext;this.audioContext=new e,this.gainNode=this.audioContext.createGain(),this.gainNode.connect(this.audioContext.destination),this.gainNode.gain.value=this.currentVolume}}async initPCM(e,t={}){if(this.init(),!this.audioContext){console.error("音频上下文初始化失败");return}Object.assign(this.options,t);const{sampleRate:n,channelCount:a,bitDepth:i,startTime:s,duration:l,endianness:c,volume:u}=this.options;this.startTime=s,this.duration=l,this.offsetTime=void 0,this.setVolume(u),await this.stop();try{const o=this.convertPCMToFloat32(e,i,c);this.audioBuffer=this.audioContext.createBuffer(a,o.length/a,n);for(let g=0;g<a;g++){const D=this.audioBuffer.getChannelData(g);for(let w=0;w<D.length;w++)D[w]=o[w*a+g]}}catch(o){console.error("播放 PCM 失败：",o)}}convertPCMToFloat32(e,t,n=M.LE){const a=new DataView(e),i=t/8,s=n===M.LE,l=Math.floor(e.byteLength/i),c=new Float32Array(l);for(let u=0;u<l;u++){const o=u*i;switch(t){case 8:c[u]=(a.getUint8(o)-128)/128;break;case 16:c[u]=a.getInt16(o,s)/32768;break;case 24:let g;s?g=a.getUint8(o)|a.getUint8(o+1)<<8|a.getUint8(o+2)<<16:g=a.getUint8(o)<<16|a.getUint8(o+1)<<8|a.getUint8(o+2),g&8388608&&(g|=4278190080),c[u]=g/8388608;break;case 32:c[u]=a.getInt32(o,s)/2147483648;break}}return c}async playFromPosition(e=0,t=0){if(!this.audioBuffer||!this.audioContext){console.error("请先加载 PCM 数据");return}this.isPlaying&&await this.stop();const n=this.audioBuffer.duration,a=Math.max(0,Math.min(e,n)),i=t>0?Math.min(t,n-a):void 0;this.source=this.audioContext.createBufferSource(),this.source.buffer=this.audioBuffer,this.source.connect(this.gainNode),this.source.start(0,a,i),this.isPlaying=!0,this.playStartTime=this.audioContext.currentTime,this.source.onended=()=>{var s,l;this.updatePlayProgress(),this.isPlaying=!1,typeof this.offsetTime=="number"&&(this.offsetTime+=(((s=this.audioContext)==null?void 0:s.currentTime)||0)-this.playStartTime),(l=this.onPlayCompleted)==null||l.call(this)}}updatePlayProgress(){const{isPlaying:e,audioContext:t,audioBuffer:n,offsetTime:a,playStartTime:i,playProgressCallback:s}=this;if(!e||!t||!n||!s)return;const l=(a||0)+(t.currentTime-i),c=l/n.duration,u=l.toFixed(2),o=n.duration.toFixed(2),g=Math.min(1,c).toFixed(6);s(u,o,g),requestAnimationFrame(()=>this.updatePlayProgress())}async play(e){if(typeof e=="number")await this.stop(),this.offsetTime=e;else{if(this.isPlaying)return;const{startTime:t,offsetTime:n}=this;(!n||n+t>=this.totalDuration)&&(this.offsetTime=0)}this.playFromPosition(this.startTime+this.offsetTime,this.duration),this.updatePlayProgress()}async stop(){this.source&&(this.source.stop(),this.source.disconnect(),this.source=void 0,await ke(()=>!this.isPlaying,500))}clear(){this.stop(),this.isPlaying=!1,this.audioBuffer=void 0}}class It{constructor(){d(this,"audioSpectrum",new yt);d(this,"audioSpectrumCanvas",document.createElement("canvas"));d(this,"audioSpectrumCtx",this.audioSpectrumCanvas.getContext("2d"));d(this,"audioSpectrumHeight",100);d(this,"audioWaveform",new Et);d(this,"audioWaveformCanvas",document.createElement("canvas"));d(this,"audioWaveformCtx",this.audioWaveformCanvas.getContext("2d"));d(this,"audioWaveformHeight",100);d(this,"audioPlayer",new Rt);d(this,"canvas");d(this,"ctx");d(this,"onPlayCompleted");d(this,"playProgressCallback");this.audioPlayer.onPlayCompleted=()=>{var e;(e=this.onPlayCompleted)==null||e.call(this)},this.audioPlayer.playProgressCallback=(e,t,n)=>{var i;const a=Number(n);this.render(a),(i=this.playProgressCallback)==null||i.call(this,e,t,n)}}get totalDuration(){return this.audioPlayer.totalDuration}async init(e){await this.initPCM(e),this.audioPlayer.ready&&this.initCanvas(e)}async initPCM(e){const{audioPlayer:t}=this,{pcmData:n,pcmOptions:a}=e;await t.initPCM(n,a)}initCanvas(e){const{audioPlayer:t,audioSpectrumCanvas:n,audioSpectrumCtx:a,audioSpectrumHeight:i,audioWaveformCanvas:s,audioWaveformCtx:l,audioWaveformHeight:c}=this,{canvas:u}=e,o=t.options.channelCount,g=t.audioBuffer,D=t.totalDuration,w=Math.floor(u.getBoundingClientRect().width);if(u.width=w,u.height=c*o+i,this.canvas=u,this.ctx=u.getContext("2d"),!this.ctx||!a||!l){console.error("Canvas 上下文不可用。");return}n.width=w,n.height=i,s.width=w,s.height=c*o;const N={channelCount:o,audioBuffer:g,duration:D};this.audioWaveform.init({...N,canvasContext:l}),this.audioSpectrum.init({...N,canvasContext:a}),this.ctx.drawImage(s,0,0),this.ctx.drawImage(n,0,s.height)}render(e){const{canvas:t,ctx:n,audioSpectrum:a,audioSpectrumCanvas:i,audioWaveform:s,audioWaveformCanvas:l}=this;if(!t||!n){console.error("Canvas 不可用。");return}n.clearRect(0,0,t.width,t.height),a.render(e),s.render(e),n.drawImage(l,0,0),n.drawImage(i,0,l.height)}setVolume(e){this.audioPlayer.setVolume(e)}play(e){return this.audioPlayer.play(e)}stop(){this.audioPlayer.stop()}clear(){this.audioPlayer.clear(),this.audioSpectrum.clear(),this.audioWaveform.clear();const{ctx:e,canvas:t}=this;e&&t&&e.clearRect(0,0,t.width,t.height)}}const De=["Blues","Classic Rock","Country","Dance","Disco","Funk","Grunge","Hip-Hop","Jazz","Metal","New Age","Oldies","Other","Pop","R&B","Rap","Reggae","Rock","Techno","Industrial","Alternative","Ska","Death Metal","Pranks","Soundtrack","Euro-Techno","Ambient","Trip-Hop","Vocal","Jazz+Funk","Fusion"];function j(r,e,t){const n=r.subarray(e,t),a=n.findIndex(l=>l===0),i=a===-1?n:n.subarray(0,a),s=new TextDecoder("ascii").decode(i).trim();return s===""?"-":s}function wt(r){return r<De.length?De[r]:"Unknown"}function bt(r){const e=new Uint8Array(r);if(e.length<128)return null;const t=e.subarray(e.length-128);if(t[0]!==84||t[1]!==65||t[2]!==71)return null;const n=t[125],a=t[126];let i=n===0;if(i&&(a<1||a>99)&&(i=!1),i){const c=t.subarray(97,125);Array.from(c).every(o=>o===0||o===32)&&a!==0&&a!==32&&(i=!1)}let s,l;return i?(s=j(t,97,125),l=a):(s=j(t,97,127),l=0),{title:j(t,3,33),artist:j(t,33,63),album:j(t,63,93),year:j(t,93,97),comment:s,track:l,genre:wt(t[127]),isID3v1_1:i}}const Te={2.2:{TT2:"标题",TP1:"艺术家",TAL:"专辑",TYE:"年份",COM:"评论",TRK:"音轨号",TCO:"流派",PIC:"附加图片",TCM:"作曲家",TCR:"版权信息",TBP:"播放速度",TLE:"时长",TLA:"语言",TPB:"发行商"},2.3:{TIT2:"标题",TPE1:"艺术家",TALB:"专辑",TYER:"年份",COMM:"评论",TRCK:"音轨号",TCON:"流派",APIC:"附加图片",TCOM:"作曲家",TCOP:"版权信息",TBPM:"播放速度",TLEN:"时长",TLAN:"语言",TPUB:"发行商",TIT3:"副标题",TPE2:"乐队",TPE3:"指挥",TPE4:"改编者",TOPE:"原艺术家",TOAL:"原专辑",TSRC:"ISRC码",TENC:"编码者",TEXT:"歌词作者",TOWN:"文件所有者",TPOS:"音轨集位置",TRDA:"录制日期",TXXX:"用户自定义文本",USLT:"非同步歌词",SYLT:"同步歌词",UFID:"唯一文件标识",RBUF:"推荐缓冲区大小",RVAD:"相对音量调整",RVRB:"混响",ETCO:"事件定时码",MLLT:"MPEG位置查找表",SYTC:"同步节奏码",IPLS:"参与人员列表",MCDI:"音乐CD标识符",GEOB:"通用封装对象",PCNT:"播放计数器",POPM:"流行度计量",AENC:"音频加密",LINK:"链接信息",POSS:"位置同步帧",USER:"使用条款",OWNE:"所有权帧",ENCR:"加密方法注册",GRID:"组标识注册",PRIV:"私有帧",COMR:"商业帧",EQUA:"均衡器",WCOM:"商业信息URL",WCOP:"版权信息URL",WOAF:"官方音频文件URL",WOAR:"官方艺术家URL",WOAS:"官方音频源URL",WORS:"官方电台URL",WPAY:"支付信息URL",WPUB:"官方发行商URL",WXXX:"用户自定义URL"},2.4:{TIT2:"标题",TPE1:"艺术家",TALB:"专辑",TYER:"年份",COMM:"评论",TRCK:"音轨号",TCON:"流派",APIC:"附加图片",TCOM:"作曲家",TCOP:"版权信息",TBPM:"播放速度",TLEN:"时长",TLAN:"语言",TPUB:"发行商",TIT3:"副标题",TPE2:"乐队",TPE3:"指挥",TPE4:"改编者",TOPE:"原艺术家",TOAL:"原专辑",TSRC:"ISRC码",TENC:"编码者",TEXT:"歌词作者",TOWN:"文件所有者",TPOS:"音轨集位置",TRDA:"录制日期",TXXX:"用户自定义文本",USLT:"非同步歌词",SYLT:"同步歌词",UFID:"唯一文件标识",RBUF:"推荐缓冲区大小",RVAD:"相对音量调整",RVRB:"混响",ETCO:"事件定时码",MLLT:"MPEG位置查找表",SYTC:"同步节奏码",IPLS:"参与人员列表",MCDI:"音乐CD标识符",GEOB:"通用封装对象",PCNT:"播放计数器",POPM:"流行度计量",AENC:"音频加密",LINK:"链接信息",POSS:"位置同步帧",USER:"使用条款",OWNE:"所有权帧",ENCR:"加密方法注册",GRID:"组标识注册",PRIV:"私有帧",COMR:"商业帧",EQUA:"均衡器",WCOM:"商业信息URL",WCOP:"版权信息URL",WOAF:"官方音频文件URL",WOAR:"官方艺术家URL",WOAS:"官方音频源URL",WORS:"官方电台URL",WPAY:"支付信息URL",WPUB:"官方发行商URL",WXXX:"用户自定义URL"}};class Dt{constructor(e,t=0){d(this,"buffer");d(this,"offset",0);d(this,"offsetBase",0);d(this,"version","");d(this,"frameIdMap",{});this.buffer=e,this.offsetBase=t}initVersion(e){return this.version=`2.${e}`,this.frameIdMap=Te[this.version],!!this.frameIdMap}syncSafeInteger(e){return e[0]<<21|e[1]<<14|e[2]<<7|e[3]}cleanString(e){return e.replace(/\0/g,"").trim()}readID3String(e,t){if(t<=0)return"";const n=new Uint8Array(this.buffer,e,t);let a="";switch(n[0]){case 1:if(t>=2)try{a=new TextDecoder("utf-16",{ignoreBOM:!0}).decode(n.subarray(1))}catch{a=this.readIso88591String(e+1,t-1)}break;case 2:if(t>=2)try{a=new TextDecoder("utf-16be").decode(n.subarray(1))}catch{a=this.readIso88591String(e+1,t-1)}break;case 3:if(t>=2)try{a=new TextDecoder("utf-8").decode(n.subarray(1))}catch{a=this.readIso88591String(e+1,t-1)}break;case 0:a=this.readIso88591String(e+1,t-1);break;default:try{a=new TextDecoder("utf-8",{fatal:!0}).decode(n)}catch{a=this.readIso88591String(e,t)}break}return this.cleanString(a)}readIso88591String(e,t){const n=new Uint8Array(this.buffer,e,t);return Array.from(n).map(a=>String.fromCharCode(a)).join("")}readAsciiString(e,t){const n=new Uint8Array(this.buffer,e,t);return Array.from(n).map(a=>a===0?"":String.fromCharCode(a)).join("")}readUInt24BE(e){const t=new Uint8Array(this.buffer);return t[e]<<16|t[e+1]<<8|t[e+2]}readUInt32BE(e){return new DataView(this.buffer).getUint32(e,!1)}parseAPICFrame(e,t){if(t<=0)return null;const n=new Uint8Array(this.buffer,e,t);let a=0;if(this.version!=="2.2"&&(a+=1,a>=t))return null;const i=n.subarray(a).findIndex(c=>c===0);if(i===-1)return null;let s=this.readAsciiString(e+a,i);if(a+=i+1,a>=t||(s==="JPG"||s==="JPEG"?s="image/jpeg":s==="PNG"?s="image/png":s==="GIF"&&(s="image/gif"),a+=1,a>=t))return null;const l=n.subarray(a).findIndex(c=>c===0);return l===-1||(a+=l+1,a>=t)?null:{mime:s,data:this.buffer.slice(e+a,e+t)}}parseFrame(e,t,n,a){const i=this.readID3String(n,a),s=this.frameIdMap[t]||t;let l=i;t=="TRCK"?l=parseInt(i)||0:t=="APIC"&&(l=this.parseAPICFrame(n,a),e.audioCover=l),e[s]=l}validateTagId(){return this.readAsciiString(this.offset,3)==="ID3"}getVersion(){if(this.offset=this.offsetBase,this.buffer.byteLength<this.offset+10||!this.validateTagId())return null;const n=`2.${new Uint8Array(this.buffer)[this.offset+3]}`;return Te[n]?n:null}commonParse(e,t,n){this.offset=this.offsetBase;try{if(this.buffer.byteLength<this.offset+10||!this.validateTagId())return null;const a=new Uint8Array(this.buffer),i=a[this.offset+3];if(!this.initVersion(i))return null;const s=this.calculateTagSize(a),l={版本:this.version,标签大小:s+10};let c=this.offset+10;const u=this.offset+10+s;for(;c+t<=u&&c+t<=this.buffer.byteLength;){const o=this.readAsciiString(c,e);if(!o||o.replace(/\0/g,"")==="")break;const g=n(c+e);if(g<=0||c+t+g>this.buffer.byteLength){c+=t+g;continue}this.parseFrame(l,o,c+t,g),c+=t+g}return l}catch(a){return console.error(`ID3v${this.version} 解析失败:`,a),null}}calculateTagSize(e){if(this.version==="2.2")return this.readUInt24BE(this.offset+6);{const t=[e[this.offset+6],e[this.offset+7],e[this.offset+8],e[this.offset+9]];return this.syncSafeInteger(t)}}}class Tt extends Dt{ID3v22Parser(){return this.commonParse(3,6,e=>this.readUInt24BE(e))}ID3v23Parser(){return this.commonParse(4,10,e=>this.readUInt32BE(e))}ID3v24Parser(){return this.commonParse(4,10,e=>this.readUInt32BE(e))}parse(){const e=this.getVersion();if(!e)return null;switch(e){case"2.4":return this.ID3v24Parser();case"2.3":return this.ID3v23Parser();case"2.2":return this.ID3v22Parser();default:return null}}}function Pt(r){return new Tt(r).parse()}const H={offset:-1,isValid:!1,syncWord:0,mpegVersion:"Unknown",layer:"Unknown",protectionBit:!1,crcValid:null,bitrateIndex:-1,bitrate:0,sampleRateIndex:-1,sampleRate:0,sampleRateExtension:!1,bitrateExtension:!1,paddingBit:!1,privateBit:!1,frameSize:0,frameDuration:0,channelMode:"Unknown",modeExtension:-1,copyright:!1,original:!1,emphasis:-1},B=class B{constructor(e){d(this,"dataView");this.dataView=new DataView(e)}parseFrameHeaderWithError(e){var c,u;if(e+4>this.dataView.byteLength){const o={offset:e,errorType:"偏移量越界",errorMsg:`偏移量${e}超出buffer范围（总长度${this.dataView.byteLength}）`};return{frameHeader:{...H,offset:e},errorDetail:o}}const t=this.readHeaderBytes(e);if(t===null){const o={offset:e,errorType:"其他解析错误",errorMsg:"读取帧头4字节失败"};return{frameHeader:{...H,offset:e},errorDetail:o}}const n=(t&B.SYNC_WORD_MASK)>>>20;if((t&B.SYNC_WORD_VALUE)>>>0!==B.SYNC_WORD_VALUE){const o={offset:e,errorType:"同步字无效",errorMsg:`同步字${n.toString(16)}无效，预期0xFFE`};return{frameHeader:{...H,offset:e,syncWord:n},errorDetail:o}}const a={...H,offset:e,isValid:!0,syncWord:n};a.mpegVersion=this.parseMpegVersion(t>>19&3),a.layer=this.parseLayer(t>>17&3),a.protectionBit=(t>>16&1)===1,a.bitrateIndex=t>>12&15,a.sampleRateIndex=t>>10&3,a.paddingBit=(t>>9&1)===1,a.privateBit=(t>>8&1)===1,a.channelMode=this.parseChannelMode(t>>6&3),a.modeExtension=t>>4&3,a.copyright=(t>>3&1)===1,a.original=(t>>2&1)===1,a.emphasis=t&3;const i=this.parseBitrate(a.mpegVersion,a.layer,a.bitrateIndex);a.bitrate=i.bitrate,a.bitrateExtension=i.isExtended;const s=this.parseSampleRate(a.mpegVersion,a.sampleRateIndex);if(a.sampleRate=s.sampleRate,a.sampleRateExtension=s.isExtended,a.bitrate===0||a.sampleRate===0){const o={offset:e,errorType:"比特率/采样率为0",errorMsg:`比特率${a.bitrate}kbps/采样率${a.sampleRate}Hz无效`};return a.isValid=!1,{frameHeader:a,errorDetail:o}}if(a.protectionBit)a.crcValid=null;else{const o=this.validateCrc(e,t);if(a.crcValid=o.isValid,a.crcValue=o.crcValue,!o.isValid){const g={offset:e,errorType:"CRC校验失败",errorMsg:`CRC校验失败，实际值${((c=o.crcValue)==null?void 0:c.toString(16))||"未知"}，计算值${((u=o.calculatedCrc)==null?void 0:u.toString(16))||"未知"}`};return a.isValid=!1,{frameHeader:a,errorDetail:g}}}const l=new Pe;if(a.frameSize=l.calculateFrameSize(a),a.frameDuration=l.calculateFrameDuration(a),a.frameSize<=0||a.frameSize>this.dataView.byteLength-e){const o={offset:e,errorType:"帧大小计算异常",errorMsg:`帧大小${a.frameSize}字节无效（超出剩余buffer长度）`};return a.isValid=!1,{frameHeader:a,errorDetail:o}}return{frameHeader:a,errorDetail:null}}readHeaderBytes(e){try{return this.dataView.getUint32(e,!1)}catch{return null}}parseMpegVersion(e){switch(e){case 0:return"MPEG Version 2.5";case 1:return"Unknown";case 2:return"MPEG Version 2";case 3:return"MPEG Version 1";default:return"Unknown"}}parseLayer(e){switch(e){case 0:return"Unknown";case 1:return"Layer III";case 2:return"Layer II";case 3:return"Layer I";default:return"Unknown"}}parseChannelMode(e){switch(e){case 0:return"Stereo";case 1:return"Joint Stereo";case 2:return"Dual Channel";case 3:return"Mono";default:return"Unknown"}}parseBitrate(e,t,n){var s,l;if(e==="Unknown"||t==="Unknown"||n>15||n<0)return{bitrate:0,isExtended:!1};const a=((l=(s=B.BITRATE_TABLE[e])==null?void 0:s[t])==null?void 0:l[n])||0;return{bitrate:a||0,isExtended:a===0&&n!==0}}parseSampleRate(e,t){var i;if(e==="Unknown"||t>3||t<0)return{sampleRate:0,isExtended:!1};const n=((i=B.SAMPLE_RATE_TABLE[e])==null?void 0:i[t])||0;return{sampleRate:n||0,isExtended:n===0&&t!==3}}validateCrc(e,t){try{const n=this.dataView.getUint16(e+4,!1),a=t&4294967292,i=new Uint8Array(4);i[0]=a>>24&255,i[1]=a>>16&255,i[2]=a>>8&255,i[3]=a&255;const l=new Pe().calculateFrameSize({...H,mpegVersion:this.parseMpegVersion(t>>19&3),layer:this.parseLayer(t>>17&3),bitrate:this.parseBitrate(this.parseMpegVersion(t>>19&3),this.parseLayer(t>>17&3),t>>12&15).bitrate,sampleRate:this.parseSampleRate(this.parseMpegVersion(t>>19&3),t>>10&3).sampleRate,paddingBit:(t>>9&1)===1,isValid:!0})-6;if(l<=0||e+6+l>this.dataView.byteLength)return{isValid:!1,crcValue:n};const c=new Uint8Array(this.dataView.buffer,e+6,l),u=new Uint8Array(4+c.length);u.set(i,0),u.set(c,4);const o=this.calculateCrc16(u);return{isValid:(o^65535)===n,crcValue:n,calculatedCrc:o}}catch(n){return console.error("CRC校验计算失败:",n),{isValid:!1}}}calculateCrc16(e){let t=65535;const n=4129;for(let a=0;a<e.length;a++){t^=e[a]<<8&65280;for(let i=0;i<8;i++)t&32768?t=t<<1^n:t<<=1,t&=65535}return t}};d(B,"SYNC_WORD_MASK",4292870144),d(B,"SYNC_WORD_VALUE",4292870144),d(B,"BITRATE_TABLE",{"MPEG Version 1":{"Layer I":[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,0],"Layer II":[0,32,48,64,80,96,112,128,144,160,176,192,208,224,240,256],"Layer III":[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,0]},"MPEG Version 2":{"Layer I":[0,32,48,64,80,96,112,128,144,160,176,192,208,224,240,256],"Layer II":[0,8,16,24,32,40,48,56,64,80,88,96,112,128,144,160],"Layer III":[0,8,16,24,32,40,48,56,64,80,88,96,112,128,144,160]},"MPEG Version 2.5":{"Layer I":[0,32,48,64,80,96,112,128,144,160,176,192,208,224,240,256],"Layer II":[0,8,16,24,32,40,48,56,64,80,88,96,112,128,144,160],"Layer III":[0,8,16,24,32,40,48,56,64,80,88,96,112,128,144,160]}}),d(B,"SAMPLE_RATE_TABLE",{"MPEG Version 1":[44100,48e3,32e3,0],"MPEG Version 2":[22050,24e3,16e3,0],"MPEG Version 2.5":[11025,12e3,8e3,0],Unknown:[0,0,0,0]});let Ee=B;class Pe{calculateFrameSize(e){if(!e.isValid||e.bitrate===0||e.sampleRate===0)return 0;const t=e.bitrate,n=e.sampleRate,a=e.paddingBit?1:0;switch(e.layer){case"Layer I":return Math.floor(12*t*1e3/n+a*4);case"Layer II":case"Layer III":return Math.floor(144*t*1e3/n+a);default:return 0}}calculateFrameDuration(e){if(!e.isValid||e.sampleRate===0)return 0;let t=0;switch(e.layer){case"Layer I":t=384;break;case"Layer II":t=1152;break;case"Layer III":t=e.mpegVersion==="MPEG Version 1"?1152:576;break;default:return 0}return t/e.sampleRate*1e3}}class St{constructor(e,t,n){d(this,"dataView");d(this,"frameParser");d(this,"audioStartOffset");d(this,"audioEndOffset");this.dataView=new DataView(e),this.frameParser=new Ee(e),this.audioStartOffset=Math.max(0,t),this.audioEndOffset=this.dataView.byteLength-(n?128:0)}findAllFramesWithError(){const e=[],t=[];let n=this.audioStartOffset,a=0;for(;n<this.audioEndOffset-4;){a++;const{frameHeader:i,errorDetail:s}=this.frameParser.parseFrameHeaderWithError(n);s?(t.push(s),n+=1):(e.push(i),n+=i.frameSize||1)}return{validFrames:e,totalFrameCount:a,errorFrameDetails:t}}}const le=class le{constructor(e,t,n){d(this,"frameFinder");this.frameFinder=new St(e,t,n)}parseComplete(){const{validFrames:e,totalFrameCount:t,errorFrameDetails:n}=this.frameFinder.findAllFramesWithError(),a=e.find(s=>s.isValid)||H,i={sampleRate:a.sampleRate,bitrate:a.bitrate,channelCount:a.channelMode==="Mono"?1:2,totalDuration:e.reduce((s,l)=>s+l.frameDuration,0),bitDepth:le.DEFAULT_BIT_DEPTH};return{frameHeader:a,frameCount:t,errorFrameCount:n.length,errorFrameDetails:n,audioBasicInfo:i}}};d(le,"DEFAULT_BIT_DEPTH",16);let Re=le;var C;(function(r){r.LOAD="LOAD",r.EXEC="EXEC",r.FFPROBE="FFPROBE",r.WRITE_FILE="WRITE_FILE",r.READ_FILE="READ_FILE",r.DELETE_FILE="DELETE_FILE",r.RENAME="RENAME",r.CREATE_DIR="CREATE_DIR",r.LIST_DIR="LIST_DIR",r.DELETE_DIR="DELETE_DIR",r.ERROR="ERROR",r.DOWNLOAD="DOWNLOAD",r.PROGRESS="PROGRESS",r.LOG="LOG",r.MOUNT="MOUNT",r.UNMOUNT="UNMOUNT"})(C||(C={}));const Lt=(()=>{let r=0;return()=>r++})(),At=new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first"),xt=new Error("called FFmpeg.terminate()");var P,z,O,G,X,ue,T;class Bt{constructor(){k(this,P,null);k(this,z,{});k(this,O,{});k(this,G,[]);k(this,X,[]);d(this,"loaded",!1);k(this,ue,()=>{v(this,P)&&(v(this,P).onmessage=({data:{id:e,type:t,data:n}})=>{switch(t){case C.LOAD:this.loaded=!0,v(this,z)[e](n);break;case C.MOUNT:case C.UNMOUNT:case C.EXEC:case C.FFPROBE:case C.WRITE_FILE:case C.READ_FILE:case C.DELETE_FILE:case C.RENAME:case C.CREATE_DIR:case C.LIST_DIR:case C.DELETE_DIR:v(this,z)[e](n);break;case C.LOG:v(this,G).forEach(a=>a(n));break;case C.PROGRESS:v(this,X).forEach(a=>a(n));break;case C.ERROR:v(this,O)[e](n);break}delete v(this,z)[e],delete v(this,O)[e]})});k(this,T,({type:e,data:t},n=[],a)=>v(this,P)?new Promise((i,s)=>{const l=Lt();v(this,P)&&v(this,P).postMessage({id:l,type:e,data:t},n),v(this,z)[l]=i,v(this,O)[l]=s,a==null||a.addEventListener("abort",()=>{s(new DOMException(`Message # ${l} was aborted`,"AbortError"))},{once:!0})}):Promise.reject(At));d(this,"load",({classWorkerURL:e,...t}={},{signal:n}={})=>(v(this,P)||(ee(this,P,e?new Worker(new URL(e,import.meta.url),{type:"module"}):new Worker(new URL(""+new URL("worker-BAOIWoxA.js",import.meta.url).href,import.meta.url),{type:"module"})),v(this,ue).call(this)),v(this,T).call(this,{type:C.LOAD,data:t},void 0,n)));d(this,"exec",(e,t=-1,{signal:n}={})=>v(this,T).call(this,{type:C.EXEC,data:{args:e,timeout:t}},void 0,n));d(this,"ffprobe",(e,t=-1,{signal:n}={})=>v(this,T).call(this,{type:C.FFPROBE,data:{args:e,timeout:t}},void 0,n));d(this,"terminate",()=>{const e=Object.keys(v(this,O));for(const t of e)v(this,O)[t](xt),delete v(this,O)[t],delete v(this,z)[t];v(this,P)&&(v(this,P).terminate(),ee(this,P,null),this.loaded=!1)});d(this,"writeFile",(e,t,{signal:n}={})=>{const a=[];return t instanceof Uint8Array&&a.push(t.buffer),v(this,T).call(this,{type:C.WRITE_FILE,data:{path:e,data:t}},a,n)});d(this,"mount",(e,t,n)=>{const a=[];return v(this,T).call(this,{type:C.MOUNT,data:{fsType:e,options:t,mountPoint:n}},a)});d(this,"unmount",e=>{const t=[];return v(this,T).call(this,{type:C.UNMOUNT,data:{mountPoint:e}},t)});d(this,"readFile",(e,t="binary",{signal:n}={})=>v(this,T).call(this,{type:C.READ_FILE,data:{path:e,encoding:t}},void 0,n));d(this,"deleteFile",(e,{signal:t}={})=>v(this,T).call(this,{type:C.DELETE_FILE,data:{path:e}},void 0,t));d(this,"rename",(e,t,{signal:n}={})=>v(this,T).call(this,{type:C.RENAME,data:{oldPath:e,newPath:t}},void 0,n));d(this,"createDir",(e,{signal:t}={})=>v(this,T).call(this,{type:C.CREATE_DIR,data:{path:e}},void 0,t));d(this,"listDir",(e,{signal:t}={})=>v(this,T).call(this,{type:C.LIST_DIR,data:{path:e}},void 0,t));d(this,"deleteDir",(e,{signal:t}={})=>v(this,T).call(this,{type:C.DELETE_DIR,data:{path:e}},void 0,t))}on(e,t){e==="log"?v(this,G).push(t):e==="progress"&&v(this,X).push(t)}off(e,t){e==="log"?ee(this,G,v(this,G).filter(n=>n!==t)):e==="progress"&&ee(this,X,v(this,X).filter(n=>n!==t))}}P=new WeakMap,z=new WeakMap,O=new WeakMap,G=new WeakMap,X=new WeakMap,ue=new WeakMap,T=new WeakMap;var Se;(function(r){r.MEMFS="MEMFS",r.NODEFS="NODEFS",r.NODERAWFS="NODERAWFS",r.IDBFS="IDBFS",r.WORKERFS="WORKERFS",r.PROXYFS="PROXYFS"})(Se||(Se={}));const Mt=r=>new Promise((e,t)=>{const n=new FileReader;n.onload=()=>{const{result:a}=n;a instanceof ArrayBuffer?e(new Uint8Array(a)):e(new Uint8Array)},n.onerror=a=>{var i,s;t(Error(`File could not be read! Code=${((s=(i=a==null?void 0:a.target)==null?void 0:i.error)==null?void 0:s.code)||-1}`))},n.readAsArrayBuffer(r)}),Ot=async r=>{let e;if(typeof r=="string")/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(r)?e=atob(r.split(",")[1]).split("").map(t=>t.charCodeAt(0)):e=await(await fetch(r)).arrayBuffer();else if(r instanceof URL)e=await(await fetch(r)).arrayBuffer();else if(r instanceof File||r instanceof Blob)e=await Mt(r);else return new Uint8Array;return new Uint8Array(e)},K=new Bt;K.load();async function Ut(r,e){const t=r.name,n="output_s16le.pcm";try{await K.writeFile(t,await Ot(r)),await K.exec(["-i",t,"-f","s16le","-acodec","pcm_s16le","-ac",e.channelCount.toString(),"-ar",e.sampleRate.toString(),n]);const a=await K.readFile(n);return typeof a=="string"?(console.warn("PCM 文件读取结果为字符串，转换失败"),null):a.buffer}catch(a){return console.error("MPEG 转 PCM 失败：",a),null}finally{try{await K.deleteFile(t),await K.deleteFile(n)}catch(a){console.warn("清理虚拟文件失败：",a)}}}async function Vt(r){const e=await r.arrayBuffer(),t=e.byteLength,n=Pt(e),a=bt(e),i=a?128:0,s=n&&t-n.标签大小-i,l=new Re(e,(n==null?void 0:n.标签大小)||0,!!a).parseComplete(),c={bitDepth:16,bitrate:340,channelCount:2,sampleRate:44100,totalDuration:0},u=l.frameHeader.isValid?l.audioBasicInfo:c,o=await Ut(r,u);return o?{id3v2:n,id3v1:a,audioSize:s,fileSize:t,mpegAudio:l,pcm:o,audioBasicInfo:u}:null}const Nt={class:"flex-box"},_t={class:"img-box"},kt=J({__name:"audioBasicInfo",props:{isRunning:{type:Boolean},info:{},getMetadata:{type:Function}},setup(r){const e=r,t=W(""),n=Fe([]);function a(){i();const s=e.getMetadata();if(s){const{mp3Info:l}=s;if(l){const{id3v2:c}=l;if(!c)return;const u=c.audioCover;if(n.value=Object.keys(c).filter(o=>{if(/^[\u4e00-\u9fa5]+$/.test(o))return typeof c[o]=="string"}).map(o=>`${o}：${c[o]}`),u&&typeof u=="object"){const o=new Blob([u.data],{type:u.mime});t.value=URL.createObjectURL(o)}}}}function i(){t.value&&URL.revokeObjectURL(t.value),n.value=[],t.value=""}return ve(()=>e.info,a,{immediate:!0}),xe(i),(s,l)=>(A(),U("div",Nt,[V("div",{class:Ae([r.isRunning&&"running","record-player"])},[V("div",_t,[t.value?(A(),Ce(f(qe),{key:0,src:t.value},null,8,["src"])):Be("",!0)]),l[0]||(l[0]=V("div",{class:"tonarm-lift"},null,-1))],2),h(f(fe),{vertical:""},{default:m(()=>[h(f(ae),null,{default:m(()=>[R(L(r.info.name),1)]),_:1}),h(f(ye),{style:{"max-height":"90px"}},{default:m(()=>[h(f(fe),null,{default:m(()=>[(A(!0),U(he,null,We(n.value,c=>(A(),Ce(f($),{key:c},{default:m(()=>[c.length>30?(A(),U(he,{key:0},[R(L(c.slice(0,28))+".. ",1),h(f(se),{type:"info",text:"",onClick:u=>f(ze).success("复制完成").error("复制失败").run(f($e)(c))},{default:m(()=>[h(f(oe),{component:f(Ge)},null,8,["component"])]),_:1},8,["onClick"])],64)):(A(),U(he,{key:1},[R(L(c),1)],64))]),_:2},1024))),128))]),_:1})]),_:1}),h(f(fe),null,{default:m(()=>[h(f($),{type:"info"},{default:m(()=>[R(L(r.info.type),1)]),_:1}),h(f($),{color:{color:"#8a2be21a",textColor:"#9339E7FF",borderColor:"#9339E7FF"}},{default:m(()=>[R(L(r.info.size),1)]),_:1}),h(f($),{type:"success"},{default:m(()=>[R(L(r.info.totalDuration),1)]),_:1}),h(f($),{type:"warning"},{default:m(()=>[R(L(r.info.sampleRate)+"Hz ",1)]),_:1}),h(f($),null,{default:m(()=>[R(L(r.info.channelCount)+"ch ",1)]),_:1}),h(f($),null,{default:m(()=>[R(L(r.info.bitDepth)+"bit ",1)]),_:1})]),_:1})]),_:1})]))}}),Ft=ce(kt,[["__scopeId","data-v-7eae69ce"]]),Wt={key:0,class:"audio-player-container"},zt={class:"canvas-container"},$t=["id"],Gt={class:"time-container"},Le=".mp3,.pcm,.wav",Xt=J({__name:"index",setup(r){const e=ge("audio-player-"),t=ge("file-list-"),n=W(!1),a=W(void 0),i=W([]),s=new Map,l=W(.2),c=W({sampleRate:16e3,bitDepth:16,channelCount:1,startTime:0,duration:0,endianness:M.LE}),u=W(),o=new It;o.onPlayCompleted=()=>{n.value=!1},o.playProgressCallback=I=>{u.value.currentTime=q(Number(I))},ve([c,a],async([I,p])=>{if(typeof p=="number"){const E=i.value[p],y=s.get(E.id);u.value=ft(y,0),requestAnimationFrame(async()=>{const b=document.getElementById(e),x=y.pcm;await o.init({canvas:b,pcmData:x,pcmOptions:{volume:l.value,...I}}),u.value.currentTime=q(0),u.value.totalDuration=q(Number(o.totalDuration))})}},{deep:!0}),ve(l,I=>{o.setVolume(I)});function g(){o.play(),n.value=!0}function D(){o.stop(),n.value=!1}async function w(I){const{offsetX:p,target:E}=I,y=E.clientWidth,b=p/y*o.totalDuration;await o.play(b),n.value=!0}function N(I){const{offsetX:p,target:E}=I,y=E,b=y.clientWidth,x=p/b*o.totalDuration;y.dataset.time=q(x),y.style.setProperty("--after-x",p-46/2+"px")}function Z(){if(a.value===void 0)return;const I=i.value[a.value];return s.get(I.id)}function Q(I){const p=y=>Le.split(",").some(b=>y.endsWith(b)),E=I.filter(y=>p(y.name));E.length>0?E.forEach(y=>{const b=String(y.lastModified);i.value.push({id:b,name:y.name,status:"finished",file:y})}):window.$message.warning("请拖拽音频文件")}function _(){Ye.get("/multimedia/Jay Chou.pcm",{responseType:"blob"}).then(async I=>{const p=new File([I.data],"Jay Chou.pcm"),E=await p.arrayBuffer(),y=String(p.lastModified);s.set(y,{fileName:p.name,fileSize:p.size,audioBasicInfo:{sampleRate:24e3,bitDepth:16,channelCount:2,endianness:M.LE},pcm:E}),i.value.push({id:y,name:p.name,status:"finished"}),ne(i.value.length-1)})}async function ne(I){const p=i.value[I];let E=s.get(p.id);const y=window.$message.loading("解析中... 希望不会太久~",{duration:0}),b=()=>{setTimeout(()=>{y.type="success",y.content="解析完成。久等了~",setTimeout(()=>y.destroy(),3e3)},1e3)},x=S=>{y.type="error",y.content=`解析失败，${S}。额~`,setTimeout(()=>y.destroy(),3e3)};if(!E){const S=p.file;if(!S)return x("数据异常");const ie=S.name.lastIndexOf("."),re=S.name.slice(ie+1);if(re.toLocaleLowerCase()=="mp3"){const Y=await Vt(S);if(Y){const de=Y.audioBasicInfo;s.set(p.id,{fileName:S.name,fileSize:S.size,audioBasicInfo:{sampleRate:de.sampleRate,channelCount:de.channelCount,bitDepth:de.bitDepth,endianness:M.LE},pcm:Y.pcm,mp3Info:Y})}else return x("MP3文件解析失败")}else if(re.toLocaleLowerCase()=="pcm"){const Y=await S.arrayBuffer();s.set(p.id,{fileName:S.name,fileSize:S.size,audioBasicInfo:{sampleRate:8e3,channelCount:2,bitDepth:16,endianness:M.LE},pcm:Y})}else return x("敬请期待");E=s.get(p.id)}a.value=I,b(),Object.assign(c.value,E.audioBasicInfo),setTimeout(()=>{document.querySelectorAll(`#${t} .n-upload-file`).forEach((ie,re)=>{ie.classList.remove("active"),re==I&&ie.classList.add("active")})},100)}function Me(I){const p=I.target.closest(".n-button"),E=I.target.closest(".n-upload-file");if(!E)return;const y=document.querySelectorAll(`#${t} .n-upload-file`),b=Array.from(y).findIndex(x=>x===E);if(p){const x=i.value[b];s.delete(x.id),b==a.value&&(a.value=void 0,n.value=!1,o.clear()),u.value=void 0;return}b!=-1&&ne(b)}return Xe(()=>{o.stop()}),xe(()=>{o.clear()}),(I,p)=>(A(),Ce(Ct,{onDropCallback:Q},{default:m(()=>[h(je,{"default-size":.35,min:0},{left:m(()=>[h(f(ye),null,{default:m(()=>[h(f(Je),{prefix:"bar"},{default:m(()=>[h(f(ae),{type:"success"},{default:m(()=>[p[5]||(p[5]=R(" PCM / MP3 / ",-1)),h(f(ae),{type:"warning"},{default:m(()=>[...p[4]||(p[4]=[R("WAV(额~)",-1)])]),_:1}),p[6]||(p[6]=R(" 音频可视化播放器 ",-1))]),_:1})]),_:1}),h(pt,{options:c.value,"onUpdate:options":p[2]||(p[2]=E=>c.value=E),volume:l.value,"onUpdate:volume":p[3]||(p[3]=E=>l.value=E)},{prefix:m(()=>[h(f(Qe),{"file-list":i.value,"onUpdate:fileList":p[0]||(p[0]=E=>i.value=E),abstract:"",accept:Le,multiple:""},{default:m(()=>[h(f(Ze),null,{default:m(()=>[h(f(et),{abstract:""},{default:m(({handleClick:E})=>[h(f(se),{type:"info",onClick:E},{icon:m(()=>[h(f(oe),{component:f(at)},null,8,["component"])]),default:m(()=>[p[7]||(p[7]=R(" 选择或拖入文件 ",-1))]),_:1},8,["onClick"])]),_:1}),h(f(se),{type:"info",ghost:"",onClick:_},{icon:m(()=>[h(f(oe),{component:f(nt)},null,8,["component"])]),default:m(()=>[p[8]||(p[8]=R(" 加载样例 ",-1))]),_:1})]),_:1}),h(f(tt),{id:f(t),onClickCapture:Me},null,8,["id"])]),_:1},8,["file-list"])]),suffix:m(()=>[h(f(se),{disabled:typeof a.value!="number",type:n.value?"error":"success",ghost:"",onClick:p[1]||(p[1]=E=>n.value?D():g())},{icon:m(()=>[h(f(oe),{component:n.value?f(dt):f(ot)},null,8,["component"])]),default:m(()=>[R(" "+L(n.value?"暂停":"播放"),1)]),_:1},8,["disabled","type"])]),_:1},8,["options","volume"])]),_:1})]),right:m(()=>[h(f(ye),null,{default:m(()=>[u.value?(A(),U("div",Wt,[h(Ft,{"is-running":n.value,info:u.value,getMetadata:Z},null,8,["is-running","info"]),V("div",zt,[V("canvas",{id:f(e)},null,8,$t),V("div",{class:"progress",onMousemove:N,onClick:w},null,32)]),V("div",Gt,[h(f(ae),null,{default:m(()=>[R(L(u.value.currentTime),1)]),_:1}),h(f(ae),null,{default:m(()=>[R(L(u.value.totalDuration),1)]),_:1})])])):Be("",!0)]),_:1})]),_:1})]),_:1}))}}),pa=ce(Xt,[["__scopeId","data-v-b06600fa"]]);export{pa as default};
