var E=Object.defineProperty;var G=(p,i,t)=>i in p?E(p,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):p[i]=t;var l=(p,i,t)=>G(p,typeof i!="symbol"?i+"":i,t);import{bB as z,cw as T,cx as H,cy as B,cz as X,cA as L,cB as Y}from"./index-BPBd_PCe.js";class N{constructor(i){l(this,"canvas");l(this,"show",{all:!0,grid:{main:!0,secondary:!0},axis:!0,axisText:!0});this.canvas=i}drawAxisAndGrid(){!this.canvas||!this.show.all||((this.show.grid.main||this.show.grid.secondary)&&this.drawGrid(),this.show.axis&&this.drawAxis(),this.show.axisText&&this.drawAxisText())}color(){const{theme:i,style:t}=this.canvas;return(t[i]||t.light).grid}drawGrid(){const i=this.canvas,{ctx:t,rect:s,center:e,axisConfig:n}=i,{width:a,height:o}=s.value,r=this.color(),h=n.size,c=h/5;t.lineWidth=1;const f=(y,m)=>{const u=e.x%y>0?e.x%y:y+e.x%y;t.strokeStyle=m,t.beginPath();for(let v=0;v*y+u<=a;v++)t.moveTo(v*y+u,0),t.lineTo(v*y+u,o);t.stroke()},d=(y,m)=>{const u=e.y%y>0?e.y%y:y+e.y%y;t.strokeStyle=m,t.beginPath();for(let v=0;v*y+u<=o;v++)t.moveTo(0,v*y+u),t.lineTo(a,v*y+u);t.stroke()};this.show.grid.secondary&&(f(c,r.innerGrid),d(c,r.innerGrid)),this.show.grid.main&&(f(h,r.grid),d(h,r.grid))}drawAxis(){const i=this.canvas,{ctx:t,rect:s,center:e}=i,{width:n,height:a}=s.value,o=this.color();t.lineWidth=2,t.strokeStyle=o.axis;const r=()=>{e.y>=0&&e.y<=a&&(t.beginPath(),t.moveTo(0,e.y),t.lineTo(n,e.y),t.stroke())},h=()=>{e.x>=0&&e.x<=n&&(t.beginPath(),t.moveTo(e.x,0),t.lineTo(e.x,a),t.stroke())};r(),h()}drawText(i,t,s,e){const{ctx:n,theme:a}=this.canvas,o=this.canvas.style[a].text;n.font=`${o.bold?"bold":""} ${o.size}px ${o.family}`,n.strokeStyle=o.stroke,n.strokeText(i,t,s),n.fillStyle=o[e?"secondary":"color"],n.fillText(i,t,s)}drawAxisText(){const i=this.canvas,{ctx:t,rect:s,center:e,axisConfig:n,style:a,theme:o}=i,{width:r,height:h}=s.value,c=u=>Math.ceil(t.measureText(u).width),f=4,d=a[o].text.size;{const u=c("0"),v=e.x<f||e.x>r+u+f,w=e.y<-(f+d)||e.y>h+d+f;!v&&!w&&this.drawText("0",e.x-u-f,e.y+d+f)}const y=i.getGridCount(),m=n.size;{let u=e.y+d+f;u=Math.max(Math.min(u,h-f),f+d);const v=e.y>h||e.y<0;let w=e.x>0?e.x%m:e.x<0?m+e.x%m:0,g=i.getAxisValueByPoint((w-e.x)*n.x,0).xV;for(;w<=r;){const C=c(String(g));g!==0&&this.drawText(String(g),w-C/2,u,v),w+=m,g=i.preservePrecision(g+y*n.x)}}{const u=e.x>r||e.x<0;let v=e.y>0?e.y%m:e.y<0?m+e.y%m:0,w=i.getAxisValueByPoint(0,(v-e.y)*n.y).yV;for(;v<=h;){const g=c(String(w));let C=e.x-g-f;C=Math.max(Math.min(C,r-g-f),f),w!==0&&this.drawText(String(w),C,v+d/2,u),v+=m,w=i.preservePrecision(w+y*n.y)}}}}class M{constructor(i){l(this,"show",!0);l(this,"scales");l(this,"notifyReload");(i==null?void 0:i.show)!==void 0&&(this.show=i.show),i!=null&&i.scales&&(this.scales=i.scales)}setShow(i){var t;i!=this.show&&(this.show=i,(t=this.notifyReload)==null||t.call(this,!0))}setScales(i){var t;i!=this.scales&&(this.scales=i,this.show&&((t=this.notifyReload)==null||t.call(this)))}shouldRender(i,t){if(!this.show||i===void 0||t===0)return!1;if(this.scales){const s=Math.min(...this.scales),e=Math.max(...this.scales);return i>=s&&i<=e}return!0}}class x{constructor(i){l(this,"show",new M);l(this,"style");l(this,"position");l(this,"value");l(this,"zIndex");l(this,"dynamicPosition");l(this,"name");l(this,"draggable",!1);l(this,"path");l(this,"extData");l(this,"isClick",!1);l(this,"isDown",!1);l(this,"isHover",!1);l(this,"mainCanvas");l(this,"notifyReload");this.show.setShow(i.show??!0),this.style=i.style,this.zIndex=i.zIndex??0,this.position=i.position,this.dynamicPosition=i.dynamicPosition,this.value=i.value,this.name=i.name,this.draggable=i.draggable??!1}notifyClick(i){this.isClick=i}notifyDown(i){this.isDown=i}notifyHover(i){this.isHover=i}notifyDraggable(i,t){if(this.mainCanvas){const{percentage:s,axisConfig:e}=this.mainCanvas,n=e.count/e.min/s,a={value:i*n*e.x,position:i/s*e.x,dynamicPosition:i*e.x},o={value:t*n*e.y,position:t/s*e.y,dynamicPosition:t*e.y};return{x:a,y:o}}}isPointInAnywhere(i,t){return this.isPointInPath(i,t)||this.isPointInStroke(i,t)}setMainCanvas(i){this.mainCanvas=i,this.updateBaseData()}equalsMainCanvas(i){return this.mainCanvas===i}setNotifyReload(i){this.notifyReload=i?t=>{var s;(t||this.show.shouldRender((s=this.mainCanvas)==null?void 0:s.scale))&&i()}:void 0,this.show.notifyReload=this.notifyReload}setStyle(i){var t;this.style=i,this.dynamicPosition&&((t=this.notifyReload)==null||t.call(this))}setZIndex(i){var t;this.zIndex=i,this.dynamicPosition&&((t=this.notifyReload)==null||t.call(this))}setPosition(i){var s;this.position=i,this.value=void 0;const t=!!this.dynamicPosition;this.updateBaseData(),(this.dynamicPosition||t)&&((s=this.notifyReload)==null||s.call(this))}setValue(i){var s;this.value=i,this.position=void 0;const t=!!this.dynamicPosition;this.updateBaseData(),(this.dynamicPosition||t)&&((s=this.notifyReload)==null||s.call(this))}}l(x,"ctx",document.createElement("canvas").getContext("2d"));class P{static preservePrecision(i,t){return i=Number(i),i?Number.isInteger(i)?i:Number(i.toFixed(t)):0}static LngLatToPlane(i,t){const s=Math.max(Math.min(i,180),-180),e=Math.max(Math.min(t,this.MAX_LAT),-this.MAX_LAT),n=s*this.PI_OVER_180*this.EARTH_RADIUS,a=Math.log(Math.tan((90+e)*this.PI_OVER_180))*this.EARTH_RADIUS;return[n,a]}static PlaneToLngLat(i,t){const s=i/this.EARTH_RADIUS/this.PI_OVER_180,e=(2*Math.atan(Math.exp(t/this.EARTH_RADIUS))-this.HALF_PI)/this.PI_OVER_180;return[s,e]}static IsValid(i){return Array.isArray(i)&&typeof i[0]=="number"&&typeof i[1]=="number"&&isFinite(i[0])&&isFinite(i[1])}static IsValids(i){return Array.isArray(i)&&i.every(t=>this.IsValid(t))}}l(P,"HALF_PI",Math.PI/2),l(P,"PI_OVER_180",Math.PI/180),l(P,"EARTH_RADIUS",6378137),l(P,"MAX_LAT",85.05112878);class b extends x{constructor(t){super(t);l(this,"textOffset",{x:0,y:0});l(this,"text");this.text=String(t.text)}notifyDraggable(t,s){}notifyHover(t){var s;t!==this.isHover&&(super.notifyHover(t),(s=this.notifyReload)==null||s.call(this))}isPointInPath(t,s){return this.path?x.ctx.isPointInPath(this.path,t,s):!1}isPointInStroke(t,s){return!1}updateBaseData(){if(!this.mainCanvas)return;if(!this.text||this.text.length==0)return this.dynamicPosition=void 0;const t=P.IsValid;let{value:s,position:e}=this;const[n,a]=[t(s),t(e)];if(!n&&!a)return this.dynamicPosition=void 0;if(n){const c=this.mainCanvas.getAxisPointByValue(s[0],s[1],!0);e=[c.x,c.y]}else{const c=this.mainCanvas.getAxisValueByPoint(e[0],e[1],!0);s=[c.xV,c.yV]}const o=this.mainCanvas.transformPosition([e])[0];this.dynamicPosition=o,this.value=s,this.position=e;const r=this.mainCanvas.ctx;this.setCanvasStyles(r);const h=r.measureText(this.text);this.textOffset={x:h.width/2,y:h.actualBoundingBoxAscent/2}}setText(t){var s;t!=this.text&&(this.text=t,this.updateBaseData(),this.dynamicPosition&&((s=this.notifyReload)==null||s.call(this)))}setCanvasStyles(t){var a;const s=this.mainCanvas,e=s.style[s.theme].text;let n={};typeof this.style=="string"?n=((a=s.style[this.style])==null?void 0:a.text)||e:typeof this.style=="object"?n=Object.assign({},e,this.style):n=e,t.font=`${n.bold?"bold":""} ${n.size}px ${n.family}`,t.strokeStyle=n.stroke,t.fillStyle=n[this.isHover?"secondary":"color"]}draw(t){if(!this.mainCanvas)return;const s=this.dynamicPosition,e=this.textOffset,n=this.text;this.setCanvasStyles(t);const a=s[0]-e.x,o=s[1]+e.y;t.strokeText(n,a,o),t.fillText(n,a,o),this.path=new Path2D,this.path.rect(a,s[1]-e.y,e.x*2,e.y*2)}getDraw(){const{show:t,dynamicPosition:s,position:e,value:n,textOffset:a,mainCanvas:o}=this;if(!o)return;const{scale:r,maxMinValue:h,isRecalculate:c}=o;if(t.shouldRender(r)&&s){const[d,y]=n;if(h.maxXV>d-a.x&&h.minXV<d+a.x&&h.maxYV>y-a.y&&h.minYV<y+a.y)return c&&(this.dynamicPosition=o.transformPosition([e])[0]),[this.draw,this]}}}class A extends x{constructor(t){super(t);l(this,"radiusValue",0);l(this,"angle",2*Math.PI);l(this,"fillProgress")}notifyDraggable(t,s){var a;if(!this.mainCanvas)return;const{x:e,y:n}=super.notifyDraggable(t,s);this.value=[this.value[0]+e.value,this.value[1]+n.value],this.position=[this.position[0]+e.position,this.position[1]+n.position],this.dynamicPosition=[this.dynamicPosition[0]+e.dynamicPosition,this.dynamicPosition[1]+n.dynamicPosition],(a=this.notifyReload)==null||a.call(this)}notifyHover(t){if(t===this.isHover)return;super.notifyHover(t);const s=300,e=this.setCanvasStyles().width;this.fillProgress?this.cancelAndRestartAnimation(t,e,s-100):t&&this.startNewHoverAnimation(e,s)}cancelAndRestartAnimation(t,s,e){this.fillProgress.scheduleCallback();let n=0;this.fillProgress.scheduleCallback=z(a=>{!this.fillProgress||!a||(this.fillProgress.progress+=(a-n)*(t?1:-1),n=a,this.fillProgress.progress=Math.min(1,Math.max(0,this.fillProgress.progress)),this.updateLineWidthOffset(s),(this.fillProgress.progress===1||this.fillProgress.progress===0)&&(this.fillProgress.scheduleCallback(),this.fillProgress.progress===0&&(this.fillProgress=void 0)))},e)}startNewHoverAnimation(t,s){this.fillProgress={lineWidthOffset:0,progress:0,scheduleCallback:z(e=>{this.fillProgress&&(this.fillProgress.progress=e,this.updateLineWidthOffset(t))},s)}}updateLineWidthOffset(t){var e;if(!this.fillProgress)return;const s=Math.ceil(t*this.fillProgress.progress);s!==this.fillProgress.lineWidthOffset&&(this.fillProgress.lineWidthOffset=s,(e=this.notifyReload)==null||e.call(this))}isPointInPath(t,s){return this.path?x.ctx.isPointInPath(this.path,t,s):!1}isPointInStroke(t,s){var e;if(this.path&&this.mainCanvas){const{width:n}=this.setCanvasStyles(x.ctx);return((e=this.fillProgress)==null?void 0:e.lineWidthOffset)==n?!1:x.ctx.isPointInStroke(this.path,t,s)}return!1}updateBaseData(){var f;if(!this.mainCanvas)return;const t=P.IsValid;let{value:s,position:e}=this;const[n,a]=[t(s),t(e)];if(!n&&!a)return this.dynamicPosition=void 0;if(n){const d=this.mainCanvas.getAxisPointByValue(s[0],s[1],!0);e=[d.x,d.y]}else{const d=this.mainCanvas.getAxisValueByPoint(e[0],e[1],!0);s=[d.xV,d.yV]}const o=this.mainCanvas.transformPosition([e])[0];this.dynamicPosition=o,this.value=s,this.position=e;const r=this.mainCanvas.style[this.mainCanvas.theme].point;let h={};typeof this.style=="string"?h=(f=this.mainCanvas.style[this.style])==null?void 0:f.point:typeof this.style=="object"&&(h=this.style);const c=((h==null?void 0:h.width)||r.width)+((h==null?void 0:h.radius)||r.radius);this.radiusValue=this.mainCanvas.preservePrecision(s[0]/e[0]*c)}setCanvasStyles(t){var h,c;const s=this.mainCanvas,e=s.style[s.theme].point;let n={};typeof this.style=="string"?n=((h=s.style[this.style])==null?void 0:h.point)||e:typeof this.style=="object"?n=Object.assign({},e,this.style):n=e;const{width:a,stroke:o,fill:r}=n;if(t){const f=((c=this.fillProgress)==null?void 0:c.lineWidthOffset)||0;t.lineWidth=a-f,t.strokeStyle=o,t.fillStyle=r}return{...n}}draw(t){var r;const{dynamicPosition:s,mainCanvas:e}=this;if(!e)return;const{radius:n,width:a}=this.setCanvasStyles(t),o=((r=this.fillProgress)==null?void 0:r.lineWidthOffset)||0;t.beginPath(),this.path=new Path2D,this.path.arc(s[0],s[1],n+o/2,0,this.angle),t.fill(this.path),a!=o&&t.stroke(this.path)}getDraw(){const{show:t,dynamicPosition:s,position:e,value:n,radiusValue:a,mainCanvas:o}=this;if(!o)return;const{scale:r,maxMinValue:h,isRecalculate:c}=o;if(t.shouldRender(r)&&!!s){const[y,m]=n;if(h.maxXV>y-a&&h.minXV<y+a&&h.maxYV>m-a&&h.minYV<m+a)return c&&(this.dynamicPosition=o.transformPosition([e])[0]),[this.draw,this]}}}class k extends x{constructor(t){super(t);l(this,"infinite");l(this,"lineHandlePoints",[]);this.infinite=t.infinite}notifyHover(t){t!==this.isHover&&super.notifyHover(t)}notifyClick(t){var s;t!==this.isClick&&(super.notifyClick(t),(s=this.notifyReload)==null||s.call(this))}notifyDraggable(t,s){this.lineHandlePoints.some((e,n)=>(e.isHover&&(e.notifyDraggable(t,s),this.value[n]=e.value,this.position[n]=e.position,this.dynamicPosition[n]=e.dynamicPosition),e.isHover))}isPointInPath(t,s){return!1}isPointInStroke(t,s){return this.path&&this.mainCanvas?(this.setCanvasStylesLine(x.ctx),x.ctx.lineWidth=Math.max(x.ctx.lineWidth,20),x.ctx.isPointInStroke(this.path,t,s)):!1}isPointInAnywhere(t,s){const e=super.isPointInAnywhere(t,s),n=this.lineHandlePoints.some(a=>{const o=a.isPointInAnywhere(t,s);return a.notifyHover(o),o});return e||n}updateLineHandlePoints(){let{value:t,position:s,dynamicPosition:e}=this;if(!e)return;const n=this.setCanvasStylesLine().point;this.lineHandlePoints=[],t==null||t.forEach((a,o)=>{const r=this.lineHandlePoints[o]||new A({});r.value=t[o],r.position=s[o],r.dynamicPosition=e[o],r.style=n,r.mainCanvas=this.mainCanvas,r.setNotifyReload(()=>{var h;return(h=this.notifyReload)==null?void 0:h.call(this)}),this.lineHandlePoints[o]||this.lineHandlePoints.push(r)})}updateBaseData(){if(!this.mainCanvas)return;let{value:t,position:s}=this;const[e,n]=[P.IsValids(t)&&t.length>1,P.IsValids(s)&&s.length>1];if(!e&&!n)return this.lineHandlePoints=[],this.dynamicPosition=void 0;if(e){s=[];for(let o=0;o<t.length;o++){const r=t[o],h=this.mainCanvas.getAxisPointByValue(r[0],r[1],!0);s.push([h.x,h.y])}}else{t=[];for(let o=0;o<s.length;o++){const r=s[o],h=this.mainCanvas.getAxisValueByPoint(r[0],r[1],!0);t.push([h.xV,h.yV])}}const a=this.mainCanvas.transformPosition(s);this.dynamicPosition=a,this.value=t,this.position=s,this.updateLineHandlePoints()}setInfinite(t){var s;t!=this.infinite&&(this.infinite=t,this.dynamicPosition&&((s=this.notifyReload)==null||s.call(this)))}setCanvasStylesLine(t){var y;const s=this.mainCanvas,e=s.style[s.theme].line;let n={};typeof this.style=="string"?n=((y=s.style[this.style])==null?void 0:y.line)||e:typeof this.style=="object"?n=Object.assign({},e,this.style):n=e;const{width:a,color:o,dash:r,dashGap:h,dashOffset:c,cap:f,join:d}=n;return t&&(t.setLineDash(r?h:[]),t.lineDashOffset=c,t.lineCap=f,t.lineJoin=d,t.lineWidth=a,t.strokeStyle=o),n}drawLine(t,s){const{mainCanvas:e,infinite:n,isClick:a}=this;s=s||this.dynamicPosition,e&&(this.setCanvasStylesLine(t),t.beginPath(),this.path=new Path2D,s.forEach((o,r)=>{this.path[r==0?"moveTo":"lineTo"](o[0],o[1])}),t.stroke(this.path),(n||a)&&this.lineHandlePoints.forEach(o=>o.draw(t)))}drawInfiniteStraightLine(t){const{mainCanvas:s,dynamicPosition:e}=this;if(!s)return;const{rect:n}=s,[a,o]=T(e),r=[o[0]-a[0],o[1]-a[1]];if(r[0]===0&&r[1]===0)return console.error("重合点无法确定方向");const h=(d,y)=>{const[m,u]=d,[v,w]=y;let g=1/0;if(v!==0){const C=v>0?(n.value.width-m)/v:-m/v;C>0&&(g=Math.min(g,C))}if(v!==0){const C=v>0?(n.value.width-m)/v:-m/v;C>0&&(g=Math.min(g,C))}return g===1/0?d:[m+v*g,u+w*g]},c=h(a,[-r[0],-r[1]]),f=h(o,r);this.drawLine(t,[c,f])}getDraw(){const{show:t,dynamicPosition:s,position:e,infinite:n,mainCanvas:a}=this;if(!a)return;const{scale:o,isRecalculate:r}=a;if(t.shouldRender(o)&&!!s)return r&&(this.dynamicPosition=a.transformPosition(e),this.lineHandlePoints.forEach((f,d)=>f.dynamicPosition=this.dynamicPosition[d])),n?[this.drawInfiniteStraightLine,this]:[this.drawLine,this]}}class V extends x{constructor(t){super(t);l(this,"size");l(this,"dynamicSize");this.size=t.size}notifyHover(t){var s;t!==this.isHover&&(super.notifyHover(t),(s=this.notifyReload)==null||s.call(this))}notifyDraggable(t,s){}isPointInPath(t,s){return this.path?x.ctx.isPointInPath(this.path,t,s):!1}isPointInStroke(t,s){return this.path&&this.mainCanvas?(this.setCanvasStyles(x.ctx),x.ctx.isPointInStroke(this.path,t,s)):!1}updateBaseData(){if(!this.mainCanvas)return;const{axisConfig:t,percentage:s}=this.mainCanvas;let{value:e,position:n,size:a}=this;const[o,r,h]=[P.IsValids(e),P.IsValids(n),P.IsValid(a)];if(!o&&!r)return this.dynamicPosition=void 0;if(h)r?n.length=1:o&&(e.length=1);else{if(o&&e.length<3||r&&n.length<3)return this.dynamicPosition=void 0;a=void 0}if(o){n=[];for(let d=0;d<e.length;d++){const y=e[d],m=this.mainCanvas.getAxisPointByValue(y[0],y[1],!0);n.push([m.x,m.y])}}else{e=[];for(let d=0;d<n.length;d++){const y=n[d],m=this.mainCanvas.getAxisValueByPoint(y[0],y[1],!0);e.push([m.xV,m.yV])}}const c=this.mainCanvas.transformPosition(n),f=[];if(h){const[d,y]=a;f[0]=d*s*t.x,f[1]=y*s*t.y}this.dynamicSize=f,this.dynamicPosition=c,this.value=e,this.position=n,this.size=a}setSize(t){var e;this.size=t;const s=!!this.dynamicPosition;this.updateBaseData(),(this.dynamicPosition||s)&&((e=this.notifyReload)==null||e.call(this))}setCanvasStyles(t){var u;const{mainCanvas:s,isHover:e}=this;if(!s)return;const n=s.style[s.theme].polygon;let a={};typeof this.style=="string"?a=((u=s.style[this.style])==null?void 0:u.polygon)||n:typeof this.style=="object"?a=Object.assign({},n,this.style):a=n;const{width:o,stroke:r,dash:h,dashGap:c,dashOffset:f,fill:d,fill_hover:y,stroke_hover:m}=a;t.setLineDash(h?c:[]),t.lineDashOffset=f,t.lineWidth=o,t.strokeStyle=e?m:r,t.fillStyle=e?y:d}drawRect(t){const{dynamicPosition:s,dynamicSize:e}=this;this.setCanvasStyles(t),t.beginPath(),this.path=new Path2D,this.path.rect(s[0][0],s[0][1],e[0],e[1]),t.stroke(this.path),t.fill(this.path)}drawPolygon(t){const{dynamicPosition:s}=this;this.setCanvasStyles(t),t.beginPath(),this.path=new Path2D,s.forEach((e,n)=>{this.path[n==0?"moveTo":"lineTo"](e[0],e[1])}),this.path.lineTo(s[0][0],s[0][1]),t.closePath(),t.stroke(this.path),t.fill(this.path)}getDraw(){var d;const{show:t,dynamicPosition:s,position:e,mainCanvas:n}=this;if(!n)return;const{scale:a,isRecalculate:o,percentage:r,axisConfig:h}=n;if(t.shouldRender(a)&&!!s)return o&&(this.dynamicPosition=n.transformPosition(e),this.size&&(this.dynamicSize=[this.size[0]*r*h.x,this.size[1]*r*h.y])),(d=this.dynamicSize)!=null&&d.length?[this.drawRect,this]:[this.drawPolygon,this]}}class I extends x{constructor(t,s){super(t);l(this,"multiple");l(this,"draw");this.draw=s}notifyDraggable(t,s){}isPointInPath(t,s){return!1}isPointInStroke(t,s){return!1}isMultiple(){if(!this.mainCanvas)return;const t=P.IsValid,s=P.IsValids.bind(P);let{value:e,position:n}=this;const a=o=>{const r=o(e),h=o(n);return r||h?(r||(this.value=void 0),h||(this.position=void 0),!0):!1};return a(t)?this.multiple=!1:a(s)&&(this.multiple=!0),this.multiple}updateBaseData(){this.mainCanvas&&(this.isMultiple(),this.dynamicPosition=void 0,this.multiple===!0?this.handleMultipleData():this.multiple===!1&&this.handleSingleData())}handleMultipleData(){let t=this.value,s=this.position;t?s=this.convertValuesToPositions(t):t=this.convertPositionsToValues(s),this.updateDataProperties(t,s)}handleSingleData(){let t=this.value,s=this.position;if(t){const e=this.mainCanvas.getAxisPointByValue(t[0],t[1],!0);s=[e.x,e.y]}else{const e=this.mainCanvas.getAxisValueByPoint(s[0],s[1],!0);t=[e.xV,e.yV]}this.updateDataProperties(t,s)}convertValuesToPositions(t){const s=[];let e=1;return t.forEach((n,a)=>{if(a===0){const o=this.mainCanvas.getAxisPointByValue(n[0],n[1],!0);s.push([o.x,o.y]),e=this.mainCanvas.preservePrecision(o.x/n[0])}else s.push([this.mainCanvas.preservePrecision(e*n[0]),this.mainCanvas.preservePrecision(e*n[1])])}),s}convertPositionsToValues(t){const s=[];let e=1;return t.forEach((n,a)=>{if(a===0){const o=this.mainCanvas.getAxisValueByPoint(n[0],n[1],!0);s.push([o.xV,o.yV]),e=this.mainCanvas.preservePrecision(o.xV/n[0])}else s.push([this.mainCanvas.preservePrecision(e*n[0]),this.mainCanvas.preservePrecision(e*n[1])])}),s}updateDataProperties(t,s){this.dynamicPosition=this.multiple?this.mainCanvas.transformPosition(s):this.mainCanvas.transformPosition([s])[0],this.value=t,this.position=s}getDraw(){const{show:t,dynamicPosition:s,mainCanvas:e,multiple:n,position:a}=this;if(!e||typeof n!="boolean")return;const{scale:o,isRecalculate:r}=e;if(t.shouldRender(o)&&!!s)return r&&(this.dynamicPosition=n?e.transformPosition(a):e.transformPosition([a])[0]),[this.draw,this]}}class O{constructor(i){l(this,"name");l(this,"show",new M);l(this,"overlays",new Set);l(this,"mainCanvas");l(this,"notifyReload");this.name=i}equalsMainCanvas(i){return this.mainCanvas===i}setMainCanvas(i){var t;this.mainCanvas=i,this.overlays.forEach(s=>s.setMainCanvas(i)),i&&this.overlays.size&&((t=this.notifyReload)==null||t.call(this))}setNotifyReload(i){this.notifyReload=i?t=>{var s;(t||this.show.shouldRender((s=this.mainCanvas)==null?void 0:s.scale)&&this.overlays.size)&&i()}:void 0,this.overlays.forEach(t=>t.setNotifyReload(this.notifyReload)),this.show.notifyReload=this.notifyReload}addOverlays(i){var t;[i].flat().forEach(s=>{s.setNotifyReload(this.notifyReload),s.setMainCanvas(this.mainCanvas),this.overlays.add(s)}),(t=this.notifyReload)==null||t.call(this)}hasOverlay(i){return this.overlays.has(i)}removeOverlays(i){var t;[i].flat().forEach(s=>{this.overlays.delete(s),s.setNotifyReload(),s.setMainCanvas()}),(t=this.notifyReload)==null||t.call(this)}clearOverlays(){var i;(i=this.notifyReload)==null||i.call(this),this.overlays.forEach(t=>{t.setNotifyReload(),t.setMainCanvas()}),this.overlays.clear()}getOverlays(){var t;const i=[];if(this.show.shouldRender((t=this.mainCanvas)==null?void 0:t.scale)&&this.overlays.size){let s=1;Array.from(this.overlays.values()).sort((e,n)=>e.zIndex-n.zIndex).forEach(e=>{if(e.equalsMainCanvas(this.mainCanvas)){const n=e.getDraw();n&&i.push([(Number(e.zIndex)||0)+s++,n])}else this.overlays.delete(e)})}return i}}class S{constructor(i){l(this,"name");l(this,"show",new M);l(this,"opacity",1);l(this,"zIndex",4);l(this,"canvas",document.createElement("canvas"));l(this,"ctx",this.canvas.getContext("2d"));l(this,"isReload",!1);l(this,"groups",new Map);l(this,"mainCanvas");l(this,"notifyReload");l(this,"currentDrawOverlays",[]);this.name=i}equalsMainCanvas(i){return this.mainCanvas===i}setMainCanvas(i){var t,s;this.mainCanvas=i,this.canvas.width=((t=i==null?void 0:i.rect)==null?void 0:t.value.width)||0,this.canvas.height=((s=i==null?void 0:i.rect)==null?void 0:s.value.height)||0,this.groups.forEach(e=>e.setMainCanvas(i))}setNotifyReload(i){this.notifyReload=i?t=>{var s;(t||this.show.shouldRender((s=this.mainCanvas)==null?void 0:s.scale)&&this.groups.size)&&i()}:void 0,this.groups.forEach(t=>t.setNotifyReload(i?()=>{var s;(s=this.notifyReload)==null||s.call(this),this.isReload=!0}:void 0)),this.show.notifyReload=this.notifyReload}getGroup(i){return this.groups.get(i)}addGroup(i){[i].flat().forEach(t=>{t instanceof O&&(t.setNotifyReload(this.notifyReload),t.setMainCanvas(this.mainCanvas),this.groups.set(t.name,t))})}removeGroup(i){var s;let t=!1;[i].flat().forEach(e=>{e instanceof O&&(this.groups.delete(e.name),e.setNotifyReload(),e.setMainCanvas(),t=!0)}),t&&((s=this.notifyReload)==null||s.call(this))}clearGroup(){var i;this.groups.size&&(this.groups.forEach(t=>{t.setNotifyReload(),t.setMainCanvas()}),this.groups.clear(),(i=this.notifyReload)==null||i.call(this))}setzIndex(i){var t;i!=this.zIndex&&(this.zIndex=i,(t=this.notifyReload)==null||t.call(this,!1))}setOpacity(i){var t;this.opacity!=i&&(i>=0&&i<=1?(this.opacity=i,(t=this.notifyReload)==null||t.call(this,!1)):console.warn("Opacity value should be between 0 and 1."))}getCanvas(){if(!this.mainCanvas)return;const{scale:i,rect:t,isRecalculate:s,isThemeUpdated:e}=this.mainCanvas,n=this.show.shouldRender(i),a=this.groups.size;if(n&&a){if(this.isReload||s||e){this.currentDrawOverlays=[],this.isReload=!1,this.canvas.width=(t==null?void 0:t.value.width)||0,this.canvas.height=(t==null?void 0:t.value.height)||0;const o=[];this.groups.forEach(r=>{r.equalsMainCanvas(this.mainCanvas)?o.push(...r.getOverlays()):this.groups.delete(r.name)}),o.sort((r,h)=>r[0]-h[0]),o.forEach(([r,[h,c]])=>{h.call(c,this.ctx),this.currentDrawOverlays.push([[Number(this.zIndex)||0,r],c])})}return[Number(this.zIndex)||0,this.canvas,this.currentDrawOverlays]}}}class D{constructor(i){l(this,"name");l(this,"show",new M);l(this,"layers",new Map);l(this,"mainCanvas");l(this,"notifyReload");this.name=i}setMainCanvas(i){this.mainCanvas=i,this.layers.forEach(t=>t.setMainCanvas(i))}setNotifyReload(i){this.notifyReload=i?t=>{var s;(t||this.show.shouldRender((s=this.mainCanvas)==null?void 0:s.scale)&&this.layers.size)&&i()}:void 0,this.layers.forEach(t=>t.setNotifyReload(this.notifyReload)),this.show.notifyReload=this.notifyReload}getLayer(i){return this.layers.get(i)}addLayer(i){[i].flat().forEach(t=>{t instanceof S&&(t.setNotifyReload(this.notifyReload),t.setMainCanvas(this.mainCanvas),this.layers.set(t.name,t))})}removeLayer(i){var s;let t=!1;[i].flat().forEach(e=>{e instanceof S&&(this.layers.delete(e.name),e.setNotifyReload(),e.setMainCanvas(),t=!0)}),t&&((s=this.notifyReload)==null||s.call(this))}clearLayers(){var i;this.layers.size&&(this.layers.forEach(t=>{t.setNotifyReload(),t.setMainCanvas()}),this.layers.clear(),(i=this.notifyReload)==null||i.call(this))}fetchCanvas(){var i;if(this.show.shouldRender((i=this.mainCanvas)==null?void 0:i.scale)&&this.layers.size){const t=[];return this.layers.forEach(s=>{if(s.equalsMainCanvas(this.mainCanvas)){const e=s.getCanvas();e&&t.push(e)}else this.layers.delete(s.name)}),t}return[]}}class W{constructor(i){l(this,"canvas");l(this,"ctx");l(this,"rect");l(this,"offset",{x:0,y:0});l(this,"center",{x:0,y:0});l(this,"defaultCenter",{top:void 0,bottom:void 0,left:void 0,right:void 0});l(this,"lockDragAndResize",!1);l(this,"accuracy",5);l(this,"scale",1);l(this,"percentage",1);l(this,"axisConfig",{count:2,min:100,max:200,size:100,x:1,y:1});l(this,"cycle",10);l(this,"delta",.02);l(this,"redrawInNextRenderFrame",!1);l(this,"isAuto",!1);l(this,"isRendering",!1);l(this,"drawAxis");l(this,"layerGroups",new Map);l(this,"nowGridCount");const t=document.getElementById(i);if(t instanceof HTMLCanvasElement)if(t.getContext){this.canvas=t,this.ctx=t.getContext("2d"),this.rect=(n=>{let a=!0;Promise.resolve().then(()=>a=!1);const o={value:n.getBoundingClientRect()};return new Proxy(o,{get(r,h){return h=="value"?(a||(r.value=n.getBoundingClientRect(),a=!0,Promise.resolve().then(()=>a=!1)),r.value):r[h]},set(){return!1}})})(t);const{clientWidth:s,clientHeight:e}=t;[t.width,t.height]=[s,e]}else throw new Error("canvas-unsupported code here");else throw new Error("canvas is not HTMLCanvasElement")}updateCenter(){const{canvas:i,rect:t,offset:s,defaultCenter:e}=this;if(!i)return console.error("canvas is not HTMLCanvasElement");const{width:n,height:a}=t.value,{top:o,bottom:r,left:h,right:c}=e,f={vertical:(u,v)=>{if([0,"0","0%"].includes(u))return 0;if(!(u==1/0||u==-1/0))return typeof u=="number"?u:["top","left"].includes(u)?0:["bottom","right"].includes(u)?v:["middle","center"].includes(u)?v/2:/^(\d+)%$/.test(u)?(u=u.match(/^(\d+)%$/)[1],v*Number(u)/100):Number(u)||void 0},reverse:(u,v)=>{if([0,"0","0%"].includes(u))return v;if(u==1/0||u==-1/0)return;if(typeof u=="number")return v-u;const w=f.vertical(u,v);return w?v-w:void 0}},d=(u,v,w)=>{if(u!==void 0){const g=f.vertical(u,w);if(g!==void 0)return g}if(v!==void 0){const g=f.reverse(v,w);if(g!==void 0)return g}return w/2},y=d(o,r,a),m=d(h,c,n);this.center={x:Math.floor(m+s.x),y:Math.floor(y+s.y)}}updateSize(){const{scale:i,cycle:t,delta:s,axisConfig:e}=this;let n=Math.abs(i-1)%(t*s)/s;n=Math.round(i<1?t-n:n),e.size=n/t*(e.max-e.min)+e.min,this.percentage=this.getAxisPointByValue(e.count,0).x/e.min}setScale(i,t){const{canvas:s,lockDragAndResize:e,axisConfig:n}=this,a=this.rect.value;if(e)return;if(!s||!a)return console.error("canvas is not HTMLCanvasElement");let o,r;i==="center"?(o=a.left+a.width/2,r=a.top+a.height/2):[o,r]=[i.clientX,i.clientY];const h=this.getMousePositionOnAxis({clientX:o,clientY:r}),c=this.getAxisValueByPoint(h.x,h.y);this.scale=this.preservePrecision(this.scale+t),this.updateSize();const f=this.getAxisPointByValue(c.xV,c.yV);this.offset.x-=(f.x-h.x)*n.x,this.offset.y-=(f.y-h.y)*n.y}setAxis(i){const t={...this.axisConfig,...i},s=Object.fromEntries(Object.entries(t).map(([u,v])=>[u,Number(v)])),{x:e,y:n,count:a,min:o,max:r,size:h}=s,c=[1,-1].includes(e),f=[1,-1].includes(n),d=a>0,y=o>0&&o<r,m=h>=o&&h<=r;if(!c||!f||!d||!y||!m){console.warn("Invalid axis configuration:",{x:e,y:n,count:a,min:o,max:r,size:h});return}this.axisConfig=s}setDefaultCenter(i){Object.assign(this.defaultCenter,i)}getGridCount(){const{axisConfig:i,scale:t,cycle:s,delta:e,nowGridCount:n,isRendering:a}=this,o=i.count;if(n&&a)return n;const r=s*e;if(t===1)this.nowGridCount=o;else if(t>1)this.nowGridCount=o/Math.pow(2,Math.floor((t-1)/r));else{const h=(1-t)/r;this.nowGridCount=o*Math.pow(2,Number.isInteger(h)?h+1:Math.ceil(h))}return a&&Promise.resolve().then(()=>this.nowGridCount=void 0),this.nowGridCount}getMousePositionOnAxis(i){const{canvas:t,center:s,rect:e,axisConfig:n}=this;if(!t)return console.error("canvas is not HTMLCanvasElement");const{clientX:a,clientY:o}=i,{left:r,top:h}=e.value,c=(a-r-s.x)*n.x,f=(o-h-s.y)*n.y;return{x:c,y:f}}getAxisValueByPoint(i,t,s){const{axisConfig:e}=this;if(s)return{xV:i/e.min*e.count,yV:t/e.min*e.count};const n=this.getGridCount(),a=this.preservePrecision(i/e.size*n),o=this.preservePrecision(t/e.size*n);return{xV:a,yV:o}}getAxisPointByValue(i,t,s){const{axisConfig:e}=this;if(s)return{x:i/e.count*e.min,y:t/e.count*e.min};const n=this.getGridCount(),a=this.preservePrecision(i/n*e.size,3),o=this.preservePrecision(t/n*e.size,3);return{x:a,y:o}}getMaxMinValue(i){i=i||this.rect.value;const{left:t,top:s,right:e,bottom:n}=i,{axisConfig:a}=this,{x:o,y:r}=this.getMousePositionOnAxis({clientX:a.x==1?t:e,clientY:a.y==1?s:n}),{xV:h,yV:c}=this.getAxisValueByPoint(o,r),{x:f,y:d}=this.getMousePositionOnAxis({clientX:a.x==1?e:t,clientY:a.y==1?n:s}),{xV:y,yV:m}=this.getAxisValueByPoint(f,d);return{minXV:h,maxXV:y,minYV:c,maxYV:m}}preservePrecision(i,t){return P.preservePrecision(i,t||this.accuracy)}transformPosition(i){const{center:t,percentage:s,axisConfig:e}=this,n=[];for(let a=0;a<i.length;a++){let[o,r]=i[a];o=t.x+o*s*e.x,r=t.y+r*s*e.y,n.push([o,r])}return n}}class _ extends W{constructor(t){super(t);l(this,"theme","light");l(this,"isThemeUpdated",!1);l(this,"style",{light:{background:"#fff",text:{color:"#222",secondary:"#909399",stroke:"#fff",size:12,family:"monospace",bold:!0},grid:{axis:"#222",grid:"#666",innerGrid:"#e5e5e5"},point:{radius:5,fill:"#d03050",width:14,stroke:"#d0305080"},line:{color:"#f0a020",width:4,dash:!1,dashGap:[5,10],dashOffset:0,cap:"round",join:"round",point:{radius:5,stroke:"#f0a02080",width:14,fill:"#f0a020"}},polygon:{fill:"#18a05830",stroke:"#18a058",fill_hover:"#03693360",stroke_hover:"#036933",width:1,dash:!1,dashGap:[5,10],dashOffset:0}},dark:{background:"#000",text:{color:"#aeaeae",secondary:"#8c8c8c",stroke:"#000",size:12,family:"monospace",bold:!0},grid:{axis:"#aeaeae",grid:"#666",innerGrid:"#454545"},point:{radius:5,fill:"#e88080",width:14,stroke:"#e8808070"},line:{color:"#f2c97d",width:4,dash:!1,dashGap:[5,10],dashOffset:0,cap:"round",join:"round",point:{radius:5,stroke:"#f2c97d80",width:14,fill:"#f2c97d"}},polygon:{fill:"#63e2b730",stroke:"#63e2b7",fill_hover:"#7efbd160",stroke_hover:"#7efbd1",width:1,dash:!1,dashGap:[5,10],dashOffset:0}}});this.initStyle(),this.clearScreen()}initStyle(){const{canvas:t,ctx:s,theme:e}=this;t.classList.add("_nhanh_canvas");const n=this.style[e];s.font=`${n.text.bold?"bold":""} ${n.text.size}px ${n.text.family}`}clearScreen(){const{ctx:t,theme:s,rect:e}=this,{width:n,height:a}=e.value;t.fillStyle=this.style[s].background,t.fillRect(0,0,n,a)}setStyle(t){for(const s in t)if(Object.prototype.hasOwnProperty.call(t,s)){const e=T(this.style[s]||this.style[this.theme]);H(e,t[s]),this.style[s]=e}this.initStyle()}setTheme(t){t in this.style&&(this.theme=t,this.isThemeUpdated=!0)}}class j extends _{constructor(t){super(t);l(this,"resizeObserver");l(this,"currentDrawOverlays",[]);l(this,"rely","");l(this,"isRecalculate",!1);l(this,"notifyReload");l(this,"maxMinValue",{minXV:0,maxXV:0,minYV:0,maxYV:0});l(this,"measureRedrawPerformance",X(()=>this.redraw(),[[1,"#F56C6C"],[.5,"#E6A23C"],[0,"#67C23A"]]));this.canvas&&(this.resizeObserver=new ResizeObserver(B(()=>{const s=this.rect.value;[this.canvas.width,this.canvas.height]=[s.width,s.height],this.redrawOnce()},200)),this.resizeObserver.observe(this.canvas)),this.updateRely(),this.isRecalculate=!1}updateRely(){const{center:t,scale:s,rect:e,axisConfig:n}=this,a=[t.x,t.y,s,JSON.stringify(n),e.value.width,e.value.height].join();this.isRecalculate=this.rely!==a,this.rely=a}redraw(){var e;if(!this.canvas)return console.error("canvas is not HTMLCanvasElement");if(this.canvas.clientWidth==0||this.canvas.clientHeight==0)return console.error("The image argument is a canvas element with a width or height of 0.");this.updateCenter(),this.updateRely(),this.maxMinValue=this.getMaxMinValue(),this.clearScreen();const t=[];let s=[[0,()=>{var n;return(n=this.drawAxis)==null?void 0:n.drawAxisAndGrid()},[]]];this.layerGroups.forEach(n=>s=s.concat(n.fetchCanvas())),s.sort((n,a)=>n[0]-a[0]),s.forEach(([,n,a],o)=>{typeof n=="function"?n():this.ctx.drawImage(n,0,0),a.forEach(([[r,h],c])=>{t.push([[r+o,h],c])})}),t.sort(([[n,a],o],[[r,h],c])=>{if(n!==r)return r-n;if(a!==h)return h-a;const f=d=>d instanceof I?0:d instanceof b?1:d instanceof A?2:d instanceof k?3:d instanceof V?4:5;return f(c)-f(o)}),this.currentDrawOverlays=t.map(([,n])=>n),this.isRecalculate=!1,this.isThemeUpdated=!1,(e=this.notifyReload)==null||e.call(this)}redrawOnce(t){this.isAuto&&!t&&(this.isAuto=!1),this.redrawInNextRenderFrame||(this.redrawInNextRenderFrame=!0,Promise.resolve().then(()=>{this.isRendering=!0,this.redrawInNextRenderFrame=!1,this.measureRedrawPerformance(),this.isRendering=!1}))}findOverlayByPoint(t,s){return this.currentDrawOverlays.find(e=>e.isPointInAnywhere(t,s))}destroy(){var t;(t=this.resizeObserver)==null||t.disconnect()}}class F extends j{constructor(t){super(t);l(this,"mouseInCanvas",!1);l(this,"mouseIsDown",!1);l(this,"mouseLastPosition",{x:0,y:0});l(this,"unBind");l(this,"lastClickedOverlay");l(this,"lastPressedKey",{key:"",keyupTime:0,dblclick:!1});l(this,"lastDownOverlay");l(this,"lastHoverOverlay");l(this,"oldClientX",[]);l(this,"oldClientY",[]);this.initEvent()}initEvent(){const{canvas:t}=this;if(!t)return console.error("canvas is not HTMLCanvasElement");const s=[{type:"click",handler:this.click.bind(this)},{type:"contextmenu",handler:this.contextmenu.bind(this)},{type:"mouseenter",handler:this.mouseenter.bind(this)},{type:"mouseleave",handler:this.mouseleave.bind(this)},{type:"keydown",handler:this.keydown.bind(this),target:window},{type:"keyup",handler:this.keyup.bind(this),target:window},{type:"wheel",handler:this.wheel.bind(this)},{type:"mousedown",handler:this.mousedown.bind(this)},{type:"mouseup",handler:this.mouseup.bind(this),target:window},{type:"mousemove",handler:this.mousemove.bind(this),target:window},{type:"touchend",handler:this.touchend.bind(this)},{type:"touchmove",handler:this.touchmove.bind(this)}];s.forEach(({type:e,handler:n,target:a=t})=>{a.addEventListener(e,n)}),this.unBind=()=>{s.forEach(({type:e,handler:n,target:a=t})=>{a.removeEventListener(e,n)})}}click(t){var e;const s=this.findOverlayByPoint(t.offsetX,t.offsetY);this.lastClickedOverlay!=s&&((e=this.lastClickedOverlay)==null||e.notifyClick(!1)),s==null||s.notifyClick(!0),this.lastClickedOverlay=s}contextmenu(t){var s;t.preventDefault(),console.log("mousecontextmenu"),(s=this.lastClickedOverlay)==null||s.notifyClick(!1),this.lastClickedOverlay=void 0}mouseenter(t){this.mouseInCanvas=!0}mouseleave(t){this.mouseInCanvas=!1}getStep(t){const{lastPressedKey:s}=this;return s.dblclick?4:s.key===t&&Date.now()-s.keyupTime<300?(s.dblclick=!0,4):1}keydown(t){const{mouseInCanvas:s,offset:e,delta:n,lockDragAndResize:a}=this;if(s&&!a){const o=t.key,r=this.getStep(o);switch(o){case"ArrowUp":e.y-=r;break;case"ArrowDown":e.y+=r;break;case"ArrowLeft":e.x-=r;break;case"ArrowRight":e.x+=r;break;case"+":this.setScale("center",n);break;case"-":this.setScale("center",-n);break}["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","+","-"].includes(o)&&this.redrawOnce()}}keyup(t){const{mouseInCanvas:s,lastPressedKey:e}=this;if(s){const n=t.key;e.key=n,e.keyupTime=Date.now(),e.dblclick=!1}}wheel(t){t.preventDefault();const{delta:s,lockDragAndResize:e}=this;e||(this.setScale(t,t.deltaY<0?s:-s),this.redrawOnce())}mousedown(t){var a;this.mouseIsDown=!0;const{clientX:s,clientY:e}=t;this.mouseLastPosition={x:s,y:e};const n=this.findOverlayByPoint(t.offsetX,t.offsetY);this.lastDownOverlay!=n&&((a=this.lastDownOverlay)==null||a.notifyDown(!1)),n==null||n.notifyDown(!0),this.lastDownOverlay=n}mouseup(t){this.mouseIsDown=!1,this.lastDownOverlay=void 0}mousemove(t){var h,c;const{clientX:s,clientY:e}=t,{mouseIsDown:n,offset:a,mouseLastPosition:o,lockDragAndResize:r}=this;if(n){if(r)return;(h=this.lastDownOverlay)!=null&&h.draggable?this.lastDownOverlay.notifyDraggable(s-o.x,e-o.y):(a.x+=s-o.x,a.y+=e-o.y,this.redrawOnce()),this.mouseLastPosition={x:s,y:e}}else{const f=this.rect.value,d=s-f.x,y=e-f.y;if(d<0||y<0||d>f.width||y>f.height)return;const m=this.findOverlayByPoint(t.offsetX,t.offsetY);this.lastHoverOverlay!=m&&((c=this.lastHoverOverlay)==null||c.notifyHover(!1)),this.lastHoverOverlay=m,this.lastHoverOverlay?(this.lastHoverOverlay.notifyHover(!0),this.canvas.classList.add("_nhanh_canvas_hover_overlay")):this.canvas.classList.remove("_nhanh_canvas_hover_overlay")}}touchend(t){this.oldClientX=this.oldClientY=[]}touchmove(t){const s=t.touches;t.preventDefault();const{oldClientX:e,oldClientY:n,offset:a,delta:o,lockDragAndResize:r}=this;if(!r){if(s.length===1){const{clientX:h,clientY:c}=s[0];e.length&&(a.x+=h-e[0],a.y+=c-n[0],this.redrawOnce()),this.oldClientX=[h],this.oldClientY=[c]}else if(s.length===2){const{clientX:h,clientY:c}=s[0],{clientX:f,clientY:d}=s[1];if(e.length==2){const y=L(e[0],n[0],e[1],n[1]),m=L(h,c,f,d),{x:u,y:v}=Y(h,c,f,d);this.setScale({clientX:u,clientY:v},m>y?o:-o),this.redrawOnce()}this.oldClientX=[h,f],this.oldClientY=[c,d]}}}destroy(){var t;super.destroy(),(t=this.unBind)==null||t.call(this)}}class U extends F{getDefaultOverlayGroup(){var o,r,h,c,f;const i=this.layerGroups.get("默认图层群组");if(!i)return;const t=(o=i.getLayer("点位图层"))==null?void 0:o.getGroup("点位覆盖物群组"),s=(r=i.getLayer("线段图层"))==null?void 0:r.getGroup("线段覆盖物群组"),e=(h=i.getLayer("多边形图层"))==null?void 0:h.getGroup("多边形覆盖物群组"),n=(c=i.getLayer("文字图层"))==null?void 0:c.getGroup("文字覆盖物群组"),a=(f=i.getLayer("自定义绘制图层"))==null?void 0:f.getGroup("自定义绘制覆盖物群组");return{overlays_text:n,overlays_point:t,overlays_line:s,overlays_polygon:e,overlays_custom:a}}reset(){if(this.lockDragAndResize)return;this.isAuto=!0;const i=300,t={offset:{...this.offset},scale:this.scale-1};z(s=>{!this.isAuto||!this.canvas||this.lockDragAndResize||(s===1?(this.offset={x:0,y:0},this.scale=1,this.updateSize(),this.isAuto=!1):s>0&&(s=1-s,this.offset={x:t.offset.x*s,y:t.offset.y*s},this.scale=1+t.scale*s,this.updateSize()),this.redrawOnce(!0))},i)}zoom(i){const{canvas:t,rect:s}=this;if(!t||!s)return console.error("canvas is not HTMLCanvasElement");this.setScale("center",i),this.redrawOnce()}zoomIn(){this.zoom(this.delta)}zoomOut(){this.zoom(-this.delta)}setStyle(i){super.setStyle(i),this.redrawOnce()}setTheme(i){super.setTheme(i),this.redrawOnce()}setAxis(i){super.setAxis(i),this.redrawOnce()}setDefaultCenter(i){super.setDefaultCenter(i),this.redrawOnce()}toggleAxis(i){const t=(()=>{if(typeof i=="object"){const{all:s=!0,grid:e={main:!0,secondary:!0},axis:n=!0,axisText:a=!0}=i;return Object.assign({main:!0,secondary:!0},e),{all:s,grid:e,axis:n,axisText:a}}return typeof i=="boolean"?{all:!0,grid:{main:i,secondary:i},axis:i,axisText:i}:!this.drawAxis.show.all})();typeof t=="boolean"?this.drawAxis.show.all=t:this.drawAxis.show=t,this.redrawOnce()}togglePoint(i){const{overlays_point:t}=this.getDefaultOverlayGroup()||{};return t?(t.show.setShow(i??!t.show),this.redrawOnce(),t.show):!1}toggleLine(i){const{overlays_line:t}=this.getDefaultOverlayGroup()||{};return t?(t.show.setShow(i??!t.show),this.redrawOnce(),t.show):!1}togglePolygon(i){const{overlays_polygon:t}=this.getDefaultOverlayGroup()||{};return t?(t.show.setShow(i??!t.show),this.redrawOnce(),t.show):!1}toggleLock(i){return this.lockDragAndResize=i??!this.lockDragAndResize,this.lockDragAndResize}}class R extends U{constructor(i,t){if(super(i),this.drawAxis=new N(this),t){const{theme:s,axisConfig:e,axisShow:n,defaultCenter:a}=t;s&&this.setTheme(s),e&&this.setAxis(e),n&&this.toggleAxis(n),a&&this.setDefaultCenter(a)}this.initLayerGroups(),this.updateCenter()}initLayerGroups(){const i=new S("多边形图层");i.addGroup(new O("多边形覆盖物群组")),i.setzIndex(1);const t=new S("线段图层");t.addGroup(new O("线段覆盖物群组")),t.setzIndex(2);const s=new S("点位图层");s.addGroup(new O("点位覆盖物群组")),s.setzIndex(3);const e=new S("文字图层");e.addGroup(new O("文字覆盖物群组")),e.setzIndex(4);const n=new S("自定义绘制图层");n.addGroup(new O("自定义绘制覆盖物群组")),n.setzIndex(5);const a=new D("默认图层群组");a.addLayer([e,s,t,i,n]),this.setLayerGroups(a)}gteLayerGroups(i){return this.layerGroups.get(i)}setLayerGroups(i){i instanceof D&&(this.layerGroups.set(i.name,i),i.setNotifyReload(()=>this.redrawOnce()),i.setMainCanvas(this))}removeLayerGroups(i){i instanceof D&&(this.layerGroups.delete(i.name),i.setNotifyReload(),i.setMainCanvas(),this.redrawOnce())}addLayer(i){const t=this.layerGroups.get("默认图层群组");t&&t.addLayer([i].flat())}removeLayer(i){const t=this.layerGroups.get("默认图层群组");t&&t.removeLayer([i].flat())}addOverlay(i){const{overlays_text:t,overlays_point:s,overlays_line:e,overlays_polygon:n,overlays_custom:a}=this.getDefaultOverlayGroup()||{};[i].flat().forEach(o=>{o instanceof b?t==null||t.addOverlays(o):o instanceof A?s==null||s.addOverlays(o):o instanceof k?e==null||e.addOverlays(o):o instanceof V?n==null||n.addOverlays(o):o instanceof I&&(a==null||a.addOverlays(o))})}removeOverlay(i){const{overlays_text:t,overlays_point:s,overlays_line:e,overlays_polygon:n,overlays_custom:a}=this.getDefaultOverlayGroup()||{};[i].flat().forEach(o=>{o instanceof b?t==null||t.removeOverlays(o):o instanceof A?s==null||s.removeOverlays(o):o instanceof k?e==null||e.removeOverlays(o):o instanceof V?n==null||n.removeOverlays(o):o instanceof I&&(a==null||a.addOverlays(o))})}destroy(){super.destroy()}}l(R,"LayerGroup",D),l(R,"Layer",S),l(R,"OverlayGroup",O),l(R,"Text",b),l(R,"Point",A),l(R,"Line",k),l(R,"Polygon",V),l(R,"Custom",I);export{R as _};
